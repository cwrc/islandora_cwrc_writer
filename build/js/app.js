/*! For license information please see app.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("$rdf")):"function"==typeof define&&define.amd?define(["$rdf"],t):"object"==typeof exports?exports.GitWriter=t(require("$rdf")):e.GitWriter=t(e.$rdf)}(window,(function(__WEBPACK_EXTERNAL_MODULE__233__){return function(e){function t(t){for(var i,r,s=t[0],l=t[1],c=t[2],u=0,p=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&p.push(a[r][0]),a[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(d&&d(t);p.length;)p.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,s=1;s<n.length;s++){var l=n[s];0!==a[l]&&(i=!1)}i&&(o.splice(t--,1),e=r(r.s=n[0]))}return e}var i={},a={0:0},o=[];function r(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=i,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var s=window.webpackJsonpGitWriter=window.webpackJsonpGitWriter||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var d=l;return o.push([191,1]),n()}([,,function(e,t,n){"use strict";var i=n(1);n(13),n(32),n(6),n(178),n(20);var a=n(33);function o(e){this.w=e.writer,this.$el=e.$el;var t=e.title,n=e.height||650,o=e.width||575;this.showConfig,this.cwrcWriter,this.cwrcWriterConfig=e.cwrcWriterConfig,this.isValid=!0,this.type=e.type,this.mode=null,this.currentData={attributes:{},properties:{},customValues:{}},this.currentId=null,this.$el.dialog({title:t,modal:!0,resizable:!0,dialogClass:"splitButtons",closeOnEscape:!1,open:i.proxy((function(e,t){this.$el.parent().find(".ui-dialog-titlebar-close").hide()}),this),height:n,width:o,position:{my:"center",at:"center",of:this.w.layoutManager.getContainer()},autoOpen:!1,buttons:[{text:"Cancel",role:"cancel",click:i.proxy((function(){this.$el.trigger("beforeCancel"),this.$el.trigger("beforeClose"),this.$el.dialog("close")}),this)},{text:"Ok",role:"ok",click:i.proxy((function(){this.save()}),this)}]}),i("[data-transform]",this.$el).each(function(e,t){var n=i(t);switch(n.data("transform")){case"buttonset":n.controlgroup();break;case"accordion":n.accordion({heightStyle:"content",animate:!1,collapsible:!0,active:!1});break;case"selectmenu":n.selectmenu({appendTo:this.w.layoutManager.getContainer()})}}.bind(this)),i('[data-type="attributes"]',this.$el).first().each(function(e,t){this.attributesWidget=new a({writer:this.w,$parent:this.$el,$el:i(t)}),this.attWidgetInit=!1}.bind(this))}o.ADD=0,o.EDIT=1,o.processForm=function(e){var t=e.currentData;if(1===i('[data-type="attributes"]',e.$el).length){var n=e.attributesWidget.getData();i.extend(t.attributes,n)}for(var a in i("[data-type]",e.$el).not('[data-type="attributes"]').each((function(e,n){var a=i(this);if(1===a.parents(".cwrcDialogWrapper").length){var o=a.data("type"),r=a.data("mapping");if(void 0!==r){var s="attributes",l=0===r.indexOf("custom."),c=0===r.indexOf("prop.");switch(l?(r=r.replace(/^custom\./,""),s="customValues"):c&&(r=r.replace(/^prop\./,""),s="properties"),o){case"radio":var d=a.find("input:checked").val();t[s][r]=d;break;case"textbox":case"hidden":case"select":d=a.val();t[s][r]=d}}}})),t.attributes)void 0!==t.attributes[a]&&""!==t.attributes[a]||delete t.attributes[a]},o.populateForm=function(e){var t=e.currentData;i("[data-type]",e.$el).filter((function(e,t){return 1===i(t).parents(".cwrcWrapper").length})).each((function(n,a){var o=i(this),r=o.data("type");if("attributes"===r){e.attributesWidget.setData(t.attributes)&&e.attributesWidget.expand()}else{var s=o.data("mapping");if(void 0!==s){var l,c=0===s.indexOf("custom."),d=0===s.indexOf("prop.");if(c?(s=s.replace(/^custom\./,""),l=t.customValues[s]):d?(s=s.replace(/^prop\./,""),l=t.properties[s]):l=t.attributes[s],void 0!==l)switch(r){case"select":o.val(l),"selectmenu"===o.data("transform")&&o.selectmenu("refresh"),o.parents('[data-transform="accordion"]').accordion("option","active",0);break;case"radio":i('input[value="'+l+'"]',o).prop("checked",!0),"buttonset"===o.data("transform")&&i("input",o).button("refresh");break;case"textbox":o.val(l);break;case"label":o.html(l)}}}}))},o.prototype={constructor:o,show:function(e){var t=this;this.showConfig=e,this.mode=e.entry?o.EDIT:o.ADD,null!=this.attributesWidget&&(!1===this.attWidgetInit&&function(e,t){var n;n=t.entry?t.entry.tag:e.w.schemaManager.mapper.getParentTag(e.type);var i=e.w.schemaManager.getAttributesForTag(n);e.attributesWidget.buildWidget(i),e.attWidgetInit=!0}(this,e),this.attributesWidget.reset()),i("[data-type]",this.$el).each((function(e,t){var n=i(this);switch(n.data("type")){case"radio":n.find("input").prop("checked",!1),n.find("[data-default]").prop("checked",!0),"buttonset"===n.data("transform")&&i("input",n).button("refresh");break;case"textbox":case"select":n.val(""),"selectmenu"===n.data("transform")&&n.selectmenu("refresh");break;case"label":n.empty()}})),i('[data-transform="accordion"]',this.$el).each((function(e,t){i(this).accordion("option","active",!1)})),this.$el.one("beforeClose",(function(e){e.stopPropagation()})),this.$el.one("beforeSave",(function(e){e.stopPropagation()})),this.currentData={attributes:{},properties:{},customValues:{}};var n=this.w.schemaManager.mapper.getMappedProperties(this.type);if(this.mode===o.ADD)i.extend(this.currentData.properties,e.properties),n.forEach((function(e){var n=t.currentData.properties[e],i=t.w.schemaManager.mapper.getAttributeForProperty(t.type,e);void 0!==n&&void 0!==i&&(t.currentData.attributes[i]=n)}));else if(this.mode===o.EDIT){this.currentId=e.entry.getId();var a=Object.assign({},e.entry.getAttributes());for(var r in a)a[r]=this.w.utilities.unescapeHTMLString(a[r]);var s=JSON.parse(JSON.stringify(e.entry.getCustomValues()));for(var r in s){var l=s[r];if(i.isArray(l))for(var c=0;c<l.length;c++)s[r][c]=this.w.utilities.unescapeHTMLString(l[c]);else if(i.isPlainObject(l))for(var d in l)s[r][d]=this.w.utilities.unescapeHTMLString(l[d]);else s[r]=this.w.utilities.unescapeHTMLString(l)}this.currentData.attributes=a,this.currentData.customValues=s,this.currentData.properties={tag:e.entry.tag,type:e.entry.type},n.forEach((function(n){t.currentData.properties[n]=e.entry[n]}))}o.populateForm(this),this.$el.trigger("beforeShow",[e,this]),this.$el.dialog("open")},save:function(){o.processForm(this),this.$el.trigger("beforeSave",[this]),!0===this.isValid&&(this.$el.trigger("beforeClose"),this.$el.dialog("close"),this.mode===o.EDIT&&null!=this.currentData?this.w.tagger.editEntity(this.currentId,this.currentData):this.w.tagger.finalizeEntity(this.type,this.currentData),this.$el.trigger("save",[this]))},destroy:function(){null!=this.attributesWidget&&this.attributesWidget.destroy(),null!=this.cwrcWriter&&this.cwrcWriter.destroy(),i("[data-transform]",this.$el).each((function(e,t){var n=i(t);if(Object.keys(n.data()).find((function(e){return 0===e.indexOf("ui")})))switch(n.data("transform")){case"buttonset":n.controlgroup("destroy");break;case"accordion":n.accordion("destroy");break;case"selectmenu":n.selectmenu("destroy")}})),this.$el.remove()}},e.exports=o},,,,,,,function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(1);n(17);function o(e){this.w=e.writer,this.currentMappingsId=void 0,this.mappings={empty:n(229),tei:n(230),teiLite:n(231),orlando:n(232),cwrcEntry:n(235)}}o.reservedAttributes={_entity:!0,_type:!0,_tag:!0,_textallowed:!0,_note:!0,_candidate:!0,_attributes:!0,id:!0,name:!0,class:!0,style:!0},o.getAttributeString=function(e){var t="";for(var n in e){var i=e[n];void 0!==i&&""!==i&&(t+=" "+n+'="'+i+'"')}return t},o.getTagAndDefaultAttributes=function(e,t){t=void 0===t||t;var n=Object.assign({},e.getAttributes());for(var i in n)o.reservedAttributes[i]&&delete n[i];var a="<"+e.getTag();return a+=o.getAttributeString(n),t&&(a+=">"),a},o.getDefaultMapping=function(e){return[o.getTagAndDefaultAttributes(e),"</"+e.getTag()+">"]},o.xmlToString=function(e){var t="";try{t=window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e)}catch(e){alert(e)}return t},o.prototype={constructor:o,loadMappings:function(e){this.clearMappings(),this.currentMappingsId=e;var t=this.getMappings();if(void 0!==t.listeners)for(var n in t.listeners)this.w.event(n).subscribe(t.listeners[n])},clearMappings:function(){var e=this.getMappings();if(void 0!==e.listeners)for(var t in e.listeners)this.w.event(t).unsubscribe(e.listeners[t])},getMappings:function(){return void 0!==this.currentMappingsId?this.mappings[this.currentMappingsId]:this.mappings.empty},getMapping:function(e){var t=e.getType(),n=this.getMappings().entities[t];return n.mappingFunction?n.mappingFunction(e):o.getDefaultMapping(e)},getReverseMapping:function(e,t){function n(e,t){var i,a=this.w.utilities.evaluateXPath(e,t);if(null!==a){if(a.nodeType)switch(a.nodeType){case Node.ELEMENT_NODE:i=o.xmlToString(a);break;case Node.TEXT_NODE:i=a.textContent;break;case Node.ATTRIBUTE_NODE:i=a.value}else if("string"==typeof a){i=a;var r=/^local-name\((.*)\)$/.exec(t);if(null!==r){r=r[1];var s=n.call(this,e,r);void 0===s?(console.warn("mapper.getReverseMapping.getValueFromXPath: cannot get match for unrecognizable xpath",t),a=void 0):a=s.match}else console.warn("mapper.getReverseMapping.getValueFromXPath: cannot get match for unrecognizable xpath",t)}return{value:i,match:a}}}t=void 0!==t&&t;var r=e.ownerDocument===this.w.editor.getDoc(),s=this.getEntityTypeForTag(e);if(null===s)return{};var l=this.getMappings().entities[s].mapping,c={attributes:{}};if(r?c.attributes=this.w.tagger.getAttributesForTag(e):a.map(e.attributes,(function(e){c.attributes[e.name]=e.value})),void 0!==l){for(var d in l)if("object"===i(l[d]))for(var u in c[d]={},l[d]){var p=l[d][u];void 0!==(g=n.call(this,e,p))&&(c[d][u]=g)}else if("string"==typeof l[d]){var g;p=l[d];void 0!==(g=n.call(this,e,p))&&(c[d]=g)}var f=this.getTextTag(s);!function(e,t,n,i,o){function r(e){var t;return t=n?e.getAttribute("_tag"):e.nodeName,Array.isArray(i)?-1!==i.indexOf(t):t===i}function s(t){switch(t.nodeType){case Node.ATTRIBUTE_NODE:t.ownerElement!==e&&t.ownerElement.parentElement.removeChild(t.ownerElement);break;case Node.ELEMENT_NODE:t!==e&&(r(t)?a(t.firstChild).unwrap():t.parentElement.removeChild(t));break;case Node.TEXT_NODE:t.parentElement!==e&&(r(t.parentElement)?a(t).unwrap():a(t.parentElement).remove());break;default:console.warn("mapper.getReverseMapping.cleanupMappings: cannot remove node with unknown type",t)}}for(var l in t)if("attributes"!==l){var c=t[l];if(c.match)o&&s(c.match),t[l]=c.value;else for(var d in c){var u=c[d];u.match&&(o&&s(u.match),c[d]=u.value)}}}(e,c,r,f,t)}return c.type=s,c.isNote=this.isEntityTypeNote(s),c},getEntityTypeForTag:function(e){var t,n=!1;"string"==typeof e?t=e:(n=!0,t=e.ownerDocument===this.w.editor.getDoc()?e.getAttribute("_tag"):e.nodeName);var i=this.getMappings(),o=[];for(var r in i.entities){(l=Object.assign({},i.entities[r])).type=r,void 0!==l.xpathSelector?o.splice(0,0,l):o.push(l)}for(var s=0;s<o.length;s++){var l;if(void 0!==(l=o[s]).xpathSelector&&n){if(null!==this.w.utilities.evaluateXPath(e,l.xpathSelector))return l.type}else{var c=l.parentTag;if(a.isArray(c)&&-1!==c.indexOf(t)||c===t)return l.type}}return null},getMappingForProperty:function(e,t){var n=this.getMappings().entities[e];if(n.mapping&&n.mapping[t])return n.mapping[t]},getAttributeForProperty:function(e,t){var n=this.getMappingForProperty(e,t);if(void 0!==n&&/^@\w+$/.test(n))return n.slice(1)},getMappedProperties:function(e){var t=[],n=this.getMappings().entities[e];if(n.mapping)for(var i in n.mapping)"customValues"!==i&&t.push(i);return t},updatePropertiesFromAttributes:function(e){var t=e.getType(),n=this.getMappings().entities[t];if(n.mapping)for(var i in n.mapping)if("customValues"!==i){var a=n.mapping[i];if("string"==typeof a&&/^@\w+$/.test(a)){var o=a.slice(1),r=e.getAttribute(o);void 0!==r&&e.setProperty(i,r)}}},isEntityTypeNote:function(e){if(null==e)return!1;var t=this.getMappings().entities[e].isNote;return void 0!==t&&t},isNamedEntity:function(e){if(null==e)return!1;var t=this.getMappings().entities[e];return!(!t.mapping||!t.mapping.uri)},doesEntityRequireSelection:function(e){if(null==e)return!0;var t=this.getMappings().entities[e].requiresSelection;return void 0===t||t},convertTagToEntity:function(e,t){t=void 0!==t&&t;var n=this.getEntityTypeForTag(e);if(null!==n){var i=e.getAttribute("id"),o=this.isEntityTypeNote(n),r=this.isNamedEntity(n),s={id:i,tag:e.getAttribute("_tag"),type:n,isNote:o,isNamedEntity:r,range:{startXPath:this.w.utilities.getElementXPath(e)}},l=this.getReverseMapping(e,!0);if(a.extend(s,l),o){var c=a(e);s.content=c.text(),s.noteContent=c.html()}var d={_entity:!0,_type:n,class:"entity "+n+" start end",name:i};for(var u in o&&(d._note=!0),d)e.setAttribute(u,d[u]);o&&this.w.tagger.addNoteWrapper(e,n);var p=this.w.entitiesManager.addEntity(s);return t&&(!r||r&&void 0===p.getURI())&&this.w.dialogManager.show(n,{type:n,entry:p}),p}return console.warn("mapper.convertTagToEntity: tag "+e.getAttribute("_tag")+" cannot be converted to an entity!"),null},findEntities:function(e){e=void 0===e?["person","place","date","org","title","link"]:e;var t={},n=this.getHeaderTag(),i=this.getMappings().entities;for(var o in i)if(0==e.length||-1!=e.indexOf(o)){var r=[],s=i[o].parentTag;a.isArray(s)?r=r.concat(s):""!==s&&r.push(s),r=r.map((function(e){return'[_tag="'+e+'"]'}));var l=a(r.join(","),this.w.editor.getBody()).filter(function(e,t){if("true"===t.getAttribute("_entity"))return!1;if(0!==a(t).parents('[_tag="'+n+'"]').length)return!1;var i=this.getEntityTypeForTag(t);if(null===i)return!1;var o=this.getMappings().entities[i];return!o.mapping||!o.mapping.uri||null!==this.w.utilities.evaluateXPath(t,o.mapping.uri)}.bind(this));t[o]=a.makeArray(l)}return t},getParentTag:function(e){var t=this.getMappings().entities[e].parentTag;return void 0===t?"":(a.isArray(t)&&(t=t[0]),t)},getTextTag:function(e){return this.getMappings().entities[e].textTag},getRequiredAttributes:function(e){var t=this.getMappings().entities[e].requiredAttributes;return void 0===t?{}:t},getRootTags:function(){return this.getMappings().root},getHeaderTag:function(){return this.getMappings().header},getNamespace:function(){return this.getMappings().namespace},getIdAttributeName:function(){return this.getMappings().id},getResponsibilityAttributeName:function(){return this.getMappings().responsibility},getRdfParentSelector:function(){return this.getMappings().rdfParentSelector},getBlockLevelElements:function(){return this.getMappings().blockElements},getUrlAttributes:function(){return this.getMappings().urlAttributes||[]},getPopupAttributes:function(){return this.getMappings().popupAttributes||[]}},e.exports=o},function(e,t,n){var i=window.cwrcQuery;if(void 0===i){var a=window.jQuery;i=n(1),window.jQuery=i,n(211),window.jQuery=a,window.cwrcQuery=i}var o,r,s=n(358).BroadcastChannel;void 0!==s.default&&(s=s.default);var l,c=n(42),d=document.createElement("style");d.setAttribute("type","text/css"),d.appendChild(document.createTextNode('\n.panel-heading a {\n    cursor: pointer;\n}\n.panel-heading a:after {\n    font-family:\'Glyphicons Halflings\';\n    content:"\\e114";\n    float: right;\n    color: grey;\n    cursor: pointer;\n}\n.panel-heading a.collapsed:after {\n    content:"\\e080";\n}\n.list-group .list-group-item {\n    cursor: pointer;\n    float: none !important; /* islandora css conflict */\n}\n.list-group .list-group-item:hover {\n    color: #555;\n    text-decoration: none;\n    background-color: #f5f5f5;\n}\n.list-group .list-group-item.active a {\n    color: #fff;\n}\n.list-group-item .logo {\n    display: inline-block;\n    width: 30px;\n    height: 30px;\n    position: relative;\n    top: -23.5px;\n    float: right;\n    vertical-align: middle;\n    background-size: cover;\n    background-repeat: no-repeat;\n}\n')),document.querySelector("head").appendChild(d);var u="";var p="";var g="";var f=!0;var h=!0;var m=!0;var v=!1,y="cwrc-public-entity-dialogs-lookup-sources",b={entityType:void 0,entityLookupMethodName:void 0,entityLookupTitle:void 0,searchOptions:void 0},w=void 0;function _(e){if(void 0===e)i("#cwrc-entity-lookup [data-toggle=tooltip]").tooltip("destroy"),_("cwrc-entity-lookup"),_("cwrc-entity-lookup-edit-sources-dialog"),_("cwrc-title-entity-dialog");else{var t=i("#"+e);void 0!==t[0]&&(t.modal("hide").data("bs.modal",null),t[0].parentNode.removeChild(t[0]),"cwrc-entity-lookup"===e&&(o&&o.close(),T()))}}function x(e){_(),b.success(e)}function C(){k(i("#cwrc-entity-query").val())}function k(e){w=void 0,i(".cwrc-result-list").empty(),l[b.entityType].forEach((function(t,n){R(n)&&t[b.entityLookupMethodName](e).then((function(e){return function(e,t){var n=i("#cwrc-".concat(t,"-list"));0===e.length?n.append('<li class="list-group-item">No results</li>'):e.forEach((function(e,t){var a=e.description?"<div><b>".concat(e.name,"</b> - <i>").concat(e.description,"</i></div>"):"<div><b>".concat(e.name,"</b></div>");e.externalLink&&(a+='<div><a href="'.concat(e.externalLink,'" target="_blank">Open Full Description in New Tab/Window</a></div>')),e.logo&&(a+='<div class="logo" style="background-image: url('.concat(e.logo,')"></div>'));var o=i('<li class="list-group-item cwrc-result-item">'.concat(a,"</li>")).appendTo(n);i(o).on("click",(function(t){i(".cwrc-result-item",".cwrc-result-panel").removeClass("active"),w===e?w=void 0:(i(this).addClass("active"),w=e,e.uriForDisplay&&function(e,t,n){if(n.stopPropagation(),E){if(E[0]===t)return;T(),setTimeout(a,175)}else a();function a(){(E=i(t)).popover({animation:!1,trigger:"manual",html:!0,title:e.name,sanitize:!1,content:function(){return'<div id="entity-iframe-loading" style="width:38em">Loading...</div>\n            <iframe id="entity-iframe" src="'.concat(e.uriForDisplay,'" style="display:none;border:none;height:40em;width:38em"/>')}}),E.popover("show"),i("#entity-iframe").on("load",(function(e){i("#entity-iframe-loading").hide(),i("#entity-iframe").show()})),E.data("bs.popover").tip().css({"max-width":"40em"}),i("#cwrc-entity-lookup").on("click.popover",(function(e){T()}))}}(e,o,t)),I(),L()})),i(o).on("dblclick",(function(t){x(e)}))}))}(e,n)}),(function(e){return function(e,t){i("#cwrc-".concat(t,"-list")).append('<li class="list-group-item list-group-item-danger">'.concat(e,"</li>"))}(e,n)}))}))}function T(){i("#cwrc-entity-lookup").off(".popover"),i("#entity-iframe").off("load"),E&&(E.popover("destroy"),E=null)}var E=null;var S={cwrc:{title:"CWRC",enabled:!0},viaf:{title:"VIAF",enabled:!0},dbpedia:{title:"DBPedia",enabled:!0},geonames:{title:"GeoNames",enabled:!0},getty:{title:"Getty ULAN",enabled:!0},wikidata:{title:"Wikidata",enabled:!0},lgpn:{title:"LGPN",enabled:!0}};function D(e){for(var t in e)M(t,e[t]);v=!0}function M(e,t){S[e]&&(S[e].enabled=t)}function R(e){var t=S[e];return void 0===t.enabled||t.enabled}function A(){var e={},t=function(t){l[t].forEach((function(n,i){void 0===e[i]&&(e[i]=[]),e[i].push(t)}))};for(var n in l)t(n);var i="";for(var a in e){var o=e[a],r=S[a].title,s=S[a].enabled;i+='\n        <div class="checkbox">\n            <label><input type="checkbox" '.concat(s?"checked":"",' data-source="').concat(a,'"/>').concat(r,'<br/><span class="small">').concat(o.join(", "),"</span></label>\n        </div>")}return i}function P(e){var t={};e.each((function(e,n){var a=i(n).data("source"),o=i(n).prop("checked");t[a]=o})),D(t),c.set(y,t,{expires:93,path:""})}function N(){if(!document.getElementById("cwrc-entity-lookup")){var e="";Object.entries(S).forEach((function(t){var n=t[0],i=t[1].title;e+='\n            <div class="panel panel-default cwrc-result-panel" id="cwrc-'.concat(n,'-panel">\n                <div class="panel-heading">\n                    <h4 class="panel-title">\n                        <a data-toggle="collapse" data-target="#collapse-').concat(n,'">').concat(i,'</a>\n                    </h4>\n                </div>\n                <div id="collapse-').concat(n,'" class="panel-collapse collapse in">\n                    <ul class="list-group cwrc-result-list" id="cwrc-').concat(n,'-list">\n                    </ul>\n                </div>\n            </div>')}));var t=b.parentEl||document.body;i(t).append(i.parseHTML('<div id="cwrc-entity-lookup" role="dialog" class="modal">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h3 id="cwrc-entity-lookup-title" class="modal-title"></h3>\n            </div>\n            <div class="modal-body">\n                <div class="row">\n                    <div class="col-sm-10">\n                        <div class="input-group">\n                            <input type="text" placeholder="Enter a name to find" class="form-control" id="cwrc-entity-query"/>\n                            <span class="input-group-btn">\n                                <button id="cwrc-entity-lookup-redo" type="button" class="btn btn-default"\n                                        data-toggle="tooltip" data-placement="top" title="Search">\n                                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>&nbsp;\n                                </button>\n                            </span>\n                        </div>\n                    </div>\n                    <div class="col-sm-2">\n                        <button id="cwrc-entity-lookup-edit-sources" type="button" class="btn btn-default"\n                                data-toggle="tooltip" data-placement="top" title="Select Lookup Sources" style="float: right;">\n                            <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>&nbsp;\n                        </button>\n                    </div>\n                </div>\n                <div style="width: 100%;">\n                    <div class="panel-group">\n                        '.concat(e,'\n                        <div class="panel panel-default">\n                            <div class="panel-heading">\n                                <h4 class="panel-title">Other / Manual Input</h4>\n                            </div>\n                            <div class="panel-body">\n                                <input type="text" placeholder="Enter URL" class="form-control" id="cwrc-manual-input"/>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button id="cwrc-entity-lookup-select" type="button" class="btn btn-default">Select</button>\n                ').concat(m?'<button id="cwrc-entity-lookup-nolink" type="button" class="btn btn-default">Tag Without Linking</button><button id="cwrc-entity-lookup-keeplink" type="button" class="btn btn-default">Keep Current Link</button>':"","\n                ").concat(h?'<button id="cwrc-entity-lookup-edit" type="button" class="btn btn-default">Edit Selected</button>':"","\n                ").concat(f?'<button id="cwrc-entity-lookup-new" type="button" class="btn btn-default" disabled="disabled">Create New</button>':"",'\n                <button id="cwrc-entity-lookup-cancel" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>\n<div id="cwrc-title-entity-dialog" role="dialog" class="modal">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h3 id="cwrc-entity-lookup-title" class="modal-title">Create a New Entity</h3>\n            </div>\n            <div class="modal-body">\n                <p>A new window will open, where you can navigate to the desired collection and create the new entity (a citation object).</p>\n                <p>Once you\'re done, return to the current window and re-run the title search. The new entity you created will show up in the results and you will be able to tag it.</p>\n            </div>\n            <div class="modal-footer">\n                <button id="cwrc-title-entity-dialog-ok" type="button" class="btn btn-default">Ok</button>\n                <button id="cwrc-title-entity-dialog-cancel" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>\n<div id="cwrc-entity-lookup-edit-sources-dialog" role="dialog" class="modal">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h3 class="modal-title">Select Lookup Sources</h3>\n            </div>\n            <div class="modal-body">\n                ').concat(A(),'\n            </div>\n            <div class="modal-footer">\n                <button id="cwrc-entity-lookup-edit-sources-ok" type="button" class="btn btn-default">Use Selected</button>\n            </div>\n        </div>\n    </div>\n</div>'))),i('#cwrc-entity-lookup button[data-dismiss="modal"]').on("click",(function(){return _(),void(b.cancelled&&b.cancelled())})),i("#cwrc-entity-lookup-title").text(b.entityLookupTitle),i("#cwrc-entity-query").keyup((function(e){13===e.which&&k(i("#cwrc-entity-query").val())})),i("#cwrc-entity-lookup-redo").click((function(e){C()})),i("#cwrc-entity-lookup-edit-sources").click((function(e){!function(e){function t(){P(e.data("bs.popover").tip().find("input[type=checkbox]")),z(),C(),e.popover("hide")}void 0!==e.data("bs.popover")||(e.popover({animation:!1,trigger:"manual",placement:"bottom",html:!0,title:"Select sources",sanitize:!1,content:function(){return"".concat(A(),'<button class="btn btn-default" type="submit">Use Selected</button>')}}),e.on("hide.bs.popover",(function(){e.data("bs.popover").tip().find("button[type=submit]").off("click",t)}))),e.popover("show"),e.data("bs.popover").tip().css({"min-width":"230px"}),e.popover("show"),e.data("bs.popover").tip().find("button[type=submit]").on("click",t)}(i(this))})),i("#cwrc-entity-lookup-edit-sources-ok").click((function(){P(i("#cwrc-entity-lookup-edit-sources-dialog").find("input[type=checkbox]")),_("cwrc-entity-lookup-edit-sources-dialog"),F()})),i("#cwrc-manual-input").keyup((function(e){i(this).parent().removeClass("has-error").find("span.help-block").remove(),I()})),i("#cwrc-entity-lookup-new").click((function(e){"title"===b.entityType?(i("#cwrc-entity-lookup").modal("hide"),$("cwrc-title-entity-dialog")):O(!1)})),i("#cwrc-entity-lookup-edit").click((function(e){"title"===b.entityType?(i("#cwrc-entity-lookup").modal("hide"),$("cwrc-title-entity-dialog")):void 0!==w&&"CWRC"===w.repository&&O(!0)})),i("#cwrc-entity-lookup-select").click((function(e){if(void 0!==w)x(w);else{var t=i("#cwrc-manual-input").val();if(void 0!==t&&""!==t){/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(t)?x({id:t,uri:t,name:"Custom Entry",repository:"custom"}):!1===i("#cwrc-manual-input").parent().hasClass("has-error")&&i("#cwrc-manual-input").parent().addClass("has-error").append('<span class="help-block">URL is not valid</span>')}}})),i("#cwrc-entity-lookup-nolink").click((function(e){x({})})),i("#cwrc-entity-lookup-keeplink").click((function(e){x({uri:b.uri,name:b.name})})),i("#cwrc-title-entity-dialog-ok").click((function(e){O(),i("#cwrc-title-entity-dialog").modal("hide"),$("cwrc-entity-lookup")})),i('#cwrc-title-entity-dialog button[data-dismiss="modal"]').click((function(e){i("#cwrc-title-entity-dialog").modal("hide"),$("cwrc-entity-lookup")}))}}function $(e){(i("#"+e).modal("show"),b.parentEl)&&i("#"+e).data("bs.modal").$backdrop.detach().appendTo(b.parentEl)}function O(e){var t;"title"===b.entityType?t=p:(t=u+b.entityType,e&&(t+="?entityId="+w.id));var n=Math.min(1100,.8*window.outerWidth),i=.8*window.outerHeight,a=.5*(window.outerHeight-i),o=.5*(window.outerWidth-n);r=window.open(t,"entityFormWindow","menubar=no,statusbar=no,toolbar=no,width="+n+",height="+i+",top="+a+",left="+o)}function I(){var e=!0;if(void 0!==w)e=!1;else{var t=i("#cwrc-manual-input").val();void 0!==t&&""!==t&&(e=!1)}e?i("#cwrc-entity-lookup-select").addClass("disabled").prop("disabled",!0):i("#cwrc-entity-lookup-select").removeClass("disabled").prop("disabled",!1)}function L(){h&&(void 0===w||"CWRC"!==w.repository?i("#cwrc-entity-lookup-edit").addClass("disabled").prop("disabled",!0):i("#cwrc-entity-lookup-edit").removeClass("disabled").prop("disabled",!1))}function z(){l[b.entityType].forEach((function(e,t){R(t)?i("#cwrc-".concat(t,"-panel")).show():i("#cwrc-".concat(t,"-panel")).hide()}))}function F(){v?($("cwrc-entity-lookup"),i("#cwrc-entity-lookup [data-toggle=tooltip]").tooltip(),I(),L(),f&&i.ajax({url:g}).then((function(e){try{return e.response.docs}catch(e){return[]}}),(function(){return[]})).then((function(e){e.length>0?i("#cwrc-entity-lookup-new").prop("disabled",""):i("#cwrc-entity-lookup-new").prop("disabled","disabled")})),i(".cwrc-result-panel").hide(),z(),b.query&&(i("#cwrc-entity-query").val(b.query),k(b.query))):$("cwrc-entity-lookup-edit-sources-dialog")}function j(e,t,n,a){(o=new s("cwrc-entity-management-forms")).onmessage=function(e){void 0===e||x({id:e,uri:l[b.entityType].get("cwrc").getEntityRoot()+"/"+e,repository:"cwrc"});r.close()};var d=c.get(y);if(void 0!==d)try{D(JSON.parse(d))}catch(e){console.warn('error parsing cookie "'+y+'"',e)}w=void 0,b=Object.assign({entityType:e,entityLookupMethodName:t,entityLookupTitle:n},a),N(),F(),b.uri?i("#cwrc-entity-lookup-keeplink").show():i("#cwrc-entity-lookup-keeplink").hide()}function B(e){return j("person","findPerson","Find a Person",e)}function U(e){return j("place","findPlace","Find a Place",e)}function W(e){return j("organization","findOrganization","Find an Organization",e)}function H(e){return j("title","findTitle","Find a Title",e)}function V(e){return j("rs","findRS","Find a Referencing String",e)}e.exports={init:N,registerEntitySources:function(e){l=e},setEnabledSources:D,showCreateNewButton:function(e){"boolean"==typeof e&&(f=e)},showNoLinkButton:function(e){"boolean"==typeof e&&(m=e)},showEditButton:function(e){"boolean"==typeof e&&(h=e)},setEntityFormsRoot:function(e){u=e},setCollectionsRoot:function(e){p=e},setEntityCollectionsUrl:function(e){g=e},popSearchPerson:B,popSearchOrganization:W,popSearchPlace:U,popSearchTitle:H,popSearchRS:V,popSearch:{person:B,organization:W,place:U,title:H,rs:V}}},,function(e,t,n){"use strict";var i="";var a="";var o="",r="";var s={};function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;return new Promise((function(i,a){setTimeout((function(){return a(new Error("Call to CWRC timed out"))}),n),fetch(e,t).then(i,a)})).then((function(e){if(e.ok)return e.json();throw new Error("Something wrong with the call to CWRC, possibly a problem with the network or the server. HTTP error: ".concat(e.status))}))}function c(e,t){return"".concat(a,"/search/").concat(t,"?query=").concat(encodeURIComponent(e),"&limit=100&page=0")}function d(e){return c(e,"person")}function u(e){return c(e,"place")}function p(e){return c(e,"organization")}function g(e){return c(e,"title")}function f(e,t,n){return l(e,{credentials:"same-origin"}).then((function(e){return console.log(e),e.response.objects?e.response.objects.map((function(e){var a=e.PID,r=e.object_label,l=i+"/"+a,c={id:a,uri:l,uriForDisplay:l,name:r,nameType:n,repository:"CWRC",originalQueryString:t},d=a.substring(0,a.indexOf(":")),u=s[d];return void 0!==u&&(c.logo=o+"/"+u),c})):[]}))}e.exports={setEntityRoot:function(e){i=e},getEntityRoot:function(){return i},setSearchRoot:function(e){a=e},getSearchRoot:function(){return a},setProjectLookupConfig:function(e){return o=e.projectLogoRoot,r=e.cwrcProjectId,l(e.projectLookupUrl,{credentials:"same-origin"}).then((function(e){return s=function(e){var t={};for(var n in e){var i=e[n],a=void 0,o=i.field_logo;if(void 0!==o)for(var s in o){var l=o[s];l.length>0&&(a=l[0].filename)}var c=void 0,d=i.field_top_level_collection;if(void 0!==d&&void 0!==d.und){var u=d.und;if(u.length>0&&void 0!==u[0].pid){var p=u[0].pid,g=void 0;""!==(g=p===r?"cwrc":p.substring(0,p.indexOf(":")))&&(c=g)}}void 0!==a&&void 0!==c&&void 0===t[c]&&(t[c]=a)}return t}(e)}))},findPerson:function(e){return f(d(e),e,"person")},findPlace:function(e){return f(u(e),e,"place")},findOrganization:function(e){return f(p(e),e,"organization")},findTitle:function(e){return f(g(e),e,"title")},getPersonLookupURI:d,getPlaceLookupURI:u,getOrganizationLookupURI:p,getTitleLookupURI:g,fetchWithTimeout:l}},,,function(e,t,n){"use strict";var i=n(1);e.exports=function(e,t){var n=e,a=e.initialConfig.entityLookupDialogs,o=t.cwrcType,r=t.localDialog;return{show:function(e){if(e.entry){var t=e.entry.getContent().trim(),s=e.entry.getURI(),l=e.entry.getLemma();a.popSearch[o]({query:t,uri:s,name:l,parentEl:n.dialogManager.getDialogWrapper(),success:function(a){i.isArray(a.name)&&(a.name=a.name[0]);var o=a.name;"custom"===a.repository&&(o=t),n.entitiesManager.setURIForEntity(e.entry.getId(),a.uri),n.entitiesManager.setLemmaForEntity(e.entry.getId(),o),n.dialogManager.show("schema/"+r,{entry:e.entry})},cancelled:function(){},error:function(e){}})}else{t=(t=n.editor.currentBookmark.rng.toString()).trim().replace(/\s+/g," "),a.popSearch[o]({query:t,parentEl:n.dialogManager.getDialogWrapper(),success:function(e){i.isArray(e.name)&&(e.name=e.name[0]);var a=e.name;"custom"===e.repository&&(a=t),n.dialogManager.show("schema/"+r,{query:t,properties:{uri:e.uri,lemma:a}})},error:function(e){}})}},destroy:function(){}}}},,function(e,t,n){"use strict";function i(e){if(this.id=void 0,this.type=void 0,this._isNote=!1,this._isNamedEntity=!1,this.tag=void 0,this.content=void 0,this.title=void 0,this.attributes={},this.customValues={},this.noteContent=void 0,this.dateCreated=void 0,this.annotationRange={},this.uri=void 0,this.lemma=void 0,this.certainty=void 0,this.id=e.id,this.type=e.type,this.tag=e.tag,void 0!==e.dateCreated){var t=new Date(e.dateCreated);isNaN(t.valueOf())?this.dateCreated=(new Date).toISOString():this.dateCreated=t.toISOString()}else this.dateCreated=(new Date).toISOString();void 0!==e.content&&this.setContent(e.content),void 0!==e.attributes&&(this.attributes=e.attributes),void 0!==e.customValues&&(this.customValues=e.customValues),void 0!==e.noteContent&&(this.noteContent=e.noteContent,this._isNote=!0),void 0!==e.isNote&&(this._isNote=e.isNote),void 0!==e.range&&(this.annotationRange=e.range),void 0!==e.uri&&(this.uri=e.uri,this._isNamedEntity=!0),void 0!==e.lemma&&(this.lemma=e.lemma),void 0!==e.certainty&&(this.certainty=e.certainty),void 0!==e.isNamedEntity&&(this._isNamedEntity=e.isNamedEntity)}i.getTitleFromContent=function(e){return(e=e.trim().replace(/\s+/g," ")).length<=34?e:e.substring(0,34)+"&#8230;"},i.prototype={constructor:i,getId:function(){return this.id},setId:function(e){this.id=e},getType:function(){return this.type},isNote:function(){return this._isNote},isNamedEntity:function(){return this._isNamedEntity},getTag:function(){return this.tag},setTag:function(e){this.tag=e},getContent:function(){return this.content},setContent:function(e){this.content=e,this.title=i.getTitleFromContent(this.content)},getTitle:function(){return void 0!==this.lemma?this.lemma:this.title},getAttribute:function(e){return this.attributes[e]},getAttributes:function(){return this.attributes},setAttribute:function(e,t){this.attributes[e]=t},setAttributes:function(e){for(var t in this.attributes={},e)this.attributes[t]=e[t]},removeAttribute:function(e){delete this.attributes[e]},getCustomValue:function(e){return this.customValues[e]},getCustomValues:function(){return this.customValues},setCustomValue:function(e,t){this.customValues[e]=t},setCustomValues:function(e){this.customValues=e},removeCustomValue:function(e){delete this.customValues[e]},setProperty:function(e,t){this.hasOwnProperty(e)&&(this[e]=t)},getNoteContent:function(){return this.noteContent},setNoteContent:function(e){this.noteContent=e},getDateCreated:function(){return this.dateCreated},getURI:function(){return this.uri},setURI:function(e){this.uri=e},getLemma:function(){return this.lemma},setLemma:function(e){this.lemma=e},getCertainty:function(){return this.certainty},setCertainty:function(e){this.certainty=e},getRange:function(){return this.annotationRange},setRange:function(e){this.annotationRange=e},clone:function(){var e=Object.create(i.prototype);for(var t in this){var n=this[t];"function"!=typeof n&&(e[t]=n)}return e.dateCreated=(new Date).toISOString(),e}},e.exports=i},,,,,,,,,,,,,function(e,t,n){"use strict";var i=n(5);function a(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){a(r,i,o,s,l,"next",e)}function l(e){a(r,i,o,s,l,"throw",e)}s(void 0)}))}}var r=n(1),s=n(233),l=n(0);l.suppressDeprecationWarnings=!0;var c,d;n(17);function u(e){this.w=e}u.prefixMap={bibo:"http://purl.org/ontology/bibo/",cnt:"http://www.w3.org/2011/content#",cw:"http://cwrc.ca/ns/cw#",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",oa:"http://www.w3.org/ns/oa#",owl:"http://www.w3.org/2002/07/owl#",prov:"http://www.w3.org/ns/prov#",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",skos:"http://www.w3.org/2004/02/skos/core#",time:"http://www.w3.org/2006/time#",xsd:"http://www.w3.org/2001/XMLSchema#"},u.namespaces={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",as:"http://www.w3.org/ns/activitystreams#",cwrc:"http://sparql.cwrc.ca/ontologies/cwrc#",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",geo:"http://www.geonames.org/ontology#",oa:"http://www.w3.org/ns/oa#",schema:"http://schema.org/",xsd:"http://www.w3.org/2001/XMLSchema#"},u.legacyTypes={person:"foaf:Person",org:"foaf:Organization",place:"geo:SpatialThing",title:"dcterms:title",date:"time:TemporalEntity",note:"bibo:Note",citation:"dcterms:BibliographicResource",correction:"oa:editing",keyword:"skos:Concept",link:"oa:linking"},u.prototype={constructor:u,getAnnotationURIForEntity:function(e){var t=l(e.getDateCreated()).format("YYYYMMDDHHmmssSSS"),n=e.getType()+"_annotation_"+t;return encodeURI(n)},commonAnnotation:function(e,t,n){void 0===n&&(n="oa:identifying");var i=this.w.getUserInfo(),a="https://cwrc-writer.cwrc.ca/",o=new Date,s=e.getDateCreated(),l=o.toISOString(),c=e.getType(),d=e.getCertainty(),p=e.getRange(),g=e.getURI(),f=this.w.getDocumentURI(),h=f+"?"+this.getAnnotationURIForEntity(e),m={"@context":{"dcterms:created":{"@type":"xsd:dateTime","@id":"dcterms:created"},"dcterms:issued":{"@type":"xsd:dateTime","@id":"dcterms:issued"},"oa:motivatedBy":{"@type":"oa:Motivation"},"@language":"en"},"@id":h,"@type":"oa:Annotation","dcterms:created":s,"dcterms:issued":l,"dcterms:creator":{"@id":i.id,"@type":["cwrc:NaturalPerson","schema:Person"],"cwrc:hasName":i.name,"foaf:nick":i.nick},"oa:motivatedBy":n,"oa:hasTarget":{"@id":h+"#Target","@type":"oa:SpecificResource","oa:hasSource":{"@id":f,"@type":"dctypes:Text","dc:format":"text/xml"},"oa:renderedVia":{"@id":a,"@type":"as:Application","rdfs:label":"CWRC Writer","schema:softwareVersion":"1.0"}},"oa:hasBody":{"@type":t},"as:generator":{"@id":a,"@type":"as:Application","rdfs:label":"CWRC Writer","schema:url":"https://cwrc-writer.cwrc.ca","schema:softwareVersion":"1.0"}};for(var v in u.namespaces)m["@context"][v]=u.namespaces[v];if(g&&"citation"!==c)m["oa:hasBody"]["@id"]=g,m["oa:hasBody"]["dc:format"]="text/plain";else if(e.isNote()){var y=r("#"+e.getId(),this.w.editor.getBody())[0].textContent;m["oa:hasBody"]["dc:format"]="text/plain",m["oa:hasBody"]["rdf:value"]=y}return p.endXPath?m["oa:hasTarget"]["oa:hasSelector"]={"@id":h+"#Selector","@type":"oa:RangeSelector","oa:hasStartSelector":{"@type":"oa:XPathSelector","rdf:value":p.startXPath},"oa:hasEndSelector":{"@type":"oa:XPathSelector","rdf:value":p.endXPath},"oa:refinedBy":{"@type":"oa:TextPositionSelector","oa:start":p.startOffset,"oa:end":p.endOffset}}:m["oa:hasTarget"]["oa:hasSelector"]={"@id":h+"#Selector","@type":"oa:XPathSelector","rdf:value":p.startXPath},void 0!==d&&(m["oa:hasCertainty"]="cwrc:"+d),m},getAnnotations:(d=o(i.mark((function e(t,n){var a,o,r,s,l,c,d=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||"json",e.next=3,Promise.all(t.map((function(e){return d.getAnnotationString(e,n)})));case 3:for(a=e.sent,o=a.join(""),r=0;r<this.w.triples.length;r++)s=this.w.triples[r],o+='\n<rdf:Description rdf:about="'+s.subject.uri+'" cw:external="'+s.subject.external+'">\n\t<cw:'+s.predicate.name+' cw:text="'+s.predicate.text+'" cw:external="'+s.predicate.external+'">\n\t\t<rdf:Description rdf:about="'+s.object.uri+'" cw:external="'+s.object.external+'" />\n\t</cw:'+s.predicate.name+">\n</rdf:Description>";for(c in l="<rdf:RDF",u.namespaces)l+=" xmlns:"+c+'="'+u.namespaces[c]+'"';return o=(l+=">\n")+o+"</rdf:RDF>",e.abrupt("return",o);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)}),getAnnotation:function(e){var t=e.getType(),n=this.w.schemaManager.mapper.getMappings().entities[t];return n&&void 0!==n.annotation?n.annotation(this,e):void console.warn("annotationsManager.getAnnotation: no mapping found for",t)},getAnnotationString:(c=o(i.mark((function e(t,n){var a,o,s,l;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="",void 0===(o=this.getAnnotation(t))){e.next=19;break}if("xml"!==n){e.next=18;break}return e.prev=4,e.next=7,this.convertJSONAnnotationToXML(o);case 7:s=e.sent,r("rdf\\:Description, Description",s).each(function(e,t){a+="\n",a+=this.w.utilities.xmlToString(t)}.bind(this)),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(4),console.warn("rdflib:",e.t0),l=this.w.utilities.convertTextForExport(e.t0.message),this.w.dialogManager.show("message",{title:"CWRC-Writer Export",msg:"There was an error exporting your document: "+l,type:"error"});case 16:e.next=19;break;case 18:"json"===n&&(a+='\n<rdf:Description rdf:datatype="http://www.w3.org/TR/json-ld/"><![CDATA[\n',a+=JSON.stringify(o,null,"\t"),a+="\n]]></rdf:Description>");case 19:return e.abrupt("return",a);case 20:case"end":return e.stop()}}),e,this,[[4,11]])}))),function(e,t){return c.apply(this,arguments)}),convertJSONAnnotationToXML:function(e){var t=this,n=this.w.getDocumentURI(),i=s.sym(n),a=s.graph();return new Promise((function(n,o){try{s.parse(JSON.stringify(e),a,i.uri,"application/ld+json",(function(e,a){try{var r=s.serialize(i,a,i.uri,"application/rdf+xml");if(void 0!==r){var l=t.w.utilities.stringToXML(r);n(l)}else o(e)}catch(e){o(e)}}))}catch(e){o(e)}}))},getEntityConfigFromAnnotation:function(e){var t=null;return e.parentElement.hasAttribute("xmlns:cw")?("http://www.w3.org/TR/json-ld/"===e.getAttribute("rdf:datatype")?t=this._getEntityConfigFromJsonAnnotationLegacy(e):null!==e.getAttribute("rdf:about")&&(t=this._getEntityConfigFromXmlAnnotationLegacy(e)),t):this.getEntityConfigFromJsonAnnotation(e)},getEntityConfigFromJsonAnnotation:function(e){var t=null,n=r(e),i=JSON.parse(n.text());if(null!=i){(t={}).type="",t.range={};var a=i["oa:hasTarget"]["oa:hasSelector"];a["oa:refinedBy"]?(t.range.startXPath=a["oa:hasStartSelector"]["rdf:value"],t.range.startOffset=a["oa:refinedBy"]["oa:start"],t.range.endXPath=a["oa:hasEndSelector"]["rdf:value"],t.range.endOffset=a["oa:refinedBy"]["oa:end"]):t.range.startXPath=a["rdf:value"]}return t},_getEntityConfigFromJsonAnnotationLegacy:function(e){var t=null,n=r(e),i=JSON.parse(n.text());if(null!=i){t={};var a,o=null,s=i.hasBody["@type"];-1!==s.indexOf("cnt:ContentAsText")&&(s=s.concat(i.motivatedBy));for(var l=0;l<s.length;l++){var c=s[l];if(null!=(o=this._getEntityTypeForAnnotationLegacy(c)))break}t.type=o;var d=i.hasTarget.hasSelector;if("oa:TextPositionSelector"==d["@type"]){var u=d["oa:start"],p=d["oa:end"];a=this._getRangeObject(u,p)}else if("oa:FragmentSelector"==d["@type"]){var g=d["rdf:value"];a=this._getRangeObject(g)}t.range=a,i.cwrcInfo&&(t.uri=i.cwrcInfo.uri,t.lemma=i.cwrcInfo.name);var f=i.hasCertainty;void 0!==f&&("reasonable"===(f=f.split(":")[1])&&(f="reasonably certain"),t.certainty=f),t.dateCreated=i.annotatedAt}return t},_getEntityConfigFromXmlAnnotationLegacy:function(e){var t=null,n=r(e);if(-1!==n.attr("rdf:about").indexOf("id.cwrc.ca/annotation")){var i=n.parent("rdf\\:RDF, RDF"),a=n.find("oa\\:hasBody, hasBody").attr("rdf:resource"),o=i.find('[rdf\\:about="'+a+'"]'),s=n.find("oa\\:hasTarget, hasTarget").attr("rdf:resource"),l=i.find('[rdf\\:about="'+s+'"]'),c=o.children().last().attr("rdf:resource");if(null!=c&&-1===c.indexOf("ContentAsText")||(c=n.find("oa\\:motivatedBy, motivatedBy").last().attr("rdf:resource")),null==c)console.warn("can't determine type for",e);else{t={type:this._getEntityTypeForAnnotationLegacy(c)};var d={},u=l.find("oa\\:hasSelector, hasSelector").attr("rdf:resource"),p=i.find('[rdf\\:about="'+u+'"]');if(-1!==p.find("rdf\\:type, type").attr("rdf:resource").indexOf("FragmentSelector")){var g=p.find("rdf\\:value, value").text();d=this._getRangeObject(g)}else{var f=p.find("oa\\:start, start").text(),h=p.find("oa\\:end, end").text();d=this._getRangeObject(f,h)}t.range=d;var m=n.find("cw\\:hasCertainty, hasCertainty").attr("rdf:resource");m&&""!=m&&("reasonable"===(m=m.split("#")[1])&&(m="reasonably certain"),t.certainty=m);var v=n.find("cw\\:cwrcInfo, cwrcInfo").text();""!=v&&(v=JSON.parse(v),t.uri=v.uri,t.lemma=v.name),t.dateCreated=n.find("cw\\:annotatedAt, annotatedAt").text()}}return t},_getEntityTypeForAnnotationLegacy:function(e){if(-1!==e.indexOf("http://"))for(var t in u.prefixMap){var n=u.prefixMap[t];if(0===e.indexOf(n)){e=e.replace(n,t+":");break}}for(var i in u.legacyTypes)if(u.legacyTypes[i]===e)return i;return null},_getRangeObject:function(e,t){function n(e){var t,n=null;if(-1===e.indexOf("string-range")){t=new RegExp(/xpointer\((.*)?\)$/).exec(e)[1]}else{var i=new RegExp(/xpointer\((?:string-range\()?([^\)]*)\)+/).exec(e)[1].split(",");t=i[0],i[2]&&(n=parseInt(i[2]))}return{xpath:t,offset:n}}var i={},a=n(e);if(void 0!==t){var o=n(t);i={startXPath:a.xpath,startOffset:a.offset,endXPath:o.xpath,endOffset:o.offset}}else i={startXPath:a.xpath};return i}},e.exports=u},,,function(e,t,n){"use strict";var i=n(1),a=n(9);function o(e){this.w=e.writer,this.$el=e.$el,this.$parent=e.$parent,this.showSchemaHelp=!0===e.showSchemaHelp;var t="";this.showSchemaHelp&&(t='<div class="schemaHelp"></div>'),this.mode=o.ADD,this.isDirty=!1,this.$el.addClass("attributeWidget"),this.$el.append('<div class="attributeSelector"><h2>Attributes</h2><ul></ul></div><div class="attsContainer"></div>'+t),void 0!==this.$parent&&i("[data-mapping]",this.$parent).each(i.proxy((function(e,t){var n,a=i(t),o=a.data("type"),r=a.data("mapping");-1===r.indexOf("custom.")&&-1===r.indexOf("prop.")&&("radio"===o?n=i("input",a):"textbox"!==o&&"select"!==o||(n=a),void 0!==n&&n.change(i.proxy((function(e,t){var n={};n[e]=i(t.target).val(),this.setData(n)}),this,r)))}),this))}n(32),n(27),o.ADD=0,o.EDIT=1,o.prototype={constructor:o,buildWidget:function(e,t,n){if(t=t||{},i(".attributeSelector ul, .attsContainer, .schemaHelp",this.$el).empty(),this.isDirty=!1,this.showSchemaHelp&&void 0!==n){var o=this.w.schemaManager.getDocumentationForTag(n);""!=o&&i(".schemaHelp",this.$el).html("<h3>"+n+" Documentation</h3><p>"+o+"</p>")}e.sort((function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}));for(var r,s,l=a.reservedAttributes,c="",d="",u=!1,p=0;p<e.length;p++)if(s="",u=(r=e[p]).required,!0!==l[r.name]){var g=r.name;""!==r.fullName&&(g+=" ("+r.fullName+")"),r.defaultValue="";var f="block",h=u?" required":"";if(t[r.name]&&void 0!==t[r.name]?(f="block",d+='<li data-name="'+r.name+'" class="selected'+h+'">'+g+"</li>",r.defaultValue=t[r.name]):(f="none",d+='<li data-name="'+r.name+'" class="'+h+'">'+g+"</li>"),s+='<div data-name="form_'+r.name+'" style="display:'+f+';"><label>'+g+"</label>","string"==typeof r.documentation&&""!==r.documentation&&(s+='<ins class="ui-icon ui-icon-help" title="'+r.documentation+'">&nbsp;</ins>'),s+="<br/>",r.choices&&r.choices.length>0){var m;s+='<select name="'+r.name+'">';for(var v=0;v<r.choices.length;v++)s+='<option value="'+(m=r.choices[v])+'"'+(r.defaultValue==m?' selected="selected"':"")+">"+m+"</option>";s+="</select>"}else s+='<input type="text" name="'+r.name+'" value="'+r.defaultValue+'"/>';u&&(s+=' <span class="required">*</span>'),c+=s+="</div>"}i(".attributeSelector ul",this.$el).html(d),i(".attsContainer",this.$el).html(c),i(".attributeSelector li",this.$el).click((function(){var e=i(this).data("name").replace(/:/g,"\\:"),t=i('[data-name="form_'+e+'"]',this.$el);i(this).toggleClass("selected"),i(this).hasClass("selected")?t.show():t.hide()})),i("ins",this.$el).tooltip({show:!1,hide:!1,classes:{"ui-tooltip":"cwrc-tooltip"}}),i("input, select, option",this.$el).change((function(e){this.isDirty=!0})),i("select, option",this.$el).click((function(e){this.isDirty=!0}))},reset:function(){i(".attributeSelector li",this.$el).each((function(e,t){i(this).removeClass("selected");var n=i(this).data("name").replace(/:/g,"\\:");i('[data-name="form_'+n+'"]',this.$el).hide()})),i(".attsContainer input, .attsContainer select",this.$el).val("")},setData:function(e){var t=!1;for(var n in e){var i=e[n];t=this.setAttribute(n,i)||t}return t},setAttribute:function(e,t){var n=i('.attributeSelector li[data-name="'+e+'"]',this.$el);if(1===n.length){if(null!=t){n.addClass("selected");var a=i('[data-name="form_'+e+'"]',this.$el);return i("input, select",a).val(t),a.show(),!0}n.removeClass("selected");a=i('[data-name="form_'+e+'"]',this.$el);return i("input, select",a).val(""),a.hide(),!0}return console.warn("attributeWidget: no attribute for",e),!1},getData:function(){var e=this,t={};i(".attributeSelector li.selected",this.$el).each((function(n,a){var o=i(a).data("name");i('.attsContainer > div[data-name="form_'+o+'"]',e.$el).children('input[type!="hidden"], select').each((function(e,n){var a=i(this).val();""!==a&&(t[i(this).attr("name")]=a)}))}));var n=[];if(i(".attsContainer span.required",this.$el).parent().children('input[type!="hidden"], select').each((function(e,a){var o=t[i(this).attr("name")];void 0!==o&&""!=o||n.push(i(this).attr("name"))})),n.length>0){for(var a=0;a<n.length;a++){var o=n[a];i('.attsContainer *[name="'+o+'"]',this.$el).css({borderColor:"red"}).keyup((function(e){i(this).css({borderColor:"#ccc"})}))}return t}return t},expand:function(){this.$el.parent('[data-transform="accordion"]').accordion("option","active",0)},collapse:function(){this.$el.parent('[data-transform="accordion"]').accordion("option","active",!1)},destroy:function(){try{i("ins",this.$el).tooltip("destroy")}catch(e){console&&console.log("error destroying tooltip")}}},e.exports=o},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var i=n(1);n(13),i.widget("custom.popup",i.ui.dialog,{version:"1.10.4",close:function(e){var t=this;this._isOpen&&!1!==this._trigger("beforeClose",e)&&(this._isOpen=!1,this._destroyOverlay(),this._hide(this.uiDialog,this.options.hide,(function(){t._trigger("close",e)})))},open:function(){this._isOpen?this._moveToTop():(this._isOpen=!0,this.opener=i(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,(function(){})),this._trigger("open"))}})},function(e,t,n){var i,a,o;function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}a=[n(1)],void 0===(o="function"==typeof(i=function(e,t,n){t=window;var i="watermark",a="watermarkClass",o="watermarkFocus",s="watermarkSubmit",l="watermarkMaxLength",c="watermarkPassword",d="watermarkText",u=/\r/g,p=/^(button|checkbox|hidden|image|radio|range|reset|submit)$/i,g="input:data("+i+"),textarea:data("+i+")",f=":watermarkable",h=["Page_ClientValidate"],m=!1,v="placeholder"in document.createElement("input");e.watermark=e.watermark||{version:"3.2.0",runOnce:!0,options:{className:"watermark",clearAllFormsOnSubmit:!1,hideBeforeUnload:!0,textAttr:"",useNative:!0},hide:function(t){e(t).filter(g).each((function(){e.watermark._hide(e(this))}))},_hide:function(e,n){var i,o,r=e[0],s=(r.value||"").replace(u,""),p=e.data(d)||"",g=e.data(l)||0,f=e.data(a);p.length&&s==p&&(r.value="",e.data(c)&&"text"===(e.attr("type")||"")&&(i=e.data(c)||[],o=e.parent()||[],i.length&&o.length&&(o[0].removeChild(e[0]),o[0].appendChild(i[0]),e=i)),g&&(e.attr("maxLength",g),e.removeData(l)),n&&(e.attr("autocomplete","off"),t.setTimeout((function(){e.select()}),1))),f&&e.removeClass(f)},show:function(t){e(t).filter(g).each((function(){e.watermark._show(e(this))}))},_show:function(t){var n,i,r,s=t[0],p=(s.value||"").replace(u,""),g=t.data(d)||"",f=t.attr("type")||"",h=t.data(a);0!=p.length&&p!=g||t.data(o)?e.watermark._hide(t):(m=!0,t.data(c)&&"password"===f&&(n=t.data(c)||[],i=t.parent()||[],n.length&&i.length&&(i[0].removeChild(t[0]),i[0].appendChild(n[0]),(t=n).attr("maxLength",g.length),s=t[0])),("text"===f||"search"===f)&&(r=t.attr("maxLength")||0)>0&&g.length>r&&(t.data(l,r),t.attr("maxLength",g.length)),h&&t.addClass(h),s.value=g)},hideAll:function(t){m&&(e.watermark.hide(e(f,t)),m=!1)},showAll:function(){e.watermark.show(f)}},e.fn.watermark=e.fn.watermark||function(n,l){if(!this.length)return this;var p=!1,g="string"==typeof n;return g&&(n=n.replace(u,"")),"object"==r(l)?(p="string"==typeof l.className,l=e.extend({},e.watermark.options,l)):"string"==typeof l?(p=!0,l=e.extend({},e.watermark.options,{className:l})):"object"==r(n)?(l=e.extend({},e.watermark.options,n),n=""):l=e.watermark.options,"function"!=typeof l.useNative&&(l.useNative=l.useNative?function(){return!0}:function(){return!1}),this.each((function(){var r,h,m,y,b=e(this);if(b.is(f)){if(l.textAttr&&(n=(b.attr(l.textAttr)||"").replace(u,""),g=!!n),b.data(i))(g||p)&&(e.watermark._hide(b),g&&b.data(d,n),p&&b.data(a,l.className));else{if(v&&l.useNative.call(this,b)&&"TEXTAREA"!==(b.attr("tagName")||""))return void(g&&"placeholder"!==l.textAttr&&b.attr("placeholder",n));b.data(d,g?n:""),b.data(a,l.className),b.data(i,1),"password"===(b.attr("type")||"")?(r=b.wrap("<span>").parent(),(h=e(r.html().replace(/type=["']?password["']?/i,'type="text"'))).data(d,b.data(d)),h.data(a,b.data(a)),h.data(i,1),h.attr("maxLength",n.length),h.focus((function(){e.watermark._hide(h,!0)})).bind("dragenter",(function(){e.watermark._hide(h)})).bind("dragend",(function(){t.setTimeout((function(){h.blur()}),1)})),b.blur((function(){e.watermark._show(b)})).bind("dragleave",(function(){e.watermark._show(b)})),h.data(c,b),b.data(c,h)):b.focus((function(){b.data(o,1),e.watermark._hide(b,!0)})).blur((function(){b.data(o,0),e.watermark._show(b)})).bind("dragenter",(function(){e.watermark._hide(b)})).bind("dragleave",(function(){e.watermark._show(b)})).bind("dragend",(function(){t.setTimeout((function(){e.watermark._show(b)}),1)})).bind("drop",(function(e){var t=b[0],n=e.originalEvent.dataTransfer.getData("Text");(t.value||"").replace(u,"").replace(n,"")===b.data(d)&&(t.value=n),b.focus()})),this.form&&(m=this.form,(y=e(m)).data(s)||(y.submit((function(){return e.watermark.hideAll.apply(this,l.clearAllFormsOnSubmit?[]:[m])})),m.submit?(y.data(s,m.submit),m.submit=function(t,n){return function(){var i=n.data(s);e.watermark.hideAll(l.clearAllFormsOnSubmit?null:t),i.apply?i.apply(t,Array.prototype.slice.call(arguments)):i()}}(m,y)):(y.data(s,1),m.submit=function(t){return function(){e.watermark.hideAll(l.clearAllFormsOnSubmit?null:t),delete t.submit,t.submit()}}(m))))}e.watermark._show(b)}}))},e.watermark.runOnce&&(e.watermark.runOnce=!1,e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo((function(t){return function(n){return!!e.data(n,t)}})):function(t,n,i){return!!e.data(t,i[3])},watermarkable:function(e){var t,n=e.nodeName;return"TEXTAREA"===n||"INPUT"===n&&(!(t=e.getAttribute("type"))||!p.test(t))}}),function(t){e.fn.val=function(){var a,o=Array.prototype.slice.call(arguments);return this.length?o.length?(t.apply(this,o),e.watermark.show(this),this):this.data(i)?(a=(this[0].value||"").replace(u,""))===(this.data(d)||"")?"":a:t.apply(this):o.length?this:n}}(e.fn.val),h.length&&e((function(){for(var n,i,a=h.length-1;a>=0;a--)"function"==typeof(i=t[n=h[a]])&&(t[n]=function(t){return function(){return e.watermark.hideAll(),t.apply(null,Array.prototype.slice.call(arguments))}}(i))})),e(t).bind("beforeunload",(function(){e.watermark.options.hideBeforeUnload&&e.watermark.hideAll()})))})?i.apply(t,a):i)||(e.exports=o)},,,,function(e,t){},function(e,t,n){e.exports=n(359)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t,n){"use strict";var i=n(1);e.exports=function(e){var t=e,n=!0,a={};t.event=function(e){var t,o=e&&a[e];return o||(o={publish:function(){n&&console.debug('CWRC-Writer "'+this.event+'":',arguments),t.fire.apply(this,arguments)},subscribe:(t=i.Callbacks()).add,unsubscribe:t.remove,event:e}),e&&(a[e]=o),o},t.event("writerInitialized"),t.event("tinymceInitialized"),t.event("structureTreeInitialized"),t.event("entitiesListInitialized"),t.event("nodeChanged"),t.event("contentChanged"),t.event("loadingDocument"),t.event("processingDocument"),t.event("documentLoaded"),t.event("documentSaved"),t.event("savingDocument"),t.event("loadingSchema"),t.event("schemaLoaded"),t.event("schemaChanged"),t.event("schemaAdded"),t.event("validationInitiated"),t.event("documentValidated"),t.event("contentCopied"),t.event("contentPasted"),t.event("writerKeydown"),t.event("writerKeyup"),t.event("entityAdded"),t.event("entityEdited"),t.event("entityRemoved"),t.event("entityFocused"),t.event("entityUnfocused"),t.event("entityCopied"),t.event("entityPasted"),t.event("tagAdded"),t.event("tagEdited"),t.event("tagRemoved"),t.event("tagContentsRemoved"),t.event("tagSelected"),t.event("selectionChanged"),t.event("massUpdateStarted"),t.event("massUpdateCompleted");var o={getEvents:function(){return a},destroy:function(){},debug:function(e){n=e}};return o}},function(e,t,n){"use strict";var i=n(1),a=n(227);e.exports=function(e){var t,n=e,o={xmlToString:function(e){var t="";try{t=(new XMLSerializer).serializeToString(e)}catch(e){console.warn(e)}return t},stringToXML:function(e){var t=(new DOMParser).parseFromString(e,"text/xml"),n=t.querySelector("parsererror");return null!==n?(console.error("utilities.stringToXML parse error:",n.innerText),null):t},xmlToJSON:function(e){if("string"==i.type(e)&&null===(e=o.stringToXML(e)))return null;var t=new a;return t.attr_prefix="@",t.parseDOM(e)},convertTextForExport:function(e,a){a=void 0!==a&&a,void 0===t&&(t=i('<div style="display: none;"></div>').appendTo(n.layoutManager.getContainer()));var o=e;return null!=o&&(o.match(/&.+?;/gim)&&(t[0].innerHTML=o,o=t[0].innerText||t[0].firstChild.nodeValue),o=o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a&&(o=o.replace(/"/g,"&quot;"))),o},addCSS:function(e){var t=n.cwrcRootUrl+e;document.querySelector('link[rel=stylesheet][href="'+t+'"]')||i(document.head).append('<link type="text/css" rel="stylesheet" href="'+t+'" />')},getTitleFromContent:function(e){return(e=e.trim()).length<=34?e:e.substring(0,34)+"&#8230;"},getCamelCase:function(e){return e.replace(/(?:^|\s)\w/g,(function(e){return e.toUpperCase()}))},escapeHTMLString:function(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e},unescapeHTMLString:function(e){return"string"==typeof e?e.replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e},getPreviousTextNode:function(e,t){t=void 0!==t&&t;var n=e.ownerDocument.createTreeWalker(e.ownerDocument,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return!1===t||t&&null===e.textContent.match(/^[\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000]*$/)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return n.currentNode=e,n.previousNode()},getNextTextNode:function(e,t){t=void 0!==t&&t;var n=e.ownerDocument.createTreeWalker(e.ownerDocument,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return!1===t||t&&null===e.textContent.match(/^[\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000]*$/)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return n.currentNode=e,n.nextNode()},selectElementById:function(e,t){t=null!=t&&t,n.entitiesManager.removeHighlights(),i.isArray(e)&&(e=e[e.length-1]);var a=i("#"+e,n.editor.getBody()),o=a[0];if(null!=o){a.parents(".noteWrapper").removeClass("hide");var r=n.editor.dom.createRng();t?tinymce.isWebKit?(null==o.firstChild&&a.append("\ufeff"),r.selectNodeContents(o)):r.selectNodeContents(o):(i("[data-mce-bogus]",a.parent()).remove(),r.selectNode(o)),n.editor.selection.setRng(r),n.editor.currentBookmark=n.editor.selection.getBookmark(1);var s=0;a.is(":hidden")?(a.show(),s=a.position().top,a.hide()):s=a.position().top;var l=s-.25*i(n.editor.getContentAreaContainer()).height();i(n.editor.getDoc()).scrollTop(l),window.setTimeout((function(){n.editor.focus(),n.event("tagSelected").publish(e,t)}),0)}},getRootTag:function(){return i("[_tag]:first",n.editor.getBody())},getElementXPath:function(e,t){if(null==e)return null;var n=void 0;void 0!==t?n=t:null!==e.getAttribute("_tag")&&(n="_tag");for(var i=[];e&&1==e.nodeType;e=e.parentNode){for(var a=0,o=e.previousSibling;o;o=o.previousSibling)o.nodeType!=Node.DOCUMENT_TYPE_NODE&&(void 0!==n&&void 0!==o.getAttribute?o.getAttribute(n)==e.getAttribute(n)&&++a:o.nodeName==e.nodeName&&++a);var r=null;if(null!=(r=void 0!==n?e.getAttribute(n):e.nodeName)){var s=a?"["+(a+1)+"]":"";i.splice(0,0,r+s)}}return i.length?i.join("/"):null},evaluateXPath:function(e,t){var i=e.ownerDocument;null===i&&(i=e);var a,o,r=i===n.editor.getDoc(),s=/(\/{0,2})([\w-]+::|@)?(\w+?:)?([\w()]+)(\[.+?\])?/g,l=null,c=i.documentElement.getAttribute("xmlns");if(!r){var d=i.createNSResolver(i.documentElement);l=function(e){return d.lookupNamespaceURI(e)||c},null!==c&&(t=t.replace(s,(function(e,t,n,i,a,o){return void 0!==i?e:void 0!==n&&(0===n.indexOf("attribute")||0===n.indexOf("@"))||-1!==a.indexOf("()")?[t,n,i,a,o].join(""):[t,n,"foo:",a,o].join("")})))}null===c&&(t=t.replace(s,(function(e,t,n,i,a,o){return[t,n,a,o].join("")}))),r&&(i===e&&(e=i.documentElement),e.getAttribute("_tag")===n.schemaManager.getRoot()&&"@"!==t.charAt(0)&&"/"!==t.charAt(1)&&"/"!==(t="/"+t).charAt(1)&&(t="/"+t),t=t.replace(s,(function(e,t,n,i,a,o){return void 0!==n&&(0===n.indexOf("attribute")||0===n.indexOf("@"))||-1!==a.indexOf("()")?[t,n,i,a,o].join(""):[t,n,i,'*[@_tag="'+a+'"]',o].join("")})));try{a=i.evaluate(t,e,l,XPathResult.ANY_TYPE,null)}catch(e){return console.warn("utilities.evaluateXPath: there was an error evaluating the xpath",e),null}switch(a.resultType){case XPathResult.NUMBER_TYPE:o=a.numberValue;break;case XPathResult.STRING_TYPE:o=a.stringValue;break;case XPathResult.BOOLEAN_TYPE:o=a.booleanValue;break;case XPathResult.UNORDERED_NODE_ITERATOR_TYPE:case XPathResult.ORDERED_NODE_ITERATOR_TYPE:o=a.iterateNext();break;case XPathResult.ANY_UNORDERED_NODE_TYPE:case XPathResult.FIRST_ORDERED_NODE_TYPE:o=a.singleNodeValue}return o},processArray:function(e,t,a){a=void 0===a?250:a;var o=new i.Deferred,r=n.dialogManager.getDialog("loadingindicator"),s=e.length,l=(new Date).getTime();return function n(){for(;e.length>0;){var i=e.shift();if(t.call(this,i),(new Date).getTime()-l>a)break}var c=Math.abs(e.length-s)/s*100;r.setValue(c),e.length>0?(l=(new Date).getTime(),setTimeout(n,10)):o.resolve()}(),o.promise()},createGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},getOffsetPosition:function(e,t){t=void 0===t?n.layoutManager.getContainer():i(t);for(var a=i(e),o=a.position(),r=a.offsetParent();1==t.find(r).length;){var s=r.position();o.top+=s.top,o.left+=s.left,r=r.offsetParent()}return o},constrain:function(e,t,n){return e<0||e+n>t&&(e=t-n)<0?0:e},destroy:function(){void 0!==t&&t.remove()}};return o}},function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=function(){return this};a.VERSION="0.24",a.prototype.xmlDecl='<?xml version="1.0" encoding="UTF-8" ?>\n',a.prototype.attr_prefix="-",a.prototype.overrideMimeType="text/xml",a.prototype.parseXML=function(e){var t;if(window.DOMParser){var n=new DOMParser,i=n.parseFromString(e,"application/xml");if(!i)return;t=i.documentElement}else window.ActiveXObject&&((n=new ActiveXObject("Microsoft.XMLDOM")).async=!1,n.loadXML(e),t=n.documentElement);if(t)return this.parseDOM(t)},a.prototype.parseHTTP=function(e,t,n){var i,a={};for(var o in t)a[o]=t[o];if(a.method||(void 0===a.postBody&&void 0===a.postbody&&void 0===a.parameters?a.method="get":a.method="post"),n){a.asynchronous=!0;var r=this,s=n,l=a.onComplete;a.onComplete=function(e){var t;e&&e.responseXML&&e.responseXML.documentElement?t=r.parseDOM(e.responseXML.documentElement):e&&e.responseText&&(t=r.parseXML(e.responseText)),s(t,e),l&&l(e)}}else a.asynchronous=!1;if("undefined"!=typeof HTTP&&HTTP.Request)a.uri=e,(c=new HTTP.Request(a))&&(i=c.transport);else if("undefined"!=typeof Ajax&&Ajax.Request){var c;(c=new Ajax.Request(e,a))&&(i=c.transport)}return n?i:i&&i.responseXML&&i.responseXML.documentElement?this.parseDOM(i.responseXML.documentElement):i&&i.responseText?this.parseXML(i.responseText):void 0},a.prototype.parseDOM=function(e){if(e){if(this.__force_array={},this.force_array)for(var t=0;t<this.force_array.length;t++)this.__force_array[this.force_array[t]]=1;var n=this.parseElement(e);if(this.__force_array[e.nodeName]&&(n=[n]),11!=e.nodeType){var i={};i[e.nodeName]=n,n=i}return n}},a.prototype.parseElement=function(e){if(7!=e.nodeType){if(3==e.nodeType||4==e.nodeType){if(null==e.nodeValue.match(/[^\x00-\x20]/))return;return e.nodeValue}var t,n={};if(e.attributes&&e.attributes.length){t={};for(var a=0;a<e.attributes.length;a++){if("string"==typeof(s=e.attributes[a].nodeName))(l=e.attributes[a].nodeValue)&&(void 0===n[s=this.attr_prefix+s]&&(n[s]=0),n[s]++,this.addNode(t,s,n[s],l))}}if(e.childNodes&&e.childNodes.length){var o=!0;t&&(o=!1);for(a=0;a<e.childNodes.length&&o;a++){var r=e.childNodes[a].nodeType;3!=r&&4!=r&&(o=!1)}if(o){t||(t="");for(a=0;a<e.childNodes.length;a++)t+=e.childNodes[a].nodeValue}else{t||(t={});for(a=0;a<e.childNodes.length;a++){var s,l;if("string"==typeof(s=e.childNodes[a].nodeName))(l=this.parseElement(e.childNodes[a]))&&(void 0===n[s]&&(n[s]=0),n[s]++,"object"==i(l)&&(l.$parent=t,l.$key=s),this.addNode(t,s,n[s],l))}}}return t}},a.prototype.addNode=function(e,t,n,i){this.__force_array[t]?(1==n&&(e[t]=[]),e[t][e[t].length]=i):1==n?e[t]=i:2==n?e[t]=[e[t],i]:e[t][e[t].length]=i},a.prototype.writeXML=function(e){var t=this.hash_to_xml(null,e);return this.xmlDecl+t},a.prototype.hash_to_xml=function(e,t){var n=[],a=[];for(var o in t)if(t.hasOwnProperty(o)){var r=t[o];o.charAt(0)!=this.attr_prefix?void 0===r||null==r?n[n.length]="<"+o+" />":"object"==i(r)&&r.constructor==Array?n[n.length]=this.array_to_xml(o,r):"object"==i(r)?n[n.length]=this.hash_to_xml(o,r):n[n.length]=this.scalar_to_xml(o,r):a[a.length]=" "+o.substring(1)+'="'+this.xml_escape(r)+'"'}var s=a.join(""),l=n.join("");return void 0===e||null==e||(l=n.length>0?l.match(/\n/)?"<"+e+s+">\n"+l+"</"+e+">\n":"<"+e+s+">"+l+"</"+e+">\n":"<"+e+s+" />\n"),l},a.prototype.array_to_xml=function(e,t){for(var n=[],a=0;a<t.length;a++){var o=t[a];void 0===o||null==o?n[n.length]="<"+e+" />":"object"==i(o)&&o.constructor==Array?n[n.length]=this.array_to_xml(e,o):"object"==i(o)?n[n.length]=this.hash_to_xml(e,o):n[n.length]=this.scalar_to_xml(e,o)}return n.join("")},a.prototype.scalar_to_xml=function(e,t){return"#text"==e?this.xml_escape(t):"<"+e+">"+this.xml_escape(t)+"</"+e+">\n"},a.prototype.xml_escape=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e.exports&&(e.exports=a)},function(e,t,n){"use strict";var i=n(5);function a(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){a(r,i,o,s,l,"next",e)}function l(e){a(r,i,o,s,l,"throw",e)}s(void 0)}))}}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a,o=!0,r=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return o=e.done,e},e:function(e){r=!0,a=e},f:function(){try{o||null==i.return||i.return()}finally{if(r)throw a}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var c=n(1),d=n(9),u=n(236),p=n(254);e.exports=function(e,t){var n=e,a={getBlockTag:function(){return"div"},getInlineTag:function(){return"span"}};a.mapper=new d({writer:n}),a.navigator=new p,a.getChildrenForTag=a.navigator.getChildrenForTag,a.getChildrenForPath=a.navigator.getChildrenForPath,a.getAttributesForTag=a.navigator.getAttributesForTag,a.getAttributesForPath=a.navigator.getAttributesForPath,a.getParentsForTag=a.navigator.getParentsForTag,a.getParentsForPath=a.navigator.getParentsForPath,a.schemaProxyUrl=t.schemaProxyUrl,a.schemas=t.schemas||[],a.schemaId=null,a.schemaXML=null,a._xmlUrl=null,a.getXMLUrl=function(){return a._xmlUrl},a.schemaJSON=null,a.schema={elements:[]},a.getCurrentSchema=function(){return a.schemas.find((function(e){return e.id===a.schemaId}))},a.getSchemaIdFromRoot=function(e){for(var t in a.mapper.mappings)if(-1!==a.mapper.mappings[t].root.indexOf(e))return t},a.getSchemaIdFromUrl=function(e){if(void 0!==e){var t=e.split(/^.*?\/\//)[1],n=a.schemas.find((function(e){var n,i=s(e.xmlUrl);try{for(i.s();!(n=i.n()).done;){if(-1!==n.value.indexOf(t))return e}}catch(e){i.e(e)}finally{i.f()}}));return n?n.id:void 0}},a._root=null,a.getRoot=function(){return a._root},a._header=null,a.getHeader=function(){return a._header},a._idName=null,a.getIdName=function(){return a._idName},a._cssUrl=null,a.getCSSUrl=function(){return a._cssUrl},a.isSchemaCustom=function(){return void 0===a.getCurrentSchema().schemaMappingsId},a._currentDocumentSchemaUrl=null,a.getCurrentDocumentSchemaUrl=function(){return a._currentDocumentSchemaUrl},a.setCurrentDocumentSchemaUrl=function(e){a._currentDocumentSchemaUrl=e},a._currentDocumentCSSUrl=null,a.getCurrentDocumentCSSUrl=function(){return a._currentDocumentCSSUrl},a.setCurrentDocumentCSSUrl=function(e){a._currentDocumentCSSUrl=e},a.canTagContainText=function(e){if(e==a.getRoot())return!1;var t={canContainText:!1};return function e(t,n,i,o){if(o.canContainText)return!1;var r=t.find("text");if(r.length>0&&(0===i||0===r.parents("element").length))return o.canContainText=!0,!1;t.find("ref").each((function(t,r){var s=c(r).attr("name");if(!(c(r).parents("element").length>0&&i>0)&&!n[s])return n[s]=!0,e(c('define[name="'+s+'"]',a.schemaXML),n,i+1,o)}))}(c('element[name="'+e+'"]',a.schemaXML),{},0,t),t.canContainText},a.isTagBlockLevel=function(e){return e==a.getRoot()||null!=n.editor.schema.getBlockElements()[e]},a.isTagEntity=function(e){return null!==a.mapper.getEntityTypeForTag(e)},a.getTagForEditor=function(e){return a.isTagBlockLevel(e)?"div":"span"},a.getDocumentationForTag=function(e){var t=c('element[name="'+e+'"]',a.schemaXML);return c("a\\:documentation, documentation",t).first().text()},a.getFullNameForTag=function(e){var t=c('element[name="'+e+'"]',a.schemaXML),n=c("a\\:documentation, documentation",t).first().text(),i=/^\((.*?)\)/.exec(n);return null!==i?i[1]:""},a.getRequiredChildrenForTag=function(e){for(var t=a.getChildrenForTag(e),n=t.length-1;n>-1;n--)!0!==t[n].required&&t.splice(n,1);return t},a.canTagHaveAttributes=function(e){return 0!==a.getAttributesForTag(e).length},a.isTagValidChildOfParent=function(e,t){for(var n=a.getParentsForTag(e),i=0;i<n.length;i++)if(n[i].name===t)return!0;return!1},a.isAttributeValidForTag=function(e,t){for(var n=a.getAttributesForTag(t),i=0;i<n.length;i++)if(n[i].name===e)return!0;return!1},a.wouldDeleteInvalidate=function(e,t,n){for(var i=e.parentElement,o=i.getAttribute("_tag");null===o;){if(null===(i=i.parentElement))return console.warn("schemaManager.wouldDeleteInvalidate: outside of document!"),!1;o=i.getAttribute("_tag")}if(t){var s=e.getAttribute("_tag");if(a.getRequiredChildrenForTag(o).find((function(e){return e.name===s}))){for(var l=!1,c=0;c<i.children.length;c++){var d=e.children[c];if(d!==e)if(d.getAttribute("_tag")===s){l=!0;break}}if(!l)return!0}if(!n){for(var u=a.getChildrenForTag(o),p=function(t){var n=e.children[t].getAttribute("_tag");if(!u.find((function(e){return e.name===n})))return{v:!0}},g=0;g<e.children.length;g++){var f=p(g);if("object"===r(f))return f.v}var h=!1;if(e.childNodes.forEach((function(e){h||e.nodeType!==Node.TEXT_NODE||"\ufeff"===e.textContent||(h=!0)})),h&&!1===a.canTagContainText(o))return!0}}else if(n){var m=e.getAttribute("_tag");if(a.getRequiredChildrenForTag(m).length>0)return!0}return!1},a.addSchema=function(e){return e.id=n.getUniqueId("schema"),e.xmlUrl&&"string"==typeof e.xmlUrl&&(e.xmlUrl=[e.xmlUrl]),e.cssUrl&&"string"==typeof e.cssUrl&&(e.cssUrl=[e.cssUrl]),a.schemas.push(e),n.event("schemaAdded").publish(e.id),e.id},a.getUrlForSchema=function(e){var t=a.schemas.find((function(t){return t.id===e}));return void 0!==t?t.xmlUrl:null},a.getRootForSchema=function(){var e=o(i.mark((function e(t){var n,o,r,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===a.mapper.mappings[t]){e.next=2;break}return e.abrupt("return",a.mapper.mappings[t].root[0]);case 2:if(n=a.getUrlForSchema(t)){e.next=5;break}throw"schemaManager.getRootForSchema: no url for "+t;case 5:return e.next=7,l(n);case 7:if(o=e.sent){e.next=10;break}throw"schemaManager.getRootForSchema: could not connect to ".concat(t);case 10:return(r=c("start element:first",o).attr("name"))||(s=c("start ref:first",o).attr("name"),r=c('define[name="'+s+'"] element',o).attr("name")),e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var l=function(){var e=o(i.mark((function e(t){var o,r,l,c,d,u,p;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=s(t),e.prev=1,r.s();case 3:if((l=r.n()).done){e.next=19;break}return c=l.value,d=c,a.schemaProxyUrl&&(d="".concat(a.schemaProxyUrl,"/schema/xml?url=").concat(c)),e.next=9,fetch(d).catch((function(e){console.log(e)}));case 9:if(!(u=e.sent)||200!==u.status){e.next=17;break}return e.next=13,u.text();case 13:return p=e.sent,o=n.utilities.stringToXML(p),a._xmlUrl=c,e.abrupt("break",19);case 17:e.next=3;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),r.e(e.t0);case 24:return e.prev=24,r.f(),e.finish(24);case 27:return e.abrupt("return",o);case 28:case"end":return e.stop()}}),e,null,[[1,21,24,27]])})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=o(i.mark((function e(t,n){var a,o,r,s,d;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="",r=n.attr("href"),o=-1!=r.indexOf("/")?r.match(/(.*\/)(.*)/)[2]:r,s=t.url.match(/(.*\/)(.*)/)[1],a=null!=s?s+o:"schema/"+o,e.next=7,l([a]);case 7:if(d=e.sent){e.next=10;break}return e.abrupt("return",null);case 10:return n.children().each((function(e,t){if("start"==t.nodeName)c("start",d).replaceWith(t);else if("define"==t.nodeName){var n=c(t).attr("name"),i=c('define[name="'.concat(n,'"]'),d);1==i.length?i.replaceWith(t):c("grammar",d).append(t)}})),n.replaceWith(c("grammar",d).children()),e.abrupt("return");case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){c("#schemaTags",n.editor.dom.doc).remove(),c("head",n.editor.getDoc()).append('<style id="schemaTags" type="text/css" />');var e="",t=[];c("element",a.schemaXML).each((function(n,i){var a=c(i).attr("name");null!=a&&-1==t.indexOf(a)&&(t.push(a),e+=".showTags *[_tag=".concat(a,']:before { color: #aaa !important; font-size: 13px !important; font-weight: normal !important; font-style: normal !important; font-family: monospace !important; font-variant: normal !important; content: "<').concat(a,'>"; }'),e+=".showTags *[_tag=".concat(a,']:after { color: #aaa !important; font-size: 13px !important; font-weight: normal !important; font-style: normal !important; font-family: monospace !important; font-variant: normal !important; content: "</').concat(a,'>"; }'))})),t.sort();var i=a.getTagForEditor(a._header);e+=i+"[_tag=".concat(a._header,"] { display: none !important; }"),c("#schemaTags",n.editor.getDoc()).text(e),a.schema.elements=t,a.navigator.setSchemaElements(a.schema.elements),c("a\\:documentation *",a.schemaXML).each((function(e,t){t.parentElement&&(t.parentElement.innerHTML=n.utilities.escapeHTMLString(t.parentElement.textContent))})),a.schemaJSON=n.utilities.xmlToJSON(c("grammar",a.schemaXML)[0]),null===a.schemaJSON&&console.warn("schemaManager.loadSchema: schema XML could not be converted to JSON"),a.navigator.setSchemaJSON(a.schemaJSON)};a.loadSchema=function(){var e=o(i.mark((function e(t,o,r){var s,d,u,p,h,m,v,y,b;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(s=a.schemas.find((function(e){return e.id===t})))){e.next=6;break}if(n.dialogManager.show("message",{title:"Error",msg:"Error loading schema. No entry found for: ".concat(t),type:"error"}),!r){e.next=5;break}return e.abrupt("return",r(!1));case 5:return e.abrupt("return",{success:!1});case 6:return n.event("loadingSchema").publish(),a.schemaId=t,d=s.schemaMappingsId,a.mapper.loadMappings(d),e.next=12,l(s.xmlUrl);case 12:if(u=e.sent){e.next=20;break}if(a.schemaId=null,n.dialogManager.getDialog("loadingindicator").hide(),n.dialogManager.show("message",{title:"Error",msg:"<p>Error loading schema from: ".concat(s.name,".</p>"),type:"error"}),!r){e.next=19;break}return e.abrupt("return",r(!1));case 19:return e.abrupt("return",{success:!1});case 20:for(a.schemaXML=u,(p=c("start element:first",a.schemaXML).attr("name"))||(h=c("start ref:first",a.schemaXML).attr("name"),p=c('define[name="'.concat(h,'"] element'),a.schemaXML).attr("name")),a._root=p,a._header=a.mapper.getHeaderTag(),a._idName=a.mapper.getIdAttributeName(),m=a.mapper.getBlockLevelElements(),v=n.editor.schema.getBlockElements(),y=0;y<m.length;y++)v[m[y]]={};if(1!=(b=c("include:first",a.schemaXML)).length){e.next=33;break}return e.next=33,g(s,b);case 33:if(!0===o&&a.loadSchemaCSS(s.cssUrl),f(),n.event("schemaLoaded").publish(),!r){e.next=38;break}return e.abrupt("return",r(!0));case 38:return e.abrupt("return",{success:!0});case 39:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}();var h=function(){var e=o(i.mark((function e(t){var n,o,r,l,c,d;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=s(t),e.prev=1,o.s();case 3:if((r=o.n()).done){e.next=18;break}return l=r.value,c=l,a.schemaProxyUrl&&(c="".concat(a.schemaProxyUrl,"/schema/css?url=").concat(l)),e.next=9,fetch(c).catch((function(e){console.log(e)}));case 9:if(!(d=e.sent)||200!==d.status){e.next=16;break}return e.next=13,d.text();case 13:return n=e.sent,a._cssUrl=l,e.abrupt("break",18);case 16:e.next=3;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(1),o.e(e.t0);case 23:return e.prev=23,o.f(),e.finish(23);case 26:return e.abrupt("return",n);case 27:case"end":return e.stop()}}),e,null,[[1,20,23,26]])})));return function(t){return e.apply(this,arguments)}}();return a.loadSchemaCSS=function(){var e=o(i.mark((function e(t){var a,o,r,s,l,d,p,g,f,m,v,y,b,w;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("#schemaRules",n.editor.dom.doc).remove(),c("#schemaRules",document).remove(),e.next=4,h(t);case 4:if(a=e.sent){e.next=8;break}return n.dialogManager.show("message",{title:"Error",msg:"No CSS could be loaded to this schema.",type:"error"}),e.abrupt("return",null);case 8:for(o=u.parse(a),r={stylesheet:{rules:[]}},s=o.stylesheet.rules,l=0;l<s.length;l++)if(d=s[l],p=Object.assign({},d),"rule"===d.type){for(g=[],f=[],m=0;m<d.selectors.length;m++)v=d.selectors[m],y=v.replace(/(^|,|\s)(#?\w+)/g,(function(e,t,n,i,a){return t+'*[_tag="'+n+'"]'})),f.push(".cwrc .popup "+y),g.push(y);d.selectors=g,p.selectors=f,r.stylesheet.rules.push(p)}b=u.stringify(o),w=u.stringify(r),c("head",n.editor.dom.doc).append('<style id="schemaRules" type="text/css" />'),c("#schemaRules",n.editor.dom.doc).text(b),c("head",document).append('<style id="schemaRules" type="text/css" />'),c("#schemaRules",document).text(w);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.event("schemaChanged").subscribe(function(){var e=o(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.loadSchema(t,!0);case 2:e.sent.success&&(a.setCurrentDocumentSchemaUrl(a.getXMLUrl()),a.setCurrentDocumentCSSUrl(a.getCSSUrl()));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a}},function(e,t,n){n(1),n(9);e.exports={namespace:"",id:"",responsibility:"",rdfParentSelector:"",root:[],header:"",blockElements:[],urlAttributes:[],popupAttributes:[],listeners:{},entities:{rs:{parentTag:"",mappingFunction:function(e){},mapping:{},annotation:function(e,t){}},person:{parentTag:"",mappingFunction:function(e){},mapping:{},annotation:function(e,t){}},org:{parentTag:"",mappingFunction:function(e){},mapping:{},annotation:function(e,t){}},place:{parentTag:"",mappingFunction:function(e){},mapping:{},annotation:function(e,t){}},title:{parentTag:"",mappingFunction:function(e){},mapping:{},annotation:function(e,t){}},correction:{parentTag:"",mappingFunction:function(e){},mapping:{},annotation:function(e,t){}},link:{parentTag:"",mappingFunction:function(e){},mapping:{},annotation:function(e,t){}},date:{parentTag:"",mappingFunction:function(e){},mapping:{},annotation:function(e,t){}},note:{parentTag:"",textTag:"",isNote:!0,mappingFunction:function(e){},mapping:{},annotation:function(e,t){}},citation:{parentTag:"",textTag:"",mappingFunction:function(e){},mapping:{},annotation:function(e,t){}},keyword:{parentTag:"",textTag:"",mappingFunction:function(e){},mapping:{},annotation:function(e,t){}}}}},function(e,t,n){var i=n(1),a=n(9);function o(e){var t=e.attr("url");if(void 0!==t){e.css("backgroundImage","url("+t+")"),e.css("display","inline-block");var n=i("<img />");n.hide(),n.on("load",(function(){var t=i(this).height(),a=i(this).width();e.width(a),e.height(t),n.remove()})),i("body").append(n),n.attr("src",t)}}e.exports={namespace:"http://www.tei-c.org/ns/1.0",id:"xml:id",responsibility:"resp",rdfParentSelector:"/TEI/teiHeader/fileDesc/following-sibling::xenoData",root:["TEI","teiCorpus"],header:"teiHeader",blockElements:["argument","back","bibl","biblFull","biblScope","body","byline","category","change","cit","classCode","elementSpec","macroSpec","classSpec","closer","creation","date","distributor","div","div1","div2","div3","div4","div5","div6","div7","docAuthor","edition","editionStmt","editor","eg","epigraph","extent","figure","front","funder","group","head","dateline","idno","item","keywords","l","label","langUsage","lb","lg","list","listBibl","note","noteStmt","opener","p","principal","publicationStmt","publisher","pubPlace","q","rendition","resp","respStmt","salute","samplingDecl","seriesStmt","signed","sp","sponsor","tagUsage","taxonomy","textClass","titlePage","titlePart","trailer","TEI","teiHeader","text","authority","availability","fileDesc","sourceDesc","revisionDesc","catDesc","encodingDesc","profileDesc","projectDesc","docDate","docEdition","docImprint","docTitle"],urlAttributes:["ref","target"],popupAttributes:[],listeners:{tagAdded:function(e){var t=i(e);"graphic"===t.attr("_tag")&&o(t)},tagEdited:function(e){var t=i(e);"graphic"===t.attr("_tag")&&o(t)},documentLoaded:function(e,t){i(t).find('*[_tag="graphic"]').each((function(e,t){o(i(t))}))}},entities:{rs:{parentTag:"rs",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(e,t){var n=t.getAttribute("type");return void 0!==n&&""!==n||(n="owl:Thing"),n=n.replace("http://sparql.cwrc.ca/ontology/cwrc#","cwrc:"),e.commonAnnotation(t,n)}},person:{parentTag:"persName",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(e,t){var n="";switch(t.getAttribute("type")){case"real":n="cwrc:NaturalPerson";break;case"fictional":n=["schema:Person","cwrc:FictionalPerson"];break;case"both":n=["cwrc:NaturalPerson","schema:Person","cwrc:FictionalPerson"];break;default:n="cwrc:NaturalPerson"}return e.commonAnnotation(t,n)}},org:{parentTag:"orgName",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(e,t){return e.commonAnnotation(t,"org:Organization")}},place:{parentTag:"placeName",mappingFunction:function(e){var t=a.getTagAndDefaultAttributes(e),n="",i=e.getCustomValue("precision");return void 0!==i&&(n+='<precision match="@ref" precision="'+i+'" />'),[t,n+="</"+e.getTag()+">"]},mapping:{uri:"@ref",lemma:"@key",certainty:"@cert",customValues:{precision:"precision/@precision"}},annotation:function(e,t){var n=e.commonAnnotation(t,"cwrc:RealPlace"),i=t.getCustomValue("precision");return i&&(n["cwrc:hasPrecision"]="cwrc:"+i+"Certainty"),n}},title:{parentTag:"title",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(e,t){return e.commonAnnotation(t,"bf:Title")}},correction:{xpathSelector:"self::choice|self::corr",parentTag:["choice","corr"],textTag:"sic",requiresSelection:!1,mappingFunction:function(e){var t,n=e.getCustomValue("corrText"),i=e.getCustomValue("sicText"),o="<"+(t=i?"choice":"corr")+a.getAttributeString(e.getAttributes())+">",r="";return i?(o+="<sic>",r="</sic><corr>"+n+"</corr></choice>"):r="</"+t+">",[o,r]},mapping:{customValues:{sicText:"sic/text()",corrText:"corr/text()"}},annotation:function(e,t){var n=e.commonAnnotation(t,"fabio:Correction","oa:editing");return n["oa:hasBody"]={"@type":"fabio:Correction","dc:format":"text/xml","rdf:value":t.getCustomValue("corrText")},n}},link:{parentTag:"ref",annotation:function(e,t){var n=e.commonAnnotation(t,"cnt:ContentAsText","oa:linking");return n["oa:hasBody"]={"@id":t.getAttribute("target"),"@type":"cnt:ContentAsText"},n}},date:{parentTag:"date",annotation:function(e,t){var n,i=e.commonAnnotation(t,"xsd:date");return n=void 0!==t.getAttribute("when")?t.getAttribute("when"):t.getAttribute("from")+"/"+t.getAttribute("to"),i["oa:hasBody"]["rdf:value"]=n,i}},note:{parentTag:"note",xpathSelector:'self::note[not(@type="citation")]',isNote:!0,requiresSelection:!1,mapping:{noteContent:"."},annotation:function(e,t){var n="";switch(t.getAttribute("type")){case"researchNote":n="cwrc:NoteInternal";break;case"scholarNote":n="cwrc:NoteScholarly";break;case"annotation":n="oa:TextualBody"}return e.commonAnnotation(t,n,"oa:describing")}},citation:{parentTag:"note",xpathSelector:'self::note[@type="citation"]/bibl',textTag:"bibl",isNote:!0,requiresSelection:!1,mappingFunction:function(e){var t=a.getTagAndDefaultAttributes(e)+"<bibl>",n=e.getURI();n&&(t+='<ref target="'+n+'"/>');return[t,"</bibl></note>"]},mapping:{uri:"bibl/ref/@target",certainty:"@cert",noteContent:"bibl/text()"},annotation:function(e,t){var n=e.commonAnnotation(t,"cito:Citation","cwrc:citing");return t.getURI()&&(n["oa:hasBody"]=[n["oa:hasBody"],{"@id":n["@id"]+"#Cites","@type":"cito:Citation","cito:hasCitingEntity":n["@id"],"cito:hasCitedEntity":t.getURI(),"cito:hasCitationEvent":"cito:cites"}],n["@context"].cito="http://purl.org/spar/cito/"),n}},keyword:{parentTag:"seg",xpathSelector:"self::seg/term",textTag:"term",isNote:!0,requiresSelection:!1,mappingFunction:function(e){return[a.getTagAndDefaultAttributes(e)+"<term>","</term></seg>"]},mapping:{noteContent:"term/text()"},annotation:function(e,t){var n="",i="",a=t.getAttribute("ana"),o=void 0!==a,r=o&&0===a.indexOf("http");r?(n="fabio:ControlledVocabulary",i="oa:classifying"):(n="fabio:UncontrolledVocabulary",i="oa:tagging");var s=e.commonAnnotation(t,n,i);return r?(s["oa:hasBody"]=[{"@type":"fabio:ControlledVocabulary","rdf:value":a},{"dc:format":"text/xml","skos:altLabel":t.getContent()}],s["@context"].skos="http://www.w3.org/2004/02/skos/"):o?(s["oa:hasBody"]=[{"@type":"fabio:UncontrolledVocabulary","rdf:value":a},{"dc:format":"text/xml","skos:altLabel":t.getContent()}],s["@context"].skos="http://www.w3.org/2004/02/skos/"):s["oa:hasBody"]={"@type":"fabio:UncontrolledVocabulary","dc:format":"text/xml","rdf:value":t.getContent()},s}}}}},function(e,t,n){var i=n(1),a=n(9);function o(e){var t=e.attr("url");if(void 0!==t){e.css("backgroundImage","url("+t+")"),e.css("display","inline-block");var n=i("<img />");n.hide(),n.on("load",(function(){var t=i(this).height(),a=i(this).width();e.width(a),e.height(t),n.remove()})),i("body").append(n),n.attr("src",t)}}e.exports={namespace:"http://www.tei-c.org/ns/1.0",id:"xml:id",responsibility:"resp",rdfParentSelector:"/TEI/teiHeader/fileDesc/following-sibling::xenoData",root:["TEI","teiCorpus"],header:"teiHeader",blockElements:["argument","back","bibl","biblFull","biblScope","body","byline","category","change","cit","classCode","elementSpec","macroSpec","classSpec","closer","creation","date","distributor","div","div1","div2","div3","div4","div5","div6","div7","docAuthor","edition","editionStmt","editor","eg","epigraph","extent","figure","front","funder","group","head","dateline","idno","item","keywords","l","label","langUsage","lb","lg","list","listBibl","note","noteStmt","opener","p","principal","publicationStmt","publisher","pubPlace","q","rendition","resp","respStmt","salute","samplingDecl","seriesStmt","signed","sp","sponsor","tagUsage","taxonomy","textClass","titlePage","titlePart","trailer","TEI","teiHeader","text","authority","availability","fileDesc","sourceDesc","revisionDesc","catDesc","encodingDesc","profileDesc","projectDesc","docDate","docEdition","docImprint","docTitle"],urlAttributes:["ref","target"],popupAttributes:[],listeners:{tagAdded:function(e){var t=i(e);"graphic"===t.attr("_tag")&&o(t)},tagEdited:function(e){var t=i(e);"graphic"===t.attr("_tag")&&o(t)},documentLoaded:function(e,t){i(t).find('*[_tag="graphic"]').each((function(e,t){o(i(t))}))}},entities:{rs:{parentTag:"rs",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(e,t){var n=t.getAttribute("type");return void 0!==n&&""!==n||(n="owl:Thing"),n=n.replace("http://sparql.cwrc.ca/ontology/cwrc#","cwrc:"),e.commonAnnotation(t,n)}},person:{parentTag:"rs",xpathSelector:'self::rs[@type="http://sparql.cwrc.ca/ontologies/cwrc#PersonalName"]',requiredAttributes:{type:"http://sparql.cwrc.ca/ontologies/cwrc#PersonalName"},mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(e,t){return e.commonAnnotation(t,"cwrc:PersonalName")}},org:{parentTag:"rs",xpathSelector:'self::rs[@type="http://www.w3.org/ns/org#FormalOrganization"]',requiredAttributes:{type:"http://www.w3.org/ns/org#FormalOrganization"},mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(e,t){return e.commonAnnotation(t,"org:FormalOrganization")}},place:{parentTag:"rs",xpathSelector:'self::rs[@type="http://sparql.cwrc.ca/ontologies/cwrc#Place"]',requiredAttributes:{type:"http://sparql.cwrc.ca/ontologies/cwrc#Place"},mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(e,t){return e.commonAnnotation(t,"cwrc:Place")}},title:{parentTag:"title",mapping:{uri:"@ref",lemma:"@key",certainty:"@cert"},annotation:function(e,t){return e.commonAnnotation(t,"bf:Title")}},correction:{xpathSelector:"self::choice|self::corr",parentTag:["choice","corr"],textTag:"sic",requiresSelection:!1,mappingFunction:function(e){var t,n=e.getCustomValue("corrText"),i=e.getCustomValue("sicText"),o="<"+(t=i?"choice":"corr")+a.getAttributeString(e.getAttributes())+">",r="";return i?(o+="<sic>",r="</sic><corr>"+n+"</corr></choice>"):r="</"+t+">",[o,r]},mapping:{customValues:{sicText:"sic/text()",corrText:"corr/text()"}},annotation:function(e,t){var n=e.commonAnnotation(t,"fabio:Correction","oa:editing");return n["oa:hasBody"]={"@type":"fabio:Correction","dc:format":"text/xml","rdf:value":t.getCustomValue("corrText")},n}},link:{parentTag:"ref",annotation:function(e,t){var n=e.commonAnnotation(t,"cnt:ContentAsText","oa:linking");return n["oa:hasBody"]={"@id":t.getAttribute("target"),"@type":"cnt:ContentAsText"},n}},date:{parentTag:"date",annotation:function(e,t){var n,i=e.commonAnnotation(t,"xsd:date");return n=void 0!==t.getAttribute("when")?t.getAttribute("when"):t.getAttribute("from")+"/"+t.getAttribute("to"),i["oa:hasBody"]["rdf:value"]=n,i}},note:{parentTag:"note",xpathSelector:'self::note[not(@type="citation")]',isNote:!0,requiresSelection:!1,annotation:function(e,t){var n="";switch(t.getAttribute("type")){case"researchNote":n="cwrc:NoteInternal";break;case"scholarNote":n="cwrc:NoteScholarly";break;case"annotation":n="oa:TextualBody"}return e.commonAnnotation(t,n,"oa:describing")}},citation:{parentTag:"note",xpathSelector:'self::note[@type="citation"]/bibl',textTag:"bibl",isNote:!0,requiresSelection:!1,mappingFunction:function(e){var t=a.getTagAndDefaultAttributes(e)+"<bibl>",n=e.getURI();n&&(t+='<ref target="'+n+'"/>');return[t,"</bibl></note>"]},mapping:{uri:"bibl/ref/@target",certainty:"@cert",noteContent:"bibl/text()"},annotation:function(e,t){var n=e.commonAnnotation(t,"cito:Citation","cwrc:citing");return t.getURI()&&(n["oa:hasBody"]=[n["oa:hasBody"],{"@id":n["@id"]+"#Cites","@type":"cito:Citation","cito:hasCitingEntity":n["@id"],"cito:hasCitedEntity":t.getURI(),"cito:hasCitationEvent":"cito:cites"}],n["@context"].cito="http://purl.org/spar/cito/"),n}},keyword:{parentTag:"seg",xpathSelector:"self::seg/term",textTag:"term",isNote:!0,requiresSelection:!1,mappingFunction:function(e){return[a.getTagAndDefaultAttributes(e)+"<term>","</term></seg>"]},mapping:{noteContent:"term/text()"},annotation:function(e,t){var n="",i="",a=t.getAttribute("ana"),o=void 0!==a,r=o&&0===a.indexOf("http");r?(n="fabio:ControlledVocabulary",i="oa:classifying"):(n="fabio:UncontrolledVocabulary",i="oa:tagging");var s=e.commonAnnotation(t,n,i);return r?(s["oa:hasBody"]=[{"@type":"fabio:ControlledVocabulary","rdf:value":a},{"dc:format":"text/xml","skos:altLabel":t.getContent()}],s["@context"].skos="http://www.w3.org/2004/02/skos/"):o?(s["oa:hasBody"]=[{"@type":"fabio:UncontrolledVocabulary","rdf:value":a},{"dc:format":"text/xml","skos:altLabel":t.getContent()}],s["@context"].skos="http://www.w3.org/2004/02/skos/"):s["oa:hasBody"]={"@type":"fabio:UncontrolledVocabulary","dc:format":"text/xml","rdf:value":t.getContent()},s}}}}},function(e,t,n){var i=n(1),a=n(9);n(30);function o(e){var t=e.attr("url");if(void 0!==t){e.css("backgroundImage","url("+t+")"),e.css("display","inline-block");var n=i("<img />");n.hide(),n.on("load",(function(){var t=i(this).height(),a=i(this).width();e.width(a),e.height(t),n.remove()})),i("body").append(n),n.attr("src",t)}}e.exports={id:"ID",responsibility:"RESP",rdfParentSelector:"/*/ORLANDOHEADER/FILEDESC/following-sibling::XENODATA",root:["ENTRY","EVENT","BIOGRAPHY","WRITING"],header:"ORLANDOHEADER",blockElements:["DIV0","DIV1","EVENT","ORLANDOHEADER","DOCAUTHOR","DOCEDITOR","DOCEXTENT","PUBLICATIONSTMT","TITLESTMT","PUBPLACE","L","P","HEADING","CHRONEVENT","CHRONSTRUCT"],urlAttributes:["URL","REF"],popupAttributes:["PLACEHOLDER"],popupElements:["RESEARCHNOTE","SCHOLARNOTE"],listeners:{tagAdded:function(e){var t=i(e);"GRAPHIC"===t.attr("_tag")&&o(t)},tagEdited:function(e){var t=i(e);"GRAPHIC"===t.attr("_tag")&&o(t)},documentLoaded:function(e,t){i(t).find('*[_tag="GRAPHIC"]').each((function(e,t){o(i(t))}))}},entities:{person:{parentTag:"NAME",mapping:{uri:"@REF",lemma:"@STANDARD"},annotation:function(e,t,n){return e.commonAnnotation(t,n,"foaf:Person")}},org:{parentTag:"ORGNAME",mapping:{uri:"@REF",lemma:"@STANDARD"},annotation:function(e,t,n){return e.commonAnnotation(t,n,"foaf:Organization")}},place:{parentTag:"PLACE",textTag:["ADDRESS","AREA","GEOG","PLACENAME","REGION","SETTLEMENT"],mappingFunction:function(e){var t=e.getCustomValue("placeType")||"ADDRESS",n=a.getTagAndDefaultAttributes(e);return[n+="<"+t+">","</"+t+"></"+e.getTag()+">"]},mapping:{uri:"@REF",lemma:"@REG",customValues:{placeType:"local-name(./*)"}},annotation:function(e,t,n){return e.commonAnnotation(t,n,"geo:SpatialThing")}},title:{parentTag:"TITLE",mapping:{uri:"@REF",lemma:"@REG"},annotation:function(e,t,n){var a=e.commonAnnotation(t,n,["dcterms:BibliographicResource","dcterms:title"],"oa:identifying");if("xml"===n){var o=i.parseXML('<cw:pubType xmlns:cw="http://cwrc.ca/ns/cw#">'+t.getAttribute("TITLETYPE")+"</cw:pubType>");i('[rdf\\:about="'+t.getUris().entityId+'"]',a).prepend(o.firstChild)}else a["oa:hasBody"].pubType=t.getAttribute("TITLETYPE");return a}},date:{xpathSelector:"self::orlando:DATE|self::orlando:DATERANGE|self::orlando:DATESTRUCT",parentTag:["DATE","DATERANGE","DATESTRUCT"],mapping:{tag:"local-name(.)"},annotation:function(e,t,n){var a=[];void 0!==t.getAttribute("FROM")?a.push("time:Interval"):a.push("time:Instant"),a.push("time:TemporalEntity");var o,r=e.commonAnnotation(t,n,a);"xml"===n?(o=void 0!==t.getAttribute("VALUE")?i.parseXML('<xsd:date xmlns:xsd="http://www.w3.org/2001/XMLSchema#">'+t.getAttribute("VALUE")+"</xsd:date>"):i.parseXML('<xsd:date xmlns:xsd="http://www.w3.org/2001/XMLSchema#">'+t.getAttribute("FROM")+"/"+t.getAttribute("TO")+"</xsd:date>"),i('[rdf\\:about="'+t.getUris().entityId+'"]',r).prepend(o.firstChild)):void 0!==t.getAttribute("VALUE")?r["oa:hasBody"]["xsd:date"]=t.getAttribute("VALUE"):r["oa:hasBody"]["xsd:date"]=t.getAttribute("FROM")+"/"+t.getAttribute("TO");return r}},note:{xpathSelector:"self::orlando:RESEARCHNOTE|self::orlando:SCHOLARNOTE",parentTag:["RESEARCHNOTE","SCHOLARNOTE"],isNote:!0,mapping:{tag:"local-name(.)",noteContent:"."},annotation:function(e,t,n){return e.commonAnnotation(t,n,"bibo:Note","oa:commenting")}},citation:{parentTag:"BIBCIT",isNote:!0,mapping:{uri:"@REF",noteContent:"."},annotation:function(e,t,n){return e.commonAnnotation(t,n,"dcterms:BibliographicResource","cw:citing")}},correction:{parentTag:"SIC",annotation:function(e,t,n){var a=e.commonAnnotation(t,n,"cnt:ContentAsText","oa:editing");if("xml"===n){var o=i.parseXML('<cnt:chars xmlns:cnt="http://www.w3.org/2011/content#">'+t.getAttribute("CORR")+"</cnt:chars>");i('[rdf\\:about="'+t.getUris().entityId+'"]',a).prepend(o.firstChild)}else a["oa:hasBody"]["cnt:chars"]=t.getAttribute("CORR");return a}},keyword:{parentTag:"KEYWORDCLASS",isNote:!0,annotation:function(e,t,n){var a=e.commonAnnotation(t,n,["oa:Tag","cnt:ContentAsText","skos:Concept"],"oa:classifying"),o=t.getAttribute("KEYWORDTYPE");if("xml"===n){var r=i('[rdf\\:about="'+t.getUris().entityId+'"]',a),s=i.parseXML('<cnt:chars xmlns:cnt="http://www.w3.org/2011/content#">'+o+"</cnt:chars>");r.prepend(s.firstChild)}else a["oa:hasBody"]["cnt:chars"]=o;return a}},link:{parentTag:"XREF",annotation:function(e,t,n){return e.commonAnnotation(t,n,"cnt:ContentAsText","oa:linking")}}}}},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__233__},function(e,t,n){var i={"./af":43,"./af.js":43,"./ar":44,"./ar-dz":45,"./ar-dz.js":45,"./ar-kw":46,"./ar-kw.js":46,"./ar-ly":47,"./ar-ly.js":47,"./ar-ma":48,"./ar-ma.js":48,"./ar-sa":49,"./ar-sa.js":49,"./ar-tn":50,"./ar-tn.js":50,"./ar.js":44,"./az":51,"./az.js":51,"./be":52,"./be.js":52,"./bg":53,"./bg.js":53,"./bm":54,"./bm.js":54,"./bn":55,"./bn.js":55,"./bo":56,"./bo.js":56,"./br":57,"./br.js":57,"./bs":58,"./bs.js":58,"./ca":59,"./ca.js":59,"./cs":60,"./cs.js":60,"./cv":61,"./cv.js":61,"./cy":62,"./cy.js":62,"./da":63,"./da.js":63,"./de":64,"./de-at":65,"./de-at.js":65,"./de-ch":66,"./de-ch.js":66,"./de.js":64,"./dv":67,"./dv.js":67,"./el":68,"./el.js":68,"./en-SG":69,"./en-SG.js":69,"./en-au":70,"./en-au.js":70,"./en-ca":71,"./en-ca.js":71,"./en-gb":72,"./en-gb.js":72,"./en-ie":73,"./en-ie.js":73,"./en-il":74,"./en-il.js":74,"./en-nz":75,"./en-nz.js":75,"./eo":76,"./eo.js":76,"./es":77,"./es-do":78,"./es-do.js":78,"./es-us":79,"./es-us.js":79,"./es.js":77,"./et":80,"./et.js":80,"./eu":81,"./eu.js":81,"./fa":82,"./fa.js":82,"./fi":83,"./fi.js":83,"./fo":84,"./fo.js":84,"./fr":85,"./fr-ca":86,"./fr-ca.js":86,"./fr-ch":87,"./fr-ch.js":87,"./fr.js":85,"./fy":88,"./fy.js":88,"./ga":89,"./ga.js":89,"./gd":90,"./gd.js":90,"./gl":91,"./gl.js":91,"./gom-latn":92,"./gom-latn.js":92,"./gu":93,"./gu.js":93,"./he":94,"./he.js":94,"./hi":95,"./hi.js":95,"./hr":96,"./hr.js":96,"./hu":97,"./hu.js":97,"./hy-am":98,"./hy-am.js":98,"./id":99,"./id.js":99,"./is":100,"./is.js":100,"./it":101,"./it-ch":102,"./it-ch.js":102,"./it.js":101,"./ja":103,"./ja.js":103,"./jv":104,"./jv.js":104,"./ka":105,"./ka.js":105,"./kk":106,"./kk.js":106,"./km":107,"./km.js":107,"./kn":108,"./kn.js":108,"./ko":109,"./ko.js":109,"./ku":110,"./ku.js":110,"./ky":111,"./ky.js":111,"./lb":112,"./lb.js":112,"./lo":113,"./lo.js":113,"./lt":114,"./lt.js":114,"./lv":115,"./lv.js":115,"./me":116,"./me.js":116,"./mi":117,"./mi.js":117,"./mk":118,"./mk.js":118,"./ml":119,"./ml.js":119,"./mn":120,"./mn.js":120,"./mr":121,"./mr.js":121,"./ms":122,"./ms-my":123,"./ms-my.js":123,"./ms.js":122,"./mt":124,"./mt.js":124,"./my":125,"./my.js":125,"./nb":126,"./nb.js":126,"./ne":127,"./ne.js":127,"./nl":128,"./nl-be":129,"./nl-be.js":129,"./nl.js":128,"./nn":130,"./nn.js":130,"./pa-in":131,"./pa-in.js":131,"./pl":132,"./pl.js":132,"./pt":133,"./pt-br":134,"./pt-br.js":134,"./pt.js":133,"./ro":135,"./ro.js":135,"./ru":136,"./ru.js":136,"./sd":137,"./sd.js":137,"./se":138,"./se.js":138,"./si":139,"./si.js":139,"./sk":140,"./sk.js":140,"./sl":141,"./sl.js":141,"./sq":142,"./sq.js":142,"./sr":143,"./sr-cyrl":144,"./sr-cyrl.js":144,"./sr.js":143,"./ss":145,"./ss.js":145,"./sv":146,"./sv.js":146,"./sw":147,"./sw.js":147,"./ta":148,"./ta.js":148,"./te":149,"./te.js":149,"./tet":150,"./tet.js":150,"./tg":151,"./tg.js":151,"./th":152,"./th.js":152,"./tl-ph":153,"./tl-ph.js":153,"./tlh":154,"./tlh.js":154,"./tr":155,"./tr.js":155,"./tzl":156,"./tzl.js":156,"./tzm":157,"./tzm-latn":158,"./tzm-latn.js":158,"./tzm.js":157,"./ug-cn":159,"./ug-cn.js":159,"./uk":160,"./uk.js":160,"./ur":161,"./ur.js":161,"./uz":162,"./uz-latn":163,"./uz-latn.js":163,"./uz.js":162,"./vi":164,"./vi.js":164,"./x-pseudo":165,"./x-pseudo.js":165,"./yo":166,"./yo.js":166,"./zh-cn":167,"./zh-cn.js":167,"./zh-hk":168,"./zh-hk.js":168,"./zh-tw":169,"./zh-tw.js":169};function a(e){var t=o(e);return n(t)}function o(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=o,e.exports=a,a.id=234},function(e,t,n){var i=n(1);n(9),n(30);function a(e){var t=e.attr("url");if(void 0!==t){e.css("backgroundImage","url("+t+")"),e.css("display","inline-block");var n=i("<img />");n.hide(),n.on("load",(function(){var t=i(this).height(),a=i(this).width();e.width(a),e.height(t),n.remove()})),i("body").append(n),n.attr("src",t)}}e.exports={id:"ID",responsibility:"RESP",rdfParentSelector:"/CWRC/CWRCHEADER",root:["CWRC"],header:"CWRCHEADER",blockElements:[],urlAttributes:["URL","REF"],popupAttributes:[],popupElements:[],listeners:{tagAdded:function(e){var t=i(e);"GRAPHIC"===t.attr("_tag")&&a(t)},tagEdited:function(e){var t=i(e);"GRAPHIC"===t.attr("_tag")&&a(t)},documentLoaded:function(e,t){i(t).find('*[_tag="GRAPHIC"]').each((function(e,t){a(i(t))}))}},entities:{person:{parentTag:"NAME",mapping:{uri:"@REF",lemma:"@STANDARD"},annotation:function(e,t,n){return e.commonAnnotation(t,n,"foaf:Person")}},org:{parentTag:"ORGNAME",mapping:{uri:"@REF",lemma:"@REG"},annotation:function(e,t,n){return e.commonAnnotation(t,n,"foaf:Organization")}},place:{parentTag:"PLACE",mapping:{uri:"@REF",lemma:"@REG"},annotation:function(e,t,n){return e.commonAnnotation(t,n,"geo:SpatialThing")}},title:{parentTag:"TITLE",mapping:{uri:"@REF",lemma:"@REG"},annotation:function(e,t,n){var a=e.commonAnnotation(t,n,["dcterms:BibliographicResource","dcterms:title"],"oa:identifying");if("xml"===n){var o=i.parseXML('<cw:pubType xmlns:cw="http://cwrc.ca/ns/cw#">'+t.getAttribute("TITLETYPE")+"</cw:pubType>");i('[rdf\\:about="'+t.getUris().entityId+'"]',a).prepend(o.firstChild)}else a.hasBody.pubType=t.getAttribute("TITLETYPE");return a}},date:{xpathSelector:"self::cwrcEntry:DATE|self::cwrcEntry:DATERANGE",parentTag:["DATE","DATERANGE"],mapping:{tag:"local-name(.)"},annotation:function(e,t,n){var a=[];void 0!==t.getAttribute("FROM")?a.push("time:Interval"):a.push("time:Instant"),a.push("time:TemporalEntity");var o,r=e.commonAnnotation(t,n,a);"xml"===n?(o=void 0!==t.getAttribute("VALUE")?i.parseXML('<xsd:date xmlns:xsd="http://www.w3.org/2001/XMLSchema#">'+t.getAttribute("VALUE")+"</xsd:date>"):i.parseXML('<xsd:date xmlns:xsd="http://www.w3.org/2001/XMLSchema#">'+t.getAttribute("FROM")+"/"+t.getAttribute("TO")+"</xsd:date>"),i('[rdf\\:about="'+t.getUris().entityId+'"]',r).prepend(o.firstChild)):void 0!==t.getAttribute("VALUE")?r.hasBody["xsd:date"]=t.getAttribute("VALUE"):r.hasBody["xsd:date"]=t.getAttribute("FROM")+"/"+t.getAttribute("TO");return r}},note:{xpathSelector:"self::cwrcEntry:RESEARCHNOTE|self::cwrcEntry:SCHOLARNOTE",parentTag:["RESEARCHNOTE","SCHOLARNOTE"],isNote:!0,mapping:{tag:"local-name(.)",noteContent:"."},annotation:function(e,t,n){return e.commonAnnotation(t,n,"bibo:Note","oa:commenting")}},citation:{parentTag:"BIBCIT",isNote:!0,mapping:{uri:"@REF",noteContent:"."},annotation:function(e,t,n){return e.commonAnnotation(t,n,"dcterms:BibliographicResource","cw:citing")}},correction:{parentTag:"SIC",annotation:function(e,t,n){var a=e.commonAnnotation(t,n,"cnt:ContentAsText","oa:editing");if("xml"===n){var o=i.parseXML('<cnt:chars xmlns:cnt="http://www.w3.org/2011/content#">'+t.getAttribute("CORR")+"</cnt:chars>");i('[rdf\\:about="'+t.getUris().entityId+'"]',a).prepend(o.firstChild)}else a.hasBody["cnt:chars"]=t.getAttribute("CORR");return a}},keyword:{parentTag:"KEYWORDCLASS",isNote:!0,annotation:function(e,t,n){var a=e.commonAnnotation(t,n,["oa:Tag","cnt:ContentAsText","skos:Concept"],"oa:classifying"),o=t.getAttribute("KEYWORDTYPE");if("xml"===n){var r=i('[rdf\\:about="'+t.getUris().entityId+'"]',a),s=i.parseXML('<cnt:chars xmlns:cnt="http://www.w3.org/2011/content#">'+o+"</cnt:chars>");r.prepend(s.firstChild)}else a.hasBody["cnt:chars"]=o;return a}},link:{parentTag:"XREF",annotation:function(e,t,n){return e.commonAnnotation(t,n,"cnt:ContentAsText","oa:linking")}}}}},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n(1);e.exports=function(){var e,t,n={};function a(t){var n=[];return d(e.grammar,(function(e){"element"===e.$key&&e["@name"]===t&&n.push(e)})),n}function o(t){for(var n=e.grammar,i=null,a=t.split("/"),o=0;o<a.length;o++){var r=a[o];""!==r&&(r=r.replace(/\[\d+\]$/,""),d(n,(function(e){if(e["@name"]&&e["@name"]===r){if(n=e,o===a.length-1){if("element"===e.$key)return i=e,!1;n=e}return!0}}),!0))}return i}function r(t){for(var n=[],i=t.$parent;void 0!==i&&"define"!==i.$key&&"element"!==i.$key;)i=i.$parent;return"define"===i.$key?function t(n,i,a,o){var r=e.grammar,s=[];d(r,(function(e){"ref"===e.$key&&e["@name"]===n&&s.push(e)}));for(var l=0;l<s.length;l++){for(var c=s[l].$parent;void 0!==c&&"element"!==c.$key&&"define"!==c.$key;)c=c.$parent;if("element"===c.$key){var u=null;d(c,(function(e){if(e["a:documentation"])return u=e["a:documentation"],!1})),null!=u&&void 0!==u["#text"]?u=u["#text"]:null==u&&(u="");var g=p(u);o.push({name:c["@name"],fullName:g,level:a,documentation:u})}else i[c["@name"]]||(i[c["@name"]]=!0,t(c["@name"],i,a+1,o))}}(i["@name"],{},0,n):"element"===i.$key&&n.push({name:i["@name"],level:0}),n}function s(e,n){var a=[];if(function e(t,n,i,a,o,r){var s=[];d(t,(function(e){if("element"===e.$key&&e!==t)return!1;null!=e[a]&&(s=s.concat(e[a]))}));for(var l=0;l<s.length;l++){var g=s[l],f=null;d(g,(function(e){if(e["a:documentation"])return f=e["a:documentation"],!1})),null!=f&&void 0!==f["#text"]?f=f["#text"]:null==f&&(f="");var h=p(f);if(g.anyName)return void o.push("anyName");var m=!1;if(o.every((function(e,t,n){return e.name!==g["@name"]||(m=!0,!1)})),!m){var v={name:g["@name"],fullName:h,level:i+0,documentation:f};if("element"==a)r&&null!=r.optional?v.required=!r.optional:"element"===g.$parent.$key||"oneOrMore"===g.$parent.$key?v.required=!0:v.required=!1;else if("attribute"==a){r&&null!=r.optional?v.required=!r.optional:(v.required=!0,c(g.$parent,(function(e){if(e.optional)return v.required=!1,!1})));var y=null;d(g,(function(e){if(e["@a:defaultValue"])return y=e["@a:defaultValue"],!1})),v.defaultValue=y||"";var b=null,w=null;if(d(g,(function(e){if(e.choice&&(b=e.choice),e.list&&(w=e.list),null!==b&&null!==w)return!1})),null!=b){var _=[],x=[];d(b,(function(e){e.value&&(x=e.value)}));for(var C=0;C<x.length;C++){var k=x[C];k["#text"]&&(k=k["#text"]),_.push(k)}v.choices=_}}o.push(v)}}s=[],d(t,(function(e){if("element"===e.$key&&e!==t)return!1;e.ref&&(s=s.concat(e.ref))}));for(l=0;l<s.length;l++){var T=s[l],E=T["@name"],S=null;if(c(T,(function(e){if(e.$parent&&e.$parent.$key){var t=e.$parent.$key;if("choice"===t||"optional"===t||"zeroOrMore"===t)return S=!0,!1;if("oneOrMore"===t)return S=!1,!1}return!1})),!n[E]){n[E]=!0;var D=u(E);null!==D&&e(D,n,i+1,a,o,{optional:S})}}}(e,{},0,n,a),-1!=a.indexOf("anyName"))for(a=[],i=0;i<t.length;i++){var o=t[i];a.push({name:o})}return a}function l(e){e.sort((function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}))}function c(e,t){for(var n=!0;n&&null!=e;)null==(n=t.call(this,e))&&(n=!0),e=e.$parent}function d(e,t,n){var i=!0,a={};function o(e){return"[object Array]"===toString.apply(e)}!function e(r){var s;if(i)for(var l in null==(i=t.call(this,r))&&(i=!0),r)if("$parent"!=l&&"$key"!=l&&0!=l.search("@")){var c=r[l];if(!0===n&&"ref"===l){var d;d=o(c)?c:[c];for(var p=0;p<d.length;p++){var g=d[p]["@name"];if(void 0===a[g]){a[g]=!0;var f=u(g);null!==f&&e(f)}}}else if(o(c))for(var h=0;h<c.length;h++)e(c[h]);else(s=c)&&"[object Object]"===Object.prototype.toString.call(s)&&e(c)}}(e)}function u(t){for(var n=e.grammar.define,i=0,a=n.length;i<a;i++){var o=n[i];if(o["@name"]==t)return o}return console.warn("schemaNavigator: no definition found for",t),null}function p(e){var t=/^\((.*?)\)/.exec(e);return null!==t?t[1]:""}return n.setSchemaJSON=function(t){e=t},n.setSchemaElements=function(e){t=e},n.getParentsForTag=function(e){var t=a(e);if(0==t.length)return console.warn("schemaNavigator: cannot find element for "+e),[];for(var n=[],i=0;i<t.length;i++)n=n.concat(r(t[i]));return l(n),n},n.getParentsForPath=function(e){var t=o(e);if(null===t)return console.warn("schemaNavigator: cannot find element for "+e),[];var n=r(t);return l(n),n},n.getChildrenForTag=function(e){var t=a(e);if(0==t.length)return console.warn("schemaNavigator: cannot find element for "+e),[];for(var n=[],i=0;i<t.length;i++)n=n.concat(s(t[i],"element"));return l(n),n},n.getChildrenForPath=function(e){var t=o(e);if(null===t)return console.warn("schemaNavigator: cannot find element for "+e),[];var n=s(t,"element");return l(n),n},n.getAttributesForTag=function(e){var t=a(e);if(0==t.length)return console.warn("schemaNavigator: cannot find element for "+e),[];for(var n=[],i=0;i<t.length;i++)n=n.concat(s(t[i],"attribute"));return l(n),n},n.getAttributesForPath=function(e){var t=o(e);if(null===t)return console.warn("schemaNavigator: cannot find element for "+e),[];var n=s(t,"attribute");return l(n),n},n}},function(e,t,n){"use strict";var i=n(1);n(13),n(27),n(185);var a,o,r,s,l=n(42),c=(n(2),n(265)),d=n(266),u=n(268),p=n(269),g=n(270),f=n(271),h=n(272),m=n(273),v=n(275),y=n(276),b=n(277),w=n(278),_=n(279),x=n(280),C=n(281),k=n(282),T={tei:n(283),teiLite:n(295),orlando:n(307),cwrcEntry:n(318)};function E(e){if(e.is(":visible")&&0==e.parent(".ui-dialog").hasClass("popup")){var t=i(window).width(),n=i(window).height(),a=e.dialog("option","width"),o=e.dialog("option","height");a>t&&e.dialog("option","width",.8*t),o>n&&e.dialog("option","height",.8*n),e.dialog("option","position",{my:"center",at:"center",of:window})}}e.exports=function(e){var t=e,n=i('<div class="cwrc cwrcDialogWrapper"></div>').appendTo(t.layoutManager.getContainer());!function(e){a=i.ui.dialog.prototype.options.appendTo,o=i.ui.dialog.prototype.options.create,r=i.ui.tooltip.prototype.options.open,s=i.custom.popup.prototype.options.create,i.extend(i.ui.dialog.prototype.options,{appendTo:e,create:function(e){i(e.target).on("dialogopen",(function(e){E(i(e.target)),i(window).on("resize",i.proxy(E,this,i(e.target)))})).on("dialogclose",(function(e){i(window).off("resize",i.proxy(E,this,i(e.target)))}))}}),i.extend(i.ui.tooltip.prototype.options,{create:function(t,n){var a=i(this).tooltip("instance");a.liveRegion=a.liveRegion.appendTo(e)}}),i.extend(i.ui.tooltip.prototype,{_appendTo:function(t){var n=t.closest(".ui-front, dialog");return n.length||(n=e),n}}),i.extend(i.custom.popup.prototype.options,{appendTo:e,create:function(e){i(e.target).on("popupopen",(function(e){E(i(e.target)),i(window).on("resize",i.proxy(E,this,i(e.target)))})).on("popupclose",(function(e){i(window).off("resize",i.proxy(E,this,i(e.target)))}))}})}(n);var S={},D={},M={addDialog:function(e,i){var a=new i(t,n);return void 0===a.show&&console.warn(e+' doesn\'t have required method "show"!'),void 0===a.destroy&&console.warn(e+' doesn\'t have required method "destroy"!'),S[e]=a,a},getDialog:function(e){return S[e]},getDialogWrapper:function(){return n},show:function(e,n){var i;if(n=void 0===n?{}:n,0===e.indexOf("schema/")){var a=e.split("/");e=a[1],i=D[t.schemaManager.getCurrentSchema().schemaMappingsId][e]}else S[e]?i=S[e]:D[t.schemaManager.getCurrentSchema().schemaMappingsId][e]&&(i=D[t.schemaManager.getCurrentSchema().schemaMappingsId][e]);void 0!==i&&i.show(n)},confirm:function(e){S.message.confirm(e)}};M.destroy=function(){for(var e in D){var t=D[e];for(var n in t)t[n].destroy()}for(var n in S)void 0!==S[n].destroy?S[n].destroy():console.warn("dialogManager: cannot destroy",n);i.extend(i.ui.dialog.prototype.options,{appendTo:a,create:o}),i.extend(i.ui.tooltip.prototype.options,{open:r}),i.extend(i.custom.popup.prototype.options,{appendTo:a,create:s})},M.getDialogPref=function(e){var t=l.getJSON("cwrc-writer-base-dialog-preferences");return void 0!==t&&void 0!==t[e]?t[e]:void 0},M.setDialogPref=function(e,t){var n=l.getJSON("cwrc-writer-base-dialog-preferences");void 0===n&&(n={}),n[e]=t,l.set("cwrc-writer-base-dialog-preferences",n,{expires:7,path:""})},M.clearDialogPrefs=function(){l.remove("cwrc-writer-base-dialog-preferences",{path:""})};var R={message:g,popup:y,copyPaste:v,triple:f,translation:m,loadingindicator:d,addschema:c,person:b,org:_,title:x,citation:C,place:w,rs:k,attributesEditor:h};for(var A in!0!==t.isReadOnly&&!0!==t.isAnnotator&&(R.header=u,R.editSource=p),R)M.addDialog(A,R[A]);return t.event("schemaLoaded").subscribe((function(){var e=t.schemaManager.getCurrentSchema().schemaMappingsId;if(void 0===D[e])for(var i in D[e]={},T[e]){var a=T[e][i];D[e][i]=new a(t,n)}})),M}},,,,,,,,,,function(e,t,n){"use strict";var i=n(1);e.exports=function(e,t){var n=e,a=i('<div><div><label>Schema Name</label><input type="text" name="name" value=""/></div><div style="margin-top: 10px;"><label>Schema URL</label><input type="text" name="xmlUrl" value=""/></div><div style="margin-top: 10px;"><label>Schema CSS URL</label><input type="text" name="cssUrl" value=""/></div></div>').appendTo(t);return a.dialog({modal:!0,resizable:!1,closeOnEscape:!1,open:function(e,t){a.parent().find(".ui-dialog-titlebar-close").hide()},title:"Add Schema",height:300,width:250,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,buttons:{Add:function(){var e={};i("input",a).each((function(t,n){e[n.getAttribute("name")]=i(n).val()}));n.schemaManager.addSchema(e);a.dialog("close")},Cancel:function(){a.dialog("close")}}}),{show:function(e){i("input",a).val(""),a.dialog("open")},destroy:function(){a.dialog("destroy")}}}},function(e,t,n){"use strict";var i=n(1);n(13),n(267),e.exports=function(e,t){var n=e,a=i('<div class="loadingIndicatorDialog"><div class="progressBar"><div class="progressLabel"></div></div></div>').appendTo(t);a.dialog({title:"CWRC-Writer",modal:!0,resizable:!1,closeOnEscape:!1,height:160,width:300,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},buttons:{},autoOpen:!1,open:function(e,t){i(".ui-dialog-titlebar-close",t.dialog).hide()}});var o=a.find(".progressBar");o.progressbar({value:0});var r=a.find(".progressLabel");return n.event("loadingDocument").subscribe((function(){n.dialogManager.show("loadingindicator"),r.text("Loading Document"),o.progressbar("value",!1)})),n.event("loadingSchema").subscribe((function(){n.dialogManager.show("loadingindicator"),r.text("Loading Schema"),o.progressbar("value",!1)})),n.event("documentLoaded").subscribe((function(e,t){o.progressbar("value",100),a.dialog("close")})),n.event("schemaLoaded").subscribe((function(){r.text("Schema Loaded"),a.dialog("close")})),n.event("savingDocument").subscribe((function(){n.dialogManager.show("loadingindicator"),r.text("Saving Document"),o.progressbar("value",5)})),n.event("documentSaved").subscribe((function(e){o.progressbar("value",100),!0!==e?(r.text("Error Saving Document"),a.dialog("option","buttons",{Ok:function(){a.dialog("close")}})):a.dialog("close")})),{setText:function(e){r.text(e)},setValue:function(e){o.progressbar("value",e)},show:function(e){a.dialog("open")},hide:function(){a.dialog("close")},destroy:function(){o.progressbar("destroy"),a.dialog("destroy")}}}},,function(e,t,n){"use strict";var i=n(1);n(13),e.exports=function(e,t){var n=e,a=i('<div class="editHeader">Edit Header</div>').appendTo(n.layoutManager.getHeaderButtonsParent()),o=i('<div class="headerDialog"><div><textarea style="height: 98%; width: 98%; font-family: monospace;" spellcheck="false"></textarea></div></div>').appendTo(t);function r(){var e="";i('[_tag="'+n.schemaManager.getHeader()+'"]',n.editor.getBody()).children().each((function(t,a){e+=n.converter.buildXMLString(i(a))})),o.find("textarea").val(e),o.dialog("open")}return o.dialog({title:"Edit Header",modal:!0,resizable:!0,height:380,width:400,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,buttons:[{text:"Ok",role:"ok",click:function(){var e,t="<head>"+o.find("textarea").val()+"</head>";try{e=i.parseXML(t)}catch(e){return n.dialogManager.show("message",{title:"Invalid XML",msg:"There was an error parsing the XML.",type:"error"}),!1}var a="";i(e).find("head").children().each((function(e,t){a+=n.converter.buildEditorString(t)})),i('[_tag="'+n.schemaManager.getHeader()+'"]',n.editor.getBody()).html(a),o.dialog("close")}},{text:"Cancel",role:"cancel",click:function(){o.dialog("close")}}]}),a.click((function(){r()})),{show:function(e){r()},destroy:function(){o.dialog("destroy")}}}},function(e,t,n){"use strict";var i=n(1);n(13),e.exports=function(e,t){var n=e,a=i('<div><textarea style="height: 98%; width: 98%; font-family: monospace;" spellcheck="false"></textarea></div>').appendTo(t);return a.dialog({title:"Edit Source",modal:!0,resizable:!0,closeOnEscape:!0,height:480,width:640,autoOpen:!1,buttons:[{text:"Ok",role:"ok",click:function(){var e=i("textarea",a).val();a.dialog("close"),setTimeout((function(){n.loadDocumentXML(e,!1)}),0)}},{text:"Cancel",role:"cancel",click:function(){a.dialog("close")}}],open:function(e){console.time("set focus");var t=i(this).find("textarea");t.focus(),t[0].setSelectionRange(0,0),t.scrollTop(0),console.timeEnd("set focus")},close:function(e){i("textarea",a).val("")}}),{show:function(e){n.dialogManager.confirm({title:"Edit Raw XML",msg:"Editing the XML directly is only recommended for advanced users who know what they're doing.<br/><br/>Are you sure you wish to continue?",showConfirmKey:"confirm-edit-source",type:"info",callback:function(e){e&&n.converter.getDocumentContent(!0,(function(e){console.time("dialog open"),a.dialog("open"),console.timeEnd("dialog open"),console.time("set doc text"),i("textarea",a).val(e),console.timeEnd("set doc text")}))}})},destroy:function(){a.dialog("destroy")}}}},function(e,t,n){"use strict";function i(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o,r=!0,s=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return r=e.done,e},e:function(e){s=!0,o=e},f:function(){try{r||null==i.return||i.return()}finally{if(s)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var o=n(1);e.exports=function(e,t){var n=e,a=[];function r(e){var i=o('\n        <div>\n            <p>\n            <span class="ui-state-highlight" style="border: none;"><span style="float: left; margin-right: 4px;" class="ui-icon ui-icon-info"></span></span>\n            <span class="ui-state-error" style="border: none;"><span style="float: left; margin-right: 4px;" class="ui-icon ui-icon-alert"></span></span>\n            <span class="message"></span>\n            </p>\n            <span id="confirmCheckboxParent" style="display: none;">\n                <input type="checkbox" id="showConfirmCheckbox" checked/>\n                <label for="showConfirmCheckbox">Show this warning next time</label>\n            </span>\n        </div>\n        ').appendTo(t),r=e.title,s=null==e.modal||e.modal,l=e.height?e.height:300,c=e.width?e.width:300;i.dialog({title:r,modal:s,resizable:!0,closeOnEscape:!0,height:l,width:c,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,close:function(t){a.splice(a.indexOf(i),1),i.dialog("destroy"),i.remove(),"message"===e.dialogType&&e.callback&&setTimeout(e.callback,0)}});var d=e.msg;i.find("p > span[class=message]").html(d);var u=e.type;return i.find("p > span[class^=ui-state]").hide(),"info"==u?i.find("p > span[class=ui-state-highlight]").show():"error"==u&&i.find("p > span[class=ui-state-error]").show(),a.push(i),i}return{show:function(e){e.dialogType="message";var t=r(e);t.dialog("option","buttons",[{text:"Ok",role:"ok",click:function(){t.dialog("close")}}]),t.dialog("open")},confirm:function(e){if(e.showConfirmKey&&!1===n.dialogManager.getDialogPref(e.showConfirmKey))return void e.callback(!0);e.dialogType="confirm";var t=r(e);e.showConfirmKey&&o("#confirmCheckboxParent").show();var i=e.callback,a=e.yesText||"Yes",s=e.noText||"No";t.dialog("option","buttons",[{text:a,role:"yes",click:function(){if(e.showConfirmKey){var a=o("#showConfirmCheckbox").prop("checked");n.dialogManager.setDialogPref(e.showConfirmKey,a)}t.dialog("close"),setTimeout((function(){i(!0)}),0)}},{text:s,role:"no",click:function(){if(e.showConfirmKey){var a=o("#showConfirmCheckbox").prop("checked");n.dialogManager.setDialogPref(e.showConfirmKey,a)}t.dialog("close"),setTimeout((function(){i(!1)}),0)}}]),t.dialog("open")},destroy:function(){var e,t=i(a);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.dialog("destroy"),n.remove()}}catch(e){t.e(e)}finally{t.f()}a=[]},getOpenDialogs:function(){return a}}}},function(e,t,n){"use strict";var i=n(1);n(186),n(6),e.exports=function(e,t){var n=e,a={person:["is a child of","is a parent of","is related to","was born on","died on"],place:["is located within","contains"]},o=i('<div class="triplesDialog"><div class="columns"><div class="column"><h2>Subject</h2><ul class="entitiesList"></ul><div class="customEntry"><input type="text" name="customSubject" value="" /></div></div><div class="column predicate"><h2>Predicate</h2><ul></ul><div class="customEntry"><input type="text" name="customPredicate" value="" /></div></div><div class="column"><h2>Object</h2><ul class="entitiesList"></ul><div class="customEntry"><input type="text" name="customObject" value="" /></div></div></div><div class="currentRelation"><p></p><button type="button">Add Relation</button></div></div>').appendTo(t);o.dialog({title:"Add Relation",modal:!0,resizable:!0,closeOnEscape:!0,height:450,width:600,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,buttons:{Close:function(){o.dialog("close")}}});var r=i(".column:eq(0)",o),s=i(".column:eq(1)",o),l=i(".column:eq(2)",o);i("input",r).watermark("Custom Subject"),i("input",s).watermark("Custom Predicate"),i("input",l).watermark("Custom Object"),i("input",o).keyup((function(){i(this).parents(".column").find("li").removeClass("selected"),u()})),i(".currentRelation button",o).button({disabled:!0}).click((function(){var e=d(),t=e[0],i=e[1],a=e[2];n.triples.push({subject:t,predicate:{text:i.text,name:c(i.text),external:i.external},object:a}),n.relations.update()}));var c=function(e){for(var t=e.split(/\s/),n="",i=0;i<t.length;i++)n+=0==i?t[i].toLowerCase():t[i].replace(/^./,(function(e){return e.toUpperCase()}));return n},d=function(){var e=[null,null,null];return i("ul",o).each((function(t,a){var o=i(this).find(".selected");if(1==o.length){var r="",s=o.attr("name");null!=s&&(r=n.entitiesManager.getEntity(s).getUris().annotationId),e[t]={text:n.utilities.escapeHTMLString(o.text()),uri:r,external:!1}}})),i("input",o).each((function(t,a){var o=i(this).val();""!=o&&(e[t]={text:n.utilities.escapeHTMLString(o),uri:n.utilities.escapeHTMLString(o),external:!0})})),e},u=function(){for(var e="",t=d(),n=!0,a=0;a<t.length;a++){var r=t[a];null==r?n=!1:(e+=r.text,e+=a<2?" ":".")}i(".currentRelation p",o).html(e),n?i(".currentRelation button",o).button("enable"):i(".currentRelation button",o).button("disable")};return{show:function(e){i(".column > ul",o).empty(),i(".currentRelation p",o).html("");var t="";n.entitiesManager.eachEntity((function(e,n){t+=function(e){return'<li class="'+e.getType()+'" name="'+e.getId()+'"><span class="box"/><span class="entityTitle">'+e.getContent()+"</span></li>"}(n)})),i("ul",r).html(t),i("ul",l).html(t),i(".entitiesList > li",o).hover((function(){i(this).hasClass("selected")||i(this).addClass("over")}),(function(){i(this).hasClass("selected")||i(this).removeClass("over")})).click((function(e){(i(this).siblings("li").removeClass("selected"),i(this).removeClass("over").toggleClass("selected"),i(this).parents(".column").find("input").val(""),r.find(this).length>0)&&(i(this).hasClass("selected")?function(e){i(".predicate > ul",o).empty();for(var t=a[e]||["is associated with"],n="",r=0;r<t.length;r++)n+="<li>"+t[r]+"</li>";i(".predicate > ul",o).html(n),i(".predicate > ul li",o).click((function(){i(this).siblings("li").removeClass("selected"),i(this).toggleClass("selected"),i(this).parents(".column").find("input").val(""),u()}))}(n.entitiesManager.getEntity(i(this).attr("name")).getType()):i("ul",s).empty());u()})),o.dialog("open")},destroy:function(){o.dialog("destroy")}}}},function(e,t,n){"use strict";var i=n(1),a=n(33);e.exports=function(e,t){var n=e,o=null,r=i('<div class="annotationDialog"><div class="entityWarning" style="display: none;">Warning: you are creating a tag but <em>not</em> a corresponding entity/linked data annotation. Use the button on the tool bar to create a tag and an entity simultaneously.</div><div class="attributeWidget" /></div>').appendTo(t),s=null;r.dialog({modal:!0,resizable:!0,dialogClass:"splitButtons",closeOnEscape:!1,height:460,width:550,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},minHeight:400,minWidth:510,autoOpen:!1,open:function(e,t){s=e.timeStamp,r.parent().find(".ui-dialog-titlebar-close").hide()},beforeClose:function(e,t){if(e.timeStamp-s<150)return!1},buttons:[{text:"Cancel",role:"cancel",click:function(){d()}},{text:"Ok",role:"ok",click:function(){c()}}]});var l=new a({writer:n,$parent:r,$el:r.find(".attributeWidget"),showSchemaHelp:!0}),c=function(){var e=l.getData();if(void 0===e&&(e={}),r.dialog("close"),r.is(":hidden")){try{i("ins",r).tooltip("destroy")}catch(e){console&&console.log("error destroying tooltip")}o.call(n,e),o=null}},d=function(){if(r.dialog("close"),r.is(":hidden")){n.editor.selection.moveToBookmark(n.editor.currentBookmark);try{i("ins",r).tooltip("destroy")}catch(e){console&&console.log("error destroying tooltip")}o.call(n,null),o=null}};return{show:function(e,t,s,c){o=c,function(e,t,o){var s;(n.editor.getBody().blur(),r.find(".entityWarning").hide(),n.mode!==n.XML)&&(null!==n.schemaManager.mapper.getEntityTypeForTag(e)&&r.find(".entityWarning").show());i.isEmptyObject(o)?l.mode=a.ADD:l.mode=a.EDIT,s=void 0!==t?n.schemaManager.getAttributesForPath(t):n.schemaManager.getAttributesForTag(e),l.buildWidget(s,o,e),r.dialog("option","title",e),r.dialog("open"),i("button[role=ok]",r.parent()).focus()}(e,t,s)},destroy:function(){l.destroy(),r.dialog("destroy")}}}},function(e,t,n){"use strict";var i=n(1);n(13),n(32);var a=n(274),o=n(33);e.exports=function(e,t){var n=e,r=n.getUniqueId("translation_"),s=i('\n    <div class="annotationDialog">\n        <div>\n            <label for="'.concat(r,'_lang">Language:</label>\n            <select id="').concat(r,'_lang"></select>\n        </div>\n        <div>\n            <label for="').concat(r,'_resp">Add Responsibility:</label>\n            <input id="').concat(r,'_resp" type="checkbox" />\n        </div>\n        <div>\n            <label for="').concat(r,'_trans">Translation text</label>\n            <textarea id="').concat(r,'_trans" style="width: 98%; height: 100px;" spellcheck="false"></textarea>\n            <p>You will be able to tag and edit the text in the main document.</p>\n        </div>\n        <div>\n            <h3>Markup options</h3>\n            <div id="').concat(r,'_atts" class="attributes" />\n        </div>\n    </div>')).appendTo(t);s.dialog({title:"Tag Translation",modal:!0,resizable:!0,closeOnEscape:!0,height:500,width:600,autoOpen:!1,buttons:[{text:"Ok",role:"ok",click:function(){u(),s.dialog("close")}},{text:"Cancel",role:"cancel",click:function(){s.dialog("close")}}],open:function(e){},close:function(e){}});var l=a.reduce((function(e,t){var n=t.iso6391,i=t.name;return void 0!==n&&e.push({name:i,value:n}),e}),[]);l.sort((function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}));var c="";l.forEach((function(e){c+='<option value="'.concat(e.value,'">').concat(e.name,"</option>")})),i("#"+r+"_lang").html(c),i("#"+r+"_atts").parent().accordion({heightStyle:"content",animate:!1,collapsible:!0,active:!1});var d=new o({writer:n,$parent:s,$el:i("#"+r+"_atts"),showSchemaHelp:!0});i("#"+r+"_lang").on("change",(function(e){d.setAttribute("xml:lang",e.target.value)})),i("#"+r+"_resp").on("change",(function(e){e.target.checked?d.setAttribute("resp",n.getUserInfo().nick):d.setAttribute("resp",void 0)}));var u=function(){var e=i("#"+r+"_trans").val(),t=d.getData(),a=n.tagger.getCurrentTag().attr("id"),o=n.tagger.addStructureTag("div",t,{tagId:a},n.tagger.AFTER),s=n.tagger.addStructureTag("p",{},{tagId:o.id},n.tagger.INSIDE);i(s).html(e)};return{show:function(e){if("div"===n.tagger.getCurrentTag().attr("_tag")){var t=i("#"+r+"_resp");n.schemaManager.isAttributeValidForTag("resp","div")?t.parent().show():t.parent().hide(),t.prop("checked",!1);var a=i("#"+r+"_lang > option:eq(0)").val();i("#"+r+"_lang").val(a),i("#"+r+"_trans").val(""),d.mode=o.ADD;var l=n.schemaManager.getAttributesForTag("div"),c={type:"translation"};c["xml:lang"]=a,d.buildWidget(l,c,"div"),i("#"+r+"_atts").parent().accordion("option","active",!1),s.dialog("open")}else n.dialogManager.show("message",{title:"Translation",msg:"Please select a ".concat("div"," tag to translate."),type:"info"})},destroy:function(){i("#"+r+"_atts").parent().accordion("destroy"),s.dialog("destroy")}}}},,function(e,t,n){"use strict";var i=n(1);e.exports=function(e,t){var n=e,a=!0,o=!0,r=!1,s=i('<div><div class="content"></div></div>').appendTo(t);s.dialog({title:"Copy & Paste Help",modal:!0,resizable:!0,closeOnEscape:!0,height:250,width:350,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,dialogClass:"splitButtons",buttons:[{text:"Ok",click:function(){s.dialog("close")}}]}),n.event("contentCopied").subscribe((function(){r=!0,a&&(a=!1,l.show({type:"copy"}))})),n.event("contentPasted").subscribe((function(){o&&!r&&(o=!1,l.show({type:"paste"})),r=!1}));var l={show:function(e){var t,n=e.type,i=void 0!==e.modal&&e.modal;s.dialog("option","modal",i),"copy"==n?t='It looks like you\'re trying to copy content.<br/>Consider having a look at the <a href="https://cwrc.ca/CWRC-Writer_Documentation/#CWRCWriter_Copy_Splash.html" target="_blank">Copy & Paste Documentation</a>':"paste"==n&&(t='It looks like you\'re trying to paste from outside CWRC-Writer. Be aware that <b>all tags will be removed</b> and only plain text will remain.<br/>Consider having a look at the <a href="https://cwrc.ca/CWRC-Writer_Documentation/#CWRCWriter_Copy_Splash.html" target="_blank">Copy & Paste Documentation</a>'),s.find(".content").html(t),s.dialog("open")},destroy:function(){s.dialog("destroy")}};return l}},function(e,t,n){"use strict";var i=n(1);n(185),e.exports=function(e,t){var n,a,o=e,r="",s="",l=o.getUniqueId("popupDialog"),c=i('<div id="'+l+'"></div>').appendTo(t);c.popup({autoOpen:!1,resizable:!1,draggable:!1,minHeight:30,minWidth:40,open:function(e,t){c.parent().find(".ui-dialog-titlebar-close").hide()},position:{my:"center",at:"center",of:a,using:function(e,t){var n=t.element.element,r=i(o.editor.getDoc().documentElement),s=i(document.documentElement),l=a.offset(),c=i(o.editor.iframeElement).offset(),d=r.scrollTop(),u=r.scrollLeft(),p=s.scrollTop(),g=s.scrollLeft();e.top=c.top+l.top+a.height()-d-p,e.left=c.left+l.left-u-g;var f=o.utilities.constrain(e.left,s.width(),n.outerWidth()),h=o.utilities.constrain(e.top,s.height(),n.outerHeight());n.css({left:f+"px",top:h+"px"})}}});var d=function(e){0==(a=i("#"+e,o.editor.getBody())).length&&(a=i('[name="'+e+'"]',o.editor.getBody()).first())},u=function(){clearTimeout(n)},p=function(){n=setTimeout(w,500)},g=function(){var e=c.text();window.open(e)},f=function(e,t){var i;if(c.parent().off("mouseover",u),c.parent().off("mouseout",p),c.off("click",g),c.popup("option","dialogClass","popup "+t),c.html(e),c.popup("open"),"note"===t)i=350;else{c.popup("option","width","auto");var o=c.width();i="link"===t?o+30:Math.min(200,o)+30}c.popup("option","width",i),clearTimeout(n),a.one("mouseout",(function(){n=setTimeout(w,1e3)})),c.parent().on("mouseover",u),c.parent().on("mouseout",p)},h=function(e){var t=this.getAttribute("id")||this.getAttribute("name");d(t);for(var n=null,i=o.schemaManager.mapper.getPopupAttributes(),r=0;r<i.length;r++){var s=a.attr(i[r]);if(void 0!==s){n=s;break}}null!=n&&f(n,"tag")},m=function(e){var t=this.getAttribute("id")||this.getAttribute("name");d(t);for(var n=null,i=o.schemaManager.mapper.getUrlAttributes(),r=0;r<i.length;r++){var s=a.attr(i[r]);if(void 0!==s){n=s;break}}v(n)},v=function(e){e&&(0===e.indexOf("http")?(f(e,"link"),c.on("click",g)):f(e,"tag"))},y=function(e){a=i(this);var t=i(this).children("[_entity]").attr("id"),n=o.entitiesManager.getEntity(t);if(null!==this.textContent.match(/\S+/)){var r=n.getNoteContent();void 0===r&&(r=n.getContent()),void 0!==r&&f(r,"note")}else"citation"===n.getType()&&v(n.getURI())},b=function(e){w()},w=function(){c.popup("close")},_=function(){var e=i(o.editor.getBody());e.off("mouseover",r,h),e.off("mouseover",s,m),e.off("mouseover",".noteWrapper.hide",y),e.off("click",".noteWrapper",b),e.off("contextmenu",w)};return o.event("schemaLoaded").subscribe((function(){_();var e=i(o.editor.getBody()),t=o.schemaManager.mapper.getPopupAttributes();r="",i.map(t,(function(e,n){r+="["+e+"]",n<t.length-1&&(r+=",")})),""!=r&&e.on("mouseover",r,h);var n=o.schemaManager.mapper.getUrlAttributes();s="",i.map(n,(function(e,t){s+="["+e+"]",t<n.length-1&&(s+=",")})),""!=s&&e.on("mouseover",s,m),e.on("mouseover",".noteWrapper.hide",y),e.on("click",".noteWrapper",b),e.on("contextmenu",w)})),{show:function(e){console.warn("dialogManager.popup: shouldn't call show directly")},destroy:function(){_()}}}},function(e,t,n){"use strict";n(1);var i=n(15);e.exports=function(e){return new i(e,{label:"Person",localDialog:"person",cwrcType:"person"})}},function(e,t,n){"use strict";n(1);var i=n(15);e.exports=function(e){return new i(e,{label:"Place",localDialog:"place",cwrcType:"place"})}},function(e,t,n){"use strict";n(1);var i=n(15);e.exports=function(e){return new i(e,{label:"Organization",localDialog:"org",cwrcType:"organization"})}},function(e,t,n){"use strict";n(1);var i=n(15);e.exports=function(e){return new i(e,{label:"Title",localDialog:"title",cwrcType:"title"})}},function(e,t,n){"use strict";n(1);var i=n(15);e.exports=function(e){return new i(e,{label:"Citation",localDialog:"citation",cwrcType:"title"})}},function(e,t,n){"use strict";n(1);var i=n(15);e.exports=function(e){return new i(e,{label:"RS",localDialog:"rs",cwrcType:"rs"})}},function(e,t,n){var i=n(284),a=n(285),o=n(286),r=n(287),s=n(288),l=n(289),c=n(290),d=n(291),u=n(292),p=n(293),g=n(294);e.exports={citation:i,correction:a,date:o,keyword:r,link:s,note:l,org:c,person:d,place:u,title:p,rs:g}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("citationForm_"),r=i('<div class="annotationDialog"><div><p>Selected source:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div><label for="'+o+'_noteContent">Citation text</label><textarea id="'+o+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div><input type="hidden" data-type="hidden" data-mapping="type" value="citation" /></div>').appendTo(t),s=new a({writer:n,$el:r,width:600,height:500,type:"citation",title:"Tag Citation"});return s.$el.on("beforeShow",(function(e,t,n){n.mode===a.EDIT?(n.$el.find("label[for="+o+"_noteContent]").hide(),n.$el.find("#"+o+"_noteContent").hide()):(n.$el.find("label[for="+o+"_noteContent]").show(),n.$el.find("#"+o+"_noteContent").show())})),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("corrForm_"),r=i('<div class="annotationDialog"><div><p>Correction</p><textarea data-type="textbox" data-mapping="custom.corrText"></textarea></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:385,height:400,type:"correction",title:"Tag Correction"});return s.$el.on("beforeShow",(function(e,t,i){var o;i.mode===a.ADD?o=n.editor.currentBookmark.rng.toString():void 0===(o=t.entry.getCustomValue("sicText"))&&r.find("textarea").val(t.entry.getContent()),void 0!==o&&""!==o&&(i.currentData.customValues.sicText=o)})),s.$el.on("beforeSave",(function(e,t){var o=t.currentData.customValues.sicText,r=t.currentData.customValues.corrText;if(t.mode===a.EDIT){if(null==o){var s=n.entitiesManager.getCurrentEntity();i("#"+s,n.editor.getBody()).text(r),n.entitiesManager.getEntity(s).setContent(r)}}else if(void 0===o){var l=n.getUniqueId("temp"),c=i('<span id="'+l+'"/>',n.editor.getDoc()),d=n.editor.selection.getRng(!0);d.surroundContents(c[0]),c.html(r);var u=c[0].firstChild;i(u).unwrap(),d.selectNodeContents(u),n.editor.currentBookmark=n.editor.selection.getBookmark(1)}})),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(0);a.suppressDeprecationWarnings=!0;var o=n(2);n(28),n(6),e.exports=function(e,t){var n=e,r=(new Date).getFullYear()+10,s=n.getUniqueId("dateForm_"),l=i('<div class="annotationDialog"><div id="'+s+'_type" data-transform="buttonset"><p>Date type:</p><input type="radio" name="dateType" value="date" id="'+s+'_type_date" checked="checked"/><label for="'+s+'_type_date">Single Date</label><input type="radio" name="dateType" value="range" id="'+s+'_type_range"/><label for="'+s+'_type_range">Date Range</label></div><div id="'+s+'_date"><label for="'+s+'_cwrc_datePicker">Date:</label><br/><input type="text" data-type="textbox" data-mapping="when" id="'+s+'_cwrc_datePicker" /></div><div id="'+s+'_range"><label for="'+s+'_startDate">Start date:</label><br/><input type="text" data-type="textbox" data-mapping="from" id="'+s+'_startDate" style="margin-bottom: 5px;"/><br /><label for="'+s+'_endDate">End date:</label><br/><input type="text" data-type="textbox" data-mapping="to" id="'+s+'_endDate" /></div><div>Format: YYYY, YYYY-MM, or YYYY-MM-DD<br/>e.g. 2010, 2010-10, 2010-10-31</div><div id="'+s+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+s+'_high" name="'+s+'_id_certainty" value="high" data-default="true" /><label for="'+s+'_high">High</label><input type="radio" id="'+s+'_medium" name="'+s+'_id_certainty" value="medium" /><label for="'+s+'_medium">Medium</label><input type="radio" id="'+s+'_low" name="'+s+'_id_certainty" value="low" /><label for="'+s+'_low">Low</label><input type="radio" id="'+s+'_unknown" name="'+s+'_id_certainty" value="unknown" /><label for="'+s+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+s+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),c=new o({writer:n,$el:l,type:"date",title:"Tag Date"});i("#"+s+"_type input").click((function(){f(i(this).val())}));var d=i("#"+s+"_cwrc_datePicker");d.focus((function(){i(this).css({borderBottom:""})})),d.datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(r,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0}),i("#ui-datepicker-div").appendTo(t);var u=i("#"+s+"_startDate");u.focus((function(){i(this).css({borderBottom:""})}));var p=i("#"+s+"_endDate");p.focus((function(){i(this).css({borderBottom:""})}));var g=i("#"+s+"_startDate, #"+s+"_endDate").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(r,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0,onSelect:function(e){var t=-1===this.id.indexOf("startDate")?"maxDate":"minDate",n=i(this).data("datepicker"),a=i.datepicker.parseDate(n.settings.dateFormat||i.datepicker._defaults.dateFormat,e,n.settings);g.not(this).datepicker("option",t,a)}}),f=function(e){d.val(""),u.val(""),p.val(""),"date"==e?(i("#"+s+"_date").show(),i("#"+s+"_range").hide()):(i("#"+s+"_date").hide(),i("#"+s+"_range").show())};return c.$el.on("beforeShow",(function(e,t){if(g.datepicker("option","minDate",new Date(1800,0,1)),g.datepicker("option","maxDate",new Date(r,11,31)),c.mode===o.ADD){var l="",h=n.editor.currentBookmark.rng.toString();if(""!=h){var m=a(h);if(m.isValid()){var v=m.toDate(),y=v.getFullYear();if(h.length>4){var b=v.getMonth();++b<10&&(b="0"+b);var w=v.getDate();w<10&&(w="0"+w),l=y+"-"+b+"-"+w}else l=++y}}f("date"),i("#"+s+"_type_date").prop("checked",!0),d.val(l),u.val(""),p.val("")}else{var _=t.entry.getAttributes();void 0!==_.when?(f("date"),i("#"+s+"_type_date").prop("checked",!0),d.val(_.when),u.val(""),p.val("")):(f("range"),i("#"+s+"_type_range").prop("checked",!0),d.val(""),u.val(_.from),p.val(_.to))}i("#"+s+"_type input").button("refresh"),d.css({borderBottom:""}),u.css({borderBottom:""}),p.css({borderBottom:""}),d.focus()})),c.$el.on("beforeSave",(function(e,t){var n=!1;if("date"===i("#"+s+"_type input:checked").val()){var o=d.val();a(o).isValid()?t.currentData.attributes.when=o:(d.css({borderBottom:"1px solid red"}),n=!0)}else{var r=u.val(),l=p.val(),c=a(r),g=a(l);c.isValid()?t.currentData.attributes.from=r:(u.css({borderBottom:"1px solid red"}),n=!0),g.isValid()?t.currentData.attributes.to=l:(p.css({borderBottom:"1px solid red"}),n=!0),c.isAfter(g)&&(u.css({borderBottom:"1px solid red"}),p.css({borderBottom:"1px solid red"}),n=!0)}t.isValid=!n})),{show:function(e){c.show(e)},destroy:function(){d.datepicker("destroy"),g.datepicker("destroy"),c.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=!1,r=n.getUniqueId("keywordForm_"),s=i('<div class="annotationDialog"><div><label for="'+r+'_noteContent">Keyword</label><input type="text" id="'+r+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="margin-right: 10px;"/><p>You will be able to edit the keyword in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div><input type="hidden" data-type="hidden" data-mapping="type" value="keyword" /></div>').appendTo(t),l=new a({writer:n,$el:s,type:"keyword",title:"Tag Keyword",height:420,width:420});return l.$el.on("beforeSave",(function(e,t){o||void 0!==t.currentData.attributes.ana?t.isValid=!0:(t.isValid=!1,n.dialogManager.confirm({title:"Warning",msg:'<p>A human-readable keyword is preferably linked, using the "ana" attribute, to a controlled vocabulary.</p><p>Click "Add Link" to add a URL for your term or "Skip Link" to save as is.</p>',yesText:"Skip Link",noText:"Add Link",showConfirmKey:"confirm-tei-keyword",type:"info",callback:function(e){setTimeout((function(){e&&(o=!0,t.save())}))}}))})),l.$el.on("beforeShow",(function(e,t){l.isValid=!0,o=!1,l.mode===a.ADD?(l.attributesWidget.setData({ana:""}),l.attributesWidget.expand(),l.$el.find("label[for="+r+"_noteContent]").show(),l.$el.find("#"+r+"_noteContent").show()):(l.$el.find("label[for="+r+"_noteContent]").hide(),l.$el.find("#"+r+"_noteContent").hide())})),{show:function(e){l.show(e)},destroy:function(){l.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);n(6),e.exports=function(e,t){var n=e,o=n.getUniqueId("linkForm_"),r=i('<div class="annotationDialog"><div><label for="'+o+'_input">Hypertext link (URL or URI)</label><input type="text" id="'+o+'_input" data-type="textbox" data-mapping="target" style="margin-right: 10px;"/><button type="button">Check Link</button></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:350,height:350,type:"link",title:"Tag Link"});return i("button",r).button().click((function(){var e=i("#"+o+"_input").val();if(""!=e){null==e.match(/^https?:\/\//)&&(e="http://"+e);try{window.open(e,"linkTestWindow")}catch(e){alert(e)}}})),{show:function(e){s.show(e)},destroy:function(){i("button",r).button("destroy"),s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("noteForm_"),r=i('<div class="annotationDialog"><div><div id="'+o+'_type" data-transform="buttonset" data-type="radio" data-mapping="type"><input type="radio" id="'+o+'_re" name="'+o+'_type" value="researchNote" data-default="true" /><label for="'+o+'_re" title="Internal to projects">Research Note</label><input type="radio" id="'+o+'_scho" name="'+o+'_type" value="scholarNote" /><label for="'+o+'_scho" title="Footnotes/endnotes">Scholarly Note</label><input type="radio" id="'+o+'_ann" name="'+o+'_type" value="annotation" /><label for="'+o+'_ann" title="Informal notes">Annotation</label></div></div><div><label for="'+o+'_noteContent">Note text</label><textarea id="'+o+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:600,height:500,type:"note",title:"Tag Note"});return s.$el.on("beforeShow",(function(e,t,n){n.mode===a.EDIT?(n.$el.find("label[for="+o+"_noteContent]").hide(),n.$el.find("#"+o+"_noteContent").hide()):(n.$el.find("label[for="+o+"_noteContent]").show(),n.$el.find("#"+o+"_noteContent").show())})),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("orgForm_"),r=i('<div class="annotationDialog"><div id="'+o+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+o+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+o+'_high" name="'+o+'_id_certainty" value="high" data-default="true" /><label for="'+o+'_high">High</label><input type="radio" id="'+o+'_medium" name="'+o+'_id_certainty" value="medium" /><label for="'+o+'_medium">Medium</label><input type="radio" id="'+o+'_low" name="'+o+'_id_certainty" value="low" /><label for="'+o+'_low">Low</label><input type="radio" id="'+o+'_unknown" name="'+o+'_id_certainty" value="unknown" /><label for="'+o+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,height:550,type:"org",title:"Tag Organization"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){for(var n=e,o=n.getUniqueId("personForm_"),r=i('<div class="annotationDialog"><div id="'+o+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+o+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+o+'_high" name="'+o+'_id_certainty" value="high" data-default="true" /><label for="'+o+'_high">High</label><input type="radio" id="'+o+'_medium" name="'+o+'_id_certainty" value="medium" /><label for="'+o+'_medium">Medium</label><input type="radio" id="'+o+'_low" name="'+o+'_id_certainty" value="low" /><label for="'+o+'_low">Low</label><input type="radio" id="'+o+'_unknown" name="'+o+'_id_certainty" value="unknown" /><label for="'+o+'_unknown">Unknown</label></div><div id="'+o+'_type" data-transform="buttonset" data-type="radio" data-mapping="type"><p>Person type:</p><input type="radio" id="'+o+'_real" name="'+o+'_type_certainty" value="real" data-default="true" /><label for="'+o+'_real">Real</label><input type="radio" id="'+o+'_fictional" name="'+o+'_type_certainty" value="fictional" /><label for="'+o+'_fictional">Fictional</label><input type="radio" id="'+o+'_both" name="'+o+'_type_certainty" value="both" /><label for="'+o+'_both">Both</label></div><div id="'+o+'_role" data-transform="accordion"><h3>Add role (optional)</h3><div><select data-type="select" data-mapping="role"></select></div></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"person",title:"Tag Person"}),l=[{code:"",title:"(none)"},{code:"abr",title:"Abridger"},{code:"acp",title:"Art copyist"},{code:"act",title:"Actor"},{code:"adi",title:"Art director"},{code:"adp",title:"Adapter"},{code:"aft",title:"Author of afterword, colophon, etc."},{code:"anl",title:"Analyst"},{code:"anm",title:"Animator"},{code:"ann",title:"Annotator"},{code:"ant",title:"Bibliographic antecedent"},{code:"ape",title:"Appellee"},{code:"apl",title:"Appellant"},{code:"app",title:"Applicant"},{code:"aqt",title:"Author in quotations or text abstracts"},{code:"arc",title:"Architect"},{code:"ard",title:"Artistic director"},{code:"arr",title:"Arranger"},{code:"art",title:"Artist"},{code:"asg",title:"Assignee"},{code:"asn",title:"Associated name"},{code:"ato",title:"Autographer"},{code:"att",title:"Attributed name"},{code:"auc",title:"Auctioneer"},{code:"aud",title:"Author of dialog"},{code:"aui",title:"Author of introduction, etc."},{code:"aus",title:"Screenwriter"},{code:"aut",title:"Author"},{code:"bdd",title:"Binding designer"},{code:"bjd",title:"Bookjacket designer"},{code:"bkd",title:"Book designer"},{code:"bkp",title:"Book producer"},{code:"blw",title:"Blurb writer"},{code:"bnd",title:"Binder"},{code:"bpd",title:"Bookplate designer"},{code:"brd",title:"Broadcaster"},{code:"brl",title:"Braille embosser"},{code:"bsl",title:"Bookseller"},{code:"cas",title:"Caster"},{code:"ccp",title:"Conceptor"},{code:"chr",title:"Choreographer"},{code:"cli",title:"Client"},{code:"cll",title:"Calligrapher"},{code:"clr",title:"Colorist"},{code:"clt",title:"Collotyper"},{code:"cmm",title:"Commentator"},{code:"cmp",title:"Composer"},{code:"cmt",title:"Compositor"},{code:"cnd",title:"Conductor"},{code:"cng",title:"Cinematographer"},{code:"cns",title:"Censor"},{code:"coe",title:"Contestant-appellee"},{code:"col",title:"Collector"},{code:"com",title:"Compiler"},{code:"con",title:"Conservator"},{code:"cor",title:"Collection registrar"},{code:"cos",title:"Contestant"},{code:"cot",title:"Contestant-appellant"},{code:"cou",title:"Court governed"},{code:"cov",title:"Cover designer"},{code:"cpc",title:"Copyright claimant"},{code:"cpe",title:"Complainant-appellee"},{code:"cph",title:"Copyright holder"},{code:"cpl",title:"Complainant"},{code:"cpt",title:"Complainant-appellant"},{code:"cre",title:"Creator"},{code:"crp",title:"Correspondent"},{code:"crr",title:"Corrector"},{code:"crt",title:"Court reporter"},{code:"csl",title:"Consultant"},{code:"csp",title:"Consultant to a project"},{code:"cst",title:"Costume designer"},{code:"ctb",title:"Contributor"},{code:"cte",title:"Contestee-appellee"},{code:"ctg",title:"Cartographer"},{code:"ctr",title:"Contractor"},{code:"cts",title:"Contestee"},{code:"ctt",title:"Contestee-appellant"},{code:"cur",title:"Curator"},{code:"cwt",title:"Commentator for written text"},{code:"dbp",title:"Distribution place"},{code:"dfd",title:"Defendant"},{code:"dfe",title:"Defendant-appellee"},{code:"dft",title:"Defendant-appellant"},{code:"dgg",title:"Degree granting institution"},{code:"dis",title:"Dissertant"},{code:"dln",title:"Delineator"},{code:"dnc",title:"Dancer"},{code:"dnr",title:"Donor"},{code:"dpc",title:"Depicted"},{code:"dpt",title:"Depositor"},{code:"drm",title:"Draftsman"},{code:"drt",title:"Director"},{code:"dsr",title:"Designer"},{code:"dst",title:"Distributor"},{code:"dtc",title:"Data contributor"},{code:"dte",title:"Dedicatee"},{code:"dtm",title:"Data manager"},{code:"dto",title:"Dedicator"},{code:"dub",title:"Dubious author"},{code:"edc",title:"Editor of compilation"},{code:"edm",title:"Editor of moving image work"},{code:"edt",title:"Editor"},{code:"egr",title:"Engraver"},{code:"elg",title:"Electrician"},{code:"elt",title:"Electrotyper"},{code:"eng",title:"Engineer"},{code:"enj",title:"Enacting jurisdiction"},{code:"etr",title:"Etcher"},{code:"evp",title:"Event place"},{code:"exp",title:"Expert"},{code:"fac",title:"Facsimilist"},{code:"fds",title:"Film distributor"},{code:"fld",title:"Field director"},{code:"flm",title:"Film editor"},{code:"fmd",title:"Film director"},{code:"fmk",title:"Filmmaker"},{code:"fmo",title:"Former owner"},{code:"fmp",title:"Film producer"},{code:"fnd",title:"Funder"},{code:"fpy",title:"First party"},{code:"frg",title:"Forger"},{code:"gis",title:"Geographic information specialist"},{code:"his",title:"Host institution"},{code:"hnr",title:"Honoree"},{code:"hst",title:"Host"},{code:"ill",title:"Illustrator"},{code:"ilu",title:"Illuminator"},{code:"ins",title:"Inscriber"},{code:"itr",title:"Instrumentalist"},{code:"ive",title:"Interviewee"},{code:"ivr",title:"Interviewer"},{code:"inv",title:"Inventor"},{code:"isb",title:"Issuing body"},{code:"jud",title:"Judge"},{code:"jug",title:"Jurisdiction governed"},{code:"lbr",title:"Laboratory"},{code:"lbt",title:"Librettist"},{code:"ldr",title:"Laboratory director"},{code:"led",title:"Lead"},{code:"lee",title:"Libelee-appellee"},{code:"lel",title:"Libelee"},{code:"len",title:"Lender"},{code:"let",title:"Libelee-appellant"},{code:"lgd",title:"Lighting designer"},{code:"lie",title:"Libelant-appellee"},{code:"lil",title:"Libelant"},{code:"lit",title:"Libelant-appellant"},{code:"lsa",title:"Landscape architect"},{code:"lse",title:"Licensee"},{code:"lso",title:"Licensor"},{code:"ltg",title:"Lithographer"},{code:"lyr",title:"Lyricist"},{code:"mcp",title:"Music copyist"},{code:"mdc",title:"Metadata contact"},{code:"mfp",title:"Manufacture place"},{code:"mfr",title:"Manufacturer"},{code:"mod",title:"Moderator"},{code:"mon",title:"Monitor"},{code:"mrb",title:"Marbler"},{code:"mrk",title:"Markup editor"},{code:"msd",title:"Musical director"},{code:"mte",title:"Metal-engraver"},{code:"mus",title:"Musician"},{code:"nrt",title:"Narrator"},{code:"opn",title:"Opponent"},{code:"org",title:"Originator"},{code:"orm",title:"Organizer of meeting"},{code:"osp",title:"Onscreen presenter"},{code:"oth",title:"Other"},{code:"own",title:"Owner"},{code:"pan",title:"Panelist"},{code:"pat",title:"Patron"},{code:"pbd",title:"Publishing director"},{code:"pbl",title:"Publisher"},{code:"pdr",title:"Project director"},{code:"pfr",title:"Proofreader"},{code:"pht",title:"Photographer"},{code:"plt",title:"Platemaker"},{code:"pma",title:"Permitting agency"},{code:"pmn",title:"Production manager"},{code:"pop",title:"Printer of plates"},{code:"ppm",title:"Papermaker"},{code:"ppt",title:"Puppeteer"},{code:"pra",title:"Praeses"},{code:"prc",title:"Process contact"},{code:"prd",title:"Production personnel"},{code:"pre",title:"Presenter"},{code:"prf",title:"Performer"},{code:"prg",title:"Programmer"},{code:"prm",title:"Printmaker"},{code:"prn",title:"Production company"},{code:"pro",title:"Producer"},{code:"prp",title:"Production place"},{code:"prs",title:"Production designer"},{code:"prt",title:"Printer"},{code:"prv",title:"Provider"},{code:"pta",title:"Patent applicant"},{code:"pte",title:"Plaintiff-appellee"},{code:"ptf",title:"Plaintiff"},{code:"pth",title:"Patent holder"},{code:"ptt",title:"Plaintiff-appellant"},{code:"pup",title:"Publication place"},{code:"rbr",title:"Rubricator"},{code:"rce",title:"Recording engineer"},{code:"rcd",title:"Recordist"},{code:"rcp",title:"Addressee"},{code:"rdd",title:"Radio director"},{code:"red",title:"Redaktor"},{code:"ren",title:"Renderer"},{code:"res",title:"Researcher"},{code:"rev",title:"Reviewer"},{code:"rpc",title:"Radio producer"},{code:"rps",title:"Repository"},{code:"rpt",title:"Reporter"},{code:"rpy",title:"Responsible party"},{code:"rse",title:"Respondent-appellee"},{code:"rsg",title:"Restager"},{code:"rsp",title:"Respondent"},{code:"rsr",title:"Restorationist"},{code:"rst",title:"Respondent-appellant"},{code:"rth",title:"Research team head"},{code:"rtm",title:"Research team member"},{code:"sad",title:"Scientific advisor"},{code:"sce",title:"Scenarist"},{code:"scl",title:"Sculptor"},{code:"scr",title:"Scribe"},{code:"sds",title:"Sound designer"},{code:"sec",title:"Secretary"},{code:"sgd",title:"Stage director"},{code:"sgn",title:"Signer"},{code:"sht",title:"Supporting host"},{code:"sll",title:"Seller"},{code:"sng",title:"Singer"},{code:"spk",title:"Speaker"},{code:"spn",title:"Sponsor"},{code:"spy",title:"Second party"},{code:"std",title:"Set designer"},{code:"stg",title:"Setting"},{code:"stl",title:"Storyteller"},{code:"stm",title:"Stage manager"},{code:"stn",title:"Standards body"},{code:"str",title:"Stereotyper"},{code:"srv",title:"Surveyor"},{code:"tcd",title:"Technical director"},{code:"tch",title:"Teacher"},{code:"ths",title:"Thesis advisor"},{code:"tld",title:"Television director"},{code:"tlp",title:"Television producer"},{code:"trc",title:"Transcriber"},{code:"trl",title:"Translator"},{code:"tyd",title:"Type designer"},{code:"tyg",title:"Typographer"},{code:"uvp",title:"University place"},{code:"vdg",title:"Videographer"},{code:"wac",title:"Writer of added commentary"},{code:"wal",title:"Writer of added lyrics"},{code:"wam",title:"Writer of accompanying material"},{code:"wat",title:"Writer of added text"},{code:"wdc",title:"Woodcutter"},{code:"wde",title:"Wood engraver"},{code:"wit",title:"Witness"}],c="",d=0;d<l.length;d++){var u=l[d];c+='<option value="'+u.code+'">'+u.title+"</option>"}return i("#"+o+"_role select").html(c),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("placeForm_"),r=i('<div class="annotationDialog"><div id="'+o+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+o+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+o+'_high" name="'+o+'_id_certainty" value="high" data-default="true" /><label for="'+o+'_high">High</label><input type="radio" id="'+o+'_medium" name="'+o+'_id_certainty" value="medium" /><label for="'+o+'_medium">Medium</label><input type="radio" id="'+o+'_low" name="'+o+'_id_certainty" value="low" /><label for="'+o+'_low">Low</label><input type="radio" id="'+o+'_unknown" name="'+o+'_id_certainty" value="unknown" /><label for="'+o+'_unknown">Unknown</label></div><div><p>Precision of location of place name:</p><div id="'+o+'_precision" data-transform="buttonset" data-type="radio" data-mapping="custom.precision"><input type="radio" id="'+o+'_p_high" name="'+o+'_detail_radio" value="high" /><label for="'+o+'_p_high">High</label><input type="radio" id="'+o+'_p_medium" name="'+o+'_detail_radio" value="medium" /><label for="'+o+'_p_medium">Medium</label><input type="radio" id="'+o+'_p_low" name="'+o+'_detail_radio" value="low" /><label for="'+o+'_p_low">Low</label><input type="radio" id="'+o+'_p_unknown" name="'+o+'_detail_radio" value="unknown" /><label for="'+o+'_p_unknown">Unknown</label></div></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"place",title:"Tag Place"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("titleForm_"),r=i('<div id="'+o+'Dialog" class="annotationDialog"><div id="'+o+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+o+'_level" data-type="radio" data-mapping="level"><p>This title is:</p><input type="radio" value="a" name="level" id="'+o+'_level_a"/><label for="'+o+'_level_a">Analytic <span>article, poem, or other item published as part of a larger item</span></label><br/><input type="radio" value="m" name="level" id="'+o+'_level_m" data-default="true" /><label for="'+o+'_level_m">Monographic <span>book, collection, single volume, or other item published as a distinct item</span></label><br/><input type="radio" value="j" name="level" id="'+o+'_level_j"/><label for="'+o+'_level_j">Journal <span>magazine, newspaper or other periodical publication</span></label><br/><input type="radio" value="s" name="level" id="'+o+'_level_s"/><label for="'+o+'_level_s">Series <span>book, radio, or other series</span></label><br/><input type="radio" value="u" name="level" id="'+o+'_level_u"/><label for="'+o+'_level_u">Unpublished <span>thesis, manuscript, letters or other unpublished material</span></label><br/></div><div id="'+o+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+o+'_high" name="'+o+'_id_certainty" value="high" data-default="true" /><label for="'+o+'_high">High</label><input type="radio" id="'+o+'_medium" name="'+o+'_id_certainty" value="medium" /><label for="'+o+'_medium">Medium</label><input type="radio" id="'+o+'_low" name="'+o+'_id_certainty" value="low" /><label for="'+o+'_low">Low</label><input type="radio" id="'+o+'_unknown" name="'+o+'_id_certainty" value="unknown" /><label for="'+o+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:630,height:660,type:"title",title:"Tag Title"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);n(20),e.exports=function(e,t){var n=e,o=n.getUniqueId("rsForm_"),r=i('<div class="annotationDialog"><div id="'+o+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+o+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+o+'_high" name="'+o+'_id_certainty" value="high" data-default="true" /><label for="'+o+'_high">High</label><input type="radio" id="'+o+'_medium" name="'+o+'_id_certainty" value="medium" /><label for="'+o+'_medium">Medium</label><input type="radio" id="'+o+'_low" name="'+o+'_id_certainty" value="low" /><label for="'+o+'_low">Low</label><input type="radio" id="'+o+'_unknown" name="'+o+'_id_certainty" value="unknown" /><label for="'+o+'_unknown">Unknown</label></div><div><div class="type"><label>Type (optional):</label><select name="type" data-mapping="type" data-type="select" data-transform="selectmenu"></select></div><div style="margin-top: 5px;"><label>Other type:</label><input name="otherType" type="text" data-mapping="type" data-type="textbox" /></div></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"rs",title:"Tag Referencing String"}),l=["Award","BirthPosition","Certainty","Credential","EducationalAward","Ethnicity","Gender","GeographicHeritage","NationalHeritage","NationalIdentity","NaturalPerson","Occupation","PoliticalAffiliation","Precision","RaceColour","Religion","ReproductiveHistory","Role","Sexuality","SocialClass","TextLabels"],c="";return c+='<option value="">(none)</option>',c+='<option value="$$$$OTHER$$$$">Other (specify)</option>',l.forEach((function(e){c+='<option value="http://sparql.cwrc.ca/ontology/cwrc#'+e+'">'+e+"</option>"})),r.find("select[name=type]").html(c).selectmenu("refresh").on("selectmenuselect",(function(e,t){"$$$$OTHER$$$$"===t.item.value?r.find("input[name=otherType]").parent().show():(r.find("input[name=otherType]").val(t.item.value).parent().hide(),i(this).trigger("change",{target:this}))})),r.find("select[name=type]").selectmenu("menuWidget").addClass("overflow").height("300px"),s.$el.on("beforeShow",(function(e,t){var n=t.entry,i="",a=!1;void 0!==n&&void 0!==n.getAttribute("type")&&(i=n.getAttribute("type"),a=-1===l.indexOf(i)),a?(r.find("select[name=type]").val("$$$$OTHER$$$$").selectmenu("refresh"),r.find("input[name=otherType]").val(i).parent().show()):(r.find("select[name=type]").val(i),r.find("input[name=otherType]").val(i).parent().hide())})),s.$el.on("beforeSave",(function(e,t){""===s.currentData.attributes.type&&delete s.currentData.attributes.type})),{show:function(e){s.show(e)},destroy:function(){r.find("select[name=type]").selectmenu("destroy"),s.destroy()}}}},function(e,t,n){var i=n(296),a=n(297),o=n(298),r=n(299),s=n(300),l=n(301),c=n(302),d=n(303),u=n(304),p=n(305),g=n(306);e.exports={citation:i,correction:a,date:o,keyword:r,link:s,note:l,org:c,person:d,place:u,title:p,rs:g}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("citationForm_"),r=i('<div class="annotationDialog"><div><p>Selected source:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div><label for="'+o+'_noteContent">Citation text</label><textarea id="'+o+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div><input type="hidden" data-type="hidden" data-mapping="type" value="citation" /></div>').appendTo(t),s=new a({writer:n,$el:r,width:600,height:500,type:"citation",title:"Tag Citation"});return s.$el.on("beforeShow",(function(e,t,n){n.mode===a.EDIT?(n.$el.find("label[for="+o+"_noteContent]").hide(),n.$el.find("#"+o+"_noteContent").hide()):(n.$el.find("label[for="+o+"_noteContent]").show(),n.$el.find("#"+o+"_noteContent").show())})),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("corrForm_"),r=i('<div class="annotationDialog"><div><p>Correction</p><textarea data-type="textbox" data-mapping="custom.corrText"></textarea></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:385,height:400,type:"correction",title:"Tag Correction"});return s.$el.on("beforeShow",(function(e,t,i){var o;i.mode===a.ADD?o=n.editor.currentBookmark.rng.toString():void 0===(o=t.entry.getCustomValue("sicText"))&&r.find("textarea").val(t.entry.getContent()),void 0!==o&&""!==o&&(i.currentData.customValues.sicText=o)})),s.$el.on("beforeSave",(function(e,t){var o=t.currentData.customValues.sicText,r=t.currentData.customValues.corrText;if(t.mode===a.EDIT){if(null==o){var s=n.entitiesManager.getCurrentEntity();i("#"+s,n.editor.getBody()).text(r),n.entitiesManager.getEntity(s).setContent(r)}}else if(void 0===o){var l=n.getUniqueId("temp"),c=i('<span id="'+l+'"/>',n.editor.getDoc()),d=n.editor.selection.getRng(!0);d.surroundContents(c[0]),c.html(r);var u=c[0].firstChild;i(u).unwrap(),d.selectNodeContents(u),n.editor.currentBookmark=n.editor.selection.getBookmark(1)}})),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(0);a.suppressDeprecationWarnings=!0;var o=n(2);n(28),n(6),e.exports=function(e,t){var n=e,r=(new Date).getFullYear()+10,s=n.getUniqueId("dateForm_"),l=i('<div class="annotationDialog"><div id="'+s+'_type" data-transform="buttonset"><p>Date type:</p><input type="radio" name="dateType" value="date" id="'+s+'_type_date" checked="checked"/><label for="'+s+'_type_date">Single Date</label><input type="radio" name="dateType" value="range" id="'+s+'_type_range"/><label for="'+s+'_type_range">Date Range</label></div><div id="'+s+'_date"><label for="'+s+'_cwrc_datePicker">Date:</label><br/><input type="text" data-type="textbox" data-mapping="when" id="'+s+'_cwrc_datePicker" /></div><div id="'+s+'_range"><label for="'+s+'_startDate">Start date:</label><br/><input type="text" data-type="textbox" data-mapping="from" id="'+s+'_startDate" style="margin-bottom: 5px;"/><br /><label for="'+s+'_endDate">End date:</label><br/><input type="text" data-type="textbox" data-mapping="to" id="'+s+'_endDate" /></div><div>Format: YYYY, YYYY-MM, or YYYY-MM-DD<br/>e.g. 2010, 2010-10, 2010-10-31</div><div id="'+s+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+s+'_high" name="'+s+'_id_certainty" value="high" data-default="true" /><label for="'+s+'_high">High</label><input type="radio" id="'+s+'_medium" name="'+s+'_id_certainty" value="medium" /><label for="'+s+'_medium">Medium</label><input type="radio" id="'+s+'_low" name="'+s+'_id_certainty" value="low" /><label for="'+s+'_low">Low</label><input type="radio" id="'+s+'_unknown" name="'+s+'_id_certainty" value="unknown" /><label for="'+s+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+s+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),c=new o({writer:n,$el:l,type:"date",title:"Tag Date"});i("#"+s+"_type input").click((function(){f(i(this).val())}));var d=i("#"+s+"_cwrc_datePicker");d.focus((function(){i(this).css({borderBottom:""})})),d.datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(r,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0}),i("#ui-datepicker-div").appendTo(t);var u=i("#"+s+"_startDate");u.focus((function(){i(this).css({borderBottom:""})}));var p=i("#"+s+"_endDate");p.focus((function(){i(this).css({borderBottom:""})}));var g=i("#"+s+"_startDate, #"+s+"_endDate").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(r,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0,onSelect:function(e){var t=-1===this.id.indexOf("startDate")?"maxDate":"minDate",n=i(this).data("datepicker"),a=i.datepicker.parseDate(n.settings.dateFormat||i.datepicker._defaults.dateFormat,e,n.settings);g.not(this).datepicker("option",t,a)}}),f=function(e){d.val(""),u.val(""),p.val(""),"date"==e?(i("#"+s+"_date").show(),i("#"+s+"_range").hide()):(i("#"+s+"_date").hide(),i("#"+s+"_range").show())};return c.$el.on("beforeShow",(function(e,t){if(g.datepicker("option","minDate",new Date(1800,0,1)),g.datepicker("option","maxDate",new Date(r,11,31)),c.mode===o.ADD){var l="",h=n.editor.currentBookmark.rng.toString();if(""!=h){var m=a(h);if(m.isValid()){var v=m.toDate(),y=v.getFullYear();if(h.length>4){var b=v.getMonth();++b<10&&(b="0"+b);var w=v.getDate();w<10&&(w="0"+w),l=y+"-"+b+"-"+w}else l=++y}}f("date"),i("#"+s+"_type_date").prop("checked",!0),d.val(l),u.val(""),p.val("")}else{var _=t.entry.getAttributes();void 0!==_.when?(f("date"),i("#"+s+"_type_date").prop("checked",!0),d.val(_.when),u.val(""),p.val("")):(f("range"),i("#"+s+"_type_range").prop("checked",!0),d.val(""),u.val(_.from),p.val(_.to))}i("#"+s+"_type input").button("refresh"),d.css({borderBottom:""}),u.css({borderBottom:""}),p.css({borderBottom:""}),d.focus()})),c.$el.on("beforeSave",(function(e,t){var n=!1;if("date"===i("#"+s+"_type input:checked").val()){var o=d.val();a(o).isValid()?t.currentData.attributes.when=o:(d.css({borderBottom:"1px solid red"}),n=!0)}else{var r=u.val(),l=p.val(),c=a(r),g=a(l);c.isValid()?t.currentData.attributes.from=r:(u.css({borderBottom:"1px solid red"}),n=!0),g.isValid()?t.currentData.attributes.to=l:(p.css({borderBottom:"1px solid red"}),n=!0),c.isAfter(g)&&(u.css({borderBottom:"1px solid red"}),p.css({borderBottom:"1px solid red"}),n=!0)}t.isValid=!n})),{show:function(e){c.show(e)},destroy:function(){d.datepicker("destroy"),g.datepicker("destroy"),c.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=!1,r=n.getUniqueId("keywordForm_"),s=i('<div class="annotationDialog"><div><label for="'+r+'_noteContent">Keyword</label><input type="text" id="'+r+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="margin-right: 10px;"/><p>You will be able to edit the keyword in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+r+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div><input type="hidden" data-type="hidden" data-mapping="type" value="keyword" /></div>').appendTo(t),l=new a({writer:n,$el:s,type:"keyword",title:"Tag Keyword",height:420,width:420});return l.$el.on("beforeSave",(function(e,t){o||void 0!==t.currentData.attributes.ana?t.isValid=!0:(t.isValid=!1,n.dialogManager.confirm({title:"Warning",msg:'<p>A human-readable keyword is preferably linked, using the "ana" attribute, to a controlled vocabulary.</p><p>Click "Add Link" to add a URL for your term or "Skip Link" to save as is.</p>',yesText:"Skip Link",noText:"Add Link",showConfirmKey:"confirm-tei-keyword",type:"info",callback:function(e){setTimeout((function(){e&&(o=!0,t.save())}))}}))})),l.$el.on("beforeShow",(function(e,t){l.isValid=!0,o=!1,l.mode===a.ADD?(l.attributesWidget.setData({ana:""}),l.attributesWidget.expand(),l.$el.find("label[for="+r+"_noteContent]").show(),l.$el.find("#"+r+"_noteContent").show()):(l.$el.find("label[for="+r+"_noteContent]").hide(),l.$el.find("#"+r+"_noteContent").hide())})),{show:function(e){l.show(e)},destroy:function(){l.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);n(6),e.exports=function(e,t){var n=e,o=n.getUniqueId("linkForm_"),r=i('<div class="annotationDialog"><div><label for="'+o+'_input">Hypertext link (URL or URI)</label><input type="text" id="'+o+'_input" data-type="textbox" data-mapping="target" style="margin-right: 10px;"/><button type="button">Check Link</button></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:350,height:350,type:"link",title:"Tag Link"});return i("button",r).button().click((function(){var e=i("#"+o+"_input").val();if(""!=e){null==e.match(/^https?:\/\//)&&(e="http://"+e);try{window.open(e,"linkTestWindow")}catch(e){alert(e)}}})),{show:function(e){s.show(e)},destroy:function(){i("button",r).button("destroy"),s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("noteForm_"),r=i('<div class="annotationDialog"><div><div id="'+o+'_type" data-transform="buttonset" data-type="radio" data-mapping="type"><input type="radio" id="'+o+'_re" name="'+o+'_type" value="researchNote" data-default="true" /><label for="'+o+'_re" title="Internal to projects">Research Note</label><input type="radio" id="'+o+'_scho" name="'+o+'_type" value="scholarNote" /><label for="'+o+'_scho" title="Footnotes/endnotes">Scholarly Note</label><input type="radio" id="'+o+'_ann" name="'+o+'_type" value="annotation" /><label for="'+o+'_ann" title="Informal notes">Annotation</label></div></div><div><label for="'+o+'_noteContent">Note text</label><textarea id="'+o+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:600,height:500,type:"note",title:"Tag Note"});return s.$el.on("beforeShow",(function(e,t,n){n.mode===a.EDIT?(n.$el.find("label[for="+o+"_noteContent]").hide(),n.$el.find("#"+o+"_noteContent").hide()):(n.$el.find("label[for="+o+"_noteContent]").show(),n.$el.find("#"+o+"_noteContent").show())})),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("orgForm_"),r=i('<div class="annotationDialog"><div id="'+o+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+o+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+o+'_high" name="'+o+'_id_certainty" value="high" data-default="true" /><label for="'+o+'_high">High</label><input type="radio" id="'+o+'_medium" name="'+o+'_id_certainty" value="medium" /><label for="'+o+'_medium">Medium</label><input type="radio" id="'+o+'_low" name="'+o+'_id_certainty" value="low" /><label for="'+o+'_low">Low</label><input type="radio" id="'+o+'_unknown" name="'+o+'_id_certainty" value="unknown" /><label for="'+o+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,height:550,type:"org",title:"Tag Organization"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){for(var n=e,o=n.getUniqueId("personForm_"),r=i('<div class="annotationDialog"><div id="'+o+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+o+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+o+'_high" name="'+o+'_id_certainty" value="high" data-default="true" /><label for="'+o+'_high">High</label><input type="radio" id="'+o+'_medium" name="'+o+'_id_certainty" value="medium" /><label for="'+o+'_medium">Medium</label><input type="radio" id="'+o+'_low" name="'+o+'_id_certainty" value="low" /><label for="'+o+'_low">Low</label><input type="radio" id="'+o+'_unknown" name="'+o+'_id_certainty" value="unknown" /><label for="'+o+'_unknown">Unknown</label></div><div id="'+o+'_role" data-transform="accordion"><h3>Add role (optional)</h3><div><select data-type="select" data-mapping="role"></select></div></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"person",title:"Tag Person"}),l=[{code:"",title:"(none)"},{code:"abr",title:"Abridger"},{code:"acp",title:"Art copyist"},{code:"act",title:"Actor"},{code:"adi",title:"Art director"},{code:"adp",title:"Adapter"},{code:"aft",title:"Author of afterword, colophon, etc."},{code:"anl",title:"Analyst"},{code:"anm",title:"Animator"},{code:"ann",title:"Annotator"},{code:"ant",title:"Bibliographic antecedent"},{code:"ape",title:"Appellee"},{code:"apl",title:"Appellant"},{code:"app",title:"Applicant"},{code:"aqt",title:"Author in quotations or text abstracts"},{code:"arc",title:"Architect"},{code:"ard",title:"Artistic director"},{code:"arr",title:"Arranger"},{code:"art",title:"Artist"},{code:"asg",title:"Assignee"},{code:"asn",title:"Associated name"},{code:"ato",title:"Autographer"},{code:"att",title:"Attributed name"},{code:"auc",title:"Auctioneer"},{code:"aud",title:"Author of dialog"},{code:"aui",title:"Author of introduction, etc."},{code:"aus",title:"Screenwriter"},{code:"aut",title:"Author"},{code:"bdd",title:"Binding designer"},{code:"bjd",title:"Bookjacket designer"},{code:"bkd",title:"Book designer"},{code:"bkp",title:"Book producer"},{code:"blw",title:"Blurb writer"},{code:"bnd",title:"Binder"},{code:"bpd",title:"Bookplate designer"},{code:"brd",title:"Broadcaster"},{code:"brl",title:"Braille embosser"},{code:"bsl",title:"Bookseller"},{code:"cas",title:"Caster"},{code:"ccp",title:"Conceptor"},{code:"chr",title:"Choreographer"},{code:"cli",title:"Client"},{code:"cll",title:"Calligrapher"},{code:"clr",title:"Colorist"},{code:"clt",title:"Collotyper"},{code:"cmm",title:"Commentator"},{code:"cmp",title:"Composer"},{code:"cmt",title:"Compositor"},{code:"cnd",title:"Conductor"},{code:"cng",title:"Cinematographer"},{code:"cns",title:"Censor"},{code:"coe",title:"Contestant-appellee"},{code:"col",title:"Collector"},{code:"com",title:"Compiler"},{code:"con",title:"Conservator"},{code:"cor",title:"Collection registrar"},{code:"cos",title:"Contestant"},{code:"cot",title:"Contestant-appellant"},{code:"cou",title:"Court governed"},{code:"cov",title:"Cover designer"},{code:"cpc",title:"Copyright claimant"},{code:"cpe",title:"Complainant-appellee"},{code:"cph",title:"Copyright holder"},{code:"cpl",title:"Complainant"},{code:"cpt",title:"Complainant-appellant"},{code:"cre",title:"Creator"},{code:"crp",title:"Correspondent"},{code:"crr",title:"Corrector"},{code:"crt",title:"Court reporter"},{code:"csl",title:"Consultant"},{code:"csp",title:"Consultant to a project"},{code:"cst",title:"Costume designer"},{code:"ctb",title:"Contributor"},{code:"cte",title:"Contestee-appellee"},{code:"ctg",title:"Cartographer"},{code:"ctr",title:"Contractor"},{code:"cts",title:"Contestee"},{code:"ctt",title:"Contestee-appellant"},{code:"cur",title:"Curator"},{code:"cwt",title:"Commentator for written text"},{code:"dbp",title:"Distribution place"},{code:"dfd",title:"Defendant"},{code:"dfe",title:"Defendant-appellee"},{code:"dft",title:"Defendant-appellant"},{code:"dgg",title:"Degree granting institution"},{code:"dis",title:"Dissertant"},{code:"dln",title:"Delineator"},{code:"dnc",title:"Dancer"},{code:"dnr",title:"Donor"},{code:"dpc",title:"Depicted"},{code:"dpt",title:"Depositor"},{code:"drm",title:"Draftsman"},{code:"drt",title:"Director"},{code:"dsr",title:"Designer"},{code:"dst",title:"Distributor"},{code:"dtc",title:"Data contributor"},{code:"dte",title:"Dedicatee"},{code:"dtm",title:"Data manager"},{code:"dto",title:"Dedicator"},{code:"dub",title:"Dubious author"},{code:"edc",title:"Editor of compilation"},{code:"edm",title:"Editor of moving image work"},{code:"edt",title:"Editor"},{code:"egr",title:"Engraver"},{code:"elg",title:"Electrician"},{code:"elt",title:"Electrotyper"},{code:"eng",title:"Engineer"},{code:"enj",title:"Enacting jurisdiction"},{code:"etr",title:"Etcher"},{code:"evp",title:"Event place"},{code:"exp",title:"Expert"},{code:"fac",title:"Facsimilist"},{code:"fds",title:"Film distributor"},{code:"fld",title:"Field director"},{code:"flm",title:"Film editor"},{code:"fmd",title:"Film director"},{code:"fmk",title:"Filmmaker"},{code:"fmo",title:"Former owner"},{code:"fmp",title:"Film producer"},{code:"fnd",title:"Funder"},{code:"fpy",title:"First party"},{code:"frg",title:"Forger"},{code:"gis",title:"Geographic information specialist"},{code:"his",title:"Host institution"},{code:"hnr",title:"Honoree"},{code:"hst",title:"Host"},{code:"ill",title:"Illustrator"},{code:"ilu",title:"Illuminator"},{code:"ins",title:"Inscriber"},{code:"itr",title:"Instrumentalist"},{code:"ive",title:"Interviewee"},{code:"ivr",title:"Interviewer"},{code:"inv",title:"Inventor"},{code:"isb",title:"Issuing body"},{code:"jud",title:"Judge"},{code:"jug",title:"Jurisdiction governed"},{code:"lbr",title:"Laboratory"},{code:"lbt",title:"Librettist"},{code:"ldr",title:"Laboratory director"},{code:"led",title:"Lead"},{code:"lee",title:"Libelee-appellee"},{code:"lel",title:"Libelee"},{code:"len",title:"Lender"},{code:"let",title:"Libelee-appellant"},{code:"lgd",title:"Lighting designer"},{code:"lie",title:"Libelant-appellee"},{code:"lil",title:"Libelant"},{code:"lit",title:"Libelant-appellant"},{code:"lsa",title:"Landscape architect"},{code:"lse",title:"Licensee"},{code:"lso",title:"Licensor"},{code:"ltg",title:"Lithographer"},{code:"lyr",title:"Lyricist"},{code:"mcp",title:"Music copyist"},{code:"mdc",title:"Metadata contact"},{code:"mfp",title:"Manufacture place"},{code:"mfr",title:"Manufacturer"},{code:"mod",title:"Moderator"},{code:"mon",title:"Monitor"},{code:"mrb",title:"Marbler"},{code:"mrk",title:"Markup editor"},{code:"msd",title:"Musical director"},{code:"mte",title:"Metal-engraver"},{code:"mus",title:"Musician"},{code:"nrt",title:"Narrator"},{code:"opn",title:"Opponent"},{code:"org",title:"Originator"},{code:"orm",title:"Organizer of meeting"},{code:"osp",title:"Onscreen presenter"},{code:"oth",title:"Other"},{code:"own",title:"Owner"},{code:"pan",title:"Panelist"},{code:"pat",title:"Patron"},{code:"pbd",title:"Publishing director"},{code:"pbl",title:"Publisher"},{code:"pdr",title:"Project director"},{code:"pfr",title:"Proofreader"},{code:"pht",title:"Photographer"},{code:"plt",title:"Platemaker"},{code:"pma",title:"Permitting agency"},{code:"pmn",title:"Production manager"},{code:"pop",title:"Printer of plates"},{code:"ppm",title:"Papermaker"},{code:"ppt",title:"Puppeteer"},{code:"pra",title:"Praeses"},{code:"prc",title:"Process contact"},{code:"prd",title:"Production personnel"},{code:"pre",title:"Presenter"},{code:"prf",title:"Performer"},{code:"prg",title:"Programmer"},{code:"prm",title:"Printmaker"},{code:"prn",title:"Production company"},{code:"pro",title:"Producer"},{code:"prp",title:"Production place"},{code:"prs",title:"Production designer"},{code:"prt",title:"Printer"},{code:"prv",title:"Provider"},{code:"pta",title:"Patent applicant"},{code:"pte",title:"Plaintiff-appellee"},{code:"ptf",title:"Plaintiff"},{code:"pth",title:"Patent holder"},{code:"ptt",title:"Plaintiff-appellant"},{code:"pup",title:"Publication place"},{code:"rbr",title:"Rubricator"},{code:"rce",title:"Recording engineer"},{code:"rcd",title:"Recordist"},{code:"rcp",title:"Addressee"},{code:"rdd",title:"Radio director"},{code:"red",title:"Redaktor"},{code:"ren",title:"Renderer"},{code:"res",title:"Researcher"},{code:"rev",title:"Reviewer"},{code:"rpc",title:"Radio producer"},{code:"rps",title:"Repository"},{code:"rpt",title:"Reporter"},{code:"rpy",title:"Responsible party"},{code:"rse",title:"Respondent-appellee"},{code:"rsg",title:"Restager"},{code:"rsp",title:"Respondent"},{code:"rsr",title:"Restorationist"},{code:"rst",title:"Respondent-appellant"},{code:"rth",title:"Research team head"},{code:"rtm",title:"Research team member"},{code:"sad",title:"Scientific advisor"},{code:"sce",title:"Scenarist"},{code:"scl",title:"Sculptor"},{code:"scr",title:"Scribe"},{code:"sds",title:"Sound designer"},{code:"sec",title:"Secretary"},{code:"sgd",title:"Stage director"},{code:"sgn",title:"Signer"},{code:"sht",title:"Supporting host"},{code:"sll",title:"Seller"},{code:"sng",title:"Singer"},{code:"spk",title:"Speaker"},{code:"spn",title:"Sponsor"},{code:"spy",title:"Second party"},{code:"std",title:"Set designer"},{code:"stg",title:"Setting"},{code:"stl",title:"Storyteller"},{code:"stm",title:"Stage manager"},{code:"stn",title:"Standards body"},{code:"str",title:"Stereotyper"},{code:"srv",title:"Surveyor"},{code:"tcd",title:"Technical director"},{code:"tch",title:"Teacher"},{code:"ths",title:"Thesis advisor"},{code:"tld",title:"Television director"},{code:"tlp",title:"Television producer"},{code:"trc",title:"Transcriber"},{code:"trl",title:"Translator"},{code:"tyd",title:"Type designer"},{code:"tyg",title:"Typographer"},{code:"uvp",title:"University place"},{code:"vdg",title:"Videographer"},{code:"wac",title:"Writer of added commentary"},{code:"wal",title:"Writer of added lyrics"},{code:"wam",title:"Writer of accompanying material"},{code:"wat",title:"Writer of added text"},{code:"wdc",title:"Woodcutter"},{code:"wde",title:"Wood engraver"},{code:"wit",title:"Witness"}],c="",d=0;d<l.length;d++){var u=l[d];c+='<option value="'+u.code+'">'+u.title+"</option>"}return i("#"+o+"_role select").html(c),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("placeForm_"),r=i('<div class="annotationDialog"><div id="'+o+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+o+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+o+'_high" name="'+o+'_id_certainty" value="high" data-default="true" /><label for="'+o+'_high">High</label><input type="radio" id="'+o+'_medium" name="'+o+'_id_certainty" value="medium" /><label for="'+o+'_medium">Medium</label><input type="radio" id="'+o+'_low" name="'+o+'_id_certainty" value="low" /><label for="'+o+'_low">Low</label><input type="radio" id="'+o+'_unknown" name="'+o+'_id_certainty" value="unknown" /><label for="'+o+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"place",title:"Tag Place"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("titleForm_"),r=i('<div id="'+o+'Dialog" class="annotationDialog"><div id="'+o+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+o+'_level" data-type="radio" data-mapping="level"><p>This title is:</p><input type="radio" value="a" name="level" id="'+o+'_level_a"/><label for="'+o+'_level_a">Analytic <span>article, poem, or other item published as part of a larger item</span></label><br/><input type="radio" value="m" name="level" id="'+o+'_level_m" data-default="true" /><label for="'+o+'_level_m">Monographic <span>book, collection, single volume, or other item published as a distinct item</span></label><br/><input type="radio" value="j" name="level" id="'+o+'_level_j"/><label for="'+o+'_level_j">Journal <span>magazine, newspaper or other periodical publication</span></label><br/><input type="radio" value="s" name="level" id="'+o+'_level_s"/><label for="'+o+'_level_s">Series <span>book, radio, or other series</span></label><br/><input type="radio" value="u" name="level" id="'+o+'_level_u"/><label for="'+o+'_level_u">Unpublished <span>thesis, manuscript, letters or other unpublished material</span></label><br/></div><div id="'+o+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+o+'_high" name="'+o+'_id_certainty" value="high" data-default="true" /><label for="'+o+'_high">High</label><input type="radio" id="'+o+'_medium" name="'+o+'_id_certainty" value="medium" /><label for="'+o+'_medium">Medium</label><input type="radio" id="'+o+'_low" name="'+o+'_id_certainty" value="low" /><label for="'+o+'_low">Low</label><input type="radio" id="'+o+'_unknown" name="'+o+'_id_certainty" value="unknown" /><label for="'+o+'_unknown">Unknown</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:630,height:660,type:"title",title:"Tag Title"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);n(20),e.exports=function(e,t){var n=e,o=n.getUniqueId("rsForm_"),r=i('<div class="annotationDialog"><div id="'+o+'_tagAs"><p>Tag as:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div id="'+o+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="cert"><p>This identification is:</p><input type="radio" id="'+o+'_high" name="'+o+'_id_certainty" value="high" data-default="true" /><label for="'+o+'_high">High</label><input type="radio" id="'+o+'_medium" name="'+o+'_id_certainty" value="medium" /><label for="'+o+'_medium">Medium</label><input type="radio" id="'+o+'_low" name="'+o+'_id_certainty" value="low" /><label for="'+o+'_low">Low</label><input type="radio" id="'+o+'_unknown" name="'+o+'_id_certainty" value="unknown" /><label for="'+o+'_unknown">Unknown</label></div><div><div class="type"><label>Type (optional):</label><select name="type" data-mapping="type" data-type="select" data-transform="selectmenu"></select></div><div style="margin-top: 5px;"><label>Other type:</label><input name="otherType" type="text" data-mapping="type" data-type="textbox" /></div></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"rs",title:"Tag Referencing String"}),l=["Award","BirthPosition","Certainty","Credential","EducationalAward","Ethnicity","Gender","GeographicHeritage","NationalHeritage","NationalIdentity","NaturalPerson","Occupation","PoliticalAffiliation","Precision","RaceColour","Religion","ReproductiveHistory","Role","Sexuality","SocialClass","TextLabels"],c="";return c+='<option value="">(none)</option>',c+='<option value="$$$$OTHER$$$$">Other (specify)</option>',l.forEach((function(e){c+='<option value="http://sparql.cwrc.ca/ontology/cwrc#'+e+'">'+e+"</option>"})),r.find("select[name=type]").html(c).selectmenu("refresh").on("selectmenuselect",(function(e,t){"$$$$OTHER$$$$"===t.item.value?r.find("input[name=otherType]").parent().show():(r.find("input[name=otherType]").val(t.item.value).parent().hide(),i(this).trigger("change",{target:this}))})),r.find("select[name=type]").selectmenu("menuWidget").addClass("overflow").height("300px"),s.$el.on("beforeShow",(function(e,t){var n=t.entry,i="",a=!1;void 0!==n&&void 0!==n.getAttribute("type")&&(i=n.getAttribute("type"),a=-1===l.indexOf(i)),a?(r.find("select[name=type]").val("$$$$OTHER$$$$").selectmenu("refresh"),r.find("input[name=otherType]").val(i).parent().show()):(r.find("select[name=type]").val(i),r.find("input[name=otherType]").val(i).parent().hide())})),s.$el.on("beforeSave",(function(e,t){""===s.currentData.attributes.type&&delete s.currentData.attributes.type})),{show:function(e){s.show(e)},destroy:function(){r.find("select[name=type]").selectmenu("destroy"),s.destroy()}}}},function(e,t,n){var i=n(308),a=n(309),o=n(310),r=n(311),s=n(312),l=n(313),c=n(314),d=n(315),u=n(316),p=n(317);e.exports={citation:i,correction:a,date:o,keyword:r,link:s,note:l,org:c,person:d,place:u,title:p}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("citationForm_"),r=i('<div class="annotationDialog"><div><p>Selected source:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div><label for="'+o+'_noteContent">Citation text</label><textarea id="'+o+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:600,height:500,type:"citation",title:"Tag Citation"});return s.$el.on("beforeShow",(function(e,t,n){i("#"+o+"_type").val("citation"),n.mode===a.EDIT?(n.$el.find("label[for="+o+"_noteContent]").hide(),n.$el.find("#"+o+"_noteContent").hide()):(n.$el.find("label[for="+o+"_noteContent]").show(),n.$el.find("#"+o+"_noteContent").show())})),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("corrForm_"),r=i('<div class="annotationDialog"><div><p>Correction</p><textarea data-type="textbox" data-mapping="CORR"></textarea></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:385,height:400,type:"correction",title:"Tag Correction"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(0),o=n(2);n(6),n(28),e.exports=function(e,t){var n=e,r=(new Date).getFullYear()+10,s=n.getUniqueId("dateForm_"),l=i('<div class="annotationDialog"><div id="'+s+'_type" data-transform="buttonset" data-type="radio" data-mapping="prop.tag"><p>Date type:</p><input type="radio" name="dateType" value="DATE" id="'+s+'_type_date" checked="checked"/><label for="'+s+'_type_date">Single Date</label><input type="radio" name="dateType" value="DATERANGE" id="'+s+'_type_range"/><label for="'+s+'_type_range">Date Range</label><input type="radio" name="dateType" value="DATESTRUCT" id="'+s+'_type_season"/><label for="'+s+'_type_season">Season/Occasion</label></div><div id="'+s+'_date"><label for="'+s+'_cwrc_datePicker">Date:</label><br/><input type="text" data-type="textbox" data-mapping="VALUE" id="'+s+'_cwrc_datePicker" /></div><div id="'+s+'_range"><label for="'+s+'_startDate">Start date:</label><br/><input type="text" data-type="textbox" data-mapping="FROM" id="'+s+'_startDate" style="margin-bottom: 5px;"/><br /><label for="'+s+'_endDate">End date:</label><br/><input type="text" data-type="textbox" data-mapping="TO" id="'+s+'_endDate" /></div><div>Format: YYYY, YYYY-MM, or YYYY-MM-DD<br/>e.g. 2010, 2010-10, 2010-10-31</div><div id="'+s+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="CERTAINTY"><p>Certainty:</p><input type="radio" id="'+s+'_cert" name="'+s+'_id_certainty" value="CERT" data-default="true" /><label for="'+s+'_cert">Certain</label><input type="radio" id="'+s+'_c" name="'+s+'_id_certainty" value="C" /><label for="'+s+'_c">Circa</label><input type="radio" id="'+s+'_by" name="'+s+'_id_certainty" value="BY" /><label for="'+s+'_by">By this date</label><input type="radio" id="'+s+'_after" name="'+s+'_id_certainty" value="AFTER" /><label for="'+s+'_after">After this date</label><input type="radio" id="'+s+'_unknown" name="'+s+'_id_certainty" value="UNKNOWN" /><label for="'+s+'_unknown">Unknown date</label><input type="radio" id="'+s+'_rough" name="'+s+'_id_certainty" value="ROUGHLYDATED" /><label for="'+s+'_rough">Rough certainty</label></div><div id="'+s+'_calendar" data-transform="buttonset" data-type="radio" data-mapping="CALENDAR"><p>Calendar type:</p><input type="radio" name="calendarType" value="NEWSTYLE" id="'+s+'_calendar_new" checked="checked"/><label for="'+s+'_calendar_new">New style</label><input type="radio" name="calendarType" value="BC" id="'+s+'_calendar_old"/><label for="'+s+'_calendar_old">BC</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+s+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),c=new o({writer:n,$el:l,type:"date",title:"Tag Date"});i("#"+s+"_type input").click((function(){f(i(this).val())}));var d=i("#"+s+"_cwrc_datePicker");d.focus((function(){i(this).css({borderBottom:""})})),d.datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(r,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0}),i("#ui-datepicker-div").appendTo(t);var u=i("#"+s+"_startDate");u.focus((function(){i(this).css({borderBottom:""})}));var p=i("#"+s+"_endDate");p.focus((function(){i(this).css({borderBottom:""})}));var g=i("#"+s+"_startDate, #"+s+"_endDate").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(r,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0,onSelect:function(e){var t=-1===this.id.indexOf("startDate")?"maxDate":"minDate",n=i(this).data("datepicker"),a=i.datepicker.parseDate(n.settings.dateFormat||i.datepicker._defaults.dateFormat,e,n.settings);g.not(this).datepicker("option",t,a),i(this).change()}}),f=function(e){i("#"+s+"_date").hide(),i("#"+s+"_range").hide(),d.val(""),u.val(""),p.val(""),"DATERANGE"===e?i("#"+s+"_range").show():i("#"+s+"_date").show();var t=n.schemaManager.getAttributesForTag(e);c.attributesWidget.buildWidget(t),c.attWidgetInit=!0,c.attributesWidget.reset()};return c.$el.on("beforeShow",(function(e,t){if(g.datepicker("option","minDate",new Date(1800,0,1)),g.datepicker("option","maxDate",new Date(r,11,31)),c.mode===o.ADD){var l="",h=n.editor.currentBookmark.rng.toString();if(""!=h){var m=a(h).toDate(),v=m.getFullYear();if(!isNaN(v))if(h.length>4){var y=m.getMonth();++y<10&&(y="0"+y);var b=m.getDate();b<10&&(b="0"+b),l=v+"-"+y+"-"+b}else l=++v}f("DATE"),i("#"+s+"_type_date").prop("checked",!0).button("refresh"),d.val(l),u.val(""),p.val("")}else{var w=t.entry.getAttributes(),_=t.entry.getTag();f(_),"DATERANGE"===_?(d.val(""),u.val(w.FROM),p.val(w.TO)):(d.val(w.VALUE),u.val(""),p.val(""))}d.css({borderBottom:""}),u.css({borderBottom:""}),p.css({borderBottom:""}),d.focus()})),c.$el.on("beforeSave",(function(e,t){var n=!1;if("DATERANGE"===i("#"+s+"_type input:checked").val()){var o=u.val(),r=p.val(),l=a(o),c=a(r);l.isValid()?t.currentData.attributes.FROM=o:(u.css({borderBottom:"1px solid red"}),n=!0),c.isValid()?t.currentData.attributes.TO=r:(p.css({borderBottom:"1px solid red"}),n=!0),l.isAfter(c)&&(u.css({borderBottom:"1px solid red"}),p.css({borderBottom:"1px solid red"}),n=!0)}else{var g=d.val();a(g).isValid()?t.currentData.attributes.VALUE=g:(d.css({borderBottom:"1px solid red"}),n=!0)}t.isValid=!n})),{show:function(e){c.show(e)},destroy:function(){d.datepicker("destroy"),g.datepicker("destroy"),c.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("keywordForm_"),r=i('<div class="annotationDialog"><div><input type="text" data-type="textbox" data-mapping="KEYWORDTYPE" /></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"keyword",title:"Tag Keyword",height:350,width:350});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);n(6),e.exports=function(e,t){var n=e,o=n.getUniqueId("linkForm_"),r=i('<div class="annotationDialog"><div><label for="'+o+'_input">Hypertext link (URL or URI)</label><input type="text" id="'+o+'_input" data-type="textbox" data-mapping="URL" style="margin-right: 10px;"/><button type="button">Check Link</button></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:350,height:350,type:"link",title:"Tag Link"});return i("button",r).button().click((function(){var e=i("#"+o+"_input").val();if(""!=e){null==e.match(/^https?:\/\//)&&(e="http://"+e);try{window.open(e,"linkTestWindow")}catch(e){alert(e)}}})),{show:function(e){s.show(e)},destroy:function(){i("button",r).button("destroy"),s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("noteForm_"),r=i('<div class="annotationDialog"><div><div id="'+o+'_type" data-transform="buttonset" data-type="radio" data-mapping="prop.tag"><input type="radio" id="'+o+'_re" name="'+o+'_type" value="RESEARCHNOTE" data-default="true" /><label for="'+o+'_re">Research Note</label><input type="radio" id="'+o+'_scho" name="'+o+'_type" value="SCHOLARNOTE" /><label for="'+o+'_scho">Scholarly Note</label></div></div><div><label for="'+o+'_noteContent">Note text</label><textarea id="'+o+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:850,height:650,type:"note",title:"Tag Note"});return s.$el.on("beforeShow",(function(e,t,n){n.mode===a.EDIT?(n.$el.find("label[for="+o+"_noteContent]").hide(),n.$el.find("#"+o+"_noteContent").hide()):(n.$el.find("label[for="+o+"_noteContent]").show(),n.$el.find("#"+o+"_noteContent").show())})),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("orgForm_"),r=i('<div class="annotationDialog"><div><label for="'+o+'_input">Standard name</label><input type="text" id="'+o+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,height:450,type:"org",title:"Tag Organization"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("noteForm_"),r=i('<div class="annotationDialog"><div><label for="'+o+'_input">Standard name</label><input type="text" id="'+o+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"person",title:"Tag Person",height:400});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("placeForm_"),r=i('<div class="annotationDialog"><div id="'+o+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="custom.placeType"><p>Type of place:</p><input type="radio" id="'+o+'_address" name="'+o+'_type_place" value="ADDRESS" data-default="true" /><label for="'+o+'_address">Address</label><input type="radio" id="'+o+'_area" name="'+o+'_type_place" value="AREA" /><label for="'+o+'_area">Area</label><input type="radio" id="'+o+'_geog" name="'+o+'_type_place" value="GEOG" /><label for="'+o+'_geog">Geog</label><input type="radio" id="'+o+'_placename" name="'+o+'_type_place" value="PLACENAME" /><label for="'+o+'_placename">Placename</label><input type="radio" id="'+o+'_region" name="'+o+'_type_place" value="REGION" /><label for="'+o+'_region">Region</label><input type="radio" id="'+o+'_settlement" name="'+o+'_type_place" value="SETTLEMENT" /><label for="'+o+'_settlement">Settlement</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"place",title:"Tag Place",width:650,height:450});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("noteForm_"),r=i('<div class="annotationDialog"><div><label for="'+o+'_input">Standard name</label><input type="text" id="'+o+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div id="'+o+'_level" data-type="radio" data-mapping="TITLETYPE"><p>This title is:</p><input type="radio" value="ANALYTIC" name="'+o+'_level" id="'+o+'_level_a"/><label for="'+o+'_level_a">Analytic <span>article, poem, or other item published as part of a larger item</span></label><br/><input type="radio" value="MONOGRAPHIC" name="'+o+'_level" id="'+o+'_level_m" data-default="true" /><label for="'+o+'_level_m">Monographic <span>book, collection, single volume, or other item published as a distinct item</span></label><br/><input type="radio" value="JOURNAL" name="'+o+'_level" id="'+o+'_level_j"/><label for="'+o+'_level_j">Journal <span>magazine, newspaper or other periodical publication</span></label><br/><input type="radio" value="SERIES" name="'+o+'_level" id="'+o+'_level_s"/><label for="'+o+'_level_s">Series <span>book, radio, or other series</span></label><br/><input type="radio" value="UNPUBLISHED" name="'+o+'_level" id="'+o+'_level_u"/><label for="'+o+'_level_u">Unpublished <span>thesis, manuscript, letters or other unpublished material</span></label><br/></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:430,height:490,type:"title",title:"Tag Title"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(319),a=n(320),o=n(321),r=n(322),s=n(323),l=n(324),c=n(325),d=n(326),u=n(327),p=n(328);e.exports={citation:i,correction:a,date:o,keyword:r,link:s,note:l,org:c,person:d,place:u,title:p}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("citationForm_"),r=i('<div class="annotationDialog"><div><p>Selected source:</p><span class="tagAs" data-type="label" data-mapping="prop.lemma"></span></div><div><label for="'+o+'_noteContent">Citation text</label><textarea id="'+o+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:600,height:500,type:"citation",title:"Tag Citation"});return s.$el.on("beforeShow",(function(e,t,n){i("#"+o+"_type").val("citation"),n.mode===a.EDIT?(n.$el.find("label[for="+o+"_noteContent]").hide(),n.$el.find("#"+o+"_noteContent").hide()):(n.$el.find("label[for="+o+"_noteContent]").show(),n.$el.find("#"+o+"_noteContent").show())})),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("corrForm_"),r=i('<div class="annotationDialog"><div><p>Correction</p><textarea data-type="textbox" data-mapping="CORR"></textarea></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:385,height:400,type:"correction",title:"Tag Correction"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(0),o=n(2);n(6),n(28),e.exports=function(e,t){var n=e,r=(new Date).getFullYear()+10,s=n.getUniqueId("citationForm_"),l=i('<div class="annotationDialog"><div id="'+s+'_type" data-transform="buttonset" data-type="radio" data-mapping="prop.tag"><p>Date type:</p><input type="radio" name="dateType" value="DATE" id="'+s+'_type_date" checked="checked"/><label for="'+s+'_type_date">Single Date</label><input type="radio" name="dateType" value="DATERANGE" id="'+s+'_type_range"/><label for="'+s+'_type_range">Date Range</label></div><div id="'+s+'_date"><label for="'+s+'_cwrc_datePicker">Date:</label><br/><input type="text" data-type="textbox" data-mapping="VALUE" id="'+s+'_cwrc_datePicker" /></div><div id="'+s+'_range"><label for="'+s+'_startDate">Start date:</label><br/><input type="text" data-type="textbox" data-mapping="FROM" id="'+s+'_startDate" style="margin-bottom: 5px;"/><br /><label for="'+s+'_endDate">End date:</label><br/><input type="text" data-type="textbox" data-mapping="TO" id="'+s+'_endDate" /></div><div>Format: YYYY, YYYY-MM, or YYYY-MM-DD<br/>e.g. 2010, 2010-10, 2010-10-31</div><div id="'+s+'_certainty" data-transform="buttonset" data-type="radio" data-mapping="CERTAINTY"><p>Certainty:</p><input type="radio" id="'+s+'_cert" name="'+s+'_id_certainty" value="CERT" data-default="true" /><label for="'+s+'_cert">Certain</label><input type="radio" id="'+s+'_c" name="'+s+'_id_certainty" value="C" /><label for="'+s+'_c">Circa</label><input type="radio" id="'+s+'_by" name="'+s+'_id_certainty" value="BY" /><label for="'+s+'_by">By this date</label><input type="radio" id="'+s+'_after" name="'+s+'_id_certainty" value="AFTER" /><label for="'+s+'_after">After this date</label><input type="radio" id="'+s+'_unknown" name="'+s+'_id_certainty" value="UNKNOWN" /><label for="'+s+'_unknown">Unknown date</label><input type="radio" id="'+s+'_rough" name="'+s+'_id_certainty" value="ROUGHLYDATED" /><label for="'+s+'_rough">Rough certainty</label></div><div id="'+s+'_calendar" data-transform="buttonset" data-type="radio" data-mapping="CALENDAR"><p>Calendar type:</p><input type="radio" name="calendarType" value="NEWSTYLE" id="'+s+'_calendar_new" checked="checked"/><label for="'+s+'_calendar_new">New style</label><input type="radio" name="calendarType" value="BC" id="'+s+'_calendar_old"/><label for="'+s+'_calendar_old">BC</label></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+s+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),c=new o({writer:n,$el:l,type:"date",title:"Tag Date"});i("#"+s+"_type input").click((function(){f(i(this).val())}));var d=i("#"+s+"_cwrc_datePicker");d.focus((function(){i(this).css({borderBottom:""})})),d.datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(r,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0}),i("#ui-datepicker-div").appendTo(t);var u=i("#"+s+"_startDate");u.focus((function(){i(this).css({borderBottom:""})}));var p=i("#"+s+"_endDate");p.focus((function(){i(this).css({borderBottom:""})}));var g=i("#"+s+"_startDate, #"+s+"_endDate").datepicker({dateFormat:"yy-mm-dd",constrainInput:!1,changeMonth:!0,changeYear:!0,yearRange:"-210:+10",minDate:new Date(1800,0,1),maxDate:new Date(r,11,31),showOn:"button",buttonText:"Date Picker",buttonImage:n.cwrcRootUrl+"img/calendar.png",buttonImageOnly:!0,onSelect:function(e){var t=-1===this.id.indexOf("startDate")?"maxDate":"minDate",n=i(this).data("datepicker"),a=i.datepicker.parseDate(n.settings.dateFormat||i.datepicker._defaults.dateFormat,e,n.settings);g.not(this).datepicker("option",t,a),i(this).change()}}),f=function(e){i("#"+s+"_date").hide(),i("#"+s+"_range").hide(),d.val(""),u.val(""),p.val(""),"DATERANGE"===e?i("#"+s+"_range").show():i("#"+s+"_date").show();var t=n.schemaManager.getAttributesForTag(e);c.attributesWidget.buildWidget(t),c.attWidgetInit=!0,c.attributesWidget.reset()};return c.$el.on("beforeShow",(function(e,t){if(g.datepicker("option","minDate",new Date(1800,0,1)),g.datepicker("option","maxDate",new Date(r,11,31)),c.mode===o.ADD){var l="",h=n.editor.currentBookmark.rng.toString();if(""!=h){var m=a(h).toDate(),v=m.getFullYear();if(!isNaN(v))if(h.length>4){var y=m.getMonth();++y<10&&(y="0"+y);var b=m.getDate();b<10&&(b="0"+b),l=v+"-"+y+"-"+b}else l=++v}f("DATE"),i("#"+s+"_type_date").prop("checked",!0).button("refresh"),d.val(l),u.val(""),p.val("")}else{var w=t.entry.getAttributes(),_=t.entry.getTag();f(_),"DATERANGE"===_?(d.val(""),u.val(w.FROM),p.val(w.TO)):(d.val(w.VALUE),u.val(""),p.val(""))}d.css({borderBottom:""}),u.css({borderBottom:""}),p.css({borderBottom:""}),d.focus()})),c.$el.on("beforeSave",(function(e,t){var n=!1;if("DATERANGE"===i("#"+s+"_type input:checked").val()){var o=u.val(),r=p.val(),l=a(o),c=a(r);l.isValid()?t.currentData.attributes.FROM=o:(u.css({borderBottom:"1px solid red"}),n=!0),c.isValid()?t.currentData.attributes.TO=r:(p.css({borderBottom:"1px solid red"}),n=!0),l.isAfter(c)&&(u.css({borderBottom:"1px solid red"}),p.css({borderBottom:"1px solid red"}),n=!0)}else{var g=d.val();a(g).isValid()?t.currentData.attributes.VALUE=g:(d.css({borderBottom:"1px solid red"}),n=!0)}t.isValid=!n})),{show:function(e){c.show(e)},destroy:function(){d.datepicker("destroy"),g.datepicker("destroy"),c.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("citationForm_"),r=i('<div class="annotationDialog"><div><input type="text" data-type="textbox" data-mapping="KEYWORDTYPE" /></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"keyword",title:"Tag Keyword",height:350,width:350});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);n(6),e.exports=function(e,t){var n=e,o=n.getUniqueId("citationForm_"),r=i('<div class="annotationDialog"><div><label for="'+o+'_input">Hypertext link (URL or URI)</label><input type="text" id="'+o+'_input" data-type="textbox" data-mapping="URL" style="margin-right: 10px;"/><button type="button">Check Link</button></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:350,height:350,type:"link",title:"Tag Link"});return i("button",r).button().click((function(){var e=i("#"+o+"_input").val();if(""!=e){null==e.match(/^https?:\/\//)&&(e="http://"+e);try{window.open(e,"linkTestWindow")}catch(e){alert(e)}}})),{show:function(e){s.show(e)},destroy:function(){i("button",r).button("destroy"),s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("noteForm_"),r=i('<div class="annotationDialog"><div><div id="'+o+'_type" data-transform="buttonset" data-type="radio" data-mapping="prop.tag"><input type="radio" id="'+o+'_re" name="'+o+'_type" value="RESEARCHNOTE" data-default="true" /><label for="'+o+'_re">Research Note</label><input type="radio" id="'+o+'_scho" name="'+o+'_type" value="SCHOLARNOTE" /><label for="'+o+'_scho">Scholarly Note</label></div></div><div><label for="'+o+'_noteContent">Note text</label><textarea id="'+o+'_noteContent" data-type="textbox" data-mapping="prop.noteContent" style="width: 98%; height: 100px;"></textarea><p>You will be able to tag and edit the text in the main document.</p></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:600,height:500,type:"note",title:"Tag Note"});return s.$el.on("beforeShow",(function(e,t,n){n.mode===a.EDIT?(n.$el.find("label[for="+o+"_noteContent]").hide(),n.$el.find("#"+o+"_noteContent").hide()):(n.$el.find("label[for="+o+"_noteContent]").show(),n.$el.find("#"+o+"_noteContent").show())})),{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("orgForm_"),r=i('<div class="annotationDialog"><div><label for="'+o+'_input">Standard name</label><input type="text" id="'+o+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div><p>Organization type:</p><select data-type="select" data-mapping="ORGTYPE"><option value=""></option><option value="labour">labour</option><option value="club or society">club or society</option><option value="political">political</option><option value="academic">academic</option><option value="research">research</option><option value="corporate">corporate</option><option value="activist">activist</option><option value="governmental">governmental</option><option value="military">military</option><option value="law-enforcement">law-enforcement</option><option value="professional">professional</option><option value="sporting">sporting</option><option value="medical">medical</option><option value="altruistic">altruistic</option><option value="non-profit">non-profit</option><option value="artistic">artistic</option><option value="dramatic">dramatic</option><option value="ethnic">ethnic</option><option value="literary">literary</option><option value="musical">musical</option><option value="religious">religious</option><option value="publishing">publishing</option><option value="school">school</option></select></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,height:500,type:"org",title:"Tag Organization"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("noteForm_"),r=i('<div class="annotationDialog"><div><label for="'+o+'_input">Standard name</label><input type="text" id="'+o+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"person",title:"Tag Person"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("noteForm_"),r=i('<div class="annotationDialog"><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,type:"place",title:"Tag Place"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){var i=n(1),a=n(2);e.exports=function(e,t){var n=e,o=n.getUniqueId("noteForm_"),r=i('<div class="annotationDialog"><div><label for="'+o+'_input">Standard name</label><input type="text" id="'+o+'_input" data-type="textbox" data-mapping="STANDARD" /></div><div id="'+o+'_level" data-type="radio" data-mapping="LEVEL"><p>This title is:</p><input type="radio" value="ANALYTIC" name="'+o+'_level" id="'+o+'_level_a"/><label for="'+o+'_level_a">Analytic <span>article, poem, or other item published as part of a larger item</span></label><br/><input type="radio" value="MONOGRAPHIC" name="'+o+'_level" id="'+o+'_level_m" data-default="true" /><label for="'+o+'_level_m">Monographic <span>book, collection, single volume, or other item published as a distinct item</span></label><br/><input type="radio" value="JOURNAL" name="'+o+'_level" id="'+o+'_level_j"/><label for="'+o+'_level_j">Journal <span>magazine, newspaper or other periodical publication</span></label><br/><input type="radio" value="SERIES" name="'+o+'_level" id="'+o+'_level_s"/><label for="'+o+'_level_s">Series <span>book, radio, or other series</span></label><br/><input type="radio" value="UNPUBLISHED" name="'+o+'_level" id="'+o+'_level_u"/><label for="'+o+'_level_u">Unpublished <span>thesis, manuscript, letters or other unpublished material</span></label><br/></div><div data-transform="accordion"><h3>Markup options</h3><div id="'+o+'_attParent" class="attributes" data-type="attributes" data-mapping="attributes"></div></div></div>').appendTo(t),s=new a({writer:n,$el:r,width:430,height:500,type:"title",title:"Tag Title"});return{show:function(e){s.show(e)},destroy:function(){s.destroy()}}}},function(e,t,n){"use strict";var i=n(1),a=n(17);function o(e){this.w=e,this.reset(),this.w.event("processingDocument").subscribe(function(){this.reset()}.bind(this)),this.w.event("entityAdded").subscribe(function(e){}.bind(this)),this.w.event("entityEdited").subscribe(function(e){}.bind(this)),this.w.event("entityRemoved").subscribe(function(e){this.highlightEntity()}.bind(this)),this.w.event("entityPasted").subscribe(function(e){this.highlightEntity(e)}.bind(this))}o.prototype={constructor:o,addEntity:function(e,t){var n;"Entity"===e.constructor.name?n=e:(void 0===e.id&&(e.id=this.w.getUniqueId("dom_")),void 0===e.tag&&(e.tag=this.w.schemaManager.mapper.getParentTag(e.type)),n=new a(e));var i=this.w.schemaManager.mapper.getRequiredAttributes(e.type);for(var o in i)n.setAttribute(o,i[o]);return this.w.schemaManager.mapper.updatePropertiesFromAttributes(n),void 0!==t&&this.w.tagger.addEntityTag(n,t),void 0===n.getContent()&&n.setContent(this.getTextContentForEntity(n.id)),this.entities[n.id]=n,this.w.event("entityAdded").publish(n.id),n},editEntity:function(e,t){if(t.properties&&t.properties.type&&t.properties.type!==e.getType()){var n=this.w.schemaManager.mapper.getRequiredAttributes(e.getType());for(var i in n)e.removeAttribute(i)}if(e.setAttributes(t.attributes),void 0!==t.properties)for(var a in t.properties)e.setProperty(a,t.properties[a]);this.w.schemaManager.mapper.updatePropertiesFromAttributes(e);n=this.w.schemaManager.mapper.getRequiredAttributes(e.getType());for(var i in n)e.setAttribute(i,n[i]);for(var a in t.customValues)e.setCustomValue(a,t.customValues[a]);return e},removeEntity:function(e){void 0!==this.entities[e]&&(delete this.entities[e],this.w.event("entityRemoved").publish(e))},getEntity:function(e){return this.entities[e]},setEntity:function(e,t){t instanceof a?this.entities[e]=t:console.warn("entitiesManager: trying to set a non-Entity object.")},cloneEntity:function(e){var t=this.entities[e].clone();return t.id=this.w.getUniqueId("dom_"),t},getEntities:function(){return this.entities},getEntitiesArray:function(e){var t=[];if("cat"===(e=void 0===e?"seq":e)){var n=Object.values(this.entities),a={};for(var o in n.forEach((function(e){var t=e.getType();void 0===a[t]&&(a[t]=[]),a[t].push(e)})),a)for(var r=a[o],s=0;s<r.length;s++){var l=r[s];t.push(l)}}else if("alpha"===e)t=Object.values(this.entities).sort((function(e,t){var n=e.getTitle().charAt(0).toLowerCase(),i=t.getTitle().charAt(0).toLowerCase();return n<i?-1:n>i?1:0}));else{i("[_entity][class~=start]",this.w.editor.getBody()).each(function(e,n){var a=this.getEntity(i(n).attr("name"));void 0!==a&&t.push(a)}.bind(this))}return t},eachEntity:function(e){i.each(this.entities,e)},getCurrentEntity:function(){return this.currentEntity},setCurrentEntity:function(e){this.currentEntity=e},getTextContentForEntity:function(e){var t="";return i("[name="+e+"]",this.w.editor.getBody()).each((function(e,n){t+=n.textContent})),t},setURIForEntity:function(e,t){var n=this.getEntity(e);n.setURI(t);var i=this.w.schemaManager.mapper.getAttributeForProperty(n.getType(),"uri");i&&n.setAttribute(i,t)},setLemmaForEntity:function(e,t){var n=this.getEntity(e);n.setLemma(t);var i=this.w.schemaManager.mapper.getAttributeForProperty(n.getType(),"lemma");i&&n.setAttribute(i,t)},setCertaintyForEntity:function(e,t){var n=this.getEntity(e);n.setCertainty(t);var i=this.w.schemaManager.mapper.getAttributeForProperty(n.getType(),"certainty");i&&n.setAttribute(i,t)},removeHighlights:function(){var e=i(".entityHighlight",this.w.editor.getBody());0!==e.length&&e.each((function(e,t){var n=i(t);if(n.hasClass("noteWrapper"))n.removeClass("entityHighlight");else{var a=n.parent()[0];0!==n.contents().length?n.contents().unwrap():n.remove(),a.normalize()}})),null!==this.currentEntity&&this.w.event("entityUnfocused").publish(this.currentEntity)},highlightEntity:function(e,t,n){if(this.removeHighlights(),this.currentEntity=null,e){this.currentEntity=e;var a=i('[name="'+e+'"]',this.w.editor.getBody());if(a.length>0){var o=this.getEntity(e),r=o.getType(),s=this.w.editor.dom.createRng();if(this.w.editor.selection.setRng(s),o.isNote()?a.parent(".noteWrapper").removeClass("hide").addClass("entityHighlight"):(a.wrap('<span class="entityHighlight '+r+'"/>'),a.parents(".noteWrapper").removeClass("hide")),t?this.w.editor.selection.moveToBookmark(t):((s=this.w.editor.dom.createRng()).setStart(a[0],0),s.collapse(!0),this.w.editor.selection.setRng(s)),n){var l=a.offset().top;i(this.w.editor.getDoc().documentElement).scrollTop(l)}this.w.event("entityFocused").publish(e)}}},doEntitiesOverlap:function(){this.highlightEntity();var e=!1;return this.eachEntity(function(t,n){var i=this.w.editor.dom.select('[name="'+t+'"]');if(i.length>1){var a=i[0],o=i[i.length-1];if(a.parentNode!==o.parentNode)return e=!0,!1}}.bind(this)),e},removeOverlappingEntities:function(){this.highlightEntity(),this.eachEntity(function(e,t){var n=this.w.editor.dom.select('[name="'+e+'"]');if(n.length>1){var i=n[0],a=n[n.length-1];i.parentNode!==a.parentNode&&this.w.tagger.removeEntity(e)}}.bind(this))},convertBoundaryEntitiesToTags:function(){this.eachEntity(function(e,t){var n=this.w.editor.dom.select('[name="'+e+'"]');if(n.length>1){for(var a=!0,o=n[0].parentNode,r=0;r<n.length;r++)if(n[r].parentNode!==o){a=!1;break}if(a){var s=i(this.w.editor.dom.create("span",{},"")),l=n[0].attributes;for(r=0;r<l.length;r++){var c=l[r];s.attr(c.name,c.value)}s.addClass("end"),s.attr("id",s.attr("name")),s.attr("_tag",t.getTag()),i(n).wrapAll(s),i(n).contents().unwrap()}}}.bind(this))},reset:function(){this.currentEntity=null,this.entities={}}},e.exports=o},function(e,t,n){"use strict";var i=n(1),a=(n(17),n(9));e.exports=function(e){var t=e,n={ADD:"add",BEFORE:"before",AFTER:"after",AROUND:"around",INSIDE:"inside",NO_SELECTION:"no_selection",NO_COMMON_PARENT:"no_common_parent",OVERLAP:"overlap",VALID:"valid",getCurrentTag:function(e){if(null!=e){var n=i("#"+e,t.editor.getBody());return 0===n.length&&(n=i('[name="'+e+'"]',t.editor.getBody())),n}return i(t.editor.selection.getNode())},getAttributesForTag:function(e){var t=e.getAttribute("_attributes");if(null!==t){var n=t.replace(/&quot;/g,'"');return JSON.parse(n)}return{}},setAttributesForTag:function(e,t){for(var n=e.attributes,i=n.length-1;i>=0;i--){var o=n[i];!0!==a.reservedAttributes[o.name]&&e.removeAttribute(o.name)}for(var r in t)!0!==a.reservedAttributes[r]&&e.setAttribute(r,t[r]);var s=JSON.stringify(t).replace(/"/g,"&quot;");e.setAttribute("_attributes",s)},addAttributesToTag:function(e,t){var i=n.getAttributesForTag(e);for(var o in t)if(!0!==a.reservedAttributes[o]){var r=t[o];e.setAttribute(o,r),i[o]=r}var s=JSON.stringify(i).replace(/"/g,"&quot;");e.setAttribute("_attributes",s)},removeAttributeFromTag:function(e,t){e.removeAttribute(t);var i=n.getAttributesForTag(e);delete i[t];var a=JSON.stringify(i).replace(/"/g,"&quot;");e.setAttribute("_attributes",a)},addTagDialog:function(e,a,o){if(e!==t.schemaManager.getHeader()){if(null==t.editor.currentBookmark.tagId){t.editor.selection.moveToBookmark(t.editor.currentBookmark);var r=a===n.ADD;if(d(!0,r)!==n.VALID)return void t.dialogManager.show("message",{title:"Error",msg:"Please ensure that the beginning and end of your selection have a common parent.<br/>For example, your selection cannot begin in one paragraph and end in another, or begin in bolded text and end outside of that text.",type:"error"});t.editor.currentBookmark=t.editor.selection.getBookmark(1)}var s=void 0;if(Array.isArray(o));else if(a===n.ADD||a===n.INSIDE){var l;if(void 0===o){var c=t.editor.currentBookmark.rng.commonAncestorContainer;l=c.nodeType===Node.TEXT_NODE?i(c).parent():i(c)}else l=i("#"+o,t.editor.getBody());s=t.utilities.getElementXPath(l[0]),s+="/"+e}t.dialogManager.getDialog("attributesEditor").show(e,s,{},(function(i){null!==i&&n.addStructureTag(e,i,t.editor.currentBookmark,a),delete t.editor.currentBookmark.tagId}))}else t.dialogManager.show("header")},editTagDialog:function(e){var i=n.getCurrentTag(e);if(i.attr("_entity")){t.editor.currentBookmark=t.editor.selection.getBookmark(1);var a=t.entitiesManager.getEntity(i.attr("id"));a?t.dialogManager.show(a.getType(),{entry:a}):console.warn("tagger.editTag: no entry for entity",i)}else{var o=i.attr("_tag");if(o===t.schemaManager.getHeader())t.dialogManager.show("header");else{var r=t.utilities.getElementXPath(i[0]),s=n.getAttributesForTag(i[0]);t.dialogManager.getDialog("attributesEditor").show(o,r,s,(function(e){null!==e&&n.editStructureTag(i,e)}))}}},changeTagDialog:function(e,a){var o=n.getCurrentTag(a);if(o.attr("_entity"))t.dialogManager.confirm({title:"Remove Entity?",msg:"Changing this tag will remove the associated annotation. Do you want to proceed?",showConfirmKey:"confirm-change-tag-remove-entity",type:"info",callback:function(o){if(o){var r=n.removeEntity(a),s=t.utilities.getElementXPath(r.parentElement);s+="/"+e;var l=n.getAttributesForTag(r);t.dialogManager.getDialog("attributesEditor").show(e,s,l,(function(t){null!==t&&n.editStructureTag(i(r),t,e)}))}}});else{var r=t.utilities.getElementXPath(o.parent()[0]);r+="/"+e;var s=n.getAttributesForTag(o[0]);t.dialogManager.getDialog("attributesEditor").show(e,r,s,(function(t){null!==t&&n.editStructureTag(o,t,e)}))}},addEntityDialog:function(e,i){var a;if((a=!t.schemaManager.mapper.doesEntityRequireSelection(e)&&t.editor.selection.isCollapsed()?n.VALID:d(!1,!0))===n.NO_SELECTION)t.dialogManager.show("message",{title:"Error",msg:"Please select some text before adding an entity.",type:"error"});else if(t.editor.currentBookmark=t.editor.selection.getBookmark(1),a===n.VALID){var o;o=void 0!==i?i:t.schemaManager.mapper.getParentTag(e);for(var r=t.editor.currentBookmark.rng.commonAncestorContainer;r.nodeType!==Node.ELEMENT_NODE;)r=r.parentNode;var s=r.getAttribute("_tag");t.schemaManager.isTagValidChildOfParent(o,s)?t.dialogManager.show(e):t.dialogManager.show("message",{title:"Invalid XML",msg:"You cannot add a "+e+" entity in this location because its element <b>"+o+"</b> is not a valid child of <b>"+s+"</b>.",type:"error"})}else a===n.OVERLAP&&(!0===t.allowOverlap?t.dialogManager.show(e):t.dialogManager.confirm({title:"Warning",msg:"<p>You are attempting to create overlapping entities or to create an entity across sibling XML tags, which is not allowed in this editor mode.</p><p>If you wish to continue, the editor mode will be switched to <b>XML and RDF (Overlapping Entities)</b> and only RDF will be created for the entity you intend to add.</p><p>Do you wish to continue?</p>",showConfirmKey:"confirm-overlapping-entities",type:"info",height:350,callback:function(n){n&&(t.allowOverlap=!0,t.mode=t.XMLRDF,t.dialogManager.show(e))}}))},removeTag:function(e){n.getCurrentTag(e).attr("_entity")?n.removeEntity(e):n.removeStructureTag(e)},copyTag:function(e){var i=n.getCurrentTag(e);if(i.attr("_entity")){a=i.attr("_note")?i.parent(".noteWrapper").clone(!0):i.clone(),t.editor.copiedEntity=a[0]}else{var a=i.clone();t.editor.copiedElement.element=a[0],t.editor.copiedElement.selectionType=0}},pasteTag:function(){o(t.editor.copiedElement.element),t.editor.copiedElement={selectionType:null,element:null}},splitTag:function(){var e=t.editor.selection.getRng(!0);if(e.startContainer.nodeType===Node.TEXT_NODE){var n=e.startContainer,a=n.parentNode;if("true"!=a.getAttribute("_entity")){for(var o,r="<"+a.nodeName.toLowerCase(),s=0;s<a.attributes.length;s++){var l=a.attributes[s];"id"!==l.name&&(r+=" "+l.name+'="'+l.value+'"')}r+="></"+a.nodeName.toLowerCase()+">",a.normalize(),n.splitText(e.startOffset);for(s=0;s<a.childNodes.length;s++){var c=a.childNodes[s];c.nodeType===Node.TEXT_NODE&&(o=i(c).wrap(r))}i(a).contents().each((function(e,n){n.setAttribute("id",t.getUniqueId("dom_"))})).unwrap(),t.editor.selection.setCursorLocation(o[0]),t.editor.undoManager.add(),t.event("contentChanged").publish()}else console.warn("tagger.splitTag: cannot split an entity!")}else console.warn("tagger.splitTag: no text selection!")},mergeTags:function(e){for(var n="",a=[],o=0;o<e.length;o++){var r=i(e[o]);n+=r.html(),o>0&&a.push("#"+r.attr("id"))}i(e[0]).html(n),i(a.join(","),t.editor.getBody()).remove(),t.editor.undoManager.add(),t.event("contentChanged").publish()}},o=function(e){if(null!=e){t.editor.selection.moveToBookmark(t.editor.currentBookmark);var i=t.editor.selection;i.collapse(),i.getRng(!0).insertNode(e),n.processNewContent(e),t.editor.undoManager.add(),t.event("contentChanged").publish()}};n.processNewContent=function(e){var n=function e(n,i){if(n.nodeType===Node.ELEMENT_NODE&&n.hasAttribute("_tag")){var a=n.getAttribute("id");if(null!==a)if(1===n.ownerDocument.querySelectorAll("#"+a).length)return;var o=t.getUniqueId("dom_");if(n.setAttribute("id",o),n.hasAttribute("_entity")){n.setAttribute("name",o);var r=t.entitiesManager.getEntity(a);if(void 0!==r){var s=r.clone();s.setId(o),t.entitiesManager.setEntity(o,s)}else console.warn("processNewContent: copied entity tag had no Entity to clone for",a),t.entitiesManager.addEntity({id:o,tag:n.getAttribute("_tag"),type:n.getAttribute("_type")})}}if("up"===i)n.parentElement&&e(n.parentElement,i);else for(var l=0;l<n.childNodes.length;l++)e(n.childNodes[l],i)};n(e,"up"),n(e,"down")};var r=function(e,n){for(var a in e){var o=e[a];if(i.isArray(o))for(var r=0;r<o.length;r++)e[a][r]=t.utilities.convertTextForExport(o[r],n);else if(i.isPlainObject(o))for(var s in o)e[a][s]=t.utilities.convertTextForExport(o[s],n);else e[a]=t.utilities.convertTextForExport(o,n)}};n.finalizeEntity=function(e,a){var o=t.schemaManager.mapper.isNamedEntity(e),s=t.schemaManager.mapper.getParentTag(e);if(r(a.attributes,!0),r(a.customValues,!1),!o||o&&a.properties.uri){var l={id:t.getUniqueId("dom_"),type:e,isNote:t.schemaManager.mapper.isEntityTypeNote(e),isNamedEntity:o,tag:s,attributes:a.attributes,customValues:a.customValues};a.properties&&a.properties.noteContent&&(void 0!==a.properties.content&&""!==a.properties.content||(a.properties.content=a.properties.noteContent)),i.extend(l,a.properties),t.editor.selection.moveToBookmark(t.editor.currentBookmark);var c=t.editor.selection.getRng(!0);t.entitiesManager.addEntity(l,c)}else n.addStructureTag(s,a.attributes,t.editor.currentBookmark,n.ADD);t.editor.currentBookmark=null,t.editor.focus()},n.editEntity=function(e,a){r(a.attributes,!0),r(a.customValues,!1);var o=t.entitiesManager.getEntity(e),s=i("[name="+e+"]",t.editor.getBody()),l=a.properties.type||o.getType();l!==o.getType()&&console.log("tagger.editEntity: changing entity type");var c=t.schemaManager.mapper.isNamedEntity(l),d=t.schemaManager.mapper.getAttributeForProperty(l,"uri");c&&void 0===a.attributes[d]?(n.setAttributesForTag(s[0],a.attributes),n.removeEntity(e)):(t.entitiesManager.editEntity(o,a),n.setAttributesForTag(s[0],o.getAttributes()),s.attr("_tag",o.getTag()),s.attr("_type",o.getType()),s.attr("class","entity start end "+o.getType()),t.event("entityEdited").publish(e))},n.pasteEntity=function(){o(t.editor.copiedEntity),t.editor.copiedEntity=null},n.removeEntity=function(e){e=e||t.entitiesManager.getCurrentEntity();var a=t.entitiesManager.getEntity(e),o=i("#"+e,t.editor.getBody()),r=o.attr("_tag"),s=n.getAttributesForTag(o[0]),l=!1===t.editor.selection.getRng(!0).collapsed;a.isNote()&&n.removeNoteWrapper(o),o.wrapInner('<span id="tempSelection"/>');var d=i("#tempSelection",t.editor.getBody());d.unwrap(),t.entitiesManager.removeEntity(e),t.editor.selection.getRng(!0).selectNodeContents(d[0]),t.editor.currentBookmark=t.editor.selection.getBookmark(1);var u=n.addStructureTag(r,s,t.editor.currentBookmark,n.ADD),p=d.contents();return p.unwrap(),l&&c(p),u},n.addEntityTag=function(e,o){var r=e.getId(),l=e.getType(),c=e.getTag();void 0===c&&(c=t.schemaManager.mapper.getParentTag(l));var d={};for(var u in e.attributes)!0!==a.reservedAttributes[u]&&(d[u]=e.attributes[u]);var p=JSON.stringify(d);if(p=p.replace(/"/g,"&quot;"),e.isNote()){var g=t.utilities.convertTextForExport(e.getNoteContent()),f=t.editor.dom.create("span",i.extend(d,{_entity:!0,_note:!0,_tag:c,_type:l,class:"entity "+l+" start end",name:r,id:r,_attributes:p}),g),h=t.editor.selection;h.setRng(o),tinymce.isWebKit&&h.setRng(o),h.collapse(!1),(o=h.getRng(!0)).insertNode(f),n.addNoteWrapper(f,l)}else if(o.startContainer.parentNode!=o.endContainer.parentNode){var m=s(o.startContainer,o.endContainer,NodeFilter.SHOW_TEXT),v=o.cloneRange();v.setEnd(o.startContainer,o.startContainer.length);var y=t.editor.dom.create("span",{_entity:!0,_type:l,class:"entity "+l+" start",name:r,_attributes:p},"");v.surroundContents(y),i.each(m,(function(e,t){i(t).wrap('<span _entity="true" _type="'+l+'" class="entity '+l+'" name="'+r+'" />')}));var b=o.cloneRange();b.setStart(o.endContainer,0);var w=t.editor.dom.create("span",{_entity:!0,_type:l,class:"entity "+l+" end",name:r},"");b.surroundContents(w)}else{y=t.editor.dom.create("span",i.extend(d,{_entity:!0,_tag:c,_type:l,class:"entity "+l+" start end",name:r,id:r,_attributes:p}),"");o.surroundContents(y)}t.editor.undoManager.add()};var s=function(e,t,n){n=null==n?NodeFilter.SHOW_ALL:n;var i=[],a=e.ownerDocument.createTreeWalker(e.ownerDocument,n,null,!1);for(a.currentNode=e;a.nextNode()&&a.currentNode!==t;)i.push(a.currentNode);return i};n.addNoteWrapper=function(e,t){i(e).filter(":visible").wrap('<span class="noteWrapper '+t+'" />').parent().on("click",(function(e){var t=i(e.target);t.hasClass("noteWrapper")&&t.toggleClass("hide")}))},n.addNoteWrappersForEntities=function(){t.entitiesManager.eachEntity((function(e,a){if(a.isNote()){var o=i("#"+e,t.editor.getBody());n.addNoteWrapper(o,a.getType())}}))},n.removeNoteWrapper=function(e){i(e).unwrap(".noteWrapper")},n.removeNoteWrappersForEntities=function(){t.entitiesManager.eachEntity((function(e,a){a.isNote()&&n.removeNoteWrapper(i("#"+e,t.editor.getBody()))}))},n.addStructureTag=function(e,o,s,l){r(o,!0);var c,d=t.getUniqueId("dom_");if(s.tagId)c=i.isArray(s.tagId)?i("#"+s.tagId.join(",#"),t.editor.getBody()):i("#"+s.tagId,t.editor.getBody());else{for(var u=s.rng.commonAncestorContainer;u.nodeType==Node.TEXT_NODE||u.nodeType==Node.ELEMENT_NODE&&!u.hasAttribute("_tag");)u=u.parentNode;c=i(u)}var p=null,g=t.schemaManager.mapper.getEntityTypeForTag(c.attr("_tag"));null!==g&&t.schemaManager.mapper.isEntityTypeNote(g)&&(p=c.parent(".noteWrapper"));var f=t.schemaManager.getTagForEditor(e),h="<"+f+' id="'+d+'" _tag="'+e+'"',m={};for(var v in o)!0!==a.reservedAttributes[v]&&(h+=" "+v+'="'+o[v]+'"'),m[v]=o[v];var y=JSON.stringify(m),b="</"+f+">",w="\ufeff",_=(h+=' _attributes="'+(y=y.replace(/"/g,"&quot;"))+'">')+w+b;switch(l){case n.BEFORE:null!==p?p.before(_):c.before(_);break;case n.AFTER:null!==p?p.after(_):c.after(_);break;case n.AROUND:c.length>1?c.wrapAll(_):null!==p?p.wrap(_):c.wrap(_);break;case n.INSIDE:c.wrapInner(_);break;default:t.editor.selection.moveToBookmark(s),""==(w=t.editor.selection.getContent())&&(w="\ufeff"),_=h+w+b;var x=t.editor.selection.getRng(!0),C=i('<span data-mce-bogus="1">',t.editor.getDoc());x.surroundContents(C[0]),C.replaceWith(_)}var k=i("#"+d,t.editor.getBody());if(t.event("tagAdded").publish(k[0]),t.editor.undoManager.add(),"\ufeff"==w)t.utilities.selectElementById(d,!0);else if(null==l){var T=t.editor.selection.getRng(!0);T.selectNodeContents(i("#"+d,t.editor.getBody())[0]),T.collapse(!1),t.editor.selection.setRng(T)}return k[0]},n.editStructureTag=function(e,a,o){r(a,!0);var s,l=e.attr("id");void 0!==o&&o!==e.attr("_tag")&&(s=e.parent().is("span")?"span":t.schemaManager.getTagForEditor(o),e.contents().unwrap().wrapAll("<"+s+' id="'+l+'" _tag="'+o+'"/>'),e=i("#"+l,t.editor.getBody()));n.setAttributesForTag(e[0],a),t.event("tagEdited").publish(e[0])},n.removeStructureTag=function(e,i){null==i&&(i=!!(t.tree&&t.tree.currentlySelectedNodes.length>0&&null!=t.tree.selectionType));var a=function(){if(i)r&&r.isNote()?(n.processRemovedContent(o.parent(".noteWrapper")[0]),o.parent(".noteWrapper").remove()):(n.processRemovedContent(o[0]),o.remove());else{n.processRemovedContent(o[0],!1);var a=!1===t.editor.selection.getRng(!0).collapsed,s=o.parent(),l=o.contents();l.length>0?l.unwrap():o.remove(),r&&r.isNote()&&(n.processRemovedContent(s[0],!1),(l=s.contents()).length>0?l.unwrap():s.remove()),a&&c(l),s[0].normalize()}t.editor.undoManager.add(),t.event("tagRemoved").publish(e)},o=n.getCurrentTag(e),r=t.entitiesManager.getEntity(e);e=o.attr("id"),t.schemaManager.wouldDeleteInvalidate(o[0],!0,i)?l(o[0],!1,(function(e){e&&a()})):a()},n.removeStructureTagContents=function(e){var i=n.getCurrentTag(e),a=function(){i.contents().each((function(e,t){n.processRemovedContent(t)})).remove(),i[0].textContent="\ufeff",t.editor.undoManager.add(),t.event("tagContentsRemoved").publish(e)};t.schemaManager.wouldDeleteInvalidate(i[0],!1,!0)?l(i[0],!0,(function(e){e&&a()})):a()},n.processRemovedContent=function(e,n){n=null==n||n;var a=function e(a){if(a.nodeType===Node.ELEMENT_NODE&&a.hasAttribute("_tag")&&a.hasAttribute("_entity")){var o=a.getAttribute("name");console.log("entity will be removed",o),t.entitiesManager.removeEntity(o)}else{var r=i(a).parents("[_type=citation],[_type=note]");r.length>0&&setTimeout((function(){r.each((function(e,n){var a=i(n),o=a.attr("id"),r=t.entitiesManager.getEntity(o);r&&(r.setNoteContent(a.html()),r.setContent(a.text()),t.event("entityEdited").publish(o))}))}),0)}if(n)for(var s=0;s<a.childNodes.length;s++)e(a.childNodes[s])};void 0!==e.commonAncestorContainer?(n=!1,s(e.startContainer,e.endContainer).forEach((function(e){a(e)}))):a(e)};var l=function(e,n,i){var a="<p>Deleting the ".concat(n?"contents of the":"",' "').concat(e.getAttribute("_tag"),'" element will make the document invalid. Do you wish to continue?</p>');t.dialogManager.confirm({title:"Warning",msg:a,showConfirmKey:"confirm-delete-tag-invalidating",type:"info",callback:i})},c=function(e){var n=t.editor.selection.getRng(!0);(e=e.toArray().filter((function(e){return null!==e.parentNode}))).length>0&&1===e.length&&n.selectNodeContents(e[0])},d=function(e,a){var o=t.editor.selection;if(!e&&o.isCollapsed())return n.NO_SELECTION;var r=o.getRng(!0);if("body"===r.commonAncestorContainer.nodeName.toLowerCase()){var s=t.editor.dom.select("body > *")[0];r.setStartBefore(s.firstChild),r.setEndAfter(s.lastChild)}function l(e,t){return function e(t,n,i){return i>20||null==(a="back"==n?t.lastChild||t.previousSibling||t.parentNode.previousSibling:t.firstChild||t.nextSibling||t.parentNode.nextSibling)?null:a.nodeType==Node.TEXT_NODE?a:e(a,n,i++);var a}(e,t,0)}if(r.startContainer.nodeType===Node.ELEMENT_NODE){var c=r.endContainer;if(c.nodeType!=Node.TEXT_NODE||0===r.endOffset){if(null==(c=l(r.endContainer,"back")))return n.NO_COMMON_PARENT;r.setEnd(c,c.length)}var d=l(r.startContainer,"forward");if(null==d)return n.NO_COMMON_PARENT;r.setStart(d,0)}if(r.endContainer.nodeType===Node.ELEMENT_NODE&&r.setEnd(r.startContainer,r.startContainer.length),a&&function(e){var t=e.toString(),n=t.match(/^\s+/),i=0,a=0;null!=n&&(i=n[0].length),null!=(n=t.match(/\s+$/))&&(a=n[0].length),function e(t,n,i){if(n>0&&i<20){if(t.startOffset<t.startContainer.length&&(t.setStart(t.startContainer,t.startOffset+1),n--),t.startOffset==t.startContainer.length){var a=l(t.startContainer,"forward");null!=a&&t.setStart(a,0)}e(t,n,i++)}}(e,i,0),function e(t,n,i){if(n>0&&i<20){if(t.endOffset>0&&(t.setEnd(t.endContainer,t.endOffset-1),n--),0==t.endOffset){var a=l(t.endContainer,"back");null!=a&&t.setEnd(a,a.length)}e(t,n,i++)}}(e,a,0),o.setRng(e)}(r),r.startContainer.parentNode!=r.endContainer.parentNode){if(0!==r.endOffset||r.endContainer.previousSibling!==r.startContainer.parentNode)return e?n.NO_COMMON_PARENT:n.OVERLAP;r.setEnd(r.startContainer,r.startContainer.length)}if(e||!1===t.allowOverlap){for(var u,p=r.startContainer,g={};p!=r.endContainer;)p=p.nextSibling,null!=(u=i(p)).attr("_entity")&&null!=u.attr("_tag")&&(g[u.attr("name")]?delete g[u.attr("name")]:g[u.attr("name")]=!0);var f=0;for(var h in g)f++;if(0!=f)return n.OVERLAP}return n.VALID};return n}},function(e,t,n){"use strict";var i=n(1),a=n(332),o=n(333);e.exports=function(e){var t=e,n=new o(t),r=new a(t),s={processDocument:n.processDocument,buildEditorString:n.buildEditorString,getDocumentContent:r.getDocumentContent,buildXMLString:r.buildXMLString,loadDocumentURL:function(e){t.currentDocId=e,t.event("loadingDocument").publish(),i.ajax({url:e,type:"GET",success:function(e,t,n){s.processDocument(e)},error:function(n,i,a){t.currentDocId=null,t.dialogManager.show("message",{title:"Error",msg:"An error occurred and "+e+" was not loaded.",type:"error"}),t.event("documentLoaded").publish(!1,null)},dataType:"xml"})},loadDocumentXML:function(e){if(t.event("loadingDocument").publish(),"string"==typeof e&&null===(e=t.utilities.stringToXML(e)))return t.event("documentLoaded").publish(!1,null),t.dialogManager.show("message",{title:"Error",msg:'The document you are trying to upload is not well-formed. Check that it has the xml extension and that it follows <a href="https://www.w3resource.com/xml/well-formed.php" target="_blank" rel="noopener noreferrer">propper xml grammar</a>.',type:"error"}),!1;s.processDocument(e)},getDocument:function(e,n){var i=this;s.getDocumentContent(!0,(function(a){if(!0===e)n.call(i,a);else{var o=null;try{o=(new DOMParser).parseFromString(a,"application/xml")}catch(e){t.dialogManager.show("message",{title:"Error",msg:"There was an error getting the document:"+e,type:"error"})}n.call(i,o)}}))},setDocument:function(e){"string"==typeof e&&0===e.indexOf("http")?s.loadDocumentURL(e):s.loadDocumentXML(e)}};return s}},function(e,t,n){"use strict";var i=n(5);function a(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}var o=n(1);n(17);e.exports=function(e){var t=e,n={};function r(e){!function e(n){o(n).contents().each((function(n,i){i.nodeType==Node.TEXT_NODE?i.nodeValue=t.utilities.convertTextForExport(i.nodeValue):i.nodeType==Node.ELEMENT_NODE&&e(i)}))}(e);var n=o('[_entity][class~="start"]',e).not("[_tag]").not("[_note]"),i=o.map(n,(function(e,t){return o(e).attr("name")}));o(i).each((function(n,i){t.entitiesManager.getEntity(i).setRange(function(e){var n={};function i(n,i){var a=n.parents("[_tag]").first();return{xpath:t.utilities.getElementXPath(a[0]),offset:function(e,t,n){var i=0;return function t(a){var r=!0;return a.contents().each((function(a,s){var l,c,d,u=o(this);if(u.attr("name")===e){if(l=u.hasClass("start"),c=u.hasClass("end"),d=l&&!n||c&&n,n&&(i+=u.text().length),d)return r=!1}else{if(this.nodeType!==Node.TEXT_NODE||" "===this.data)return r=t(u);i+=this.length}})),r}(t),i}(e,a,i)}}var a=o('[name="'+e+'"]',t.editor.getBody()),r=a.first(),s=a.last(),l=i(r,!1);n.startXPath=l.xpath,n.startOffset=l.offset;var c=i(s,!0);return n.endXPath=c.xpath,n.endOffset=c.offset,n}(i)),o('[name="'+i+'"]',e).each((function(e,t){o(t).contents().unwrap()}))}))}function s(e){t.entitiesManager.eachEntity((function(n,i){var a=o('[cwrcTempId="'+n+'"]',e);1===a.length&&i.setRange({startXPath:t.utilities.getElementXPath(a[0])})}))}return n.getDocumentContent=function(){var e,l=(e=i.mark((function e(a,l){var c,d,u,p,g,f,h,m,v,y,b,w,_,x,C,k,T,E,S,D,M,R,A,P,N;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(g in a&&t.mode===t.XML&&(a=!1),t.entitiesManager.highlightEntity(),r(c=o(t.editor.getBody()).clone(!1)),d=t.schemaManager.getRoot(),0==(u=c.children("[_tag="+d+"]")).length&&(console.warn("converter: no root found for",d),u=c.find("[_tag]:eq(0)")),p=t.tagger.getAttributesForTag(u[0]))0===g.indexOf("xmlns")&&delete p[g];if(void 0!==(f=t.schemaManager.mapper.getNamespace())&&(p.xmlns=f),a&&(p["xmlns:rdf"]="http://www.w3.org/1999/02/22-rdf-syntax-ns#"),t.tagger.setAttributesForTag(u[0],p),h='<?xml version="1.0" encoding="UTF-8"?>\n',h+='<?xml-model href="'+t.schemaManager.getCurrentDocumentSchemaUrl()+'" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>\n',h+='<?xml-stylesheet type="text/css" href="'+t.schemaManager.getCurrentDocumentCSSUrl()+'"?>\n',console.time("buildXMLString"),h+=n.buildXMLString(u,a),console.timeEnd("buildXMLString"),!a){e.next=86;break}if(console.time("stringToXML"),m=t.utilities.stringToXML(h),console.timeEnd("stringToXML"),null!==m){e.next=27;break}e.next=84;break;case 27:return console.time("setEntityRanges"),s(m),console.timeEnd("setEntityRanges"),console.time("cleanUp"),o("[cwrcTempId]",m).each((function(e,t){o(t).removeAttr("cwrcTempId")})),console.timeEnd("cleanUp"),v=t.annotationMode===t.XML?"xml":"json",y=[],t.entitiesManager.eachEntity((function(e,t){y.push(t)})),e.next=38,t.annotationsManager.getAnnotations(y,v);case 38:b=e.sent,w=o(m.documentElement),_=t.schemaManager.mapper.getRdfParentSelector(),x=_.split("/"),C=w,k=0;case 44:if(!(k<x.length)){e.next=78;break}if(""===(T=x[k])){e.next=75;break}if(-1!==T.indexOf("::")){e.next=56;break}if(C[0].nodeName!==T){e.next=52;break}return e.abrupt("continue",75);case 52:1===(E=C.children(T).first()).length?C=E:(S=C[0].namespaceURI,D=m.createElementNS(S,T),M=C[0].firstElementChild,C=o(null!==M?C[0].insertBefore(D,M):C[0].appendChild(D)));case 54:e.next=75;break;case 56:R=T.split("::"),A=R[0],T=R[1],e.t0=A,e.next="preceding-sibling"===e.t0?62:"following-sibling"===e.t0?67:73;break;case 62:return P=C[0].parentNode,S=P.namespaceURI,D=m.createElementNS(S,T),C=o(P.insertBefore(D,C[0])),e.abrupt("break",75);case 67:return P=C[0].parentNode,S=P.namespaceURI,D=m.createElementNS(S,T),N=C[0].nextElementSibling,C=o(null!==N?P.insertBefore(D,N):P.appendChild(D)),e.abrupt("break",75);case 73:return console.warn("cwrc2xml: axis",A,"not supported"),e.abrupt("break",75);case 75:k++,e.next=44;break;case 78:C!==w?C.append(b):console.warn("cwrc2xml: couldn't find rdfParent for",_),console.time("xmlToString"),h=t.utilities.xmlToString(m),console.timeEnd("xmlToString"),h=h.replace(/\uFEFF/g,""),l.call(this,h);case 84:e.next=88;break;case 86:h=h.replace(/\uFEFF/g,""),l.call(this,h);case 88:case"end":return e.stop()}}),e,this)})),function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){a(r,i,o,s,l,"next",e)}function l(e){a(r,i,o,s,l,"throw",e)}s(void 0)}))});return function(e,t){return l.apply(this,arguments)}}(),n.buildXMLString=function(e,n){n=void 0!==n&&n;var i="";return function e(a){var r=function(e){var i=[],a=e.attr("_tag");if(void 0===a)i=["",""];else{var o=e.attr("id");if("true"===e.attr("_entity")){var r=t.entitiesManager.getEntity(o);r?(i=t.schemaManager.mapper.getMapping(r),n&&(""!==i[0]?i[0]=i[0].replace(/([\s>])/,' cwrcTempId="'+o+'"$&'):i[1]=i[1].replace(/([\s>])/,' cwrcTempId="'+o+'"$&'))):(console.warn("cwrc2xml.buildXMLString: no entity entry for",o),i=["",""])}else{var s="<"+a,l=t.tagger.getAttributesForTag(e[0]);for(var c in l){s+=" "+c+'="'+l[c]+'"'}0===e[0].childNodes.length||1===e[0].childNodes.length&&"\ufeff"===e[0].textContent?(s+="/>",i.push(s)):(s+=">",i.push(s),i.push("</"+a+">"))}}return i}(a);i+=r[0],r.length>1&&(a.contents().each((function(t,n){n.nodeType==Node.ELEMENT_NODE?e(o(n)):n.nodeType==Node.TEXT_NODE?i+=n.data:n.nodeType==Node.COMMENT_NODE&&(i+="\x3c!--"+n.data+"--\x3e")})),i+=r[1])}(o(e)),i},n.getEntityOffsets=function(){for(var e=function(e){var n=0,i=[];function a(e){e.contents().each((function(e,r){var s=o(this);if(this.nodeType==Node.TEXT_NODE&&" "!=this.data)n+=this.length;else if(s.attr("_tag")){var l=s.attr("id");i.push({id:l,offset:n,length:s.text().length,entity:void 0!==s.attr("_entity")}),a(s)}else if(s.attr("_entity")&&s.hasClass("start")){l=s.attr("name");i.push({id:l,offset:n,length:t.entitiesManager.getEntity(l).getContent().length,entity:!0})}}))}return a(e),i}(o(t.editor.getBody())),n=[],i=0;i<e.length;i++){var a=e[i];a.entity&&n.push(a)}return n},n}},function(e,t,n){"use strict";var i=n(5);function a(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){a(r,i,o,s,l,"next",e)}function l(e){a(r,i,o,s,l,"throw",e)}s(void 0)}))}}var r=n(1),s=n(9);e.exports=function(e){var t=e,n={};function a(e){for(var t,n,i=/href=('|")([^('|")]*)('|")/,a=0;a<e.childNodes.length;a++){var o=e.childNodes[a];if("xml-model"===o.nodeName)t=(t=o.data.match(i))[2];else if("xml-stylesheet"===o.nodeName){n=(n=o.data.match(i))[2]}}return{xmlUrl:t,cssUrl:n}}function l(e){t.event("processingDocument").publish(),r(e).find("rdf\\:RDF, RDF").remove();var i=e.documentElement,a=n.buildEditorString(i,!t.isReadOnly);t.editor.setContent(a,{format:"raw"}),t.event("documentLoaded").publish(!1,t.editor.getBody())}function c(e){t.event("processingDocument").publish(),n.isLegacyDocument=function(e){var n=r(e).find("rdf\\:RDF, RDF").length>0,i=r(e).find("*[annotationId], *[offsetId]").length>0,a=null===t.utilities.evaluateXPath(e,t.schemaManager.mapper.getRdfParentSelector());return n&&(i||a)}(e);!function(e){var i=r(e).find("rdf\\:RDF, RDF");if(i.length){i.children().each((function(i,a){var o=t.annotationsManager.getEntityConfigFromAnnotation(a);if(null!=o){var s=void 0!==o.range.endXPath;if(!s){if(null===(c=t.utilities.evaluateXPath(e,o.range.startXPath)))return void console.warn("xml2cwrc.processRDF: no matching entity element for",o);var l=t.schemaManager.mapper.getReverseMapping(c,!0);l.type!==o.type&&console.warn("xml2cwrc.processRDF: entity type mismatch. RDF =",o.type+". Element =",l.type+"."),r.extend(o,l)}if(n.isLegacyDocument){o.attributes&&(delete o.attributes.annotationId,delete o.attributes.offsetId);var c=t.utilities.evaluateXPath(e,o.range.startXPath);if(o.range.startXPath=t.utilities.getElementXPath(c),s){var d=t.utilities.evaluateXPath(e,o.range.endXPath);o.range.endXPath=t.utilities.getElementXPath(d)}}t.entitiesManager.addEntity(o)}})),i.remove();var a=r(t.utilities.evaluateXPath(e,t.schemaManager.mapper.getRdfParentSelector()));if(1===a.length)for(var o=a[0].nodeName;o!==t.schemaManager.getHeader()&&o!==t.schemaManager.getRoot();){if(0===(a=a.parent()).length){console.warn("xml2cwrc: went beyond doc root");break}a.children(o).remove(),o=a[0].nodeName}else console.warn("xml2cwrc: couldn't find the rdfParent");return!0}}(e);(function(e){var n=new r.Deferred;return function(e){var n=new r.Deferred,i=t.dialogManager.getDialog("loadingindicator");i.show(),i.setText("Building Document");var a="",o=[],s=function(e){var t=[];function n(e,i){t.push({node:e,depth:i});for(var a=0;a<e.childNodes.length;a++)n(e.childNodes[a],i+1)}return n(e,0),t}(e),l=function(e,t){var n=e.node,i=e.depth,r=d(n),s=r[0],l={string:r[1],depth:i};if(i<=t)for(var c=o.pop();null!=c&&c.depth<=t&&c.depth>=i;)if(a+=c.string,o.length>0){var u=o[o.length-1].depth;c=u<=t&&u>=i?o.pop():null}else c=null;return a+=s,o.push(l),i},c=s.length,u=(new Date).getTime(),p=0;return function e(){for(;s.length>0;){var t=s.shift();if(p=l(t,p),(new Date).getTime()-u>250)break}var r=Math.abs(s.length-c)/c*100;if(i.setValue(r),s.length>0)u=(new Date).getTime(),setTimeout(e,10);else{for(;o.length>0;){var d=o.pop();a+=d.string}n.resolve(a)}}(),n.promise()}(e.documentElement).then((function(e){return t.editor.setContent(e,{format:"raw"}),function(){var e=t.entitiesManager.getEntities(),n=Object.keys(e).map((function(t){return e[t]}));if(n.length>0){t.dialogManager.getDialog("loadingindicator").setText("Inserting Entities"),t.editor.focus();var i=r('[_tag="'+t.schemaManager.getRoot()+'"]',t.editor.getBody())[0];return t.utilities.processArray(n,(function(e){var n=null,a=null,o=0,s=0,l=e.getRange();if(l.endXPath){var c=t.utilities.evaluateXPath(i,l.startXPath),d=u(c,l.startOffset);n=d.textNode,o=d.offset,a=(d=u(c=t.utilities.evaluateXPath(i,l.endXPath),l.endOffset)).textNode,s=d.offset;try{var p=t.editor.selection.getRng(!0);p.setStart(n,o),p.setEnd(a,s),t.tagger.addEntityTag(e,p),void 0===e.getContent()&&(t.entitiesManager.highlightEntity(),t.entitiesManager.highlightEntity(e.getId()),content=r(".entityHighlight",i).text(),t.entitiesManager.highlightEntity())}catch(e){console.warn("xml2cwrc: error adding overlapping entity",e)}}else if(l.startXPath){var g=t.utilities.evaluateXPath(i,l.startXPath);if(null!==g){var f=e.getType();r(g).attr({_entity:!0,_type:f,class:"entity start end "+f,name:e.getId(),id:e.getId()}),void 0!==e.getContent()&&""!==e.getContent()||e.setContent(r(g).text()),!e.isNote()||void 0!==e.getNoteContent()&&""!==e.getNoteContent()||e.setNoteContent(r(g).html())}else console.warn("xml2cwrc.insertEntities: cannot find entity tag for",l.startXPath)}}))}var a=new r.Deferred;return a.resolve(),a.promise()}()})).then((function(){t.tagger.addNoteWrappersForEntities(),t.entitiesManager.doEntitiesOverlap()?t.allowOverlap=!0:t.allowOverlap=!1,n.resolve()})),n.promise()})(e).then((function(){t.event("documentLoaded").publish(!0,t.editor.getBody()),function(e){if(!0!==t.isReadOnly){var n,i=e.documentElement;i.nodeName.toLowerCase()!==t.schemaManager.getRoot().toLowerCase()&&t.dialogManager.show("message",{title:"Schema Mismatch",msg:"The wrong schema is specified.<br/>Schema root: "+t.schemaManager.getRoot()+"<br/>Document root: "+i.nodeName+"<br/><br/>Go to <b>Settings</b> to change the schema association.",type:"error"}),n=t.mode===t.XML?"<b>XML only</b><br/>Only XML tags and no RDF/Semantic Web annotations will be created.":t.allowOverlap?"<b>XML and RDF (overlap)</b><br/>XML tags and RDF/Semantic Web annotations equivalent to the XML tags will be created, to the extent that the hierarchy of the XML schema allows. Annotations that overlap will be created in RDF only, with no equivalent XML tags.":"<b>XML and RDF (no overlap)</b><br/>XML tags and RDF/Semantic Web annotations equivalent to the XML tags will be created, consistent with the hierarchy of the XML schema, so annotations will not be allowed to overlap.",t.dialogManager.show("message",{title:"CWRC-Writer Mode",msg:n,type:"info"})}}(e)}))}function d(e){var i="",a="";if(e.nodeType===Node.ELEMENT_NODE){var o,r=e.nodeName;if(o=null===e.parentElement?t.schemaManager.getBlockTag():t.schemaManager.getTagForEditor(r),e.hasAttribute("id")&&(console.warn("xml2cwrc.buildEditorString: node already had an ID!",e.getAttribute("id")),e.removeAttribute("id")),i="<"+o+' _tag="'+r+'" id="'+t.getUniqueId("dom_")+'" _textallowed="'+t.schemaManager.canTagContainText(r)+'"',e.hasAttributes()){for(var l={},c=e.attributes,d=0;d<c.length;d++){var u=c[d].name,p=c[d].value;n.isLegacyDocument&&"annotationId"===u||"offsetId"===u||(l[u]=p,!0!==s.reservedAttributes[u]&&(i+=" "+u+'="'+p+'"'))}var g=JSON.stringify(l);i+=' _attributes="'+(g=g.replace(/"/g,"&quot;"))+'"'}0===e.childNodes.length?(i+=">",a="\ufeff</"+o+">"):(i+=">",a="</"+o+">")}else if(e.nodeType===Node.TEXT_NODE){i=e.data.replace(/</g,"&lt;").replace(/>/g,"&gt;")}else e.nodeType===Node.COMMENT_NODE?(i+="\x3c!--"+e.data,a="--\x3e"):console.warn("xml2cwrc.buildEditorString: unsupported node type:",e.nodeType);return[i,a]}function u(e,t){var n=0,i=null;return function e(a){var o=!0;return r(a).contents().each((function(a,r){return r.nodeType!==Node.TEXT_NODE||" "===r.data?o=e(r):(n+=r.length)>=t?(n=t-(n-r.length),i=r,o=!1):void 0})),o}(e),{textNode:i,offset:n}}return n.isLegacyDocument=void 0,n.processDocument=function(e,n){r(t.editor.getBody()).empty(),setTimeout(o(i.mark((function r(){var s,d,u,p,g,f;return i.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=a(e),p=u.xmlUrl,g=u.cssUrl,t.schemaManager.setCurrentDocumentSchemaUrl(p),t.schemaManager.setCurrentDocumentCSSUrl(g),void 0!==n?(s=n,d=!0):(s=t.schemaManager.getSchemaIdFromUrl(p),d=void 0===g),void 0!==p||void 0!==s){r.next=8;break}t.dialogManager.confirm({title:"Missing Schema",msg:"<p>There is no schema associated with your document. Should CWRC-Writer try to determine the schema by examining the document root?</p>",type:"error",callback:function(n){if(n){var a=e.firstElementChild.nodeName;void 0===(s=t.schemaManager.getSchemaIdFromRoot(a))?t.dialogManager.show("message",{title:"Warning",msg:"<p>CWRC-Writer could not determine the schema for: "+a+"</p>",type:"error",callback:function(){t.event("documentLoaded").publish(!1,null),t.showLoadDialog()}}):t.dialogManager.show("message",{title:"Schema",msg:"<p>CWRC-Writer determined the schema to be: "+s+"</p>",type:"info",callback:(r=o(i.mark((function n(){return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s===t.schemaManager.schemaId){n.next=7;break}return n.next=3,t.schemaManager.loadSchema(s,!0);case 3:n.sent.success?c(e):l(e),n.next=8;break;case 7:c(e);case 8:case"end":return n.stop()}}),n)}))),function(){return r.apply(this,arguments)})})}else t.event("documentLoaded").publish(!1,null),t.showLoadDialog();var r}}),r.next=29;break;case 8:if(void 0!==s){r.next=12;break}t.dialogManager.confirm({title:"Warning",msg:"<p>The document you are loading is not fully supported by CWRC-Writer. You may not be able to use the ribbon to tag named entities.</p><p>Load document anyways?</p>",type:"error",callback:function(){var n=o(i.mark((function n(a){var r,u;return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!a){n.next=15;break}if(void 0===g){n.next=4;break}return n.next=4,t.schemaManager.loadSchemaCSS([g]);case 4:if(void 0===p){n.next=12;break}return r=t.schemaManager.addSchema({name:"Custom Schema",xmlUrl:[p],cssUrl:[g]}),n.next=8,t.schemaManager.loadSchema(r,d);case 8:n.sent.success?c(e):((u=t.dialogManager.getDialog("message").getOpenDialogs().pop())&&u.dialog("close"),t.dialogManager.confirm({title:"Error Loading Schema",msg:"<p>The schema associated with your document could not be loaded. Should CWRC-Writer try to determine the schema by examining the document root?</p>",type:"error",callback:function(n){if(n){var a=e.firstElementChild.nodeName;void 0===(s=t.schemaManager.getSchemaIdFromRoot(a))?t.dialogManager.show("message",{title:"Warning",msg:"<p>CWRC-Writer could not determine the schema for: "+a+"</p>",type:"error",callback:function(){t.event("documentLoaded").publish(!1,null),t.showLoadDialog()}}):t.dialogManager.show("message",{title:"Schema",msg:"<p>CWRC-Writer determined the schema to be: "+s+"</p>",type:"info",callback:(r=o(i.mark((function n(){return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s===t.schemaManager.schemaId){n.next=7;break}return n.next=3,t.schemaManager.loadSchema(s,!0);case 3:n.sent.success?c(e):l(e),n.next=8;break;case 7:c(e);case 8:case"end":return n.stop()}}),n)}))),function(){return r.apply(this,arguments)})})}else t.event("documentLoaded").publish(!1,null),t.showLoadDialog();var r}})),n.next=13;break;case 12:l(e);case 13:n.next=17;break;case 15:t.event("documentLoaded").publish(!1,null),t.showLoadDialog();case 17:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}),r.next=29;break;case 12:if(s===t.schemaManager.schemaId){r.next=22;break}if(void 0===g){r.next=16;break}return r.next=16,t.schemaManager.loadSchemaCSS([g]);case 16:return r.next=18,t.schemaManager.loadSchema(s,d);case 18:r.sent.success?c(e):l(e),r.next=29;break;case 22:if(void 0===g||g===t.schemaManager.getCSSUrl()){r.next=28;break}if(f=t.schemaManager.getCurrentSchema(),null!==f.cssUrl.find((function(e){return e===g}))){r.next=28;break}return r.next=28,t.schemaManager.loadSchemaCSS([g]);case 28:c(e);case 29:case"end":return r.stop()}}),r)}))),0)},n.buildEditorString=function(e,t){var n="";return function e(t){var i=d(t);n+=i[0];for(var a=0;a<t.childNodes.length;a++)e(t.childNodes[a]);n+=i[1]}(e),n},n}},function(e,t,n){"use strict";var i=n(1);n(335),n(336);var a=n(337).default,o=n(338),r=n(340),s=n(341),l=n(342),c=n(343),d=n(345),u=n(347),p=n(348),g=["nerve"];function f(e,t){this.w=e}function h(e,t){return!e.isReadOnly||e.isReadOnly&&-1===g.indexOf(t.id)}function m(e,t,n){var i="";if(void 0!==n)if(Array.isArray(n))i+='\n        <div class="cwrc tabs ui-layout-'.concat(t,'">\n            <ul>'),n.forEach((function(t){var n=t.title;void 0===n&&(n=t.id.charAt(0).toUpperCase()+t.id.substring(1)),i+='\n                <li><a href="#'.concat(e,"-").concat(t.id,'">').concat(n,"</a></li>")})),i+='\n            </ul>\n            <div class="ui-layout-content">',n.forEach((function(t){i+='\n                <div id="'.concat(e,"-").concat(t.id,'"></div>')})),i+="\n            </div>\n        </div>";else{var a=Array.isArray(n)?n[0]:n;i+='\n        <div id="'.concat(e,"-").concat(a.id,'" class="cwrc ui-layout-').concat(t,'"></div>')}return i}function v(e,t,n){if(!1===h(t,n))return null;var i=n.config||{};switch(i.writer=t,i.parentId=e+"-"+n.id,n.id){case"structure":return new o(i);case"entities":return new r(i);case"relations":return new l(i);case"validation":return new s(i);case"selection":return new c(i);case"imageViewer":return new d(i);case"nerve":return new u(i)}return null}f.prototype={constructor:f,init:function(e){var t=this;this.modulesLayout=e.modules||{west:[{id:"structure"},{id:"entities"}],east:[{id:"selection"}]},this.modules=[],this.$container=i('<div id="'+this.w.getUniqueId("cwrc_")+'" class="cwrc cwrcWrapper"></div>').appendTo(e.container);var n=p.version,o=e.editorId,r='<div class="cwrc cwrcLoadingMask" style="width: 100%; height: 100%; background-color: #DDD; position: absolute; z-index: 1000;"><div>Loading '.concat("CWRC-Writer","</div></div>");for(var s in this.$container.html(r),this.modulesLayout){var l=this.modulesLayout[s];Array.isArray(l)?this.modulesLayout[s]=l.filter((function(e){return h(t.w,e)})):this.modulesLayout[s]=h(this.w,l)?l:""}var c='\n        <div class="cwrc cwrcHeader ui-layout-north">\n            <div class="headerParent ui-widget">\n                <a class="titleLink" href="https://cwrc.ca" target="_blank">'.concat("CWRC-Writer",'</a>\n                <div class="headerButtons"></div>\n            </div>\n        </div>');(c+=m(o,"west",this.modulesLayout.west),c+='\n            <div class="cwrc ui-layout-center">\n                <div class="ui-layout-center ui-widget ui-widget-content">\n                    <textarea id="'.concat(o,'" name="editor" class="tinymce"></textarea>\n                </div>'),c+=m(o,"south",this.modulesLayout.south),c+="\n            </div>",c+=m(o,"east",this.modulesLayout.east),c+='\n        <div class="cwrc cwrcFooter ui-layout-south">\n            <a title="GitHub Release Notes" target="_blank" href="https://github.com/cwrc/CWRC-WriterBase/releases/tag/v'.concat(n,'">CWRC-Writer version ').concat(n,"</a>\n        </div>\n        "),this.$container.append(c),this.$loadingMask=this.$container.find(".cwrcLoadingMask").first(),this.$headerButtons=this.$container.find(".headerButtons").first(),this.w.isReadOnly||this.w.isAnnotator)&&i('<div class="fullscreenLink out">Fullscreen</div>').appendTo(this.$headerButtons).on("click",function(){this.toggleFullScreen()}.bind(this));a.addEventListener("fullscreenchange",function(){var e=this.w.editor.theme.panel.find("button#fullscreen");if(1==e.length){var t=e[0].$el.find("i");null!==a.fullscreenElement?t.removeClass("fullscreen-activate").addClass("fullscreen-deactivate"):t.removeClass("fullscreen-deactivate").addClass("fullscreen-activate")}if(this.w.isReadOnly||this.w.isAnnotator){var n=this.getHeaderButtonsParent().find(".fullscreenLink");1==n.length&&(null!==a.fullscreenElement?(n.removeClass("out").addClass("in"),n.text("Exit Fullscreen")):(n.removeClass("in").addClass("out"),n.text("Fullscreen")))}}.bind(this)),this.resizeEditor=function(){if(this.w.editor){for(var e=i(this.w.editor.getContainer().parentElement),t=e.height(),n=e[0].querySelectorAll(".mce-toolbar, .mce-statusbar, .mce-menubar"),a=n.length,o=0,r=0;r<a;r++){var s=n[r];if(!s.classList.contains("mce-sidebar-toolbar"))o+=i(s).height()}var l=t-o-8;this.w.editor.theme.resizeTo("100%",l)}};var d={defaults:{enableCursorHotkey:!1,maskIframesOnResize:!0,closable:!0,resizable:!0,slidable:!1,fxName:"none"},north:{size:35,spacing_open:0,minSize:35,maxSize:60,closable:!1,resizable:!1},south:{size:15,minSize:15,maxSize:15,spacing_open:0,closable:!1,resizable:!1}};void 0!==this.modulesLayout.west&&(d.west={size:"auto",minSize:320}),null!=this.modulesLayout.east&&(d.east={size:"auto",minSize:320,initClosed:!0}),this.$outerLayout=this.$container.layout(d);var u={defaults:{enableCursorHotkey:!1,maskIframesOnResize:!0,closable:!0,resizable:!0,slidable:!1,fxName:"none"},center:{onresize_end:function(e,t,n,i){this.resizeEditor()}.bind(this)}};for(var s in void 0!==this.modulesLayout.south&&(u.south={size:250,resizable:!0,initClosed:!0,activate:function(e,t){i.layout.callbacks.resizeTabLayout(e,t)}}),this.$innerLayout=this.$container.find(".ui-layout-center").first().layout(u),this.modulesLayout){var g=this.modulesLayout[s];if(Array.isArray(g)){g.forEach(function(e){null!==(e=v(o,this.w,e))&&this.modules.push(e)}.bind(this));var f=this.$container.find(".ui-layout-"+s+":not(.cwrcHeader):not(.cwrcFooter)");f.tabs({activate:function(e,t){i.layout.callbacks.resizeTabLayout(e,t)},create:function(e,t){f.parent().find(".ui-corner-all:not(button)").removeClass("ui-corner-all")}})}else{var y=v(o,this.w,g);null!==y&&this.modules.push(y)}}var b=function(e){var t=this.w.editor.theme.panel.rootControl.controlIdLookup,n=this.w.schemaManager.mapper.getMappings();for(var i in t){var a=t[i];!0===a.settings.entityButton&&(e||void 0===n.entities[a.settings.entityType]?a.disabled(!0):a.disabled(!1))}}.bind(this);this.w.event("documentLoaded").subscribe(function(e){!e||this.w.schemaManager.isSchemaCustom()?b(!0):b()}.bind(this))},showModule:function(e){for(var t in this.modulesLayout){var n=this.modulesLayout[t];if(Array.isArray(n)){for(var i=0;i<n.length;i++)if(n[i].id===e)return void this.showRegion(t,i)}else if(n.id===e)return void this.showRegion(t)}},hideModule:function(e){for(var t in this.modulesLayout){var n=this.modulesLayout[t];if(Array.isArray(n)){for(var i=0;i<n.length;i++)if(n[i].id===e)return void this.hideRegion(t)}else if(n.id===e)return void this.hideRegion(t)}},showRegion:function(e,t){if("south"===e)this.$innerLayout.open("south"),void 0!==t&&this.$innerLayout.panes[e].tabs("option","active",t);else{if("west"===e)this.$outerLayout.open("west");else{if("east"!==e)return;this.$outerLayout.open("east")}void 0!==t&&this.$outerLayout.panes[e].tabs("option","active",t)}},hideRegion:function(e){if("south"===e)this.$innerLayout.close("south");else if("west"===e)this.$outerLayout.close("west");else{if("east"!==e)return;this.$outerLayout.close("east")}},showToolbar:function(){i(".mce-toolbar-grp",this.w.editor.getContainer()).first().show()},hideToolbar:function(){i(".mce-toolbar-grp",this.w.editor.getContainer()).first().hide()},getButtonByName:function(e){var t=this.w.editor.buttons,n=this.w.editor.theme.panel.find("toolbar *");if(void 0===t[e])return!1;var i=t[e],a=!1,o=0;return window.tinymce.each(i,(function(e,t){o++})),window.tinymce.each(n,(function(e,t){if("button"==e.type&&void 0!==e.settings){var n=0;if(window.tinymce.each(e.settings,(function(e,t){i[t]==e&&n++})),n==o)return a=e,!1}})),a},toggleFullScreen:function(){if(a.fullscreenEnabled)if(null!==a.fullscreenElement)a.exitFullscreen();else{var e=this.getContainer()[0];a.requestFullscreen(e)}},isFullScreen:function(){return!(!a.fullscreenEnabled||null===a.fullscreenElement)},resizeAll:function(){this.$outerLayout.resizeAll(),this.$innerLayout.resizeAll()},getContainer:function(){return this.$container},getHeaderButtonsParent:function(){return this.$headerButtons},destroy:function(){for(var e=0;e<this.modules.length;e++){var t=this.modules[e];void 0!==t.destroy?t.destroy():console.warn("layoutManager: no destroy method for",t)}this.$outerLayout.destroy(!0),this.$container.remove()}},e.exports=f},function(module,exports,__webpack_require__){function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var jQuery=__webpack_require__(1);!function($){var min=Math.min,max=Math.max,round=Math.floor,isStr=function(e){return"string"===$.type(e)},runPluginCallbacks=function runPluginCallbacks(Instance,a_fn){if($.isArray(a_fn))for(var i=0,c=a_fn.length;i<c;i++){var fn=a_fn[i];try{isStr(fn)&&(fn=eval(fn)),$.isFunction(fn)&&g(fn)(Instance)}catch(e){}}function g(e){return e}},u,m,b,v,ie,cm,$s,bs,bm,lb;$.layout={version:"1.6.0",revision:1.0601,browser:{},effects:{slide:{all:{duration:"fast"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},drop:{all:{duration:"slow"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},scale:{all:{duration:"fast"}},blind:{},clip:{},explode:{},fade:{},fold:{},puff:{},size:{all:{easing:"swing"}}},config:{optionRootKeys:"effects,panes,north,south,west,east,center".split(","),allPanes:"north,south,west,east,center".split(","),borderPanes:"north,south,west,east".split(","),oppositeEdge:{north:"south",south:"north",east:"west",west:"east"},offscreenCSS:{left:"-99999px",right:"auto"},offscreenReset:"offscreenReset",hidden:{visibility:"hidden"},visible:{visibility:"visible"},resizers:{cssReq:{position:"absolute",padding:0,margin:0,fontSize:"1px",textAlign:"left",overflow:"hidden"},cssDemo:{background:"#DDD",border:"none"}},togglers:{cssReq:{position:"absolute",display:"block",padding:0,margin:0,overflow:"hidden",textAlign:"center",fontSize:"1px",cursor:"pointer",zIndex:1},cssDemo:{background:"#AAA"}},content:{cssReq:{position:"relative"},cssDemo:{overflow:"auto",padding:"10px"},cssDemoPane:{overflow:"hidden",padding:0}},panes:{cssReq:{position:"absolute",margin:0},cssDemo:{padding:"10px",background:"#FFF",border:"1px solid #BBB",overflow:"auto"}},north:{side:"top",sizeType:"Height",dir:"horz",cssReq:{top:0,bottom:"auto",left:0,right:0,width:"auto"}},south:{side:"bottom",sizeType:"Height",dir:"horz",cssReq:{top:"auto",bottom:0,left:0,right:0,width:"auto"}},east:{side:"right",sizeType:"Width",dir:"vert",cssReq:{left:"auto",right:0,top:"auto",bottom:"auto",height:"auto"}},west:{side:"left",sizeType:"Width",dir:"vert",cssReq:{left:0,right:"auto",top:"auto",bottom:"auto",height:"auto"}},center:{dir:"center",cssReq:{left:"auto",right:"auto",top:"auto",bottom:"auto",height:"auto",width:"auto"}}},callbacks:{},getParentPaneElem:function(e){var t=$(e),n=t.data("layout")||t.data("parentLayout");if(n){var i=n.container;if(i.data("layoutPane"))return i;var a=i.closest("."+$.layout.defaults.panes.paneClass);if(a.data("layoutPane"))return a}return null},getParentPaneInstance:function(e){var t=$.layout.getParentPaneElem(e);return t?t.data("layoutPane"):null},getParentLayoutInstance:function(e){var t=$.layout.getParentPaneElem(e);return t?t.data("parentLayout"):null},getEventObject:function(e){return"object"===_typeof(e)&&e.stopPropagation?e:null},parsePaneName:function(e){var t=$.layout.getEventObject(e),n=e;return t&&(t.stopPropagation(),n=$(this).data("layoutEdge")),n&&!/^(west|east|north|south|center)$/.test(n)&&($.layout.msg('LAYOUT ERROR - Invalid pane-name: "'+n+'"'),n="error"),n},plugins:{draggable:!!$.fn.draggable,effects:{core:!!$.effects,slide:$.effects&&($.effects.slide||$.effects.effect&&$.effects.effect.slide)}},onCreate:[],onLoad:[],onReady:[],onDestroy:[],onUnload:[],afterOpen:[],afterClose:[],scrollbarWidth:function(){return window.scrollbarWidth||$.layout.getScrollbarSize("width")},scrollbarHeight:function(){return window.scrollbarHeight||$.layout.getScrollbarSize("height")},getScrollbarSize:function(e){var t=$('<div style="position: absolute; top: -10000px; left: -10000px; width: 100px; height: 100px; border: 0; overflow: scroll;"></div>').appendTo("body"),n={width:t.outerWidth-t[0].clientWidth,height:100-t[0].clientHeight};return t.remove(),window.scrollbarWidth=n.width,window.scrollbarHeight=n.height,e.match(/^(width|height)$/)?n[e]:n},disableTextSelection:function(){var e=$(document),t="textSelectionDisabled",n="textSelectionInitialized";$.fn.disableSelection&&(e.data(n)||e.on("mouseup",$.layout.enableTextSelection).data(n,!0),e.data(t)||e.disableSelection().data(t,!0))},enableTextSelection:function(){var e=$(document),t="textSelectionDisabled";$.fn.enableSelection&&e.data(t)&&e.enableSelection().data(t,!1)},showInvisibly:function(e,t){if(e&&e.length&&(t||"none"===e.css("display"))){var n=e[0].style,i={display:n.display||"",visibility:n.visibility||""};return e.css({display:"block",visibility:"hidden"}),i}return{}},getElementDimensions:function(e,t){var n,i,a,o={css:{},inset:{}},r=o.css,s={bottom:0},l=$.layout.cssNum,c=Math.round,d=e.offset();return o.offsetLeft=d.left,o.offsetTop=d.top,t||(t={}),$.each("Left,Right,Top,Bottom".split(","),(function(l,c){n=r["border"+c]=$.layout.borderWidth(e,c),i=r["padding"+c]=$.layout.cssNum(e,"padding"+c),a=c.toLowerCase(),o.inset[a]=t[a]>=0?t[a]:i,s[a]=o.inset[a]+n})),r.width=c(e.width()),r.height=c(e.height()),r.top=l(e,"top",!0),r.bottom=l(e,"bottom",!0),r.left=l(e,"left",!0),r.right=l(e,"right",!0),o.outerWidth=c(e.outerWidth()),o.outerHeight=c(e.outerHeight()),o.innerWidth=max(0,o.outerWidth-s.left-s.right),o.innerHeight=max(0,o.outerHeight-s.top-s.bottom),o.layoutWidth=c(e.innerWidth()),o.layoutHeight=c(e.innerHeight()),o},getElementStyles:function(e,t){var n,i,a,o,r,s,l={},c=e[0].style,d=t.split(","),u="Top,Bottom,Left,Right".split(","),p="Color,Style,Width".split(",");for(o=0;o<d.length;o++)if((n=d[o]).match(/(border|padding|margin)$/))for(r=0;r<4;r++)if(i=u[r],"border"===n)for(s=0;s<3;s++)l[n+i+(a=p[s])]=c[n+i+a];else l[n+i]=c[n+i];else l[n]=c[n];return l},cssWidth:function(e,t){if(t<=0)return 0;var n=$.layout.browser,i=n.boxModel?n.boxSizing?e.css("boxSizing"):"content-box":"border-box",a=$.layout.borderWidth,o=$.layout.cssNum,r=t;return"border-box"!==i&&(r-=a(e,"Left")+a(e,"Right")),"content-box"===i&&(r-=o(e,"paddingLeft")+o(e,"paddingRight")),max(0,r)},cssHeight:function(e,t){if(t<=0)return 0;var n=$.layout.browser,i=n.boxModel?n.boxSizing?e.css("boxSizing"):"content-box":"border-box",a=$.layout.borderWidth,o=$.layout.cssNum,r=t;return"border-box"!==i&&(r-=a(e,"Top")+a(e,"Bottom")),"content-box"===i&&(r-=o(e,"paddingTop")+o(e,"paddingBottom")),max(0,r)},cssNum:function(e,t,n){e.jquery||(e=$(e));var i=$.layout.showInvisibly(e),a=$.css(e[0],t,!0),o=n&&"auto"==a?a:Math.round(parseFloat(a)||0);return e.css(i),o},borderWidth:function(e,t){e.jquery&&(e=e[0]);var n="border"+t.substr(0,1).toUpperCase()+t.substr(1);return"none"===$.css(e,n+"Style",!0)?0:Math.round(parseFloat($.css(e,n+"Width",!0))||0)},isMouseOverElem:function(e,t){var n=$(t||this),i=n.offset(),a=i.top,o=i.left,r=o+n.outerWidth(),s=a+n.outerHeight(),l=e.pageX,c=e.pageY;return $.layout.browser.msie&&l<0&&c<0||l>=o&&l<=r&&c>=a&&c<=s},msg:function(e,t,n,i){if($.isPlainObject(e)&&window.debugData){"string"==typeof t?(i=n,n=t):"object"===_typeof(n)&&(i=n,n=null);var a=n||"log( <object> )",o=$.extend({sort:!1,returnHTML:!1,display:!1},i);!0===t||o.display?debugData(e,a,o):window.console&&console.log(debugData(e,a,o))}else if(t)alert(e);else if(window.console)console.log(e);else{var r=$("#layoutLogger");r.length||(r=function(){var e=$.support.fixedPosition?"fixed":"absolute",t=$('<div id="layoutLogger" style="position: '+e+'; top: 5px; z-index: 999999; max-width: 25%; overflow: hidden; border: 1px solid #000; border-radius: 5px; background: #FBFBFB; box-shadow: 0 2px 10px rgba(0,0,0,0.3);"><div style="font-size: 13px; font-weight: bold; padding: 5px 10px; background: #F6F6F6; border-radius: 5px 5px 0 0; cursor: move;"><span style="float: right; padding-left: 7px; cursor: pointer;" title="Remove Console" onclick="$(this).closest(\'#layoutLogger\').remove()">X</span>Layout console.log</div><ul style="font-size: 13px; font-weight: none; list-style: none; margin: 0; padding: 0 0 2px;"></ul></div>').appendTo("body");t.css("left",$(window).width()-t.outerWidth()-5),$.ui.draggable&&t.draggable({handle:":first-child"});return t}()),r.children("ul").append('<li style="padding: 4px 10px; margin: 0; border-top: 1px solid #CCC;">'+e.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+"</li>")}}},u=navigator.userAgent.toLowerCase(),m=/(chrome)[ \/]([\w.]+)/.exec(u)||/(webkit)[ \/]([\w.]+)/.exec(u)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(u)||/(msie) ([\w.]+)/.exec(u)||u.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(u)||[],b=m[1]||"",v=m[2]||0,ie="msie"===b,cm=document.compatMode,$s=$.support,bs=void 0!==$s.boxSizing?$s.boxSizing:$s.boxSizingReliable,bm=!ie||!cm||"CSS1Compat"===cm||$s.boxModel||!1,lb=$.layout.browser={version:v,safari:"webkit"===b,webkit:"chrome"===b,msie:ie,isIE6:ie&&6==v,boxModel:bm,boxSizing:!!("function"==typeof bs?bs():bs)},b&&(lb[b]=!0),bm||cm||$((function(){lb.boxModel=$s.boxModel})),$.layout.defaults={name:"",containerClass:"ui-layout-container",inset:null,scrollToBookmarkOnLoad:!0,resizeWithWindow:!0,resizeWithWindowDelay:200,resizeWithWindowMaxDelay:0,maskPanesEarly:!1,onresizeall_start:null,onresizeall_end:null,onload_start:null,onload_end:null,onunload_start:null,onunload_end:null,initPanes:!0,showErrorMessages:!0,showDebugMessages:!1,zIndex:null,zIndexes:{pane_normal:0,content_mask:1,resizer_normal:2,pane_sliding:100,pane_animate:1e3,resizer_drag:1e4},errors:{pane:"pane",selector:"selector",addButtonError:"Error Adding Button\nInvalid ",containerMissing:"UI Layout Initialization Error\nThe specified layout-container does not exist.",centerPaneMissing:"UI Layout Initialization Error\nThe center-pane element does not exist.\nThe center-pane is a required element.",noContainerHeight:"UI Layout Initialization Warning\nThe layout-container \"CONTAINER\" has no height.\nTherefore the layout is 0-height and hence 'invisible'!",callbackError:"UI Layout Callback Error\nThe EVENT callback is not a valid function."},panes:{applyDemoStyles:!1,responsive:{enabled:!1,when:"xl",sizes:{xl:1140,lg:992,md:768,sm:576,xs:0}},closable:!0,resizable:!0,slidable:!0,initClosed:!1,initHidden:!1,contentSelector:".ui-layout-content",contentIgnoreSelector:".ui-layout-ignore",findNestedContent:!1,paneClass:"ui-layout-pane",resizerClass:"ui-layout-resizer",togglerClass:"ui-layout-toggler",buttonClass:"ui-layout-button",minSize:0,maxSize:0,spacing_open:6,spacing_closed:6,togglerLength_open:50,togglerLength_closed:50,togglerAlign_open:"center",togglerAlign_closed:"center",togglerContent_open:"",togglerContent_closed:"",resizerDblClickToggle:!0,autoResize:!0,autoReopen:!0,resizerDragOpacity:1,maskContents:!1,maskObjects:!1,maskZindex:null,resizingGrid:!1,livePaneResizing:!1,liveContentResizing:!1,liveResizingTolerance:1,sliderCursor:"pointer",slideTrigger_open:"click",slideTrigger_close:"mouseleave",slideDelay_open:300,slideDelay_close:300,hideTogglerOnSlide:!1,preventQuickSlideClose:$.layout.browser.webkit,preventPrematureSlideClose:!1,tips:{Open:"Open",Close:"Close",Resize:"Resize",Slide:"Slide Open",Pin:"Pin",Unpin:"Un-Pin",noRoomToOpen:"Not enough room to show this panel.",minSizeWarning:"Panel has reached its minimum size",maxSizeWarning:"Panel has reached its maximum size"},showOverflowOnHover:!1,enableCursorHotkey:!0,customHotkeyModifier:"SHIFT",fxName:"slide",fxSpeed:null,fxSettings:{},fxOpacityFix:!0,animatePaneSizing:!1,children:null,containerSelector:"",initChildren:!0,destroyChildren:!0,resizeChildren:!0,triggerEventsOnLoad:!1,triggerEventsDuringLiveResize:!0,onshow_start:null,onshow_end:null,onhide_start:null,onhide_end:null,onopen_start:null,onopen_end:null,onclose_start:null,onclose_end:null,onresize_start:null,onresize_end:function(){},onsizecontent_start:null,onsizecontent_end:null,onswap_start:null,onswap_end:null,ondrag_start:null,ondrag_end:null},north:{paneSelector:".ui-layout-north",size:"auto",resizerCursor:"n-resize",customHotkey:""},south:{paneSelector:".ui-layout-south",size:"auto",resizerCursor:"s-resize",customHotkey:""},east:{paneSelector:".ui-layout-east",size:200,resizerCursor:"e-resize",customHotkey:""},west:{paneSelector:".ui-layout-west",size:200,resizerCursor:"w-resize",customHotkey:""},center:{paneSelector:".ui-layout-center",minWidth:0,minHeight:0}},$.layout.optionsMap={layout:"name,instanceKey,stateManagement,effects,inset,zIndexes,errors,zIndex,scrollToBookmarkOnLoad,showErrorMessages,maskPanesEarly,outset,resizeWithWindow,resizeWithWindowDelay,resizeWithWindowMaxDelay,onresizeall,onresizeall_start,onresizeall_end,onload,onload_start,onload_end,onunload,onunload_start,onunload_end".split(","),center:"paneClass,contentSelector,contentIgnoreSelector,findNestedContent,applyDemoStyles,triggerEventsOnLoad,showOverflowOnHover,maskContents,maskObjects,liveContentResizing,containerSelector,children,initChildren,resizeChildren,destroyChildren,onresize,onresize_start,onresize_end,onsizecontent,onsizecontent_start,onsizecontent_end".split(","),noDefault:"paneSelector,resizerCursor,customHotkey".split(",")},$.layout.transformData=function(e,t){var n,i,a,o,r,s,l,c=t?{panes:{},center:{}}:{};if("object"!==_typeof(e))return c;for(i in e)for(n=c,r=e[i],l=(a=i.split("__")).length-1,s=0;s<=l;s++)o=a[s],s===l?$.isPlainObject(r)?n[o]=$.layout.transformData(r):n[o]=r:(n[o]||(n[o]={}),n=n[o]);return c},$.layout.backwardCompatibility={map:{applyDefaultStyles:"applyDemoStyles",childOptions:"children",initChildLayout:"initChildren",destroyChildLayout:"destroyChildren",resizeChildLayout:"resizeChildren",resizeNestedLayout:"resizeChildren",resizeWhileDragging:"livePaneResizing",resizeContentWhileDragging:"liveContentResizing",triggerEventsWhileDragging:"triggerEventsDuringLiveResize",maskIframesOnResize:"maskContents",useStateCookie:"stateManagement.enabled","cookie.autoLoad":"stateManagement.autoLoad","cookie.autoSave":"stateManagement.autoSave","cookie.keys":"stateManagement.stateKeys","cookie.name":"stateManagement.cookie.name","cookie.domain":"stateManagement.cookie.domain","cookie.path":"stateManagement.cookie.path","cookie.expires":"stateManagement.cookie.expires","cookie.secure":"stateManagement.cookie.secure",noRoomToOpenTip:"tips.noRoomToOpen",togglerTip_open:"tips.Close",togglerTip_closed:"tips.Open",resizerTip:"tips.Resize",sliderTip:"tips.Slide"},renameOptions:function(e){var t,n,i,a=$.layout.backwardCompatibility.map;for(var o in a)void 0!==(i=(t=r(o)).branch[t.key])&&((n=r(a[o],!0)).branch[n.key]=i,delete t.branch[t.key]);function r(t,n){for(var i,a=t.split("."),o=a.length-1,r={branch:e,key:a[o]},s=0;s<o;s++)i=a[s],void 0===r.branch[i]?r.branch=n?r.branch[i]={}:{}:r.branch=r.branch[i];return r}},renameAllOptions:function(e){var t=$.layout.backwardCompatibility.renameOptions;return t(e),e.defaults&&("object"!==_typeof(e.panes)&&(e.panes={}),$.extend(!0,e.panes,e.defaults),delete e.defaults),e.panes&&t(e.panes),$.each($.layout.config.allPanes,(function(n,i){e[i]&&t(e[i])})),e}},$.fn.layout=function(opts){var browser=$.layout.browser,_c=$.layout.config,cssW=$.layout.cssWidth,cssH=$.layout.cssHeight,elDims=$.layout.getElementDimensions,styles=$.layout.getElementStyles,evtObj=$.layout.getEventObject,evtPane=$.layout.parsePaneName,options=$.extend(!0,{},$.layout.defaults),effects=options.effects=$.extend(!0,{},$.layout.effects),state={id:"layout"+$.now(),initialized:!1,paneResizing:!1,panesSliding:{},container:{innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0,layoutWidth:0,layoutHeight:0},north:{childIdx:0},south:{childIdx:0},east:{childIdx:0},west:{childIdx:0},center:{childIdx:0}},children={north:null,south:null,east:null,west:null,center:null},timer={data:{},set:function(e,t,n){timer.clear(e),timer.data[e]=setTimeout(t,n)},clear:function(e){var t=timer.data;t[e]&&(clearTimeout(t[e]),delete t[e])}},_log=function(e,t,n){var i=options;return(i.showErrorMessages&&!n||n&&i.showDebugMessages)&&$.layout.msg(i.name+" / "+e,!1!==t),!1},_runCallbacks=function _runCallbacks(evtName,pane,skipBoundEvents){var hasPane=pane&&isStr(pane),s=hasPane?state[pane]:state,o=hasPane?options[pane]:options,lName=options.name,lng=evtName+(evtName.match(/_/)?"":"_end"),shrt=lng.match(/_end$/)?lng.substr(0,lng.length-4):"",fn=o[lng]||o[shrt],retVal="NC",args=[],$P=hasPane?$Ps[pane]:0;if(hasPane&&!$P)return retVal;if(hasPane||"boolean"!==$.type(pane)||(skipBoundEvents=pane,pane=""),fn)try{isStr(fn)&&(fn.match(/,/)?(args=fn.split(","),fn=eval(args[0])):fn=eval(fn)),$.isFunction(fn)&&(retVal=args.length?g(fn)(args[1]):hasPane?g(fn)(pane,$Ps[pane],s,o,lName):g(fn)(Instance,s,o,lName))}catch(e){_log(options.errors.callbackError.replace(/EVENT/,$.trim((pane||"")+" "+lng)),!1),"string"===$.type(e)&&string.length&&_log("Exception:  "+e,!1)}return skipBoundEvents||!1===retVal||(hasPane?(o=options[pane],s=state[pane],$P.triggerHandler("layoutpane"+lng,[pane,$P,s,o,lName]),shrt&&$P.triggerHandler("layoutpane"+shrt,[pane,$P,s,o,lName])):($N.triggerHandler("layout"+lng,[Instance,s,o,lName]),shrt&&$N.triggerHandler("layout"+shrt,[Instance,s,o,lName]))),hasPane&&"onresize_end"===evtName&&resizeChildren(pane+"",!0),retVal;function g(e){return e}},_fixIframe=function(e){if(!browser.mozilla){var t=$Ps[e];"IFRAME"===state[e].tagName?t.css(_c.hidden).css(_c.visible):t.find("IFRAME").css(_c.hidden).css(_c.visible)}},cssSize=function(e,t){return("horz"==_c[e].dir?cssH:cssW)($Ps[e],t)},cssMinDims=function(e){var t=$Ps[e],n=_c[e].dir,i={minWidth:1001-cssW(t,1e3),minHeight:1001-cssH(t,1e3)};return"horz"===n&&(i.minSize=i.minHeight),"vert"===n&&(i.minSize=i.minWidth),i},setOuterWidth=function(e,t,n){var i,a=e;isStr(e)?a=$Ps[e]:e.jquery||(a=$(e)),i=cssW(a,t),a.css({width:i}),i>0?n&&a.data("autoHidden")&&a.innerHeight()>0&&(a.show().data("autoHidden",!1),browser.mozilla||a.css(_c.hidden).css(_c.visible)):n&&!a.data("autoHidden")&&a.hide().data("autoHidden",!0)},setOuterHeight=function(e,t,n){var i,a=e;isStr(e)?a=$Ps[e]:e.jquery||(a=$(e)),i=cssH(a,t),a.css({height:i,visibility:"visible"}),i>0&&a.innerWidth()>0?n&&a.data("autoHidden")&&(a.show().data("autoHidden",!1),browser.mozilla||a.css(_c.hidden).css(_c.visible)):n&&!a.data("autoHidden")&&a.hide().data("autoHidden",!0)},_parseSize=function(e,t,n){if(n||(n=_c[e].dir),isStr(t)&&t.match(/%/)&&(t="100%"===t?-1:parseInt(t,10)/100),0===t)return 0;if(t>=1)return parseInt(t,10);var i=options,a=0;if("horz"==n?a=sC.innerHeight-($Ps.north?i.north.spacing_open:0)-($Ps.south?i.south.spacing_open:0):"vert"==n&&(a=sC.innerWidth-($Ps.west?i.west.spacing_open:0)-($Ps.east?i.east.spacing_open:0)),-1===t)return a;if(t>0)return round(a*t);if("center"==e)return 0;var o="horz"===n?"height":"width",r=$Ps[e],s="height"===o&&$Cs[e],l=$.layout.showInvisibly(r),c=r.css(o),d=s?s.css(o):0;return r.css(o,"auto"),s&&s.css(o,"auto"),t="height"===o?r.outerHeight():r.outerWidth(),r.css(o,c).css(l),s&&s.css(o,d),t},getPaneSize=function(e,t){var n=$Ps[e],i=options[e],a=state[e],o=t?i.spacing_open:0,r=t?i.spacing_closed:0;return!n||a.isHidden?0:a.isClosed||a.isSliding&&t?r:"horz"===_c[e].dir?n.outerHeight()+o:n.outerWidth()+o},setSizeLimits=function(e,t){if(isInitialized()){var n=options[e],i=state[e],a=_c[e],o=a.dir,r=(a.sizeType.toLowerCase(),null!=t?t:i.isSliding),s=($Ps[e],n.spacing_open),l=_c.oppositeEdge[e],c=state[l],d=$Ps[l],u=!d||!1===c.isVisible||c.isSliding?0:"horz"==o?d.outerHeight():d.outerWidth(),p=(!d||c.isHidden?0:options[l][!1!==c.isClosed?"spacing_closed":"spacing_open"])||0,g="horz"==o?sC.innerHeight:sC.innerWidth,f=cssMinDims("center"),h="horz"==o?max(options.center.minHeight,f.minHeight):max(options.center.minWidth,f.minWidth),m=g-s-(r?0:_parseSize("center",h,o)+u+p),v=i.minSize=max(_parseSize(e,n.minSize),cssMinDims(e).minSize),y=i.maxSize=min(n.maxSize?_parseSize(e,n.maxSize):1e5,m),b=i.resizerPosition={},w=sC.inset.top,_=sC.inset.left,x=sC.innerWidth,C=sC.innerHeight,k=n.spacing_open;switch(e){case"north":b.min=w+v,b.max=w+y;break;case"west":b.min=_+v,b.max=_+y;break;case"south":b.min=w+C-y-k,b.max=w+C-v-k;break;case"east":b.min=_+x-y-k,b.max=_+x-v-k}}},calcNewCenterPaneDims=function(){var e={top:getPaneSize("north",!0),bottom:getPaneSize("south",!0),left:getPaneSize("west",!0),right:getPaneSize("east",!0),width:0,height:0};return e.width=sC.innerWidth-e.left-e.right,e.height=sC.innerHeight-e.bottom-e.top,e.top+=sC.inset.top,e.bottom+=sC.inset.bottom,e.left+=sC.inset.left,e.right+=sC.inset.right,e},getHoverClasses=function(e,t){var n=$(e),i=n.data("layoutRole"),a=n.data("layoutEdge"),o=options[a][i+"Class"],r="-"+a,s="-hover ",l=n.hasClass(o+"-closed")?"-closed":"-open",c="-closed"===l?"-open":"-closed",d=o+s+(o+r+s)+(o+l+s)+(o+r+l+s);return t&&(d+=o+c+s+(o+r+c+s)),"resizer"==i&&n.hasClass(o+"-sliding")&&(d+=o+"-sliding"+s+(o+r)+"-sliding"+s),$.trim(d)},addHover=function(e,t){var n=$(t||this);e&&"toggler"===n.data("layoutRole")&&e.stopPropagation(),n.addClass(getHoverClasses(n))},removeHover=function(e,t){var n=$(t||this);n.removeClass(getHoverClasses(n,!0))},onResizerEnter=function(e){var t=$(this).data("layoutEdge"),n=state[t];$(document);n.isResizing||state.paneResizing||options.maskPanesEarly&&showMasks(t,{resizing:!0})},onResizerLeave=function e(t,n){var i=n||this,a=$(i).data("layoutEdge"),o=a+"ResizerLeave";$(document);timer.clear(a+"_openSlider"),timer.clear(o),n?options.maskPanesEarly&&!state.paneResizing&&hideMasks():timer.set(o,(function(){e(t,i)}),200)},_create=function(){initOptions();var e=options,t=state;return t.creatingLayout=!0,runPluginCallbacks(Instance,$.layout.onCreate),!1===_runCallbacks("onload_start")?"cancel":(_initContainer(),initHotkeys(),$(window).on("unload."+sID,unload),runPluginCallbacks(Instance,$.layout.onLoad),e.initPanes&&_initLayoutElements(),delete t.creatingLayout,resizeAll(),$.each(["south","north","east","west"],(function(n,i){if($Ps[i]){e=options[i],t=state[i];$Ps[i];e.initHidden?hide(i):e.initClosed&&close(i)}})),state.initialized)},isInitialized=function(){return!(!state.initialized&&!state.creatingLayout)||_initLayoutElements()},_initLayoutElements=function e(t){var n=options;if(!$N.is(":visible"))return!t&&browser.webkit&&"BODY"===$N[0].tagName&&setTimeout((function(){e(!0)}),50),!1;if(!getPane("center").length)return _log(n.errors.centerPaneMissing);if(state.creatingLayout=!0,$.extend(sC,elDims($N,n.inset)),initPanes(),n.scrollToBookmarkOnLoad){var i=self.location;i.hash&&i.replace(i.hash)}return Instance.hasParentLayout?n.resizeWithWindow=!1:n.resizeWithWindow&&$(window).on("resize."+sID,windowResize),delete state.creatingLayout,state.initialized=!0,runPluginCallbacks(Instance,$.layout.onReady),_runCallbacks("onload_end"),!0},createChildren=function(e,t){var n=evtPane.call(this,e),i=$Ps[n];if(i){var a=$Cs[n],o=state[n],r=options[n],s=options.stateManagement||{},l=t?r.children=t:r.children;if($.isPlainObject(l))l=[l];else if(!l||!$.isArray(l))return;$.each(l,(function(e,t){$.isPlainObject(t)&&(t.containerSelector?i.find(t.containerSelector):a||i).each((function(){var e=$(this),i=e.data("layout");if(!i){if(setInstanceKey({container:e,options:t},o),s.includeChildren&&state.stateData[n]){var a=(state.stateData[n].children||{})[t.instanceKey],r=t.stateManagement||(t.stateManagement={autoLoad:!0});!0===r.autoLoad&&a&&(r.autoSave=!1,r.includeChildren=!0,r.autoLoad=$.extend(!0,{},a))}(i=e.layout(t))&&refreshChildren(n,i)}}))}))}},setInstanceKey=function(e,t){var n=e.container,i=e.options,a=i.stateManagement,o=i.instanceKey||n.data("layoutInstanceKey");return o||(o=(a&&a.cookie?a.cookie.name:"")||i.name),o=o?o.replace(/[^\w-]/gi,"_").replace(/_{2,}/g,"_"):"layout"+ ++t.childIdx,i.instanceKey=o,n.data("layoutInstanceKey",o),o},refreshChildren=function(e,t){var n,i=$Ps[e],a=children[e],o=state[e];$.isPlainObject(a)&&($.each(a,(function(e,t){t.destroyed&&delete a[e]})),$.isEmptyObject(a)&&(a=children[e]=null)),t||a||(t=i.data("layout")),t&&(t.hasParentLayout=!0,n=t.options,setInstanceKey(t,o),a||(a=children[e]={}),a[n.instanceKey]=t.container.data("layout")),Instance[e].children=children[e],t||createChildren(e)},windowResize=function(){var e=options,t=Number(e.resizeWithWindowDelay);t<10&&(t=100),timer.clear("winResize"),timer.set("winResize",(function(){timer.clear("winResize"),timer.clear("winResizeRepeater");var t=elDims($N,e.inset);t.innerWidth===sC.innerWidth&&t.innerHeight===sC.innerHeight||resizeAll()}),t),timer.data.winResizeRepeater||setWindowResizeRepeater()},setWindowResizeRepeater=function e(){var t=Number(options.resizeWithWindowMaxDelay);t>0&&timer.set("winResizeRepeater",(function(){e(),resizeAll()}),t)},unload=function(){_runCallbacks("onunload_start"),runPluginCallbacks(Instance,$.layout.onUnload),_runCallbacks("onunload_end")},_initContainer=function(){var e,t,n=$N[0],i=$("html"),a=sC.tagName=n.tagName,o=sC.id=n.id,r=sC.className=n.className,s=options,l=s.name,c="position,margin,padding,border",d="layoutCSS",u={},p="hidden",g=$N.data("parentLayout"),f=$N.data("layoutEdge"),h=g&&f,m=$.layout.cssNum;sC.ref=(s.name?s.name+" layout / ":"")+a+(o?"#"+o:r?".["+r+"]":""),sC.isBody="BODY"===a,h||sC.isBody||(g=(e=$N.closest("."+$.layout.defaults.panes.paneClass)).data("parentLayout"),f=e.data("layoutEdge"),h=g&&f),$N.data({layout:Instance,layoutContainer:sID}).addClass(s.containerClass);var v={destroy:"",initPanes:"",resizeAll:"resizeAll",resize:"resizeAll"};for(l in v)$N.on("layout"+l.toLowerCase()+"."+sID,Instance[v[l]||l]);h&&(Instance.hasParentLayout=!0,g.refreshChildren(f,Instance)),$N.data(d)||(sC.isBody?($N.data(d,$.extend(styles($N,c),{height:$N.css("height"),overflow:$N.css("overflow"),overflowX:$N.css("overflowX"),overflowY:$N.css("overflowY")})),i.data(d,$.extend(styles(i,"padding"),{height:"auto",overflow:i.css("overflow"),overflowX:i.css("overflowX"),overflowY:i.css("overflowY")}))):$N.data(d,styles($N,c+",top,bottom,left,right,width,height,overflow,overflowX,overflowY")));try{if(u={overflow:p,overflowX:p,overflowY:p},$N.css(u),s.inset&&!$.isPlainObject(s.inset)&&(t=parseInt(s.inset,10)||0,s.inset={top:t,bottom:t,left:t,right:t}),sC.isBody)s.outset?$.isPlainObject(s.outset)||(t=parseInt(s.outset,10)||0,s.outset={top:t,bottom:t,left:t,right:t}):s.outset={top:m(i,"paddingTop"),bottom:m(i,"paddingBottom"),left:m(i,"paddingLeft"),right:m(i,"paddingRight")},i.css(u).css({height:"100%",border:"none",padding:0,margin:0}),browser.isIE6?($N.css({width:"100%",height:"100%",border:"none",padding:0,margin:0,position:"relative"}),s.inset||(s.inset=elDims($N).inset)):($N.css({width:"auto",height:"auto",margin:0,position:"absolute"}),$N.css(s.outset)),$.extend(sC,elDims($N,s.inset));else{var y=$N.css("position");y&&y.match(/(fixed|absolute|relative)/)||$N.css("position","relative"),$N.is(":visible")&&($.extend(sC,elDims($N,s.inset)),sC.innerHeight<1&&_log(s.errors.noContainerHeight.replace(/CONTAINER/,sC.ref)))}m($N,"minWidth")&&$N.parent().css("overflowX","auto"),m($N,"minHeight")&&$N.parent().css("overflowY","auto")}catch(e){}},initHotkeys=function(e){e=e?e.split(","):_c.borderPanes,$.each(e,(function(e,t){var n=options[t];if(n.enableCursorHotkey||n.customHotkey)return $(document).on("keydown."+sID,keyDown),!1}))},initOptions=function(){var e,t,n,i,a,o,r;if(opts=$.layout.transformData(opts,!0),opts=$.layout.backwardCompatibility.renameAllOptions(opts),!$.isEmptyObject(opts.panes)){for(e=$.layout.optionsMap.noDefault,a=0,o=e.length;a<o;a++)n=e[a],delete opts.panes[n];for(e=$.layout.optionsMap.layout,a=0,o=e.length;a<o;a++)n=e[a],delete opts.panes[n]}e=$.layout.optionsMap.layout;var s=$.layout.config.optionRootKeys;for(n in opts)i=opts[n],$.inArray(n,s)<0&&$.inArray(n,e)<0&&(opts.panes[n]||(opts.panes[n]=$.isPlainObject(i)?$.extend(!0,{},i):i),delete opts[n]);$.extend(!0,options,opts),$.each(_c.allPanes,(function(i,a){if(_c[a]=$.extend(!0,{},_c.panes,_c[a]),t=options.panes,r=options[a],"center"===a)for(e=$.layout.optionsMap.center,i=0,o=e.length;i<o;i++)n=e[i],opts.center[n]||!opts.panes[n]&&r[n]||(r[n]=t[n]);else r=options[a]=$.extend(!0,{},t,r),function(e){var t=options[e],n=options.panes;t.fxSettings||(t.fxSettings={});n.fxSettings||(n.fxSettings={});$.each(["_open","_close","_size"],(function(i,a){var o="fxName"+a,r="fxSpeed"+a,s="fxSettings"+a,l=t[o]=t[o]||n[o]||t.fxName||n.fxName||"none",c=$.effects&&($.effects[l]||$.effects.effect&&$.effects.effect[l]);"none"!==l&&options.effects[l]&&c||(l=t[o]="none");var d=options.effects[l]||{},u=d.all||null,p=d[e]||null;t[r]=t[r]||n[r]||t.fxSpeed||n.fxSpeed||null,t[s]=$.extend(!0,{},u,p,n.fxSettings,t.fxSettings,n[s],t[s])})),delete t.fxName,delete t.fxSpeed,delete t.fxSettings}(a),r.resizerClass||(r.resizerClass="ui-layout-resizer"),r.togglerClass||(r.togglerClass="ui-layout-toggler");r.paneClass||(r.paneClass="ui-layout-pane")}));var l=opts.zIndex,c=options.zIndexes;l>0&&(c.pane_normal=l,c.content_mask=max(l+1,c.content_mask),c.resizer_normal=max(l+2,c.resizer_normal)),delete options.panes},getPane=function(e){var t=options[e].paneSelector;if("#"===t.substr(0,1))return $N.find(t).eq(0);var n=$N.children(t).eq(0);return n.length?n:$N.children("form:first").children(t).eq(0)},initPanes=function(e){evtPane(e),$.each(_c.allPanes,(function(e,t){addPane(t,!0)})),initHandles(),$.each(_c.borderPanes,(function(e,t){$Ps[t]&&state[t].isVisible&&(setSizeLimits(t),makePaneFit(t))})),sizeMidPanes("center"),$.each(_c.allPanes,(function(e,t){afterInitPane(t)}))},addPane=function(e,t){if(t||isInitialized()){var n,i,a,o=options[e],r=state[e],s=_c[e],l=s.dir,c=(r.fx,o.spacing_open,"center"===e),d={},u=$Ps[e];if(u?removePane(e,!1,!0,!1):$Cs[e]=!1,(u=$Ps[e]=getPane(e)).length){if(!u.data("layoutCSS")){u.data("layoutCSS",styles(u,"position,top,left,bottom,right,width,height,overflow,zIndex,display,backgroundColor,padding,margin,border"))}Instance[e]={name:e,pane:$Ps[e],content:$Cs[e],options:options[e],state:state[e],children:children[e]},u.data({parentLayout:Instance,layoutPane:Instance[e],layoutEdge:e,layoutRole:"pane"}).css(s.cssReq).css("zIndex",options.zIndexes.pane_normal).css(o.applyDemoStyles?s.cssDemo:{}).addClass(o.paneClass+" "+o.paneClass+"-"+e).on("mouseenter."+sID,addHover).on("mouseleave."+sID,removeHover);var p,g={hide:"",show:"",toggle:"",close:"",open:"",slideOpen:"",slideClose:"",slideToggle:"",size:"sizePane",sizePane:"sizePane",sizeContent:"",sizeHandles:"",enableClosable:"",disableClosable:"",enableSlideable:"",disableSlideable:"",enableResizable:"",disableResizable:"",swapPanes:"swapPanes",swap:"swapPanes",move:"swapPanes",removePane:"removePane",remove:"removePane",createChildren:"",resizeChildren:"",resizeAll:"resizeAll",resizeLayout:"resizeAll"};for(p in g)u.on("layoutpane"+p.toLowerCase()+"."+sID,Instance[g[p]||p]);initContent(e,!1),c||(n=r.size=_parseSize(e,o.size),i=_parseSize(e,o.minSize)||1,a=_parseSize(e,o.maxSize)||1e5,n>0&&(n=max(min(n,a),i)),r.autoResize=o.autoResize,r.isClosed=!1,r.isSliding=!1,r.isResizing=!1,r.isHidden=!1,r.pins||(r.pins=[])),r.tagName=u[0].tagName,r.edge=e,r.noRoom=!1,r.isVisible=!0,setPanePosition(e),"horz"===l?d.height=cssH(u,n):"vert"===l&&(d.width=cssW(u,n)),u.css(d),"horz"!=l&&sizeMidPanes(e,!0),state.initialized&&(initHandles(e),initHotkeys(e)),o.initClosed&&o.closable&&!o.initHidden?close(e,!0,!0):o.initHidden||o.initClosed?hide(e):r.noRoom||u.css("display","block"),u.css("visibility","visible"),o.showOverflowOnHover&&u.hover(allowOverflow,resetOverflow),state.initialized&&afterInitPane(e)}else $Ps[e]=!1}},afterInitPane=function(e){var t=$Ps[e],n=state[e],i=options[e];t&&(t.data("layout")&&refreshChildren(e,t.data("layout")),n.isVisible&&(state.initialized?resizeAll():sizeContent(e),i.triggerEventsOnLoad?_runCallbacks("onresize_end",e):resizeChildren(e,!0)),i.initChildren&&i.children&&createChildren(e))},setPanePosition=function(e){e=e?e.split(","):_c.borderPanes,$.each(e,(function(e,t){var n=$Ps[t],i=$Rs[t],a=(options[t],state[t]),o=_c[t].side,r={};if(n){switch(t){case"north":r.top=sC.inset.top,r.left=sC.inset.left,r.right=sC.inset.right;break;case"south":r.bottom=sC.inset.bottom,r.left=sC.inset.left,r.right=sC.inset.right;break;case"west":r.left=sC.inset.left;break;case"east":r.right=sC.inset.right}n.css(r),i&&a.isClosed?i.css(o,sC.inset[o]):i&&!a.isHidden&&i.css(o,sC.inset[o]+getPaneSize(t))}}))},initHandles=function(e){e=e?e.split(","):_c.borderPanes,$.each(e,(function(e,t){var n=$Ps[t];if($Rs[t]=!1,$Ts[t]=!1,n){var i=options[t],a=state[t],o=(_c[t],"#"===i.paneSelector.substr(0,1)?i.paneSelector.substr(1):""),r=i.resizerClass,s=i.togglerClass,l=(a.isVisible?i.spacing_open:i.spacing_closed,"-"+t),c=(a.isVisible,Instance[t]),d=c.resizer=$Rs[t]=$("<div></div>"),u=c.toggler=!!i.closable&&($Ts[t]=$("<div></div>"));if(!a.isVisible&&i.slidable&&d.attr("title",i.tips.Slide).css("cursor",i.sliderCursor),d.attr("id",o?o+"-resizer":"").data({parentLayout:Instance,layoutPane:Instance[t],layoutEdge:t,layoutRole:"resizer"}).css(_c.resizers.cssReq).css("zIndex",options.zIndexes.resizer_normal).css(i.applyDemoStyles?_c.resizers.cssDemo:{}).addClass(r+" "+r+l).hover(addHover,removeHover).hover(onResizerEnter,onResizerLeave).mousedown($.layout.disableTextSelection).mouseup($.layout.enableTextSelection).appendTo($N),$.fn.disableSelection&&d.disableSelection(),i.resizerDblClickToggle&&d.on("dblclick."+sID,toggle),u){var p;if(u.attr("id",o?o+"-toggler":"").data({parentLayout:Instance,layoutPane:Instance[t],layoutEdge:t,layoutRole:"toggler"}).css(_c.togglers.cssReq).css(i.applyDemoStyles?_c.togglers.cssDemo:{}).addClass(s+" "+s+l).hover(addHover,removeHover).on("mouseenter",onResizerEnter).appendTo(d),i.togglerContent_open)(p=$(i.togglerContent_open))?p.data({layoutEdge:t,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",t).addClass("content content-open").css("display","none").appendTo(u):(p=$.parseHTML(i.togglerContent_open),toglElem?p.data({layoutEdge:t,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",t).addClass("content content-open").css("display","none").appendTo(u):$("<span>"+i.togglerContent_open+"</span>").data({layoutEdge:t,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",t).addClass("content content-open").css("display","none").appendTo(u));if(i.togglerContent_closed)(p=$(i.togglerContent_closed))||(p=$.parseHTML(i.togglerContent_closed))?p.data({layoutEdge:t,layoutRole:"togglerContent"}).addClass("content content-closed").css("display","none").appendTo(u):$("<span>"+i.togglerContent_closed+"</span>").data({layoutEdge:t,layoutRole:"togglerContent"}).addClass("content content-closed").css("display","none").appendTo(u);enableClosable(t)}initResizable(t),a.isVisible?setAsOpen(t):(setAsClosed(t),bindStartSlidingEvents(t,!0))}})),sizeHandles()},initContent=function(e,t){if(isInitialized()){var n,i=options[e],a=i.contentSelector,o=Instance[e],r=$Ps[e];a&&(n=o.content=$Cs[e]=i.findNestedContent?r.find(a).eq(0):r.children(a).eq(0)),n&&n.length?(n.data("layoutRole","content"),n.data("layoutCSS")||n.data("layoutCSS",styles(n,"height")),n.css(_c.content.cssReq),i.applyDemoStyles&&(n.css(_c.content.cssDemo),r.css(_c.content.cssDemoPane)),r.css("overflowX").match(/(scroll|auto)/)&&r.css("overflow","hidden"),state[e].content={},!1!==t&&sizeContent(e)):o.content=$Cs[e]=!1}},initResizable=function(e){var t=$.layout.plugins.draggable;e=e?e.split(","):_c.borderPanes,$.each(e,(function(e,i){var a=options[i];if(!t||!$Ps[i]||!a.resizable)return a.resizable=!1,!0;var o,r,s=state[i],l=options.zIndexes,c=_c[i],d="horz"==c.dir?"top":"left",u=($Ps[i],$Rs[i]),p=a.resizerClass,g=0,f=p+"-drag",h=p+"-"+i+"-drag",m=p+"-dragging",v=p+"-"+i+"-dragging",y=p+"-dragging-limit",b=p+"-"+i+"-dragging-limit",w=!1;s.isClosed||u.attr("title",a.tips.Resize).css("cursor",a.resizerCursor),u.draggable({containment:$N[0],axis:"horz"==c.dir?"y":"x",delay:0,distance:1,grid:a.resizingGrid,helper:"clone",opacity:a.resizerDragOpacity,addClasses:!1,zIndex:l.resizer_drag,start:function(e,t){if(a=options[i],s=state[i],r=a.livePaneResizing,!1===_runCallbacks("ondrag_start",i))return!1;s.isResizing=!0,state.paneResizing=i,timer.clear(i+"_closeSlider"),setSizeLimits(i),o=s.resizerPosition,g=t.position[d],u.addClass(f+" "+h),w=!1,showMasks(i,{resizing:!0})},drag:function(e,t){w||(t.helper.addClass(m+" "+v).css({right:"auto",bottom:"auto"}).children().css("visibility","hidden"),w=!0,s.isSliding&&$Ps[i].css("zIndex",l.pane_sliding));var c=0;t.position[d]<o.min?(t.position[d]=o.min,c=-1):t.position[d]>o.max&&(t.position[d]=o.max,c=1),c?(t.helper.addClass(y+" "+b),window.defaultStatus=c>0&&i.match(/(north|west)/)||c<0&&i.match(/(south|east)/)?a.tips.maxSizeWarning:a.tips.minSizeWarning):(t.helper.removeClass(y+" "+b),window.defaultStatus=""),r&&Math.abs(t.position[d]-g)>=a.liveResizingTolerance&&(g=t.position[d],n(e,t,i))},stop:function(e,t){$("body").enableSelection(),window.defaultStatus="",u.removeClass(f+" "+h),s.isResizing=!1,state.paneResizing=!1,n(e,t,i,!0)}})}));var n=function(e,t,n,i){var a,o=t.position,r=_c[n],s=options[n],l=state[n];switch(n){case"north":a=o.top;break;case"west":a=o.left;break;case"south":a=sC.layoutHeight-o.top-s.spacing_open;break;case"east":a=sC.layoutWidth-o.left-s.spacing_open}var c=a-sC.inset[r.side];if(i)!1!==_runCallbacks("ondrag_end",n)&&manualSizePane(n,c,!1,!0),hideMasks(!0),l.isSliding&&showMasks(n,{resizing:!0});else{if(Math.abs(c-l.size)<s.liveResizingTolerance)return;manualSizePane(n,c,!1,!0),sizeMasks()}}},sizeMask=function(){var e=$(this),t=e.data("layoutMask"),n=state[t];"IFRAME"==n.tagName&&n.isVisible&&e.css({top:n.offsetTop,left:n.offsetLeft,width:n.outerWidth,height:n.outerHeight})},sizeMasks=function(){$Ms.each(sizeMask)},showMasks=function(e,t){var n,i,a=_c[e],o=["center"],r=options.zIndexes,s=$.extend({objectsOnly:!1,animation:!1,resizing:!0,sliding:state[e].isSliding},t);s.resizing&&o.push(e),s.sliding&&o.push(_c.oppositeEdge[e]),"horz"===a.dir&&(o.push("west"),o.push("east")),$.each(o,(function(e,t){i=state[t],n=options[t],i.isVisible&&(n.maskObjects||!s.objectsOnly&&n.maskContents)&&getMasks(t).each((function(){sizeMask.call(this),this.style.zIndex=i.isSliding?r.pane_sliding+1:r.pane_normal+1,this.style.display="block"}))}))},hideMasks=function(e){if(e||!state.paneResizing)$Ms.hide();else if(!e&&!$.isEmptyObject(state.panesSliding))for(var t,n,i=$Ms.length-1;i>=0;i--)t=(n=$Ms.eq(i)).data("layoutMask"),options[t].maskObjects||n.hide()},getMasks=function(e){for(var t,n=$([]),i=0,a=$Ms.length;i<a;i++)(t=$Ms.eq(i)).data("layoutMask")===e&&(n=n.add(t));return n.length?n:createMasks(e)},createMasks=function(e){var t,n,i,a,o,r=$Ps[e],s=state[e],l=options[e],c=options.zIndexes;if(!l.maskContents&&!l.maskObjects)return $([]);for(o=0;o<(l.maskObjects?2:1);o++)t=l.maskObjects&&0==o,n=document.createElement(t?"iframe":"div"),i=$(n).data("layoutMask",e),n.className="ui-layout-mask ui-layout-mask-"+e,(a=n.style).background="#FFF",a.position="absolute",a.display="block",t?(n.src="about:blank",n.frameborder=0,a.border=0,a.opacity=0,a.filter="Alpha(Opacity='0')"):(a.opacity=.001,a.filter="Alpha(Opacity='1')"),"IFRAME"==s.tagName?(a.zIndex=c.pane_normal+1,$N.append(n)):(i.addClass("ui-layout-mask-inside-pane"),a.zIndex=l.maskZindex||c.content_mask,a.top=0,a.left=0,a.width="100%",a.height="100%",r.append(n)),$Ms=$Ms.add(n);return $Ms},destroy=function(e,t){$(window).unbind("."+sID),$(document).unbind("."+sID),"object"===_typeof(e)?evtPane(e):t=e,$N.clearQueue().removeData("layout").removeData("layoutContainer").removeClass(options.containerClass).unbind("."+sID),$Ms.remove(),$.each(_c.allPanes,(function(e,n){removePane(n,!1,!0,t)}));var n="layoutCSS";for(var i in $N.data(n)&&!$N.data("layoutRole")&&$N.css($N.data(n)).removeData(n),"BODY"===sC.tagName&&($N=$("html")).data(n)&&$N.css($N.data(n)).removeData(n),runPluginCallbacks(Instance,$.layout.onDestroy),unload(),Instance)i.match(/^(container|options)$/)||delete Instance[i];return Instance.destroyed=!0,Instance},removePane=function(e,t,n,i){if(isInitialized()){var a=evtPane.call(this,e),o=$Ps[a],r=$Cs[a],s=$Rs[a],l=$Ts[a];o&&$.isEmptyObject(o.data())&&(o=!1),r&&$.isEmptyObject(r.data())&&(r=!1),s&&$.isEmptyObject(s.data())&&(s=!1),l&&$.isEmptyObject(l.data())&&(l=!1),o&&o.stop(!0,!0);var c=options[a],d=(state[a],"layoutCSS"),u=children[a],p=$.isPlainObject(u)&&!$.isEmptyObject(u),g=void 0!==i?i:c.destroyChildren;if(p&&g&&($.each(u,(function(e,t){t.destroyed||t.destroy(!0),t.destroyed&&delete u[e]})),$.isEmptyObject(u)&&(u=children[a]=null,p=!1)),o&&t&&!p)o.remove();else if(o&&o[0]){var f=c.paneClass,h=f+"-"+a,m=[f,f+"-open",f+"-closed",f+"-sliding",h,h+"-open",h+"-closed",h+"-sliding"];$.merge(m,getHoverClasses(o,!0)),o.removeClass(m.join(" ")).removeData("parentLayout").removeData("layoutPane").removeData("layoutRole").removeData("layoutEdge").removeData("autoHidden").unbind("."+sID),p&&r?(r.width(r.width()),$.each(u,(function(e,t){t.resizeAll()}))):r&&r.css(r.data(d)).removeData(d).removeData("layoutRole"),o.data("layout")||o.css(o.data(d)).removeData(d)}l&&l.remove(),s&&s.remove(),Instance[a]=$Ps[a]=$Cs[a]=$Rs[a]=$Ts[a]=!1,{removed:!0},n||resizeAll()}},_hidePane=function(e){var t=$Ps[e],n=options[e],i=t[0].style;n.useOffscreenClose?(t.data(_c.offscreenReset)||t.data(_c.offscreenReset,{left:i.left,right:i.right}),t.css(_c.offscreenCSS)):t.hide().removeData(_c.offscreenReset)},_showPane=function(e){var t=$Ps[e],n=options[e],i=_c.offscreenCSS,a=t.data(_c.offscreenReset),o=t[0].style;t.show().removeData(_c.offscreenReset),n.useOffscreenClose&&a&&(o.left==i.left&&(o.left=a.left),o.right==i.right&&(o.right=a.right))},hide=function(e,t){if(isInitialized()){var n=evtPane.call(this,e),i=options[n],a=state[n],o=$Ps[n],r=$Rs[n];"center"!==n&&o&&!a.isHidden&&(state.initialized&&!1===_runCallbacks("onhide_start",n)||(a.isSliding=!1,delete state.panesSliding[n],r&&r.hide(),!state.initialized||a.isClosed?(a.isClosed=!0,a.isHidden=!0,a.isVisible=!1,state.initialized||_hidePane(n),sizeMidPanes("horz"===_c[n].dir?"":"center"),(state.initialized||i.triggerEventsOnLoad)&&_runCallbacks("onhide_end",n)):(a.isHiding=!0,close(n,!1,t))))}},show=function(e,t,n,i){if(isInitialized()){var a=evtPane.call(this,e),o=(options[a],state[a]),r=$Ps[a];$Rs[a];"center"!==a&&r&&o.isHidden&&!1!==_runCallbacks("onshow_start",a)&&(o.isShowing=!0,o.isSliding=!1,delete state.panesSliding[a],!1===t?close(a,!0):open(a,!1,n,i))}},toggle=function(e,t){if(isInitialized()){var n=evtObj(e),i=evtPane.call(this,e),a=state[i];n&&n.stopImmediatePropagation(),a.isHidden?show(i):a.isClosed?open(i,!!t):close(i)}},_closePane=function(e,t){$Ps[e];var n=state[e];_hidePane(e),n.isClosed=!0,n.isVisible=!1,t&&setAsClosed(e)},close=function(e,t,n,i){var a=evtPane.call(this,e);if("center"!==a)if(state.initialized||!$Ps[a]){if(isInitialized()){var o,r,s,l=$Ps[a],c=($Rs[a],$Ts[a],options[a]),d=state[a];_c[a];$N.queue((function(e){if(!l||!c.closable&&!d.isShowing&&!d.isHiding||!t&&d.isClosed&&!d.isShowing)return e();var i=!d.isShowing&&!1===_runCallbacks("onclose_start",a);if(r=d.isShowing,s=d.isHiding,d.isSliding,delete d.isShowing,delete d.isHiding,i)return e();o=!n&&!d.isClosed&&"none"!=c.fxName_close,d.isMoving=!0,d.isClosed=!0,d.isVisible=!1,s?d.isHidden=!0:r&&(d.isHidden=!1),d.isSliding?bindStopSlidingEvents(a,!1):sizeMidPanes("horz"===_c[a].dir?"":"center",!1),setAsClosed(a),o?(lockPaneForFX(a,!0),l.hide(c.fxName_close,c.fxSettings_close,c.fxSpeed_close,(function(){lockPaneForFX(a,!1),d.isClosed&&u(),e()}))):(_hidePane(a),u(),e())}))}}else _closePane(a,!0);function u(){d.isMoving=!1,bindStartSlidingEvents(a,!0);var e=_c.oppositeEdge[a];state[e].noRoom&&(setSizeLimits(e),makePaneFit(e)),i||!state.initialized&&!c.triggerEventsOnLoad||(r||_runCallbacks("onclose_end",a),r&&_runCallbacks("onshow_end",a),s&&_runCallbacks("onhide_end",a))}},setAsClosed=function(e){if($Rs[e]){$Ps[e];var t=$Rs[e],n=$Ts[e],i=options[e],a=state[e],o=_c[e].side,r=i.resizerClass,s=i.togglerClass,l="-"+e;t.css(o,sC.inset[o]).removeClass(r+"-open "+r+l+"-open").removeClass(r+"-sliding "+r+l+"-sliding").addClass(r+"-closed "+r+l+"-closed"),a.isHidden&&t.hide(),i.resizable&&$.layout.plugins.draggable&&t.draggable("disable").removeClass("ui-state-disabled").css("cursor","default").attr("title",""),n&&(n.removeClass(s+"-open "+s+l+"-open").addClass(s+"-closed "+s+l+"-closed").attr("title",i.tips.Open),n.children(".content-open").hide(),n.children(".content-closed").css("display","block")),syncPinBtns(e,!1),state.initialized&&sizeHandles()}},open=function(e,t,n,i){if(isInitialized()){var a,o,r=evtPane.call(this,e),s=$Ps[r],l=($Rs[r],$Ts[r],options[r]),c=state[r];_c[r];"center"!==r&&$N.queue((function(e){if(!s||!l.resizable&&!l.closable&&!c.isShowing||c.isVisible&&!c.isSliding)return e();if(c.isHidden&&!c.isShowing)return e(),void show(r,!0);c.autoResize&&c.size!=l.size?sizePane(r,l.size,!0,!0,!0):setSizeLimits(r,t);var u=_runCallbacks("onopen_start",r);return"abort"===u?e():("NC"!==u&&setSizeLimits(r,t),c.minSize>c.maxSize?(syncPinBtns(r,!1),!i&&l.tips.noRoomToOpen&&alert(l.tips.noRoomToOpen),e()):(t?bindStopSlidingEvents(r,!0):c.isSliding?bindStopSlidingEvents(r,!1):l.slidable&&bindStartSlidingEvents(r,!1),c.noRoom=!1,makePaneFit(r),o=c.isShowing,delete c.isShowing,a=!n&&c.isClosed&&"none"!=l.fxName_open,c.isMoving=!0,c.isVisible=!0,c.isClosed=!1,o&&(c.isHidden=!1),void(a?(lockPaneForFX(r,!0),s.show(l.fxName_open,l.fxSettings_open,l.fxSpeed_open,(function(){lockPaneForFX(r,!1),c.isVisible&&d(),e()}))):(_showPane(r),d(),e()))))}))}function d(){c.isMoving=!1,_fixIframe(r),c.isSliding||sizeMidPanes("vert"==_c[r].dir?"center":"",!1),setAsOpen(r)}},setAsOpen=function(e,t){var n=$Ps[e],i=$Rs[e],a=$Ts[e],o=options[e],r=state[e],s=_c[e].side,l=o.resizerClass,c=o.togglerClass,d="-"+e;i.css(s,sC.inset[s]+getPaneSize(e)).removeClass(l+"-closed "+l+d+"-closed").addClass(l+"-open "+l+d+"-open"),r.isSliding?i.addClass(l+"-sliding "+l+d+"-sliding"):i.removeClass(l+"-sliding "+l+d+"-sliding"),removeHover(0,i),o.resizable&&$.layout.plugins.draggable?i.draggable("enable").css("cursor",o.resizerCursor).attr("title",o.tips.Resize):r.isSliding||i.css("cursor","default"),a&&(a.removeClass(c+"-closed "+c+d+"-closed").addClass(c+"-open "+c+d+"-open").attr("title",o.tips.Close),removeHover(0,a),a.children(".content-closed").hide(),a.children(".content-open").css("display","block")),syncPinBtns(e,!r.isSliding),$.extend(r,elDims(n)),state.initialized&&(sizeHandles(),sizeContent(e,!0)),!t&&(state.initialized||o.triggerEventsOnLoad)&&n.is(":visible")&&(_runCallbacks("onopen_end",e),r.isShowing&&_runCallbacks("onshow_end",e),state.initialized&&_runCallbacks("onresize_end",e))},slideOpen=function(e){if(isInitialized()){var t=evtObj(e),n=evtPane.call(this,e),i=state[n],a=options[n].slideDelay_open;"center"!==n&&(t&&t.stopImmediatePropagation(),i.isClosed&&t&&"mouseenter"===t.type&&a>0?timer.set(n+"_openSlider",o,a):o())}function o(){i.isClosed?i.isMoving||open(n,!0):bindStopSlidingEvents(n,!0)}},slideClose=function(e){if(isInitialized()){var t=evtObj(e),n=evtPane.call(this,e),i=options[n],a=state[n],o=a.isMoving?1e3:300;if("center"!==n&&!a.isClosed&&!a.isResizing)if("click"===i.slideTrigger_close)r();else{if(i.preventQuickSlideClose&&a.isMoving)return;if(i.preventPrematureSlideClose&&t&&$.layout.isMouseOverElem(t,$Ps[n]))return;t?timer.set(n+"_closeSlider",r,max(i.slideDelay_close,o)):r()}}function r(){a.isClosed?bindStopSlidingEvents(n,!1):a.isMoving||close(n)}},slideToggle=function(e){var t=evtPane.call(this,e);toggle(t,!0)},lockPaneForFX=function(e,t){var n=$Ps[e],i=state[e],a=options[e],o=options.zIndexes;t?(showMasks(e,{animation:!0,objectsOnly:!0}),n.css({zIndex:o.pane_animate}),"south"==e?n.css({top:sC.inset.top+sC.innerHeight-n.outerHeight()}):"east"==e&&n.css({left:sC.inset.left+sC.innerWidth-n.outerWidth()})):(hideMasks(),n.css({zIndex:i.isSliding?o.pane_sliding:o.pane_normal}),"south"==e?n.css({top:"auto"}):"east"!=e||n.css("left").match(/\-99999/)||n.css({left:"auto"}),browser.msie&&a.fxOpacityFix&&"slide"!=a.fxName_open&&n.css("filter")&&1==n.css("opacity")&&n[0].style.removeAttribute("filter"))},bindStartSlidingEvents=function(e,t){var n=options[e],i=($Ps[e],$Rs[e]),a=n.slideTrigger_open.toLowerCase();!i||t&&!n.slidable||(a.match(/mouseover/)?a=n.slideTrigger_open="mouseenter":a.match(/(click|dblclick|mouseenter)/)||(a=n.slideTrigger_open="click"),n.resizerDblClickToggle&&a.match(/click/)&&i[t?"unbind":"bind"]("dblclick."+sID,toggle),i[t?"bind":"unbind"](a+"."+sID,slideOpen).css("cursor",t?n.sliderCursor:"default").attr("title",t?n.tips.Slide:""))},bindStopSlidingEvents=function(e,t){var n=options[e],i=state[e],a=(_c[e],options.zIndexes),o=n.slideTrigger_close.toLowerCase(),r=t?"bind":"unbind",s=$Ps[e],l=$Rs[e];function c(t){timer.clear(e+"_closeSlider"),t.stopPropagation()}timer.clear(e+"_closeSlider"),t?(i.isSliding=!0,state.panesSliding[e]=!0,bindStartSlidingEvents(e,!1)):(i.isSliding=!1,delete state.panesSliding[e]),s.css("zIndex",t?a.pane_sliding:a.pane_normal),l.css("zIndex",t?a.pane_sliding+2:a.resizer_normal),o.match(/(click|mouseleave)/)||(o=n.slideTrigger_close="mouseleave"),l[r](o,slideClose),"mouseleave"===o&&(s[r]("mouseleave."+sID,slideClose),l[r]("mouseenter."+sID,c),s[r]("mouseenter."+sID,c)),t?"click"!==o||n.resizable||(l.css("cursor",t?n.sliderCursor:"default"),l.attr("title",t?n.tips.Close:"")):timer.clear(e+"_closeSlider")},makePaneFit=function(e,t,n,i){var a=options[e],o=state[e],r=_c[e],s=$Ps[e],l=$Rs[e],c="vert"===r.dir,d=!1;if(("center"===e||c&&o.noVerticalRoom)&&((d=o.maxHeight>=0)&&o.noRoom?(_showPane(e),l&&l.show(),o.isVisible=!0,o.noRoom=!1,c&&(o.noVerticalRoom=!1),_fixIframe(e)):d||o.noRoom||(_hidePane(e),l&&l.hide(),o.isVisible=!1,o.noRoom=!0)),"center"===e);else if(o.minSize<=o.maxSize){if(d=!0,o.size>o.maxSize)sizePane(e,o.maxSize,n,!0,i);else if(o.size<o.minSize)sizePane(e,o.minSize,n,!0,i);else if(l&&o.isVisible&&s.is(":visible")){var u=o.size+sC.inset[r.side];$.layout.cssNum(l,r.side)!=u&&l.css(r.side,u)}o.noRoom&&(o.wasOpen&&a.closable?a.autoReopen?open(e,!1,!0,!0):o.noRoom=!1:show(e,o.wasOpen,!0,!0))}else o.noRoom||(o.noRoom=!0,o.wasOpen=!o.isClosed&&!o.isSliding,o.isClosed||(a.closable?close(e,!0,!0):hide(e,!0)))},manualSizePane=function(e,t,n,i,a){if(isInitialized()){var o=evtPane.call(this,e),r=options[o],s=state[o],l=a||r.livePaneResizing&&!s.isResizing;"center"!==o&&(s.autoResize=!1,sizePane(o,t,n,i,l))}},sizePane=function(e,t,n,i,a){if(isInitialized()){var o,r,s=evtPane.call(this,e),l=options[s],c=state[s],d=$Ps[s],u=$Rs[s],p=_c[s].side,g=_c[s].sizeType.toLowerCase(),f=c.isResizing&&!l.triggerEventsDuringLiveResize,h=!0!==i&&l.animatePaneSizing;"center"!==s&&$N.queue((function(e){if(setSizeLimits(s),o=c.size,t=_parseSize(s,t),t=max(t,_parseSize(s,l.minSize)),(t=min(t,c.maxSize))<c.minSize)return e(),void makePaneFit(s,!1,n);if(!a&&t===o)return e();if(c.newSize=t,!n&&state.initialized&&c.isVisible&&_runCallbacks("onresize_start",s),r=cssSize(s,t),h&&d.is(":visible")){var i=$.layout.effects.size[s]||$.layout.effects.size.all,u=l.fxSettings_size.easing||i.easing,p=options.zIndexes,f={};f[g]=r+"px",c.isMoving=!0,d.css({zIndex:p.pane_animate}).show().animate(f,l.fxSpeed_size,u,(function(){d.css({zIndex:c.isSliding?p.pane_sliding:p.pane_normal}),c.isMoving=!1,delete c.newSize,m(),e()}))}else d.css(g,r),delete c.newSize,d.is(":visible")?m():c.size=t,e()}))}function m(){for(var e="width"===g?d.outerWidth():d.outerHeight(),i=[{pane:s,count:1,target:t,actual:e,correct:t===e,attempt:t,cssSize:r}],l=i[0],h={},m="Inaccurate size after resizing the "+s+"-pane.";!(l.correct||(h={pane:s,count:l.count+1,target:t},l.actual>t?h.attempt=max(0,l.attempt-(l.actual-t)):h.attempt=max(0,l.attempt+(t-l.actual)),h.cssSize=cssSize(s,h.attempt),d.css(g,h.cssSize),h.actual="width"==g?d.outerWidth():d.outerHeight(),h.correct=t===h.actual,1===i.length&&(_log(m,!1,!0),_log(l,!1,!0)),_log(h,!1,!0),i.length>3));)i.push(h),l=i[i.length-1];c.size=t,$.extend(c,elDims(d)),c.isVisible&&d.is(":visible")&&(u&&u.css(p,t+sC.inset[p]),sizeContent(s)),!n&&!f&&state.initialized&&c.isVisible&&_runCallbacks("onresize_end",s),n||(c.isSliding||sizeMidPanes("horz"==_c[s].dir?"":"center",f,a),sizeHandles());var v=_c.oppositeEdge[s];t<o&&state[v].noRoom&&(setSizeLimits(v),makePaneFit(v,!1,n)),i.length>1&&_log(m+"\nSee the Error Console for details.",!0,!0)}},sizeMidPanes=function e(t,n,i){t=(t||"east,west,center").split(","),$.each(t,(function(t,a){if($Ps[a]){var o=options[a],r=state[a],s=$Ps[a],l=($Rs[a],!0),c={},d=$.layout.showInvisibly(s),u=calcNewCenterPaneDims();if($.extend(r,elDims(s)),"center"===a){if(!i&&r.isVisible&&u.width===r.outerWidth&&u.height===r.outerHeight)return s.css(d),!0;if($.extend(r,cssMinDims(a),{maxWidth:u.width,maxHeight:u.height}),c=u,r.newWidth=c.width,r.newHeight=c.height,c.width=cssW(s,c.width),c.height=cssH(s,c.height),l=c.width>=0&&c.height>=0,!state.initialized&&o.minWidth>u.width){var p=o.minWidth-r.outerWidth,g=options.east.minSize||0,f=options.west.minSize||0,h=state.east.size,m=state.west.size,v=h,y=m;if(p>0&&state.east.isVisible&&h>g&&(p-=h-(v=max(h-g,h-p))),p>0&&state.west.isVisible&&m>f&&(p-=m-(y=max(m-f,m-p))),0===p)return h&&h!=g&&sizePane("east",v,!0,!0,i),m&&m!=f&&sizePane("west",y,!0,!0,i),e("center",n,i),void s.css(d)}}else{if(r.isVisible&&!r.noVerticalRoom&&$.extend(r,elDims(s),cssMinDims(a)),!i&&!r.noVerticalRoom&&u.height===r.outerHeight)return s.css(d),!0;c.top=u.top,c.bottom=u.bottom,r.newSize=u.height,c.height=cssH(s,u.height),r.maxHeight=c.height,(l=r.maxHeight>=0)||(r.noVerticalRoom=!0)}if(l?(!n&&state.initialized&&_runCallbacks("onresize_start",a),s.css(c),"center"!==a&&sizeHandles(a),!r.noRoom||r.isClosed||r.isHidden||makePaneFit(a),r.isVisible&&($.extend(r,elDims(s)),state.initialized&&sizeContent(a))):!r.noRoom&&r.isVisible&&makePaneFit(a),s.css(d),delete r.newSize,delete r.newWidth,delete r.newHeight,!r.isVisible)return!0;if("center"===a){var b=browser.isIE6||!browser.boxModel;$Ps.north&&(b||"IFRAME"==state.north.tagName)&&$Ps.north.css("width",cssW($Ps.north,sC.innerWidth)),$Ps.south&&(b||"IFRAME"==state.south.tagName)&&$Ps.south.css("width",cssW($Ps.south,sC.innerWidth))}!n&&state.initialized&&_runCallbacks("onresize_end",a)}}))},resizeAll=function(e){var t=sC.innerWidth,n=sC.innerHeight;if(evtPane(e),$N.is(":visible"))if(state.initialized){if(!0===e&&$.isPlainObject(options.outset)&&$N.css(options.outset),$.extend(sC,elDims($N,options.inset)),sC.outerHeight){if(!0===e&&setPanePosition(),!1===_runCallbacks("onresizeall_start"))return!1;var i,a;sC.innerHeight,sC.innerWidth;$.each(["south","north","east","west"],(function(e,t){if($Ps[t]){i=options[t],a=state[t];var n=!1,o=$(window).width();null!==i&&"undefined"!==i&&i.responsive.enabled&&(o>=i.responsiveSizes.lg&&(n="lg"!==i.responsive.when&&"md"!==i.responsive.when&&"sm"!==i.responsive.when&&"xs"!==i.responsive.when),o>=i.responsive.sizes.md&&o<i.responsive.sizes.lg&&(n="md"!==i.responsive.when&&"sm"!==i.responsive.when&&"xs"!==i.responsive.when),o>=i.responsive.sizes.sm&&o<i.responsive.sizes.md&&(n="sm"!==i.responsive.when&&"xs"!==i.responsive.when),o>=i.responsive.sizes.xs&&o<i.responsive.sizes.sm&&(n="xs"!==i.responsive.when)),a.autoResize&&a.size!==i.size?(n&&a.isVisible?(i.closable?close(t,!0,!i.responsiveAnimate):hide(t,!i.responsiveAnimate),a.responded=!0):a.responded&&(i.closable?open(t,!1,!i.responsiveAnimate):show(t,!0,!i.responsiveAnimate),a.responded=!1),sizePane(t,i.size,!0,!0,!0)):(setSizeLimits(t),n?(i.closable?close(t,!0,!i.responsiveAnimate):hide(t,!i.responsiveAnimate),a.responded=!0):a.responded&&(i.closable?open(t,!1,!i.responsiveAnimate):show(t,!0,!i.responsiveAnimate),a.responded=!1),makePaneFit(t,!1,!0,!0))}})),sizeMidPanes("",!0,!0),sizeHandles(),$.each(_c.allPanes,(function(e,t){$Ps[t]&&state[t].isVisible&&_runCallbacks("onresize_end",t)})),_runCallbacks("onresizeall_end")}}else _initLayoutElements()},resizeChildren=function(e,t){var n=evtPane.call(this,e);if(options[n].resizeChildren){t||refreshChildren(n);var i=children[n];$.isPlainObject(i)&&$.each(i,(function(e,t){t.destroyed||t.resizeAll()}))}},sizeContent=function(e,t){if(isInitialized()){var n=evtPane.call(this,e);n=n?n.split(","):_c.allPanes,$.each(n,(function(e,n){var i=$Ps[n],a=$Cs[n],o=options[n],r=state[n],s=r.content;if(!i||!a||!i.is(":visible"))return!0;if((a.length||(initContent(n,!1),a))&&!1!==_runCallbacks("onsizecontent_start",n)){(!r.isMoving&&!r.isResizing||o.liveContentResizing||t||null==s.top)&&(d(),s.hiddenFooters>0&&"hidden"===i.css("overflow")&&(i.css("overflow","visible"),d(),i.css("overflow","hidden")));var l=r.innerHeight-(s.spaceAbove-r.css.paddingTop)-(s.spaceBelow-r.css.paddingBottom);a.is(":visible")&&s.height==l||(setOuterHeight(a,l,!0),s.height=l),state.initialized&&_runCallbacks("onsizecontent_end",n)}function c(e){return max(r.css.paddingBottom,parseInt(e.css("marginBottom"),10)||0)}function d(){var e=options[n].contentIgnoreSelector,t=a.nextAll().not(".ui-layout-mask").not(e||":lt(0)"),i=t.filter(":visible"),o=i.filter(":last");(s={top:a[0].offsetTop,height:a.outerHeight(),numFooters:t.length,hiddenFooters:t.length-i.length,spaceBelow:0}).spaceAbove=s.top,s.bottom=s.top+s.height,o.length?s.spaceBelow=o[0].offsetTop+o.outerHeight()-s.bottom+c(o):s.spaceBelow=c(a)}}))}},sizeHandles=function(e){var t=evtPane.call(this,e);t=t?t.split(","):_c.borderPanes,$.each(t,(function(e,t){var n,i=options[t],a=state[t],o=$Ps[t],r=$Rs[t],s=$Ts[t];if(o&&r){var l,c,d,u=_c[t].dir,p=a.isClosed?"_closed":"_open",g=i["spacing"+p],f=i["togglerAlign"+p],h=i["togglerLength"+p];if(0!==g){if(a.noRoom||a.isHidden||r.show(),"horz"===u?(l=sC.innerWidth,a.resizerLength=l,c=$.layout.cssNum(o,"left"),r.css({width:cssW(r,l),height:cssH(r,g),left:c>-9999?c:sC.inset.left})):(l=o.outerHeight(),a.resizerLength=l,r.css({height:cssH(r,l),width:cssW(r,g),top:sC.inset.top+getPaneSize("north",!0)})),removeHover(i,r),s){if(0===h||a.isSliding&&i.hideTogglerOnSlide)return void s.hide();if(s.show(),!(h>0)||"100%"===h||h>l)h=l,d=0;else if(isStr(f))switch(f){case"top":case"left":d=0;break;case"bottom":case"right":d=l-h;break;case"middle":case"center":default:d=round((l-h)/2)}else{var m=parseInt(f,10);d=f>=0?m:l-h+m}if("horz"===u){var v=cssW(s,h);s.css({width:v,height:cssH(s,g),left:d,top:0}),s.children(".content").each((function(){(n=$(this)).css("marginLeft",round((v-n.outerWidth())/2))}))}else{var y=cssH(s,h);s.css({height:y,width:cssW(s,g),top:d,left:0}),s.children(".content").each((function(){(n=$(this)).css("marginTop",round((y-n.outerHeight())/2))}))}removeHover(0,s)}state.initialized||!i.initHidden&&!a.isHidden||(r.hide(),s&&s.hide())}else r.hide()}}))},enableClosable=function(e){if(isInitialized()){var t=evtPane.call(this,e),n=$Ts[t],i=options[t];n&&(i.closable=!0,n.on("click."+sID,(function(e){e.stopPropagation(),toggle(t)})).css("visibility","visible").css("cursor","pointer").attr("title",state[t].isClosed?i.tips.Open:i.tips.Close).show())}},disableClosable=function(e,t){if(isInitialized()){var n=evtPane.call(this,e),i=$Ts[n];i&&(options[n].closable=!1,state[n].isClosed&&open(n,!1,!0),i.unbind("."+sID).css("visibility",t?"hidden":"visible").css("cursor","default").attr("title",""))}},enableSlidable=function(e){if(isInitialized()){var t=evtPane.call(this,e),n=$Rs[t];n&&n.data("draggable")&&(options[t].slidable=!0,state[t].isClosed&&bindStartSlidingEvents(t,!0))}},disableSlidable=function(e){if(isInitialized()){var t=evtPane.call(this,e),n=$Rs[t];n&&(options[t].slidable=!1,state[t].isSliding?close(t,!1,!0):(bindStartSlidingEvents(t,!1),n.css("cursor","default").attr("title",""),removeHover(null,n[0])))}},enableResizable=function(e){if(isInitialized()){var t=evtPane.call(this,e),n=$Rs[t],i=options[t];n&&n.data("draggable")&&(i.resizable=!0,n.draggable("enable"),state[t].isClosed||n.css("cursor",i.resizerCursor).attr("title",i.tips.Resize))}},disableResizable=function(e){if(isInitialized()){var t=evtPane.call(this,e),n=$Rs[t];n&&n.data("draggable")&&(options[t].resizable=!1,n.draggable("disable").css("cursor","default").attr("title",""),removeHover(null,n[0]))}},swapPanes=function(e,t){if(isInitialized()){var n=evtPane.call(this,e);if(state[n].edge=t,state[t].edge=n,!1===_runCallbacks("onswap_start",n)||!1===_runCallbacks("onswap_start",t))return state[n].edge=n,void(state[t].edge=t);var i=r(n),a=r(t),o={};return o[n]=i?i.state.size:0,o[t]=a?a.state.size:0,$Ps[n]=!1,$Ps[t]=!1,state[n]={},state[t]={},$Ts[n]&&$Ts[n].remove(),$Ts[t]&&$Ts[t].remove(),$Rs[n]&&$Rs[n].remove(),$Rs[t]&&$Rs[t].remove(),$Rs[n]=$Rs[t]=$Ts[n]=$Ts[t]=!1,s(i,t),s(a,n),i=a=o=null,$Ps[n]&&$Ps[n].css(_c.visible),$Ps[t]&&$Ps[t].css(_c.visible),resizeAll(),_runCallbacks("onswap_end",n),void _runCallbacks("onswap_end",t)}function r(e){var t=$Ps[e],n=$Cs[e];return!!t&&{pane:e,P:!!t&&t[0],C:!!n&&n[0],state:$.extend(!0,{},state[e]),options:$.extend(!0,{},options[e])}}function s(e,t){if(e){var n,i,a=e.P,r=e.C,s=e.pane,l=_c[t],c=$.extend(!0,{},state[t]),d=options[t],u={resizerCursor:d.resizerCursor};$.each("fxName,fxSpeed,fxSettings".split(","),(function(e,t){u[t+"_open"]=d[t+"_open"],u[t+"_close"]=d[t+"_close"],u[t+"_size"]=d[t+"_size"]})),$Ps[t]=$(a).data({layoutPane:Instance[t],layoutEdge:t}).css(_c.hidden).css(l.cssReq),$Cs[t]=!!r&&$(r),options[t]=$.extend(!0,{},e.options,u),state[t]=$.extend(!0,{},e.state),n=new RegExp(d.paneClass+"-"+s,"g"),a.className=a.className.replace(n,d.paneClass+"-"+t),initHandles(t),l.dir!=_c[s].dir?(i=o[t]||0,setSizeLimits(t),i=max(i,state[t].minSize),manualSizePane(t,i,!0,!0)):$Rs[t].css(l.side,sC.inset[l.side]+(state[t].isVisible?getPaneSize(t):0)),e.state.isVisible&&!c.isVisible?setAsOpen(t,!0):(setAsClosed(t),bindStartSlidingEvents(t,!0)),e=null}}},syncPinBtns=function(e,t){$.layout.plugins.buttons&&$.each(state[e].pins,(function(n,i){$.layout.buttons.setPinState(Instance,$(i),e,t)}))};function keyDown(e){if(!e)return!0;var t=e.keyCode;if(t<33)return!0;var n,i,a,o,r={38:"north",40:"south",37:"west",39:"east"},s=(e.altKey,e.shiftKey),l=e.ctrlKey;return l&&t>=37&&t<=40&&options[r[t]].enableCursorHotkey?o=r[t]:(l||s)&&$.each(_c.borderPanes,(function(e,r){if(n=options[r],i=n.customHotkey,a=n.customHotkeyModifier,(s&&"SHIFT"==a||l&&"CTRL"==a||l&&s)&&i&&t===(isNaN(i)||i<=9?i.toUpperCase().charCodeAt(0):i))return o=r,!1})),!(o&&$Ps[o]&&options[o].closable&&!state[o].isHidden)||(toggle(o),e.stopPropagation(),e.returnValue=!1,!1)}function allowOverflow(e){var t;if(isInitialized()&&(this&&this.tagName&&(e=this),isStr(e)?t=$Ps[e]:$(e).data("layoutRole")?t=$(e):$(e).parents().each((function(){if($(this).data("layoutRole"))return t=$(this),!1})),t&&t.length)){var n=t.data("layoutEdge"),i=state[n];if(i.cssSaved&&resetOverflow(n),i.isSliding||i.isResizing||i.isClosed)i.cssSaved=!1;else{var a={zIndex:options.zIndexes.resizer_normal+1},o={},r=t.css("overflow"),s=t.css("overflowX"),l=t.css("overflowY");"visible"!=r&&(o.overflow=r,a.overflow="visible"),s&&!s.match(/(visible|auto)/)&&(o.overflowX=s,a.overflowX="visible"),l&&!l.match(/(visible|auto)/)&&(o.overflowY=s,a.overflowY="visible"),i.cssSaved=o,t.css(a),$.each(_c.allPanes,(function(e,t){t!=n&&resetOverflow(t)}))}}}function resetOverflow(e){var t;if(isInitialized()&&(this&&this.tagName&&(e=this),isStr(e)?t=$Ps[e]:$(e).data("layoutRole")?t=$(e):$(e).parents().each((function(){if($(this).data("layoutRole"))return t=$(this),!1})),t&&t.length)){var n=t.data("layoutEdge"),i=state[n],a=i.cssSaved||{};i.isSliding||i.isResizing||t.css("zIndex",options.zIndexes.pane_normal),t.css(a),i.cssSaved=!1}}var $N=$(this).eq(0);if(!$N.length)return _log(options.errors.containerMissing);if($N.data("layoutContainer")&&$N.data("layout"))return $N.data("layout");var $Ps={},$Cs={},$Rs={},$Ts={},$Ms=$([]),sC=state.container,sID=state.id,Instance={options:options,state:state,container:$N,panes:$Ps,contents:$Cs,resizers:$Rs,togglers:$Ts,hide:hide,show:show,toggle:toggle,open:open,close:close,slideOpen:slideOpen,slideClose:slideClose,slideToggle:slideToggle,setSizeLimits:setSizeLimits,_sizePane:sizePane,sizePane:manualSizePane,sizeContent:sizeContent,swapPanes:swapPanes,showMasks:showMasks,hideMasks:hideMasks,initContent:initContent,addPane:addPane,removePane:removePane,createChildren:createChildren,refreshChildren:refreshChildren,enableClosable:enableClosable,disableClosable:disableClosable,enableSlidable:enableSlidable,disableSlidable:disableSlidable,enableResizable:enableResizable,disableResizable:disableResizable,allowOverflow:allowOverflow,resetOverflow:resetOverflow,destroy:destroy,initPanes:isInitialized,resizeAll:resizeAll,runCallbacks:_runCallbacks,hasParentLayout:!1,children:children,north:!1,south:!1,west:!1,east:!1,center:!1};return"cancel"===_create()?null:Instance}}(jQuery),jQuery.cookie=function(e,t,n){if(void 0===t){var i=null;if(document.cookie&&""!=document.cookie)for(var a=document.cookie.split(";"),o=0;o<a.length;o++){var r=jQuery.trim(a[o]);if(r.substring(0,e.length+1)==e+"="){i=decodeURIComponent(r.substring(e.length+1));break}}return i}n=n||{},null===t&&(t="",n.expires=-1);var s,l="";n.expires&&("number"==typeof n.expires||n.expires.toUTCString)&&("number"==typeof n.expires?(s=new Date).setTime(s.getTime()+24*n.expires*60*60*1e3):s=n.expires,l="; expires="+s.toUTCString());var c=n.path?"; path="+n.path:"",d=n.domain?"; domain="+n.domain:"",u=n.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),l,c,d,u].join("")},function(e){e.layout&&(e.ui||(e.ui={}),e.ui.cookie={acceptsCookies:!!navigator.cookieEnabled,read:function(t){var n,i,a,o=document.cookie,r=o?o.split(";"):[];for(a=0;n=r[a];a++)if((i=e.trim(n).split("="))[0]==t)return decodeURIComponent(i[1]);return null},write:function(t,n,i){var a="",o="",r=!1,s=i||{},l=s.expires||null,c=e.type(l);"date"===c?o=l:"string"===c&&l>0&&(l=parseInt(l,10),c="number"),"number"===c&&(o=new Date,l>0?o.setDate(o.getDate()+l):(o.setFullYear(1970),r=!0)),o&&(a+=";expires="+o.toUTCString()),s.path&&(a+=";path="+s.path),s.domain&&(a+=";domain="+s.domain),s.secure&&(a+=";secure"),document.cookie=t+"="+(r?"":encodeURIComponent(n))+a},clear:function(t){e.ui.cookie.write(t,"",{expires:-1})}},e.cookie||(e.cookie=function(t,n,i){var a=e.ui.cookie;if(null===n)a.clear(t);else{if(void 0===n)return a.read(t);a.write(t,n,i)}}),e.layout.plugins.stateManagement=!0,e.layout.defaults.stateManagement={enabled:!1,autoSave:!0,autoLoad:!0,animateLoad:!0,includeChildren:!0,stateKeys:"north.size,south.size,east.size,west.size,north.isClosed,south.isClosed,east.isClosed,west.isClosed,north.isHidden,south.isHidden,east.isHidden,west.isHidden",cookie:{name:"",domain:"",path:"",expires:"",secure:!1}},e.layout.optionsMap.layout.push("stateManagement"),e.layout.config.optionRootKeys.push("stateManagement"),e.layout.state={saveCookie:function(t,n,i){var a=t.options,o=a.stateManagement,r=e.extend(!0,{},o.cookie,i||null),s=t.state.stateData=t.readState(n||o.stateKeys);return e.ui.cookie.write(r.name||a.name||"Layout",e.layout.state.encodeJSON(s),r),e.extend(!0,{},s)},deleteCookie:function(t){var n=t.options;e.ui.cookie.clear(n.stateManagement.cookie.name||n.name||"Layout")},readCookie:function(t){var n=t.options,i=e.ui.cookie.read(n.stateManagement.cookie.name||n.name||"Layout");return i?e.layout.state.decodeJSON(i):{}},loadCookie:function(t){var n=e.layout.state.readCookie(t);return n&&!e.isEmptyObject(n)&&(t.state.stateData=e.extend(!0,{},n),t.loadState(n)),n},loadState:function(t,n,i){if(e.isPlainObject(n)&&!e.isEmptyObject(n)){n=t.state.stateData=e.layout.transformData(n);var a=t.options.stateManagement;if(i=e.extend({animateLoad:!1,includeChildren:a.includeChildren},i),t.state.initialized){var o,r,s,l,c,d,u=!i.animateLoad;if(e.each(e.layout.config.borderPanes,(function(i,a){if(p=n[a],e.isPlainObject(p)){var c=p.size;o=p.initClosed,r=p.initHidden;var d=p.autoResize;s=t.state[a],l=s.isVisible,d&&(s.autoResize=d),l||t._sizePane(a,c,!1,!1,!1),!0===r?t.hide(a,u):!0===o?t.close(a,!1,u):!1===o?t.open(a,!1,u):!1===r&&t.show(a,!1,u),l&&t._sizePane(a,c,!1,!1,u)}})),i.includeChildren)e.each(t.children,(function(t,i){(c=n[t]?n[t].children:0)&&i&&e.each(i,(function(e,t){d=c[e],t&&d&&t.loadState(d)}))}))}else{var p=e.extend(!0,{},n);e.each(e.layout.config.allPanes,(function(e,t){p[t]&&delete p[t].children})),e.extend(!0,t.options,p)}}},readState:function(t,n){"string"===e.type(n)&&(n={keys:n}),n||(n={});var i,a,o,r,s,l,c,d=t.options.stateManagement,u=n.includeChildren,p=void 0!==u?u:d.includeChildren,g=n.stateKeys||d.stateKeys,f={isClosed:"initClosed",isHidden:"initHidden"},h=t.state,m=e.layout.config.allPanes,v={};e.isArray(g)&&(g=g.join(","));for(var y=0,b=(g=g.replace(/__/g,".").split(",")).length;y<b;y++)a=(i=g[y].split("."))[0],o=i[1],e.inArray(a,m)<0||null!=(r=h[a][o])&&("isClosed"==o&&h[a].isSliding&&(r=!0),(v[a]||(v[a]={}))[f[o]?f[o]:o]=r);return p&&e.each(m,(function(n,i){l=t.children[i],s=h.stateData[i],e.isPlainObject(l)&&!e.isEmptyObject(l)&&((c=v[i]||(v[i]={})).children||(c.children={}),e.each(l,(function(t,n){n.state.initialized?c.children[t]=e.layout.state.readState(n):s&&s.children&&s.children[t]&&(c.children[t]=e.extend(!0,{},s.children[t]))})))})),v},encodeJSON:function(t){return((window.JSON||{}).stringify||function(t){var n,i,a,o=[],r=0,s=e.isArray(t);for(n in t)i=t[n],"string"==(a=_typeof(i))?i='"'+i+'"':"object"==a&&(i=parse(i)),o[r++]=(s?"":'"'+n+'":')+i;return(s?"[":"{")+o.join(",")+(s?"]":"}")})(t)},decodeJSON:function(t){try{return e.parseJSON?e.parseJSON(t):window.eval("("+t+")")||{}}catch(e){return{}}},_create:function(t){var n=e.layout.state,i=t.options.stateManagement;if(e.extend(t,{readCookie:function(){return n.readCookie(t)},deleteCookie:function(){n.deleteCookie(t)},saveCookie:function(e,i){return n.saveCookie(t,e,i)},loadCookie:function(){return n.loadCookie(t)},loadState:function(e,i){n.loadState(t,e,i)},readState:function(e){return n.readState(t,e)},encodeJSON:n.encodeJSON,decodeJSON:n.decodeJSON}),t.state.stateData={},i.autoLoad)if(e.isPlainObject(i.autoLoad))e.isEmptyObject(i.autoLoad)||t.loadState(i.autoLoad);else if(i.enabled)if(e.isFunction(i.autoLoad)){var a={};try{a=i.autoLoad(t,t.state,t.options,t.options.name||"")}catch(e){}a&&e.isPlainObject(a)&&!e.isEmptyObject(a)&&t.loadState(a)}else t.loadCookie()},_unload:function(t){var n=t.options.stateManagement;if(n.enabled&&n.autoSave)if(e.isFunction(n.autoSave))try{n.autoSave(t,t.state,t.options,t.options.name||"")}catch(e){}else t.saveCookie()}},e.layout.onCreate.push(e.layout.state._create),e.layout.onUnload.push(e.layout.state._unload))}(jQuery),function(e){e.layout&&(e.layout.plugins.buttons=!0,e.layout.defaults.autoBindCustomButtons=!1,e.layout.optionsMap.layout.push("autoBindCustomButtons"),e.layout.buttons={config:{borderPanes:"north,south,west,east"},init:function(t){var n,i=t.options.name||"";e.each("toggle,open,close,pin,toggle-slide,open-slide".split(","),(function(a,o){e.each(e.layout.buttons.config.borderPanes.split(","),(function(a,r){e(".ui-layout-button-"+o+"-"+r).each((function(){null!=(n=e(this).data("layoutName")||e(this).attr("layoutName"))&&n!==i||t.onButton(this,o,r)}))}))}))},get:function(t,n,i,a){var o=e(n),r=t.options;if(o.length&&e.layout.buttons.config.borderPanes.indexOf(i)>=0){var s=r[i].buttonClass+"-"+a;o.addClass(s+" "+s+"-"+i).data("layoutName",r.name)}return o},bind:function(t,n,i,a){var o=e.layout.buttons;switch(i.toLowerCase()){case"toggle":o.addToggle(t,n,a);break;case"open":o.addOpen(t,n,a);break;case"close":o.addClose(t,n,a);break;case"pin":o.addPin(t,n,a);break;case"toggle-slide":o.addToggle(t,n,a,!0);break;case"open-slide":o.addOpen(t,n,a,!0)}return t},addToggle:function(t,n,i,a){return e.layout.buttons.get(t,n,i,"toggle").click((function(e){t.toggle(i,!!a),e.stopPropagation()})),t},addOpen:function(t,n,i,a){return e.layout.buttons.get(t,n,i,"open").attr("title",t.options[i].tips.Open).click((function(e){t.open(i,!!a),e.stopPropagation()})),t},addClose:function(t,n,i){return e.layout.buttons.get(t,n,i,"close").attr("title",t.options[i].tips.Close).click((function(e){t.close(i),e.stopPropagation()})),t},addPin:function(t,n,i){var a=e.layout.buttons.get(t,n,i,"pin");if(a.length){var o=t.state[i];a.click((function(n){e.layout.buttons.setPinState(t,e(this),i,o.isSliding||o.isClosed),o.isSliding||o.isClosed?t.open(i):t.close(i),n.stopPropagation()})),e.layout.buttons.setPinState(t,a,i,!o.isClosed&&!o.isSliding),o.pins.push(n)}return t},setPinState:function(e,t,n,i){var a=t.attr("pin");if(!a||i!==("down"==a)){var o=e.options[n],r=o.tips,s=o.buttonClass+"-pin",l=s+"-"+n,c=s+"-up "+l+"-up",d=s+"-down "+l+"-down";t.attr("pin",i?"down":"up").attr("title",i?r.Unpin:r.Pin).removeClass(i?c:d).addClass(i?d:c)}},syncPinBtns:function(t,n,i){e.each(state[n].pins,(function(a,o){e.layout.buttons.setPinState(t,e(o),n,i)}))},_load:function(t){e.extend(t,{bindButton:function(n,i,a){return e.layout.buttons.on(t,n,i,a)},addToggleBtn:function(n,i,a){return e.layout.buttons.addToggle(t,n,i,a)},addOpenBtn:function(n,i,a){return e.layout.buttons.addOpen(t,n,i,a)},addCloseBtn:function(n,i){return e.layout.buttons.addClose(t,n,i)},addPinBtn:function(n,i){return e.layout.buttons.addPin(t,n,i)}});for(var n=0;n<4;n++){var i=e.layout.buttons.config.borderPanes[n];t.state[i].pins=[]}t.options.autoBindCustomButtons&&e.layout.buttons.init(t)},_unload:function(e){}},e.layout.onLoad.push(e.layout.buttons._load))}(jQuery),function(e){e.layout.plugins.browserZoom=!0,e.layout.defaults.browserZoomCheckInterval=1e3,e.layout.optionsMap.layout.push("browserZoomCheckInterval"),e.layout.browserZoom={_init:function(t){!1!==e.layout.browserZoom.ratio()&&e.layout.browserZoom._setTimer(t)},_setTimer:function(t){if(!t.destroyed){var n=t.options,i=t.state,a=t.hasParentLayout?5e3:Math.max(n.browserZoomCheckInterval,100);setTimeout((function(){if(!t.destroyed&&n.resizeWithWindow){var a=e.layout.browserZoom.ratio();a!==i.browserZoom&&(i.browserZoom=a,t.resizeAll()),e.layout.browserZoom._setTimer(t)}}),a)}},ratio:function(){var t,n,i,a=window,o=screen,r=document,s=r.documentElement||r.body,l=e.layout.browser,c=l.version;return!(!l.msie||c>8)&&(o.deviceXDPI&&o.systemXDPI?d(o.deviceXDPI,o.systemXDPI):l.webkit&&(t=r.body.getBoundingClientRect)?d(t.left-t.right,r.body.offsetWidth):l.webkit&&(n=a.outerWidth)?d(n,a.innerWidth):!(!(n=o.width)||!(i=s.clientWidth))&&d(n,i));function d(e,t){return(parseInt(e,10)/parseInt(t,10)*100).toFixed()}}},e.layout.onReady.push(e.layout.browserZoom._init)}(jQuery),function(e){e.effects&&(e.layout.defaults.panes.useOffscreenClose=!1,e.layout.plugins&&(e.layout.plugins.effects.slideOffscreen=!0),e.layout.effects.slideOffscreen=e.extend(!0,{},e.layout.effects.slide),e.effects.slideOffscreen=function(t){return this.queue((function(){var n=e.effects,i=t.options,a=e(this),o=a.data("layoutEdge"),r=a.data("parentLayout").state,s=r[o].size,l=this.style,c="show"==n.setMode(a,i.mode||"show"),d=i.direction||"left",u="up"==d||"down"==d?"top":"left",p="up"==d||"left"==d,g=e.layout.config.offscreenCSS||{},f=e.layout.config.offscreenReset,h="offscreenResetTop",m={};m[u]=(c?p?"+=":"-=":p?"-=":"+=")+s,c?(a.data(h,{top:l.top,bottom:l.bottom}),p?a.css(u,isNaN(s)?"-"+s:-s):"right"===d?a.css({left:r.container.layoutWidth,right:"auto"}):a.css({top:r.container.layoutHeight,bottom:"auto"}),"top"===u&&a.css(a.data(f)||{})):(a.data(h,{top:l.top,bottom:l.bottom}),a.data(f,{left:l.left,right:l.right})),a.show().animate(m,{queue:!1,duration:t.duration,easing:i.easing,complete:function(){a.data(h)&&a.css(a.data(h)).removeData(h),c?a.css(a.data(f)||{}).removeData(f):a.css(g),t.callback&&t.callback.apply(this,arguments),a.dequeue()}})}))})}(jQuery),function(e){var t=e.layout;t.callbacks||(t.callbacks={}),t.callbacks.resizePaneAccordions=function(t,n){(n.jquery?n:e(n.newPanel||n.panel)).find(".ui-accordion:visible").each((function(){var t=e(this);t.data("accordion")&&t.accordion("resize"),t.data("ui-accordion")&&t.accordion("refresh")}))}}(jQuery),function(e){e.layout.callbacks.resizeDataTables=function(t,n){var i=n.jquery?n[0]:n.panel;e(i).is(":visible")&&e(e.fn.dataTable.fnTables(!0)).each((function(t,n){e.contains(i,n)&&e(n).dataTable().fnAdjustColumnSizing()}))}}(jQuery),function(e){var t=e.layout;t.callbacks||(t.callbacks={}),t.callbacks.resizeTabLayout=function(t,n){(n.jquery?n:e(n.newPanel||n.panel)).filter(":visible").find(".ui-layout-container:visible").addBack().each((function(){var t=e(this).data("layout");t&&(t.options.resizeWithWindow=!1,t.resizeAll())}))}}(jQuery)},,,function(e,t,n){"use strict";var i=n(1);n(339),e.exports=function(e){var t,n=e.writer,a=n.getUniqueId("tree_"),o={currentlySelectedNodes:[],selectionType:null,NODE_SELECTED:0,CONTENTS_SELECTED:1,tagFilter:["head","heading"]},r=!1,s=!1,l=!1,c=!0;function d(e){var a=void 0,o=[];i(e).parentsUntil("#tinymce").each((function(e,t){t.getAttribute("_tag")===n.schemaManager.getHeader()&&(a=t.id),o.push(t.id)})),o.reverse();for(var r=0;r<o.length;r++){var s=o[r],l=i('[name="'+s+'"]',t);t.jstree("is_open",l)||t.jstree("open_node",l,null,!1)}return a}function u(e,t,a,s){var l=e.attr("name");if(h(),a||(-1!==o.currentlySelectedNodes.indexOf(l)?o.currentlySelectedNodes=[l]:o.currentlySelectedNodes=[]),l){var c=e.children("a");if((-1===o.currentlySelectedNodes.indexOf(l)||s)&&o.currentlySelectedNodes.push(l),t?(c.addClass("contentsSelected").removeClass("nodeSelected"),o.selectionType=o.CONTENTS_SELECTED):(c.addClass("nodeSelected").removeClass("contentsSelected"),o.selectionType=o.NODE_SELECTED),!s){var d=i("#"+l,n.editor.getBody());"true"===d.attr("_entity")||d.attr("_tag")!==n.schemaManager.getHeader()?(r=!0,n.utilities.selectElementById(o.currentlySelectedNodes,t)):n.dialogManager.show("header")}}}function p(e,t){var i=null,a=e.attr("_tag");if(null==a)return null;if(!1===n.isReadOnly&&e.attr("_entity")){if(void 0===(r=e.attr("name")))return console.warn("structureTree: no id for",a),null;i={text:a,li_attr:{name:r},state:{opened:t<3},level:t}}else if(!1===n.isReadOnly||n.isReadOnly&&(a===n.schemaManager.getRoot()||-1!==o.tagFilter.indexOf(a.toLowerCase()))){var r;if(void 0===(r=e.attr("id")))return console.warn("structureTree: no id for",a),null;n.isReadOnly&&a!==n.schemaManager.getRoot()&&(a=n.utilities.getTitleFromContent(e.text())),i={text:a,li_attr:{name:r},state:{opened:t<3},level:t}}if("cwrcEntry"===n.schemaManager.schemaId){var s=e.attr("subtype");void 0!==s&&(i.level=parseInt(s))}return i}function g(e,t){if(void 0!==t){i(t.event.currentTarget).removeClass("nodeSelected contentsSelected");var n=t.node.li_attr.name,a=o.currentlySelectedNodes.indexOf(n);-1!==a&&o.currentlySelectedNodes.splice(a,1)}else h(),o.currentlySelectedNodes=[];o.selectionType=null}function f(e,a){var o=e.node,r=t.jstree("get_node",e.parent),s=i("#"+o.li_attr.name,n.editor.getBody()),l=i("#"+r.li_attr.name,n.editor.getBody());if(s.parents(".noteWrapper").length>0&&(s=s.parents(".noteWrapper").first()),a&&(s=s.clone()),0===e.position)l.prepend(s);else{var c=r.children[e.position-1],d=t.jstree("get_node",c);(l=i("#"+d.li_attr.name,n.editor.getBody())).after(s)}t.jstree("open_node",r,null,!1),a&&n.tagger.processNewContent(s[0]),n.editor.undoManager.add(),n.event("contentChanged").publish()}function h(){i("a[class*=Selected]","#"+a).removeClass("nodeSelected contentsSelected")}o.update=function(){if(s&&c){var e=i.jstree.reference("#"+a),r=[];i("#cwrc_tree_root",t).find("li.jstree-open").each((function(){var e=i(this).attr("name");r.push(e)})),o.clear();var d=i('[_tag="'+n.schemaManager.getRoot()+'"]',n.editor.getBody());0===d.length&&(d=i("[_tag]",n.editor.getBody()).first());var u=p(d,0);if(null!=u){if(u.li_attr.id="cwrc_tree_root",function e(t,a,o,r){t.each((function(t,s){var l=i(this),c=a,d=p(l,o);if(d){if(n.isReadOnly&&null!=r){for(;r.level>=d.level;)r=r.parent;null==r.children&&(r.children=[]),d.parent=r,r.children.push(d)}else null==a.children&&(a.children=[]),a.children.push(d),c=a.children[a.children.length-1];r=d}l.attr("_tag")!=n.schemaManager.getHeader()&&e(l.children(),c,o+1,r)}))}(d.children(),u,0,u),n.isReadOnly){!function e(t){delete t.parent,t.children&&t.children.forEach((function(t){e(t)}))}(u)}e.create_node(null,u),i.each(r,(function(n,a){e.open_node(i("li[name="+a+"]",t),null,!1)}))}}else l=!0},o.clear=function(){i.jstree.reference("#"+a).delete_node("#cwrc_tree_root")},o.enable=function(e){c=!0,(e||l)&&(o.update(),l=!1)},o.disable=function(){c=!1},o.destroy=function(){i(document).off("dnd_start.vakata",v),i(document).off("dnd_move.vakata",y),i.jstree.reference("#"+a).destroy()},o.highlightNode=function(e){if(e){var n=e.id;if(n)if(-1===o.currentlySelectedNodes.indexOf(n)){r=!0;var a=i('[name="'+n+'"]',t);if(0===a.length){var s=d(e);a=i(s?'[name="'+s+'"]':'[name="'+n+'"]',t)}t.jstree("deselect_all"),g();t.jstree("select_node",a);r=!1,function(e){if(1===e.length){var n=e.offset().top-t.offset().top+t.scrollTop(),i=n+e.outerHeight(),a=t.innerHeight(),o=.5*a,r=parseInt(t.scrollTop(),10),s=r+a;e.outerHeight()>a||n<r?t.scrollTop(n-o):i>s&&t.scrollTop(i-o)}}(a)}else g()}else g()},o.selectNode=function(e,a){if(e){var o=i('[name="'+e+'"]',t);if(0===o.length){var r=d(i("#"+e,n.editor.getBody()));o=i(r?'[name="'+r+'"]':'[name="'+e+'"]',t)}u(o,a,!1,!0)}},i("#"+e.parentId).append('<div class="moduleParent"><div id="'+a+'" class="moduleContent"></div></div>'),t=i("#"+a);var m=["wholerow","conditionalselect"];function v(e,t){t.helper.addClass("cwrc"),n.layoutManager.isFullScreen()&&i.vakata.dnd.stop(e),t.helper.appendTo(n.layoutManager.getContainer())}function y(e,t){var a=i("#jstree-marker");a.parent()!==n.layoutManager.getContainer()&&a.appendTo(n.layoutManager.getContainer())}return!0!==n.isReadOnly&&m.push("dnd"),t.jstree({plugins:m,core:{worker:!1,check_callback:function(e,t,i,a,o){return!n.editor.readonly||"move_node"!==e&&"copy_node"!==e},animation:!1,themes:{icons:!1,url:!1,responsive:!1},data:{text:"Tags",li_attr:{id:"cwrc_tree_root"},state:{opened:!0}}},multiple:!0,conditionalselect:function(e,t,n){if((tinymce.isMac?n.metaKey:n.ctrlKey)||n.shiftKey){var a=e.jstree("get_selected");if(0==a.length)return!0;var o=a[0];return o==t.id||1==i("#"+o).siblings("#"+t.id).length}return!0}.bind(this,t),dnd:{large_drag_target:!0,large_drop_target:!0}}),t.on("contextmenu",(function(e){e.preventDefault(),e.stopImmediatePropagation();var t=i(e.target).parents("li.jstree-node").first();if(1===t.length){var a=o.currentlySelectedNodes,r=t.attr("name");o.highlightNode(i("#"+r,n.editor.getBody())[0]),-1!==a.indexOf(r)&&a.length>1&&(r=a),setTimeout((function(){n.tagMenu.show(e,r,!1)}),0)}})),t.on("select_node.jstree",(function(e,t){if(!r){var n,a=i(t.event.currentTarget);n=!a.hasClass("contentsSelected")&&(a.hasClass("nodeSelected"),!0);var o=(tinymce.isMac?t.event.metaKey:t.event.ctrlKey)||t.event.shiftKey;u(a.parent(),n,o,!1)}})),t.on("deselect_node.jstree",g),i(document).on("dnd_start.vakata",v),i(document).on("dnd_move.vakata",y),t.on("copy_node.jstree",(function(e,t){f(t,!0)})),t.on("move_node.jstree",(function(e,t){f(t,!1)})),t.on("keydown.jstree",(function(e){})),t.on("ready.jstree",(function(e,t){s=!0,l&&(o.update(),l=!1),n.event("structureTreeInitialized").publish(o)})),n.event("loadingDocument").subscribe((function(){o.clear(),o.disable()})),n.event("documentLoaded").subscribe((function(){o.enable(!0)})),n.event("massUpdateStarted").subscribe((function(){o.disable()})),n.event("massUpdateCompleted").subscribe((function(){o.enable(!0)})),n.event("nodeChanged").subscribe((function(e){r||o.highlightNode(e)})),n.event("contentChanged").subscribe((function(){o.update()})),n.event("contentCopied").subscribe((function(){if(o.currentlySelectedNodes.length>0){var e=i("#"+o.currentlySelectedNodes[0],n.editor.getBody()).clone();n.editor.copiedElement.element=e.wrapAll("<div />").parent()[0],n.editor.copiedElement.selectionType=o.selectionType}})),n.event("contentPasted").subscribe((function(){o.update()})),n.event("writerKeydown").subscribe((function(e){if(o.currentlySelectedNodes.length>0){var t=o.currentlySelectedNodes[0];if(8==e.which||46==e.which)tinymce.dom.Event.cancel(e),o.selectionType==o.NODE_SELECTED?n.tagger.removeStructureTag(t,!0):(n.tagger.removeStructureTagContents(t),n.utilities.selectElementById(t,!0));else if(0==e.ctrlKey&&0==e.metaKey&&e.which>=48&&e.which<=90&&o.selectionType==o.NODE_SELECTED){var a=i("#"+t,n.editor.getBody()),r=!0,s=a.nextAll("[_tag]")[0];if(null==s&&null==(s=a.parent().nextAll("[_tag]")[0])&&(r=!1,s=a.prevAll("[_tag]")[0]),n.tagger.removeStructureTag(t,!0),null!=s){var l=n.editor.selection.getRng(!0);l.selectNodeContents(s),l.collapse(r),n.editor.selection.setRng(l)}}}})),n.event("writerKeyup").subscribe((function(e){})),n.event("entityAdded").subscribe((function(e){o.update()})),n.event("entityRemoved").subscribe((function(e){o.update()})),n.event("entityFocused").subscribe((function(e){})),n.event("entityPasted").subscribe((function(e){o.update()})),n.event("tagAdded").subscribe((function(e){o.update()})),n.event("tagEdited").subscribe((function(e){o.update()})),n.event("tagRemoved").subscribe((function(e){o.update()})),n.event("tagContentsRemoved").subscribe((function(e){o.update()})),n.event("tagSelected").subscribe((function(e){r||o.selectNode(e,!1),r=!1})),n.tree=o,o}},,function(e,t,n){"use strict";var i=n(1),a=n(9);n(6),n(20),n(27),e.exports=function(e){var t=e.writer,n=e.parentId,o=t,r=!0,s=!1,l=!1,c=i("#"+n);c.append('<div class="moduleParent entitiesPanel">\n                <div class="moduleHeader">\n                <div>\n                    <button type="button" class="convert">Scrape Candidate Entities</button>\n                    <span style="display: none;">Candidate Entities</span>\n                </div>\n                <div class="convertActions" style="display: none;">\n                    <button type="button" class="accept">Accept All</button>\n                    <button type="button" class="reject">Reject All</button>\n                    <button type="button" class="done">Done</button>\n                </div>\n            </div>\n            <div class="subheader" style="display: none;">\n                <span>Candidate Entities</span>\n            </div>\n            <div class="moduleContent">\n                <ul class="entitiesList"></ul>\n            </div>\n            <div class="moduleFooter" style="display: flex;">\n            <div style="display: inline-block;">\n            <label for="filter" title="Filter" class="fas fa-filter"></label>\n            <select name="filter">\n                <option value="all" selected="selected">All</option>\n                <option value="person">Person</option>\n                <option value="place">Place</option>\n                <option value="date">Date</option>\n                <option value="org">Organization</option>\n                <option value="citation">Citation</option>\n                <option value="note">Note</option>\n                <option value="title">Title</option>\n                <option value="correction">Correction</option>\n                <option value="keyword">Keyword</option>\n                <option value="link">Link</option>\n            </select>\n        </div>\n        <div style="display: inline-block;">\n            <label for="sorting" title="Sorting" class="fas fa-sort"></label>\n            <select name="sorting">\n                <option value="seq" selected="selected">Sequential</option>\n                <option value="alpha">Alphabetical</option>\n                <option value="cat">Categorical</option>\n            </select>\n        </div> \n            </div>\n        </div>'),o.isReadOnly&&c.find(".moduleHeader").hide(),c.find("select").selectmenu({appendTo:o.layoutManager.getContainer(),position:{my:"left bottom",at:"left top",collision:"flipfit"},width:90}),c.find("button.convert").button().click((function(){p.convertEntities()})),c.find("button.accept").button().click((function(){_(),p.update()})),c.find("button.reject").button().click((function(){x(),p.update()})),c.find("button.done").button().click((function(){h().length<=0?C():o.dialogManager.confirm({title:"Warning",msg:"<p>All the remaining entities in the panel will be rejected.</p>\n                <p>Do you wish to proceed?</p>",showConfirmKey:"confirm-reject-candidate-entities",type:"info",callback:function(e){e&&(x(),C())}})}));var d=function(){return c.find('select[name="filter"]').val()},u=function(e){return c.find('select[name="filter"]').val(e).selectmenu("refresh")};c.find('select[name="filter"]').on("selectmenuchange",(function(){return p.update()})),c.find('select[name="sorting"]').on("selectmenuchange",(function(){return p.update()}));var p={};p.update=function(){if(r){f();var e=o.entitiesManager.getEntitiesArray(c.find('select[name="sorting"]').val());e=e.filter((function(e){return"true"!==e.getCustomValue("nerve")}));var t=d();"all"!==t&&(e=e.filter((function(e){return e.getType()===t})));var n="";e.forEach((function(e){return n+=g(e)})),l?c.find("ul.entitiesList").addClass("candidates"):c.find("ul.entitiesList").removeClass("candidates"),c.find("ul.entitiesList").html(n),c.find("ul.entitiesList > li > div").on("click",(function(){i(this).parent().toggleClass("expanded");var e=i(this).parent().data("id");o.entitiesManager.highlightEntity(e,null,!0)})).find(".actions > span").hover((function(){i(this).removeClass("ui-state-default"),i(this).addClass("ui-state-active")}),(function(){i(this).addClass("ui-state-default"),i(this).removeClass("ui-state-active")})).on("click",(function(e){e.stopPropagation();var t=i(this).data("action"),n=i(this).parents("li").data("id");switch(t){case"edit":o.tagger.editTagDialog(n);break;case"accept":v(n),p.update();break;case"reject":y(n),p.update();break;case"remove":o.tagger.removeEntity(n);break;case"acceptmatching":b(n),p.update();break;case"rejectmatching":w(n),p.update()}})),c.find(".actions").tooltip({show:!1,hide:!1,classes:{"ui-tooltip":"cwrc-tooltip"}}),o.entitiesManager.getCurrentEntity()&&c.find('ul.entitiesList > li[data-id="'+o.entitiesManager.getCurrentEntity()+'"]').addClass("expanded").find('div[class="info"]').show()}else s=!0};var g=function(e){var t="true"===e.getAttribute("_candidate"),n="<ul>",i=!1,r=e.getLemma();void 0!==r&&(n+="<li><strong>Standard</strong>: ".concat(r,"</li>"),i=!0);var s=e.getURI();void 0!==s&&(n+='<li><strong>URI</strong>: <a href="'.concat(s,'" target="_blank" rel="noopener">').concat(s,"</a></li>"),i=!0);var c=!1,d=e.getAttributes(),u=o.schemaManager.mapper.getUrlAttributes();for(var p in d)if(!0!==a.reservedAttributes[p]){var g=d[p];if(void 0===g){console.warn("entitiesList: undefined value for "+p+"in ",e);continue}if(-1!==u.indexOf(p)||0===g.indexOf("http")){if(g===s)continue;!c&&i&&(n+="<li><hr /></li>"),n+="<li><strong>".concat(p,'</strong>: <a href="').concat(g,'" target="_blank" rel="noopener">').concat(g,"</a></li>"),c=!0}else{if(g===r)continue;!c&&i&&(n+="<li><hr /></li>"),n+="<li><strong>".concat(p,"</strong>: ").concat(g,"</li>"),c=!0}}var f=e.getCustomValues();for(var h in f){var v=f[h];n+="<li><strong>".concat(h,"</strong>: ").concat(v,"</li>")}n+="</ul>";var y="";!1===o.isReadOnly&&(l&&t?(y='<span data-action="accept" class="ui-state-default" title="Accept"><span class="ui-icon ui-icon-check"/></span><span data-action="reject" class="ui-state-default" title="Reject"><span class="ui-icon ui-icon-close"/></span>',m(e.getId()).length>0&&(y+='<span data-action="acceptmatching" class="ui-state-default" title="Accept All Matching"><span class="ui-icon ui-icon-circle-check"/></span>',y+='<span data-action="rejectmatching" class="ui-state-default" title="Reject All Matching"><span class="ui-icon ui-icon-circle-close"/></span>')):y='<span data-action="edit" class="ui-state-default" title="Edit"><span class="ui-icon ui-icon-pencil"/></span><span data-action="remove" class="ui-state-default" title="Remove"><span class="ui-icon ui-icon-close"/></span>');return'\n        <li class="'.concat(e.getType()," ").concat(t?"candidate":"",'" data-type="').concat(e.getType(),'" data-id="').concat(e.getId(),'">\n            <div>\n                <div class="header">\n                    <span class="icon"/>\n                    <span class="entityTitle">').concat(e.getContent(),'</span>\n                    <div class="actions">').concat(y,'</div>\n                </div>\n                <div class="info">').concat(n,"</div>\n            </div>\n        </li>")};p.enable=function(e){r=!0,(e||s)&&(p.update(),s=!1)},p.disable=function(){return r=!1},p.destroy=function(){c.find("button").button("destroy"),c.find("select").selectmenu("destroy"),c.find(".actions").tooltip("destroy"),c.remove()};var f=function(){return c.find("ul").empty()};p.convertEntities=function(){var e=o.schemaManager.mapper.findEntities(["person","place","date","org","title","link","rs"]),t=[];for(var n in e)t=t.concat(e[n]);if((t=t.filter((function(e,t,n){return n.indexOf(e)===t}))).length<=0)o.dialogManager.show("message",{title:"Entities",msg:"No candidate entities were found.",type:"info"});else{l=!0,c.find(".convertActions").show(),c.find("button.convert").hide().button("option","disabled",!0).next("span").show();var a=o.dialogManager.getDialog("loadingindicator");a.setText("Converting Entities"),a.show(),o.event("massUpdateStarted").publish(),o.utilities.processArray(t,(function(e){var t=o.schemaManager.mapper.convertTagToEntity(e);null!==t&&(t.setAttribute("_candidate","true"),i("#"+t.id,o.editor.getBody()).attr("_candidate","true"))})).then((function(){a.hide(),o.event("contentChanged").publish(),o.event("massUpdateCompleted").publish()}))}};var h=function(){var e=o.entitiesManager.getEntitiesArray();return e=e.filter((function(e){return"true"===e.getAttribute("_candidate")&&"true"!==e.getCustomValue("nerve")}))},m=function(e){var t=[],n=o.entitiesManager.getEntity(e);return o.entitiesManager.eachEntity((function(e,i){i.getId()!==n.getId()&&JSON.stringify(i.getAttributes())===JSON.stringify(n.getAttributes())&&JSON.stringify(i.getCustomValues())===JSON.stringify(n.getCustomValues())&&i.getContent()===n.getContent()&&t.push(i.getId())})),t},v=function(e){var t=o.entitiesManager.getEntity(e);t.removeAttribute("_candidate"),i("#"+t.id,o.editor.getBody()).removeAttr("_candidate")},y=function(e){return o.tagger.removeEntity(e)},b=function(e){var t=m(e);v(e),t.forEach((function(e){return v(e)}))},w=function(e){var t=m(e);y(e),t.forEach((function(e){return y(e)}))},_=function(){var e=d();o.entitiesManager.eachEntity((function(t,n){"true"===n.getAttribute("_candidate")&&"true"!==n.getCustomValue("nerve")&&("all"!==e&&e!==n.getType()||v(n.getId()))})),u("all")},x=function(){o.event("massUpdateStarted").publish();var e=d();o.entitiesManager.eachEntity((function(t,n){"true"===n.getAttribute("_candidate")&&"true"!==n.getCustomValue("nerve")&&("all"!==e&&e!==n.getType()||y(n.getId()))})),u("all"),o.event("massUpdateCompleted").publish()},C=function(){l=!1,c.find(".convertActions").hide(),c.find("button.convert").show().button("option","disabled",!1).next("span").hide(),p.update()};return o.event("loadingDocument").subscribe((function(){f(),C(),p.disable()})),o.event("documentLoaded").subscribe((function(){return p.enable(!0)})),o.event("schemaLoaded").subscribe((function(){return p.update()})),o.event("contentChanged").subscribe((function(){return p.update()})),o.event("contentPasted").subscribe((function(){return p.update()})),o.event("entityAdded").subscribe((function(){return p.update()})),o.event("entityEdited").subscribe((function(){return p.update()})),o.event("entityRemoved").subscribe((function(e){return function(e){return c.find('li[data-id="'+e+'"]').remove()}(e)})),o.event("entityFocused").subscribe((function(e){c.find('ul.entitiesList > li[data-id="'+e+'"]').addClass("expanded")})),o.event("entityUnfocused").subscribe((function(){c.find("ul.entitiesList > li").each((function(e,t){i(this).removeClass("expanded")}))})),o.event("entityPasted").subscribe((function(){return p.update()})),o.event("massUpdateStarted").subscribe((function(){return p.disable()})),o.event("massUpdateCompleted").subscribe((function(){return p.enable(!0)})),o.entitiesList=p,o.event("entitiesListInitialized").publish(p),p}},function(e,t,n){"use strict";var i=n(1);n(6),e.exports=function(e){var t=e.writer,n=e.validationUrl;void 0===n&&console.error("Validation: no validationUrl specified!");var a=t.getUniqueId("validation_");i("#"+e.parentId).append('\n    <div class="moduleParent">\n        <div id="'.concat(a,'" class="moduleContent">\n            <ul class="validationList"></ul>\n        </div>\n        <div id="').concat(a,'_buttons" class="moduleFooter">\n            <button type="button" role="validate">Validate</button>\n            <button type="button" role="clear">Clear</button>\n        </div>\n    </div>\n    ')),t.event("documentLoaded").subscribe((function(){o.clearResult()})),t.event("validationRequested").subscribe((function(){var e=i("#"+a+" > ul");e.empty(),e.append('<li class="ui-state-default"><span class="loading"></span> Validating...</li>'),t.layoutManager.showModule("validation"),o.validate()})),t.event("documentValidated").subscribe((function(e,t,n){i("#"+a+"_indicator").hide(),o.showValidationResult(t,n)}));var o={validate:function(){t.converter.getDocumentContent(!1,(function(e){var a=t.schemaManager.getXMLUrl();i.ajax({url:n,type:"POST",dataType:"xml",data:{sch:a,type:"RNG_XML",content:e},success:function(n,a,o){var r="pass"==i("status",n).text();t.event("documentValidated").publish(r,n,e)},error:function(){t.dialogManager.show("message",{title:"Error",msg:"An error occurred while trying to validate the document.",type:"error"}),t.event("documentValidated").publish(null,"","")}})}))},showValidationResult:function(e,n){var o=i("#"+a+" > ul");o.empty(),n=n.split("\n")[1],"pass"==i("status",e).text()&&o.append('<li class="ui-state-default"><span class="ui-icon ui-icon-check" style="float: left; margin-right: 4px;"></span>Your document is valid!</li>'),t.tagger.removeNoteWrappersForEntities(),i("warning",e).each((function(e,a){var r=null,s=a.nodeName,l=i(this).find("message").text(),c=i(this).find("path").text(),d=i(this).find("elementId").text(),u=parseInt(i(this).find("column").text());if(""!=d&&(r=d),null==r&&""!=c){for(var p="",g=c.split("/"),f=0;f<g.length;f++){var h;if(null!=(b=(h=g[f]).match(/^\w+(?=\[)?/)))null===(e=h.match(/\[(\d+)\]/))?e=0:(e=parseInt(e[1]),e--),p+='*[_tag="'+b[0]+'"]:eq('+e+") > "}p=p.substr(0,p.length-3),r=i(p,t.editor.getBody()).attr("id")}if(null==r&&!isNaN(u)&&null!=(g=n.substring(0,u).match(/<.*?>/g)))if(null==(r=(h=g[g.length-1]).match(/id="(.*?)"/i)))if(-1!=l.search("text not allowed here")){var m=0;for(f=g.length-1;f>-1;f--)if(-1!=(h=g[f]).search("/")?m++:m--,-1==m){var v=h.match(/id="(.*?)"/i);null!=v&&v[1]&&(r=v[1]);break}}else{var y=h.match(/<\/(.*)>/);if(null!=y){var b=y[1];for(f=g.length-1;f>-1;f--){var w=(h=g[f]).match(/<(.*?)\s/);if(null!=w&&w[1]==b){r=h.match(/id="(.*?)"/i)[1];break}}}}else r=r[1];if(null!=r){var _,x=l.indexOf(";"),C='<li class="'+("warning"==s?"ui-state-error":"ui-state-highlight")+'"><span class="ui-icon '+("warning"==s?"ui-icon-alert":"ui-icon-info")+'" style="float: left; margin-right: 4px;"></span>Path: '+c+"<br/>Message: "+(_=-1!=x?[l.slice(0,x+1),l.slice(x+2)]:[l])[0];void 0!==_[1]&&(C+=' <span class="message_more">more...</span><span style="display: none;">'+_[1]+"</span>"),C+="</li>";var k=o.append(C).find("li:last");k.find('[class="message_more"]').click((function(){i(this).next("span").show(),i(this).hide()})),k.data("id",r)}else console.warn("validation: couldn't find element for "+c)})),t.tagger.addNoteWrappersForEntities(),o.find("li").click((function(){o.find("li").removeClass("selected"),i(this).addClass("selected");var e=i(this).data("id");t.utilities.selectElementById(e)})),t.layoutManager.showModule("validation")},clearResult:function(){i("#"+a+"_indicator").hide(),i("#"+a+" > ul").empty()}},r=i("#"+a+"_buttons button[role=validate]").button();r.click((function(){o.validate()}));var s=i("#"+a+"_buttons button[role=clear]").button();return s.click((function(){o.clearResult()})),o.destroy=function(){r.button("destroy"),s.button("destroy")},t.validation=o,o}},function(e,t,n){"use strict";var i=n(1);n(6),n(187),e.exports=function(e){var t=e.writer,n=e.parentId;i("#"+n).append('<div class="moduleParent"><ul class="moduleContent relationsList"></ul><div class="moduleFooter"><button type="button" role="add">Add Relation</button><button type="button" role="remove">Remove Relation</button></div></div>');var a=i("#"+n),o=a.find(".moduleFooter button[role=add]").button();o.click((function(){t.dialogManager.show("triple")}));var r=a.find(".moduleFooter button[role=remove]").button();r.click((function(){var e=a.find("ul li.selected");if(1==e.length){var n=e.data("index");t.triples.splice(n,1),s.update()}else t.dialogManager.show("message",{title:"No Relation Selected",msg:"You must first select a relation to remove.",type:"error"})})),i.contextMenu({selector:"#"+n+" ul li",zIndex:10,appendTo:"#"+t.containerId,className:"cwrc",items:{remove:{name:"Remove Relation",icon:"tag_remove",callback:function(e,n){var i=n.$trigger.data("index");t.triples.splice(i,1),s.update()}}}}),t.event("loadingDocument").subscribe((function(){s.clear()})),t.event("documentLoaded").subscribe((function(){s.update()})),t.event("schemaLoaded").subscribe((function(){s.update()}));var s={currentlySelectedNode:null,update:function(){s.clear();for(var e="",n=0;n<t.triples.length;n++){var o=t.triples[n];e+="<li>"+o.subject.text+" "+o.predicate.text+" "+o.object.text+"</li>"}a.find("ul").html(e),a.find("ul li").each((function(e,t){i(this).data("index",e)})).click((function(){i(this).addClass("selected").siblings().removeClass("selected")}))},clear:function(){a.find("ul").empty()},destroy:function(){o.button("destroy"),r.button("destroy"),i("#"+n+"_contextMenu").remove()}};return t.relations=s,s}},function(e,t,n){"use strict";var i=n(1),a=n(344);n(179),e.exports=function(e){var t=e.writer,n=t.getUniqueId("selection_"),o=!0,r=(new Date).getTime(),s=!1;i("#"+e.parentId).append('\n    <div class="moduleParent">\n        <div id="'.concat(n,'" class="moduleContent"></div>\n        <div id="').concat(n,'" class="moduleFooter">\n            <label>Include RDF <input type="checkbox" name="includeRdf" /></label>\n        </div>\n        <div id="').concat(n,'_selectionContents" style="display: none;"></div>\n    </div>\n    '));var l=i("#"+n),c=i("#"+n+"_selectionContents"),d=i("#"+n+' [name="includeRdf"]').checkboxradio();d.on("click",(function(e){p(!0)})),t.event("loadingDocument").subscribe((function(){f()})),t.event("selectionChanged").subscribe((function(){t.editor.selection.isCollapsed()?s||p(!0):p()})),t.event("contentChanged").subscribe((function(){p(!0)})),t.event("nodeChanged").subscribe((function(){s||p()})),t.event("tagSelected").subscribe((function(){p()})),t.event("tagAdded").subscribe((function(){p(!0)})),t.event("tagEdited").subscribe((function(){p(!0)})),t.event("tagRemoved").subscribe((function(){p(!0)})),t.event("massUpdateStarted").subscribe((function(){u.disable()})),t.event("massUpdateCompleted").subscribe((function(){u.enable(!0)}));var u={},p=function(e){if(o){var n=(new Date).getTime()-r;if(l.is(":visible")&&n>250)if(r=(new Date).getTime(),e||t.editor.selection.isCollapsed()){s=!0;var i=d.prop("checked");t.converter.getDocumentContent(i,g)}else{s=!1;var a=t.editor.selection.getRng(!0).cloneContents();c.html(a);var u=t.converter.buildXMLString(c);g(u)}}},g=function(e){var n=t.utilities.escapeHTMLString(e);n.length>5e5&&(n=n.substring(0,5e5)),l.html('<pre style="width:100%;height:100%;padding:0;margin:0;border:none !important;"><code class="language-markup" style="white-space: pre-wrap;">'+n+"</code></pre>"),a.highlightElement(i("code",l)[0])},f=function(){l.html("")};return u.enable=function(e){o=!0,e&&p(!0)},u.disable=function(){o=!1},u.showSelection=function(){t.layoutManager.showModule("selection"),p(!0)},u.destroy=function(){},t.selection=u,u}},,function(e,t,n){"use strict";var i=n(1);n(7);var a=n(346);e.exports=function(e){var t,n=e.writer,o=e.parentId+"_imageViewer",r=e.tag||"pb",s=e.attribute||"facs";i("#"+e.parentId).append('<div id="'+o+'" class="imageViewer"><div class="toolbar"><div class="navigation"><span id="'+o+'_prev" class="button prev" /><span id="'+o+'_next" class="button next" /><span class="pageInfo"><input type="text" class="currPage" /> / <span class="totalPages" /></span></div><div class="zoom"><span id="'+o+'_zoomIn" class="button zoomIn" /><span id="'+o+'_zoomOut" class="button zoomOut" /><span id="'+o+'_home" class="button home" /></div></div><div id="'+o+'_osd" class="image"></div></div>'),i("#"+e.parentId).css("overflow","hidden");var l,c=i("#"+o),d=-1,u=!1;n.event("loadingDocument").subscribe((function(){g.reset()}));var p=function e(){var t=i(n.editor.getDoc()).find("#schemaRules")[0];null==t?setTimeout(e,50):t.sheet.insertRule('*[_tag="'+r+'"] { display: block; }',0)};n.event("documentLoaded").subscribe((function(e,t){e&&(f(t,!0),setTimeout(p,50))})),n.event("contentChanged").subscribe((function(){f(n.editor.getDoc(),!1)})),n.event("writerInitialized").subscribe((function(){i(n.editor.getDoc()).scroll(m)}));var g={};function f(e,a){if(v(""),0===(l=i(e).find("*[_tag="+r+"]")).length)v("Provide page breaks ("+r+") with "+s+" attributes \n pointing to image URLs in order to \n display the corresponding images/scans \n for pages in this doument."),n.layoutManager.hideModule("imageViewer");else{var o=[];l.each((function(e,t){var n=i(t).attr(s);void 0===n||""===n||o.push({type:"image",url:n})}));var u=a||o.length!==t.tileSources.length;if(!u)for(var p=0;p<o.length;p++)if(o[p].url!==t.tileSources[p].url){u=!0;break}u&&(t.open(o),0===o.length?n.layoutManager.hideModule("imageViewer"):n.layoutManager.showModule("imageViewer"),c.find(".totalPages").html(l.length),d=-1,m())}}function h(e,t){if(e>=0&&e<l.length&&(d=e,c.find(".currPage").val(d+1),!u&&t)){u=!0;var n=l.get(d);0===d&&i(n).show(),n.scrollIntoView(),0===d&&i(n).hide()}}function m(){if(!u){var e=i("iframe",n.editor.getContainer()).height(),a=n.editor.getDoc().scrollingElement.scrollTop,o=a+e,r=-1;l.each((function(e,t){var n=i(t).offset().top;if(n>=a&&n<o)return r=e,!1})),u=!0,t.goToPage(r)}u=!1}function v(e){t.drawer.clear(),t._showMessage(e)}return g.reset=function(){l=null,d=-1,t.drawer.clear(),t.close(),t.tileSources=[]},g.destroy=function(){t.destroy(),t=null},c.find(".image img").on("load",(function(){var e,t,n,i,a,o,r,s;n=c.parent(),i=n.width(),a=n.height()-30,o=c.find(".image img"),r=o.width(),(s=o.height()/r)>=1&&(s>a/i?t=(e=a)/s:e=(t=i)*s),o.css("height",e).css("width",t).css("display","block")})),c.find(".currPage").keyup((function(e){if(13==e.keyCode){var t=parseInt(i(this).val());isNaN(t)||h(t-1,!0)}})),(t=a({id:o+"_osd",sequenceMode:!0,autoHideControls:!1,showFullPageControl:!1,previousButton:o+"_prev",nextButton:o+"_next",zoomInButton:o+"_zoomIn",zoomOutButton:o+"_zoomOut",homeButton:o+"_home"})).addHandler("open-failed",(function(e){var t=e.message;!0===e.source.url&&(t="No URI found for @"+s+"."),v(t)})),t.addHandler("reset-size",(function(e){0==e.contentFactor&&v("No URI found for @"+s+".")})),t.addHandler("page",(function(e){h(e.page,!0)})),g}},,function(e,t,n){"use strict";var i=n(5);function a(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}var o=n(1);n(6),n(20),n(27);var r=n(2),s={PERSON:"person",LOCATION:"place",ORGANIZATION:"org",TITLE:"title"};var l=function(e,t,n,i){var a=e.initialConfig.entityLookupDialogs;"org"===n&&(n="organization"),a.popSearch[n]({query:t,parentEl:e.dialogManager.getDialogWrapper(),success:function(e){o.isArray(e.name)&&(e.name=e.name[0]),i.call(a,e)},error:function(e){}})};function c(e,t){var n=e,i=!1,a=o('<div class="annotationDialog"><div><select data-transform="selectmenu" data-type="select" data-mapping="prop.type"><option value="person">Person</option><option value="place">Place</option><option value="org">Organization</option><option value="title">Title</option></select></div><div><label>Standard name:</label><input type="text" data-type="textbox" data-mapping="prop.lemma" /></div><div><label>URI:</label><input type="text" data-type="textbox" data-mapping="prop.uri" style="margin-right: 5px;" /><button type="button" title="Entity lookup" data-action="lookup"></button></div></div>').appendTo(t),s=new r({writer:n,$el:a,type:"person",title:"Edit Entity",width:350,height:300});return a.find("button[data-action=lookup]").button({icon:"ui-icon-search"}).on("click",(function(){var e=s.showConfig.entry,t=a.find("select").val(),i=e.content.trim().replace(/\s+/g," ");l(n,i,t,(function(e){a.find('input[data-mapping="prop.lemma"]').val(e.name),a.find('input[data-mapping="prop.uri"]').val(e.uri)}))})),s.$el.on("beforeShow",(function(){i=!1})),s.$el.on("beforeSave",(function(e,t){if(i)t.isValid=!0;else{var a=t.currentData.properties.uri;""!==a&&0!==a.search(/^https?:\/\//)?(t.isValid=!1,n.dialogManager.confirm({title:"Warning",msg:"<p>The URI you've entered does not look valid.</p><p>Are you sure you want to use it?</p>",showConfirmKey:"confirm-nerve-uri",type:"info",callback:function(e){setTimeout((function(){e&&(i=!0,t.save())}))}})):t.isValid=!0}if(t.isValid){var o=n.schemaManager,r=t.currentData.properties.type,s=o.mapper.getParentTag(r);t.currentData.properties.tag=s;var l=n.entitiesManager.getEntity(t.currentId).getType();if(r!==l){var c=o.mapper.getRequiredAttributes(l);for(var d in c)delete t.currentData.attributes[d]}var u=o.mapper.getAttributeForProperty(r,"lemma");u&&(t.currentData.attributes[u]=t.currentData.properties.lemma);var p=o.mapper.getAttributeForProperty(r,"uri");p&&(t.currentData.attributes[p]=t.currentData.properties.uri),t.currentData.customValues.edited="true"}})),s}function d(e,t){var n=e,i=[],a=null,r=o('<div class="annotationDialog"><div class="selections"><h3>Selections</h3><ul></ul></div><div><div class="lemma"><label>Standard name:</label><select name="lemma"></select></div><div style="margin-top: 5px;"><label>Other name:</label><input name="otherLemma" type="text" /></div></div><div><div class="link"><label>URI:</label><select name="link"></select></div><div style="margin-top: 5px;"><label>Other URI:</label><input name="otherLink" type="text" style="margin-right: 5px;"/><button type="button" title="Entity lookup" data-action="lookup"></button></div></div></div>').appendTo(t);r.dialog({title:"Merge Entities",modal:!1,resizable:!0,closeOnEscape:!1,height:500,width:400,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,buttons:[{text:"Merge",click:function(){var e=r.find("select[name=lemma]").val(),t=r.find("select[name=link]").val();"$$$$OTHER$$$$"===e&&(e=r.find("input[name=otherLemma]").val()),"$$$$OTHER$$$$"===t&&(t=r.find("input[name=otherLink]").val()),r.trigger("merge",[i,a,e,t]),r.dialog("close")}},{text:"Cancel",click:function(){r.trigger("cancel"),r.dialog("close")}}]}),r.find("button[data-action=lookup]").button({icon:"ui-icon-search"}).on("click",(function(){var e=i[0].getContent(),t=i[0].getType();l(n,e,t,(function(e){r.find("input[name=otherLink]").val(e.uri)}))}));return{show:function(){r.find("ul").empty(),r.find("select").empty().each((function(e,t){void 0!==o(t).selectmenu("instance")&&o(t).selectmenu("destroy")})),r.find("input[name=otherLemma]").val("").parent().hide(),r.find("input[name=otherLink]").val("").parent().hide(),r.dialog("open")},$el:r,populate:function(e,t){i=e,a=t;var n="",o=[],s=[];e.forEach((function(e,t){n+="<li>"+e.getContent()+"</li>";var i=e.getLemma();void 0!==i&&-1===o.indexOf(i)&&o.push(i);var a=e.getURI();void 0!==a&&-1===s.indexOf(a)&&s.push(a)}));var l=0===o.length,c="";o.forEach((function(e){c+='<option value="'+e+'">'+e+"</option>",void 0!==t&&t.lemma!==e&&(l=!0)})),c+='<option value="$$$$OTHER$$$$">Other (specify)</option>';var d=0===s.length,u="";s.forEach((function(e){u+='<option value="'+e+'">'+e+"</option>",void 0!==t&&t.uri!==e&&(d=!0)})),u+='<option value="$$$$OTHER$$$$">Other (lookup)</option>',0===s.length&&r.find("input[name=otherLink]").parent().show(),r.find("ul").html(n),r.find("select[name=lemma]").html(c).selectmenu({select:function(e,t){"$$$$OTHER$$$$"===t.item.value?r.find("input[name=otherLemma]").parent().show():r.find("input[name=otherLemma]").parent().hide()}}),r.find("select[name=link]").html(u).selectmenu({select:function(e,t){"$$$$OTHER$$$$"===t.item.value?r.find("input[name=otherLink]").parent().show():r.find("input[name=otherLink]").parent().hide()}}),void 0!==t&&(l?(r.find("select[name=lemma]").val("$$$$OTHER$$$$").selectmenu("refresh"),r.find("input[name=otherLemma]").val(t.lemma).parent().show()):r.find("select[name=lemma]").val(t.lemma),d?(r.find("select[name=link]").val("$$$$OTHER$$$$").selectmenu("refresh"),r.find("input[name=otherLink]").val(t.uri).parent().show()):r.find("select[name=link]").val(t.uri))}}}e.exports=function(e){var t=e.writer,n=e.parentId,r=e.nerveUrl;void 0===r&&console.error("Nerve: no nerveUrl specified!");var l={},u=null,p=null,g=!1,f=o("#"+n);f.append('\n        <div class="moduleParent nervePanel">\n            <div class="moduleHeader">\n                <div>\n                    <select name="processOptions">\n                        <option value="tag">Entity Recognition</option>\n                        \x3c!--<option value="both">Recognition & Linking</option>\n                        <option value="link">Linking Only</option>--\x3e\n                    </select>\n                    <button type="button" class="run">Run</button>\n                    <button type="button" class="done" style="display: none;">Done</button>\n                </div>\n                <div class="filters" style="display: none; margin: 0px;">\n                    <div style="display: inline-block; margin: 5px;">\n                        <label for="filter" title="Filter" class="fas fa-filter"></label>\n                        <select name="filter">\n                            <option value="all" selected="selected">All</option>\n                            <optgroup label="Type">\n                                <option value="type_person">Person</option>\n                                <option value="type_place">Place</option>\n                                <option value="type_org">Organization</option>\n                                <option value="type_title">Title</option>\n                            </optgroup>\n                            <optgroup label="Status">\n                                <option value="status_edited">Edited</option>\n                                <option value="status_notedited">Not Edited</option>\n                            </optgroup>\n                        </select>\n                    </div>\n                    <div style="display: inline-block; margin: 5px;">\n                        <label for="sorting" title="Sorting" class="fas fa-sort"></label>\n                        <select name="sorting">\n                            <option value="seq" selected="selected">Sequential</option>\n                            <option value="alpha">Alphabetical</option>\n                            <option value="cat">Categorical</option>\n                        </select>\n                    </div>\n                </div>\n                <div class="listActions" style="display: none;">\n                    <button type="button" class="expand">Expand All</button>\n                    <button type="button" class="accept">Accept All</button>\n                    <button type="button" class="reject">Reject All</button>\n                </div>\n            </div>\n            <div class="moduleContent">\n                <ul class="entitiesList"></ul>\n            </div>\n            <div class="moduleFooter">\n                <button type="button" class="mergeEntities">Merge Entities</button>\n                <div class="mergeActions" style="display: none;">\n                    <button type="button" class="merge">Merge</button>\n                    <button type="button" class="cancelMerge">Cancel</button>\n                </div>\n            </div>\n        </div>'),f.find("select[name=processOptions]").selectmenu({appendTo:t.layoutManager.getContainer()}),f.find(".filters select").selectmenu({appendTo:t.layoutManager.getContainer(),width:90}),f.find("button.run").button().on("click",(function(){h()})),f.find("button.done").button().on("click",(function(){var e=b(!0).length+Object.keys(l).length;e>0?t.dialogManager.confirm({title:"Warning",msg:"<p>You are about to lose edits you've made to ".concat(e," Nerve-identified entit").concat(e>1?"ies":"y",".</p>\n                <p>Do you wish to proceed?</p>"),noText:"No, review edited entities",type:"info",callback:function(e){e?(I(!0),V()):(E("status_edited"),k("status_edited"))}}):(I(!0),V())})),f.find('select[name="filter"]').on("selectmenuchange",(function(){k(T())})),f.find('select[name="sorting"]').on("selectmenuchange",(function(){w()})),f.find("button.expand").button().on("click",(function(){"Expand All"===o(this).text()?(o(this).text("Collapse All"),f.find(".entitiesList > li").each((function(e,t){o(t).addClass("expanded")}))):(o(this).text("Expand All"),f.find(".entitiesList > li").each((function(e,t){o(t).removeClass("expanded")})))})),f.find("button.accept").button().on("click",(function(){$()})),f.find("button.reject").button().on("click",(function(){I()})),f.find("button.mergeEntities").button({disabled:!0}).on("click",(function(){z(!0)})),f.find(".moduleFooter button.merge").button().on("click",(function(){j()})),f.find(".moduleFooter button.cancelMerge").button().on("click",(function(){z(!1)}));var h=function(){var e,n=(e=i.mark((function e(){var n,a,o,s,l,c,d,u,p;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X.reset(),n=m(),a=v(),o=f.find('select[name="processOptions"]').val(),["tag","link"],"tag"===o?["tag"]:"link"===o&&["link"],(s=t.dialogManager.getDialog("loadingindicator")).setText("Contacting NERVE"),s.setValue(!1),s.show(),e.next=12,fetch("".concat(r,"/ner"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({document:n,context:a})}).catch((function(e){console.warn("encoding failed",e),s.hide(),t.dialogManager.show("message",{title:"Error",msg:"The NERVE server returned an error: ".concat(e.exception),type:"error"})}));case 12:return l=e.sent,e.next=15,l.json();case 15:if(400===(c=e.sent)["http-response-status"]&&(console.warn("The NERVE server returned an error. Bad request (possibly encode error): ".concat(c.message)),s.hide(),t.dialogManager.show("message",{title:"Error",msg:"The NERVE server returned an error. Bad request (possibly encode error): ".concat(c.message),type:"error"})),t.event("massUpdateStarted").publish(),null!==(d=t.utilities.stringToXML(c.document))){e.next=23;break}return console.warn("nerve.run: could not parse response from NERVE"),s.hide(),e.abrupt("return");case 23:return u=JSON.parse(c.context),p=y(d,u),s.setText("Processing Response"),t.tagger.removeNoteWrappersForEntities(),e.next=29,t.utilities.processArray(p,R);case 29:t.tagger.addNoteWrappersForEntities(),s.hide(),w(),t.event("massUpdateCompleted").publish(),t.editor.setMode("readonly"),f.find("button.run").hide(),f.find("button.done").show(),f.find(".filters").show(),f.find(".listActions").show(),f.find('select[name="processOptions"]').selectmenu("option","disabled",!0),f.find("button.mergeEntities").button("enable");case 40:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){a(r,i,o,s,l,"next",e)}function l(e){a(r,i,o,s,l,"throw",e)}s(void 0)}))});return function(){return n.apply(this,arguments)}}(),m=function(){var e='<?xml version="1.0" encoding="UTF-8"?>\n<?xml-model href="'+t.schemaManager.getXMLUrl()+'" type="application/xml" schematypens="http://relaxng.org/ns/structure/1.0"?>\n';t.entitiesManager.highlightEntity();var n=t.schemaManager.getRoot();return function n(i){var a,r,s=(a=[],void 0!==(r=i.attr("_tag"))?(a.push("<"+r+">"),a.push("</"+r+">")):a=["",""],a);e+=s[0],i.contents().each((function(i,a){a.nodeType==Node.ELEMENT_NODE?n(o(a)):a.nodeType==Node.TEXT_NODE&&(e+=t.utilities.convertTextForExport(a.data))})),e+=s[1]}(o(t.editor.getBody()).children("[_tag="+n+"]")),e=e.replace(/\uFEFF/g,"")},v=function(){var e=t.schemaManager,n={name:e.getCurrentSchema().id,tags:{}},i=e.mapper.getResponsibilityAttributeName();for(var a in s){var o=s[a];n.tags[a]={name:e.mapper.getParentTag(o),lemmaAttribute:e.mapper.getMappingForProperty(o,"lemma").replace("@",""),linkAttribute:e.mapper.getMappingForProperty(o,"uri").replace("@",""),idAttribute:e.mapper.getIdAttributeName(),defaults:{}},n.tags[a].defaults[i]="NERVE",Object.assign(n.tags[a].defaults,e.mapper.getRequiredAttributes(o))}return n},y=function(e,n){var i=t.schemaManager,a=[],r={};for(var l in n.tags){var c=n.tags[l];r[c.name]={lemma:c.lemmaAttribute,uri:c.linkAttribute,type:s[l]}}var d=i.mapper.getResponsibilityAttributeName();return o(e.documentElement).find("["+d+"=NERVE]").each((function(e,n){var o=n.nodeName,r=i.mapper.getReverseMapping(n,!0);if(void 0===r.type)console.warn("nerve: unrecognized entity type for",o);else if(void 0!==r.lemma||void 0!==r.uri){var s=t.utilities.getElementXPath(n.parentElement),l=function(e,t){for(var n=0,i=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ALL);i.nextNode();){var a=i.currentNode;if(a===t)break;a.nodeType===Node.TEXT_NODE&&(n+=a.length)}return n}(n.parentElement,n);r.text=n.textContent,r.xpath=s,r.textOffset=l,r.textLength=n.textContent.length,a.push(r)}})),a},b=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=t.entitiesManager.getEntitiesArray(S());return n=n.filter((function(t){return"true"===t.getCustomValue("nerve")&&(e&&"true"===t.getCustomValue("edited")||!e)}))},w=function(){f.find(".moduleContent ul").empty();var e="";for(var n in b().forEach((function(t,n){!1===F(t.getId())&&(e+=_(t,g))})),l)e+=x(n,g);f.find("ul.entitiesList").html(e),f.find("ul.entitiesList > li > div").on("click",(function(e){o(this).parent().toggleClass("expanded");var n=o(this).parent().attr("data-id");t.entitiesManager.highlightEntity(n,null,!0)})).find(".actions > span").hover((function(){o(this).removeClass("ui-state-default"),o(this).addClass("ui-state-active")}),(function(){o(this).addClass("ui-state-default"),o(this).removeClass("ui-state-active")})).on("click",(function(e){e.stopPropagation();var n=o(this).data("action"),i=o(this).parents("li").data("id"),a=o(this).parents("li").hasClass("merged");switch(n){case"accept":a?(U(i),t.entitiesList.update()):(A(i),t.entitiesList.update());break;case"acceptmatching":P(i);break;case"reject":a?W(i):O(i);break;case"edit":a?j(i):L(i);break;case"unmerge":B(i)}})),f.find("ul.entitiesList > li .nav > span").hover((function(){o(this).removeClass("ui-state-default"),o(this).addClass("ui-state-active")}),(function(){o(this).addClass("ui-state-default"),o(this).removeClass("ui-state-active")})).on("click",(function(e){e.stopPropagation();var n=o(this).data("action"),i=l[o(this).parents("li").data("id")],a=t.entitiesManager.getCurrentEntity(),r=0;"previous"===n?(null==a||(r=i.entityIds.indexOf(a)-1)<0)&&(r=i.entityIds.length-1):(null==a||(r=i.entityIds.indexOf(a)+1)>i.entityIds.length-1)&&(r=0);var s=i.entityIds[r];t.entitiesManager.highlightEntity(s,null,!0)})),g&&f.find("ul.entitiesList > li > input").on("click",(function(){var e=H();if(0===e.length)k("all");else{var t=e.first().data("type");k("type_"+t)}})),f.find("ul.entitiesList .actions").tooltip({show:!1,hide:!1,classes:{"ui-tooltip":"cwrc-tooltip"}})},_=function(e,t){var n=N(e.getId()).length>0;return'<li class="'+e.getType()+'" data-type="'+e.getType()+'" data-id="'+e.getId()+'">'+(!0===t?'<input type="checkbox" />':"")+'<div><div class="header"><span class="icon"/><span class="entityTitle">'+("true"===e.getCustomValue("edited")?"&#8226; ":"")+e.getContent()+'</span><div class="actions">'+(!0===t?"":'<span data-action="edit" class="ui-state-default" title="Edit"><span class="ui-icon ui-icon-pencil"/></span><span data-action="accept" class="ui-state-default" title="Accept"><span class="ui-icon ui-icon-check"/></span>'+(!0===n?'<span data-action="acceptmatching" class="ui-state-default" title="Accept All Matching"><span class="ui-icon ui-icon-circle-check"/></span>':"")+'<span data-action="reject" class="ui-state-default" title="Reject"><span class="ui-icon ui-icon-close"/></span>')+'</div></div><div class="info">'+C(e)+"</div></div></li>"},x=function(e,t){var n=l[e];return'<li class="'+n.type+' merged" data-type="'+n.type+'" data-id="'+e+'">'+(!0===t?'<input type="checkbox" />':"")+'<div><div class="header"><span class="icon" style="margin-right: -4px;"/><span class="icon"/><span class="entityTitle">&#8226; '+n.lemma+'</span><div class="actions">'+(!0===t?"":'<div class="nav"><span data-action="previous" class="ui-state-default" title="Previous Entity"><span class="ui-icon ui-icon-circle-arrow-w"></span></span><span data-action="next" class="ui-state-default" title="Next Entity"><span class="ui-icon ui-icon-circle-arrow-e"></span></span></div><span data-action="unmerge" class="ui-state-default" title="Unmerge"><span class="ui-icon ui-icon-scissors"></span></span><span data-action="edit" class="ui-state-default" title="Edit"><span class="ui-icon ui-icon-pencil"></span></span><span data-action="accept" class="ui-state-default" title="Accept"><span class="ui-icon ui-icon-check"></span></span><span data-action="reject" class="ui-state-default" title="Reject"><span class="ui-icon ui-icon-close"></span></span>')+'</div></div><div class="info"><ul><li><strong>URI</strong>: <a href="'+n.uri+'" target="_blank" rel="noopener">'+n.uri+"</a></li></ul></div></div></li>"},C=function(e){var t="<ul>",n=e.getLemma();void 0!==n&&(t+="<li><strong>Standard</strong>: "+n+"</li>");var i=e.getURI();return void 0!==i&&(t+='<li><strong>URI</strong>: <a href="'+i+'" target="_blank" rel="noopener">'+i+"</a></li>"),t+="</ul>"},k=function(e){var n="type";if(-1!==e.indexOf("_")){var i=e.split("_");n=i[0],e=i[1]}f.find("ul.entitiesList > li").each((function(i,a){var r=o(this);if("all"===e)r.show();else if("type"===n)r.hasClass(e)?r.show():r.hide();else{var s=t.entitiesManager.getEntity(r.data("id")),l=s&&"true"===s.getCustomValue("edited")||r.hasClass("merged");"edited"===e&&l||"notedited"===e&&!l?r.show():r.hide()}}))},T=function(){return f.find('select[name="filter"]').val()},E=function(e){f.find('select[name="filter"]').val(e).selectmenu("refresh")},S=function(){return f.find('select[name="sorting"]').val()},D=function(e){return t.entitiesManager.getEntity(e)},M=function(e){f.find("ul.entitiesList li[data-id="+e+"]").remove()},R=function(e){var n=function(e){var n=t.utilities.evaluateXPath(t.editor.getBody(),e.xpath);if(null===n)return console.warn('nerve: could not get parent for "',e.lemma,'" at:',e.xpath),null;for(var i,a=0,o=t.editor.getDoc().createTreeWalker(n,NodeFilter.SHOW_ALL);o.nextNode();)if((i=o.currentNode).nodeType===Node.TEXT_NODE){if(a+i.length>=e.textOffset)break;1===i.length&&"\ufeff"===i.data||(a+=i.length)}var r=e.textOffset-a,s=r+e.textLength,l=t.editor.selection.getRng(!0);try{return l.setStart(i,r),l.setEnd(i,s),l}catch(t){return l.collapse(),console.warn("nerve: could not select range for",e),null}}(e);if(null!==n){var i=n.commonAncestorContainer.parentElement;if(0===n.startOffset){var a=["person","place","org"].map((function(e){return t.schemaManager.mapper.getParentTag(e)}));if("true"===i.getAttribute("_entity")||-1!==a.indexOf(i.getAttribute("_tag")))return console.log("nerve: entity already exists for",e),n.collapse(),!1}var r={type:e.type,content:e.text,attributes:{_candidate:"true"},customValues:{nerve:"true"}};""!==e.lemma&&(r.lemma=e.lemma),""!==e.uri&&(r.uri=e.uri),Object.assign(r.attributes,e.attributes);var s=t.entitiesManager.addEntity(r,n);return o("#"+s.id,t.editor.getBody()).attr("_candidate","true"),n.collapse(),!0}return!1},A=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=t.entitiesManager.getEntity(e),a=o("#"+e,t.editor.getBody())[0],r=t.schemaManager.mapper.getResponsibilityAttributeName();t.tagger.removeAttributeFromTag(a,r);var s=void 0!==i.getCustomValue("nerve"),l=i.getURI();s&&void 0===l?t.tagger.removeEntity(e):(i.removeCustomValue("nerve"),i.removeCustomValue("edited"),i.removeAttribute(r),i.removeAttribute("_candidate"),t.tagger.removeAttributeFromTag(a,"_candidate")),n&&M(e)},P=function(e){var n=N(e);A(e),n.forEach((function(e){A(e)})),t.entitiesList.update()},N=function(e){var n=[],i=t.entitiesManager.getEntity(e);return b().forEach((function(e){e.getId()!==i.getId()&&e.getContent()===i.getContent()&&e.getLemma()===i.getLemma()&&e.getURI()==i.getURI()&&n.push(e.getId())})),n},$=function(){t.event("massUpdateStarted").publish();var e=T(),n=t.dialogManager.getDialog("loadingindicator");for(var i in n.setText("Accepting Entities"),n.show(),l){var a=l[i];"all"!==e&&e!==a.type||(a.entityIds.forEach((function(e){t.entitiesManager.setLemmaForEntity(e,a.lemma),t.entitiesManager.setURIForEntity(e,a.uri)})),delete l[i])}t.utilities.processArray(b(),(function(t){"all"!==e&&e!==t.getType()||A(t.getId(),!1)})).then((function(){E("all"),w(),t.event("massUpdateCompleted").publish()})).always((function(){n.hide()}))},O=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=t.entitiesManager.getEntity(e),a=void 0!==i.getCustomValue("nerve");a?t.tagger.removeStructureTag(e,!1):t.tagger.removeEntity(e),n&&M(e)},I=function(e){t.event("massUpdateStarted").publish();var n=T(),i=t.dialogManager.getDialog("loadingindicator");for(var a in i.setText("Rejecting Entities"),i.show(),l){var o=l[a];"all"!==n&&n!==o.type||delete l[a]}t.utilities.processArray(b(),(function(t){(e||"all"===n||n===t.getType())&&O(t.getId(),!1)})).then((function(){E("all"),w(),t.event("massUpdateCompleted").publish()})).always((function(){i.hide()}))},L=function(e){null===u&&((u=new c(t,f)).$el.dialog("option","modal",!1),u.$el.on("save",(function(e,n){!function(e,t){var n=f.find("ul.entitiesList > li[data-id="+e.getId()+"]");n.data("type",e.getType()).attr("data-type",e.getType());var i=n.hasClass("expanded");n.removeClass(),n.addClass(e.getType()),(i||!0===t)&&n.addClass("expanded");var a=("true"===e.getCustomValue("edited")?"&#8226; ":"")+e.getContent();n.find(".entityTitle").html(a),n.find(".info").html(C(e))}(t.entitiesManager.getEntity(n.currentId),!0),k(T())}))),u.show({entry:D(e)})},z=function(e){(g=e)?(f.find(".mergeActions").show(),f.find("button.mergeEntities").hide(),f.find('select[name="filter"]').val("all").selectmenu("refresh").selectmenu("option","disabled",!0)):(f.find(".mergeActions").hide(),f.find("button.mergeEntities").show(),f.find('select[name="filter"]').selectmenu("option","disabled",!1)),w()},F=function(e){for(var t in l){if(-1!==l[t].entityIds.indexOf(e))return!0}return!1},j=function(e){null===p&&((p=new d(t,f)).$el.on("merge",(function(e,n,i,a,o){if(null!=i)i.lemma=a,i.uri=o,g?(i.entityIds=n.map((function(e){return e.getId()})),z(!1)):w();else{var r=n.map((function(e){return e.getId()})),s=t.getUniqueId("merged_");l[s]={entityIds:r,type:n[0].getType(),lemma:a,uri:o},z(!1)}})),p.$el.on("cancel",(function(){})));var n,i=[];void 0!==e?(n=l[e],i=n.entityIds.map((function(e){return t.entitiesManager.getEntity(e)}))):H().each((function(e,a){var r=o(a).data("id"),s=t.entitiesManager.getEntity(r);void 0===s?(n=l[r])&&n.entityIds.forEach((function(e){i.push(t.entitiesManager.getEntity(e))})):i.push(s)})),i.length>1?(p.show(),p.populate(i,n)):t.dialogManager.show("message",{title:"Warning",msg:"You must select at least 2 entities to merge.",type:"info"})},B=function(e){delete l[e],w()},U=function(e){var n=l[e];n.entityIds.forEach((function(e){t.entitiesManager.setLemmaForEntity(e,n.lemma),t.entitiesManager.setURIForEntity(e,n.uri),A(e)})),delete l[e],M(e)},W=function(e){l[e].entityIds.forEach((function(e){O(e)})),delete l[e],M(e)},H=function(){return f.find("ul.entitiesList > li > input:checked").parent("li")},V=function(){f.find("select").selectmenu("option","disabled",!1),f.find("button.mergeEntities").button("disable"),t.editor.setMode("design"),X.reset(),t.event("contentChanged").publish()},X={reset:function(){l={},f.find(".moduleContent ul").empty(),f.find(".listActions").hide(),f.find(".filters").hide(),f.find("button.run").show(),f.find("button.done").hide()},destroy:function(){f.empty(),f.find("ul.entitiesList .actions").tooltip("destroy")}};return X}},function(e){e.exports=JSON.parse('{"_from":"cwrc-writer-base@5.1.1","_id":"cwrc-writer-base@5.1.1","_inBundle":false,"_integrity":"sha512-zEu6bUo1/htj5a4i1JvSP+R57s2Uu27uAzgtIZpBv0sVwRMH8EHP5v+33OH2hO7q87aYPIaGOXcm71teHx/rQw==","_location":"/cwrc-writer-base","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"cwrc-writer-base@5.1.1","name":"cwrc-writer-base","escapedName":"cwrc-writer-base","rawSpec":"5.1.1","saveSpec":null,"fetchSpec":"5.1.1"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/cwrc-writer-base/-/cwrc-writer-base-5.1.1.tgz","_shasum":"387899e1499d9d0dd2606c8e2c6639a4e8deef34","_spec":"cwrc-writer-base@5.1.1","_where":"/Users/lucaju/localhost/CWRC/Islandora-CWRC-Writer","author":{"name":"Andrew MacDonald","email":"andrewjames.code@gmail.com"},"browser":{"objtree":"./src/lib/objtree/ObjTree.js","jquery-watermark":"./src/lib/jquery/jquery.watermark.min.js","jquery-popup":"./src/lib/jquery/jquery.popup.js","layout":"./src/lib/jquery/jquery.layout_and_plugins.js","dialogForm":"./src/js/dialogs/dialogForm/dialogForm.js","annotationsManager":"./src/js/entities/annotationsManager.js","entity":"./src/js/entities/entity.js","mapper":"./src/js/schema/mapper.js"},"bugs":{"url":"https://github.com/cwrc/CWRC-WriterBase/issues"},"bundleDependencies":false,"config":{"commitizen":{"path":"cz-conventional-changelog"}},"contributors":[{"name":"James Chartrand","email":"jc.chartrand@gmail.com"},{"name":"Luciano Frizzera","email":"lucaju@gmail.com"}],"dependencies":{"css":"^2.2.4","fscreen":"1.0.2","iso-639-2":"^2.0.0","jquery":"3.4.1","jquery-contextmenu":"^2.9.0","jquery-ui":"^1.12.1","js-cookie":"^2.2.1","jstree":"3.3.8","moment":"^2.24.0","openseadragon":"^2.4.1","prism-themes":"^1.4.0","prismjs":"^1.20.0","tinymce":"4.9.8"},"deprecated":false,"description":"intuitive document editing with xml and rdf","devDependencies":{"@babel/core":"^7.9.0","@babel/preset-env":"^7.9.5","@jest-runner/electron":"^2.0.3","@semantic-release/changelog":"^5.0.1","@semantic-release/git":"^9.0.0","@testing-library/jest-dom":"^5.5.0","babel-jest":"^25.3.0","codecov":"^3.6.5","commitizen":"^4.0.4","copyfiles":"^2.2.0","cz-conventional-changelog":"^3.1.0","electron":"^8.2.3","eslint":"^6.8.0","fetch-mock":"^9.4.0","husky":"^4.2.5","jest":"^25.3.0","less":"^3.11.1","mkdirp":"^1.0.4","path-exists-cli":"^1.0.0","rimraf":"^3.0.2","semantic-release":"^17.0.7","travis-deploy-once":"^5.0.11"},"files":["src"],"homepage":"https://github.com/cwrc/CWRC-WriterBase#readme","husky":{"hooks":{"pre-commit":"npm run test"}},"jest":{"browser":true,"collectCoverage":true,"collectCoverageFrom":["./src/js/**/*","!**/js/tinymce_plugins/**","!**/schema/cwrcEntry/**","!**/schema/orlando/**","!**/schema/teiLite/**"],"coverageDirectory":"./coverage","coverageThreshold":{"global":{"branches":35,"functions":50,"lines":50,"statements":50}},"moduleNameMapper":{"^rdflib$":"<rootDir>/test/mocks/rdflib.js"},"setupFiles":["./test/test-env.js"],"runner":"@jest-runner/electron","testEnvironment":"@jest-runner/electron/environment","testMatch":["**/test/test.js"],"verbose":true},"keywords":["xml","rdf","editor","annotation"],"license":"GPL-2.0","main":"src/js/writer.js","name":"cwrc-writer-base","repository":{"type":"git","url":"git+https://github.com/cwrc/CWRC-WriterBase.git"},"scripts":{"build":"npm run build-css && npm run copy-files-to-build","build-css":"mkdirp build/css && npm run build-scoped-css && npm run build-editor-css","build-editor-css":"lessc src/css/editor.less build/css/editor.css","build-scoped-css":"lessc src/css/build.less build/css/cwrc-writer.css --global-var=\\"parentId=#cwrcWriterContainer\\"","clean":"rimraf build","cm":"git-cz","copy-files-to-build":"npm run copy-tinymce && npm run copy-jqueryui-images && npm run copy-jstree-images","copy-jqueryui-images":"copyfiles -u 3 \\"src/css/jquery-ui/jquery-ui-images/*\\" build/css/","copy-jstree-images":"path-exists node_modules && copyfiles -f \\"node_modules/jstree/dist/themes/default/*.png\\" build/css/ || copyfiles -f \\"../jstree/dist/themes/default/*.png\\" build/css/","copy-tinymce":"copyfiles -u 3 \\"src/css/tinymce/**/*\\" build/css/tinymce","report-coverage":"cat ./coverage/coverage-final.json | codecov","semantic-release":"semantic-release","test":"jest","travis-deploy-once":"travis-deploy-once"},"version":"5.1.1"}')},function(e,t,n){"use strict";var i=n(1);function a(e){this.w=e,this.selector="#"+e.containerId,this.tagId=null,this.isEntity=!1,this.isMultiple=!1,this.useSelection=!1,i.contextMenu({selector:this.selector,trigger:"none",build:function(e,t){return{appendTo:"#"+this.w.containerId,className:"tagContextMenu cwrc",animation:{duration:0,show:"show",hide:"hide"},items:o.call(this),callback:function(e,t,n){var a=i(n.target).closest("li.context-menu-item").data("action");if(void 0!==a)switch(this.w.editor.currentBookmark=this.w.editor.selection.getBookmark(1),a){case"change":this.w.tagger.changeTagDialog(e,this.tagId);break;default:this.w.editor.currentBookmark.tagId=this.tagId,this.w.tagger.addTagDialog(e,a,this.tagId)}}.bind(this)}}.bind(this)})}function o(){var e={};if(null==this.tagId)return console.warn("tagContextMenu: no tagId!"),{};if(this.w.isAnnotator)return r.call(this,e),e;var t=i("#"+this.tagId,this.w.editor.getBody())[0],n=!1===this.isMultiple,a=!1===this.isMultiple,o=!0===this.isMultiple||!1===this.useSelection,d={},u={},p={};if(n&&(d=s.call(this,t)),a&&(u=l.call(this,t)),o&&(p=c.call(this,t)),this.isMultiple)return e.add_tag_around={name:"Insert Tag Around",icon:"tag_add",tagAction:"around",items:p},e.sep0="---",e.merge_tags={name:"Merge Tags",icon:"tag_merge",callback:function(){var e=i("#"+this.tagId.join(",#"),this.w.editor.getBody());this.w.tagger.mergeTags(e)}.bind(this)},e;if(this.useSelection&&(e.add_tag={name:"Insert Tag",icon:"tag_add",tagAction:"add",items:d},!1===this.w.schemaManager.isSchemaCustom()&&r.call(this,e),e.sep0="---"),this.useSelection||(e.add_tag_before={name:"Insert Tag Before",icon:"tag_add",tagAction:"before",items:u},e.add_tag_after={name:"Insert Tag After",icon:"tag_add",tagAction:"after",items:u},e.add_tag_around={name:"Insert Tag Around",icon:"tag_add",tagAction:"around",items:p},e.add_tag_inside={name:"Insert Tag Inside",icon:"tag_add",tagAction:"inside",items:d},e.sep1="---"),e.edit_tag={name:"Edit Tag/Entity",icon:"tag_edit",callback:function(){this.w.tagger.editTagDialog(this.tagId)}.bind(this)},!this.isEntity){var g=t.getAttribute("_tag");this.w.schemaManager.isTagEntity(g)&&(e.convert_tag={name:"Convert to Entity",icon:"tag_edit",callback:function(){this.w.schemaManager.mapper.convertTagToEntity(t,!0)}.bind(this)})}return e.change_tag={name:"Change Tag",icon:"tag_edit",tagAction:"change",items:u},this.isEntity?e.copy_entity={name:"Copy Entity",icon:"tag_copy",callback:function(){this.w.tagger.copyTag(this.tagId)}.bind(this)}:e.copy_tag={name:"Copy Tag and Contents",icon:"tag_copy",callback:function(){this.w.tagger.copyTag(this.tagId)}.bind(this)},null!==this.w.editor.copiedElement.element?e.paste_tag={name:"Paste Tag",icon:"tag_paste",callback:function(){this.w.tagger.pasteTag()}.bind(this)}:null!==this.w.editor.copiedEntity&&(e.paste_entity={name:"Paste Entity",icon:"tag_paste",callback:function(){this.w.tagger.pasteEntity()}.bind(this)}),this.useSelection&&(e.split_tag={name:"Split Tag",icon:"tag_split",callback:function(){this.w.tagger.splitTag()}.bind(this)}),e.sep2="---",this.isEntity&&(e.remove_entity={name:"Remove Entity",icon:"tag_remove",callback:function(){this.w.tagger.removeEntity(this.tagId)}.bind(this)}),e.remove_tag={name:"Remove Tag Only",icon:"tag_remove",callback:function(){this.w.tagger.removeStructureTag(this.tagId,!1)}.bind(this)},e.remove_content={name:"Remove Content Only",icon:"tag_remove",callback:function(){this.w.tagger.removeStructureTagContents(this.tagId)}.bind(this)},e.remove_all={name:"Remove All",icon:"tag_remove",callback:function(){this.w.tagger.removeStructureTag(this.tagId,!0)}.bind(this)},e}function r(e){e.add_entity={name:"Insert Entity",icon:"tag_add",className:"entities",items:{add_person:{name:"Tag Person",icon:"person",callback:function(){this.w.tagger.addEntityDialog("person")}.bind(this)},add_place:{name:"Tag Place",icon:"place",callback:function(){this.w.tagger.addEntityDialog("place")}.bind(this)},add_date:{name:"Tag Date",icon:"date",callback:function(){this.w.tagger.addEntityDialog("date")}.bind(this)},add_org:{name:"Tag Organization",icon:"org",callback:function(){this.w.tagger.addEntityDialog("org")}.bind(this)},add_citation:{name:"Tag Citation",icon:"citation",callback:function(){this.w.tagger.addEntityDialog("citation")}.bind(this)},add_note:{name:"Tag Note",icon:"note",callback:function(){this.w.tagger.addEntityDialog("note")}.bind(this)},add_title:{name:"Tag Text/Title",icon:"title",callback:function(){this.w.tagger.addEntityDialog("title")}.bind(this)},add_correction:{name:"Tag Correction",icon:"correction",callback:function(){this.w.tagger.addEntityDialog("correction")}.bind(this)},add_keyword:{name:"Tag Keyword",icon:"keyword",callback:function(){this.w.tagger.addEntityDialog("keyword")}.bind(this)},add_link:{name:"Tag Link",icon:"link",callback:function(){this.w.tagger.addEntityDialog("link")}.bind(this)},add_rs:{name:"Tag RS",icon:"rs",callback:function(){this.w.tagger.addEntityDialog("rs")}.bind(this)}}};var t=this.w.schemaManager.mapper.getMappings().entities;for(var n in e.add_entity.items){void 0===t[e.add_entity.items[n].icon]&&delete e.add_entity.items[n]}}function s(e){var t=i.Deferred();return setTimeout(function(){var n=this.w.utilities.getElementXPath(e),i=this.w.schemaManager.getChildrenForPath(n);t.resolve(d(i))}.bind(this),0),t.promise()}function l(e){var t=i.Deferred();return setTimeout(function(){var n=i(e).parents("[_tag]"),a=this.w.utilities.getElementXPath(n[0]),o=this.w.schemaManager.getChildrenForPath(a);t.resolve(d(o))}.bind(this),0),t.promise()}function c(e){var t=i.Deferred();return setTimeout(function(){for(var n=this.w.utilities.getElementXPath(e),a=this.w.schemaManager.getParentsForPath(n),o=i(e).parents("[_tag]"),r=(n=this.w.utilities.getElementXPath(o[0]),this.w.schemaManager.getChildrenForPath(n)),s=[],l=0;l<a.length;l++)for(var c=a[l],u=0;u<r.length;u++){var p=r[u];if(c.name==p.name){s.push(c);break}}t.resolve(d(s))}.bind(this),0),t.promise()}function d(e){var t={};if(0===e.length)t.no_tags={name:"No Tags Available",icon:"no_tags"};else{t.tag_filter={name:"Filter Tags",type:"text",events:{keyup:function(e){var t=this.value;e.data.$menu.find("li").each((function(e,n){if(e>0){var a=i(n).children("span")[0].firstChild.data;""===t||-1!==a.indexOf(t)?i(n).show():i(n).hide()}}))}}};for(var n=0;n<e.length;n++){var a=e[n],o=a.name,r=a.name;""!==a.fullName&&(r+=' <span class="fullName">('+a.fullName+")</span>"),t[o]={name:r,type:"cwrcTag",icon:"tag"}}}return t}n(187),a.prototype={constructor:a,show:function(e,t,n){if(e.preventDefault(),e.stopImmediatePropagation(),!this.w.isReadOnly&&!this.w.isEditorReadOnly()){if(void 0!==t&&Array.isArray(t))this.isMultiple=!0,this.isEntity=!1,this.useSelection=!1;else{this.isMultiple=!1;var a=this.w.tagger.getCurrentTag(t)[0];void 0===t&&(t=a.getAttribute("id"));var o=a.getAttribute("_tag");if(o==this.w.schemaManager.getRoot()||o==this.w.schemaManager.getHeader())return;this.isEntity=null!==a.getAttribute("_entity"),this.useSelection=void 0!==n&&n}this.tagId=t,i(this.selector).contextMenu({x:e.pageX,y:e.pageY})}},destroy:function(){i(this.selector).contextMenu("destroy")}},i.contextMenu.types.cwrcTag=function(e,t,n){e.icon&&this.addClass(n.classNames.icon+" "+n.classNames.icon+"-"+e.icon),i("<span>"+e.name+"</span>").appendTo(this),this.data("action",t.tagAction)},e.exports=a},function(e,t,n){"use strict";var i=n(1);window.tinymce=n(21),n(351),n(352),n(354),n(355),n(356),n(357);var a=["schematags","|","addperson","addplace","addorg","addtitle","adddate","addcitation","addnote","addcorrection","addkeyword","addlink","addrs","addtranslation","|","editTag","removeTag","|","toggletags","viewmarkup","editsource","|","validate","savebutton","loadbutton","logoutbutton","|","fullscreen"];function o(){}o.init=function(e){var t=e.writer,n=e.editorId,o=e.layoutContainerId,r=void 0===e.iconType?"img":e.iconType;function s(e){var n=[];t.editor.dom.getParent(e,(function(e){if("BODY"==e.nodeName)return!0;n.push(e)})),t.editor.fire("NodeChange",{element:e,parents:n})}function l(e){m(t.editor),t.event("selectionChanged").publish()}function c(e){console.log("undoHandler",e),t.event("contentChanged").publish()}function d(e){console.log("redoHandler",e),t.event("contentChanged").publish()}function u(e){if(t.editor.lastKeyPress=e.which,t.isReadOnly){if((tinymce.isMac?e.metaKey:e.ctrlKey)&&70==e.which)return;e.preventDefault()}else t.event("writerKeydown").publish(e)}function p(e){(e.which>=33||e.which<=40||8==e.which)&&m(t.editor);var n=t.entitiesManager.getCurrentEntity();if(null!==n){var a=i(".entityHighlight",t.editor.getBody()).text(),o=t.entitiesManager.getEntity(n);o.isNote()&&o.setNoteContent(i("#"+n,t.editor.getBody()).html()),o.setContent(a),t.event("entityEdited").publish(n)}if(t.editor.currentNode){if(null===t.editor.currentNode.parentNode){var r=(u=t.editor.selection.getRng(!0)).commonAncestorContainer.parentNode;if(null!=r.getAttribute("data-mce-bogus")){var l=i(r),c=!0,d=l.nextAll("[_tag]")[0];null==d&&null==(d=l.parent().nextAll("[_tag]")[0])&&(c=!1,d=l.prevAll("[_tag]")[0]),null!=d&&(u.selectNodeContents(d),u.collapse(c),t.editor.selection.setRng(u),window.setTimeout((function(){s(d)}),0))}}if("false"===t.editor.currentNode.getAttribute("_textallowed"))if(tinymce.isMac?e.metaKey:e.ctrlKey){var u,p=i('[_textallowed="true"]',t.editor.getBody()).first();(u=t.editor.selection.getRng(!0)).selectNodeContents(p[0]),u.collapse(!0),t.editor.selection.setRng(u)}else"true"!==t.editor.currentNode.getAttribute("_entity")&&t.dialogManager.show("message",{title:"No Text Allowed",msg:"Text is not allowed in the current tag: "+t.editor.currentNode.getAttribute("_tag")+".",type:"error"})}if(13==e.which)if(null==(p=t.editor.currentNode))console.warn("tinymceWrapper: user pressed enter but no new node found");else if(e.shiftKey)p.normalize();else{var g=i(p);""==g.text()&&g.text("\ufeff"),t.tagger.processNewContent(p),t.editor.undoManager.add(),t.event("contentChanged").publish()}t.event("writerKeyup").publish(e)}function g(e){i("br",t.editor.getBody()).remove()}function f(e){var n=e.element;if(1!=n.nodeType)t.editor.currentNode=t.utilities.getRootTag()[0];else{if("mcepastebin"==n.getAttribute("id"))return;if(null==n.getAttribute("_tag")&&0==n.classList.contains("entityHighlight")){if(null!=n.getAttribute("data-mce-bogus")){var a,o=t.editor.selection.getRng(!0);if(o.collapsed){var r=!0;36==t.editor.lastKeyPress||37==t.editor.lastKeyPress||38==t.editor.lastKeyPress?(a=i(n).prevAll("[_tag]")[0],r=!1):null==(a=i(n).nextAll("[_tag]")[0])&&(a=i(n).parent().nextAll("[_tag]")[0]),null!=a&&(o.selectNodeContents(a),o.collapse(r),t.editor.selection.setRng(o))}else a=i(n).next("[_tag]")[0];n=null!=a?a:n.parentNode}else{if(n==t.editor.getBody())return;n=n.parentNode}window.setTimeout((function(){s(n)}),0)}else t.editor.currentNode=n}t.editor.currentBookmark=t.editor.selection.getBookmark(1),t.event("nodeChanged").publish(t.editor.currentNode)}function h(e){null!=t.editor.copiedElement.element&&(i(t.editor.copiedElement.element).remove(),t.editor.copiedElement.element=null),t.event("contentCopied").publish()}function m(e){var n=t.editor.selection.getRng(!0),a=n.commonAncestorContainer;if(a.nodeType===Node.ELEMENT_NODE&&a.hasAttribute("_entity")){if(t.entitiesManager.highlightEntity(),t.editor.dom.hasClass(a,"start")&&37==e.which||t.editor.dom.hasClass(a,"end")&&39!=e.which){var o=t.utilities.getPreviousTextNode(a);n.setStart(o,o.length),n.setEnd(o,o.length)}else{var r=t.utilities.getNextTextNode(a);n.setStart(r,0),n.setEnd(r,0)}t.editor.selection.setRng(n),n=t.editor.selection.getRng(!0)}var s,l=i(n.startContainer).parents("[_entity]")[0];if(null!=l)(s=l.getAttribute("name"))!==t.entitiesManager.getCurrentEntity()&&t.entitiesManager.highlightEntity(s,t.editor.selection.getBookmark());else{t.entitiesManager.highlightEntity();var c=i(t.editor.selection.getNode());c.attr("_tag")&&(s=c.attr("id"))}}tinymce.baseURL=t.cwrcRootUrl+"/js",tinymce.init({selector:"#"+n,ui_container:"#"+o,skin_url:t.cwrcRootUrl+"css/tinymce",content_css:t.cwrcRootUrl+"css/editor.css",doctype:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',element_format:"xhtml",forced_root_block:t.schemaManager.getBlockTag(),keep_styles:!1,paste_postprocess:function(e,n){t.tagger.processNewContent(n.node),window.setTimeout((function(){t.event("contentPasted").publish()}),0)},valid_elements:"*[*]",plugins:"schematags,cwrcpath,preventdelete,paste",toolbar1:null==e.buttons1?a.join(","):e.buttons1,toolbar2:null==e.buttons2?"cwrcpath":e.buttons2,toolbar3:null==e.buttons3?"":e.buttons3,menubar:!1,elementpath:!1,statusbar:!1,branding:!1,formats:{bold:{},italic:{},underline:{}},setup:function(e){function n(e,n){n.onmouseenter=function(e){var n=this.tooltip(),a=i(this.$el[0]),o=t.utilities.getOffsetPosition(a);o.left+=-.5*i(n.$el[0]).outerWidth()+.5*a.outerWidth(),o.top+=a.outerHeight(),n.moveTo(o.left,o.top)},t.editor.addButton(e,n)}t.editor=e,e.writer=t,e.currentBookmark=null,e.currentNode=null,e.copiedElement={selectionType:null,element:null},e.copiedEntity=null,e.lastKeyPress=null,e.on("init",(function(n){!0===t.isReadOnly&&(t.layoutManager.hideToolbar(),e.setMode("readonly")),e.dom.isBlock=function(t){if(!t)return!1;var n=t.nodeType;if(n&&1===n){var i=t.getAttribute("_tag")||t.nodeName;return!!e.schema.getBlockElements()[i]}return!!e.schema.getBlockElements()[t]};var a=t.settings.getSettings(),o=i(e.getBody());a.showEntities&&o.addClass("showEntities"),a.showTags&&o.addClass("showTags"),o.on("keydown",u).on("keyup",p),i(e.iframeElement.contentDocument).on("mouseup",l),t.event("tinymceInitialized").publish(t)})),e.on("Change",g),e.on("Undo",c),e.on("Redo",d),e.on("BeforeAddUndo",(function(e){})),e.on("NodeChange",f),e.on("copy",h),e.on("contextmenu",(function(n){if(n.preventDefault(),n.stopImmediatePropagation(),!t.isReadOnly){var a=t.utilities.getOffsetPosition(e.getContentAreaContainer(),window.document.documentElement),o=i(e.getDoc().documentElement),r=o.scrollTop(),s=o.scrollLeft(),l=a.left-s,c=a.top-r;n.pageX+=l,n.pageY+=c,t.tagMenu.show(n,void 0,!0)}})),n("addperson",{title:"Tag Person",icon:" "+r+" person",entityButton:!0,entityType:"person",onclick:function(){t.tagger.addEntityDialog("person")}}),n("addplace",{title:"Tag Place",icon:" "+r+" place",entityButton:!0,entityType:"place",onclick:function(){t.tagger.addEntityDialog("place")}}),n("adddate",{title:"Tag Date",icon:" "+r+" date",entityButton:!0,entityType:"date",onclick:function(){t.tagger.addEntityDialog("date")}}),n("addorg",{title:"Tag Organization",icon:" "+r+" org",entityButton:!0,entityType:"org",onclick:function(){t.tagger.addEntityDialog("org")}}),n("addcitation",{title:"Tag Citation",icon:" "+r+" citation",entityButton:!0,entityType:"citation",onclick:function(){t.tagger.addEntityDialog("citation")}}),n("addnote",{title:"Tag Note",icon:" "+r+" note",entityButton:!0,entityType:"note",onclick:function(){t.tagger.addEntityDialog("note")}}),n("addcorrection",{title:"Tag Correction",icon:" "+r+" correction",entityButton:!0,entityType:"correction",onclick:function(){t.tagger.addEntityDialog("correction")}}),n("addkeyword",{title:"Tag Keyword",icon:" "+r+" keyword",entityButton:!0,entityType:"keyword",onclick:function(){t.tagger.addEntityDialog("keyword")}}),n("addlink",{title:"Tag Link",icon:" "+r+" link",entityButton:!0,entityType:"link",onclick:function(){t.tagger.addEntityDialog("link")}}),n("addtitle",{title:"Tag Text/Title",icon:" "+r+" title",entityButton:!0,entityType:"title",onclick:function(){t.tagger.addEntityDialog("title")}}),n("addrs",{title:"Tag Referencing String",icon:" "+r+" rs",entityButton:!0,entityType:"rs",onclick:function(){t.tagger.addEntityDialog("rs")}}),n("editTag",{title:"Edit Tag/Entity",icon:" "+r+" tag-edit",onclick:function(){t.tagger.editTagDialog()}}),n("removeTag",{title:"Remove Tag",icon:" "+r+" tag-delete",onclick:function(){t.tagger.removeTag()}}),n("newbutton",{title:"New",image:t.cwrcRootUrl+"img/page_white_text.png",onclick:function(){t.showSaveDialog()}}),n("savebutton",{title:"Save",icon:" "+r+" save",onclick:function(){t.showSaveDialog()}}),n("saveasbutton",{title:"Save As",image:t.cwrcRootUrl+"img/save_as.png",onclick:function(){t.showSaveAsDialog()}}),n("saveexitbutton",{title:"Save & Exit",image:t.cwrcRootUrl+"img/save_exit.png",onclick:function(){t.saveAndExit()}}),n("logoutbutton",{title:"Log out",icon:" "+r+" exit",onclick:function(){t.exit()}}),n("loadbutton",{title:"Load",icon:" "+r+" load",onclick:function(){t.showLoadDialog()}}),n("viewmarkup",{title:"Show Raw XML",icon:" "+r+" view-markup",onclick:function(){t.selection.showSelection()}}),n("toggletags",{title:"Toggle Tags",icon:" "+r+" toggle-tags",onclick:function(){i("body",t.editor.getDoc()).toggleClass("showTags"),this.active(i("body",t.editor.getDoc()).hasClass("showTags"))}}),n("editsource",{title:"Edit Raw XML",icon:" "+r+" edit-source",onclick:function(){t.dialogManager.show("editSource")}}),n("validate",{title:"Validate",icon:" "+r+" validate",onclick:function(){t.validate()}}),n("addtriple",{title:"Add Relation",icon:" "+r+" add-triple",onclick:function(){i("#westTabs").tabs("option","active",2),t.dialogManager.show("triple")}}),n("addtranslation",{title:"Add Translation",icon:" "+r+" translation",onclick:function(){t.dialogManager.show("translation")}}),n("fullscreen",{name:"fullscreen",title:"Toggle Fullscreen",icon:" "+r+" fullscreen-activate",onclick:function(){t.layoutManager.toggleFullScreen()}})}}),t.event("contentChanged").subscribe((function(){console.log("contentChanged")})),t.event("documentLoaded").subscribe((function(){t.editor.undoManager.clear(),t.editor.isNotDirty=!0,t.editor.getBody().focus()})),t.event("documentSaved").subscribe((function(){t.editor.isNotDirty=!0})),t.event("entityAdded").subscribe((function(){t.editor.isNotDirty=!1})),t.event("entityRemoved").subscribe((function(){t.editor.isNotDirty=!1})),t.event("entityEdited").subscribe((function(){t.editor.isNotDirty=!1}))},e.exports=o},,,,function(e,t,n){"use strict";var i=n(21);i.PluginManager.add("cwrcpath",(function(e){i.ui.CWRCPath=i.ui.Path.extend({postRender:function(){var t=this;function n(e){if(1===e.nodeType){if("BR"==e.nodeName||e.getAttribute("data-mce-bogus"))return!0;if("bookmark"===e.getAttribute("data-mce-type"))return!0}return!1}return e.writer.event("loadingDocument").subscribe((function(){t.row([])})),t.on("select",(function(t){var n=this.row()[t.index].element.getAttribute("id");e.writer.utilities.selectElementById(n,!1)})),e.on("nodeChange",(function(i){for(var a=[],o=i.parents,r=o.length;r--;){var s=o[r];if(1==s.nodeType&&!n(s)){var l=s.getAttribute("_tag"),c=s.getAttribute("id");if("entityHighlight"===c){var d=e.writer;c=d.entitiesManager.getCurrentEntity(),l=d.entitiesManager.getEntity(c).getTag()}null!=l&&a.push({name:l,element:s})}}t.row(a)})),t._super()}});new i.ui.CWRCPath(e)}))},function(e,t,n){"use strict";var i=n(1),a=n(21);n(186),a.PluginManager.add("schematags",(function(e){function t(t){t=void 0===t?"add":t;for(var n=[],i=e.writer.cwrcRootUrl+"img/",a=e.writer.schemaManager.schema.elements,o=0;o<a.length;o++){var r=a[o],s=r,l=e.writer.schemaManager.getFullNameForTag(r);""!==l&&(s+=" ("+l+")"),n.push({type:"menuitem",text:s,key:r,action:t,initialFilterState:null,image:i+"tag_blue.png",onclick:function(t){t.stopPropagation();var n=this.settings.key,i=this.settings.action;"add"==i?e.writer.tagger.addTagDialog(n,i):e.writer.tagger.changeTagDialog(n)}})}return n.push({type:"menuitem",text:"No tags available for current parent tag.",disabled:!0,hidden:!0,image:i+"cross.png",onclick:function(){}}),n}function n(e){var t=e.parent(),n=0;t.items().each((function(e){n+=i(e.getEl()).height()})),n=Math.min(n,400),t.layoutRect({h:n,minH:n}),t.repaint()}function o(a){i.extend(a,{layout:"stack",classes:"cwrc",onshow:function(t){if("menuitem"!=t.control.type){var a=t.control.items()[0],o=t.control.items()[1];a.value(""),"cwrcmenu"===o.type&&(!function(t){var n,a;if(null!=e.currentBookmark)for(n=e.currentBookmark.rng.commonAncestorContainer;3===n.nodeType;)n=n.parentNode;else n=e.currentNode;if(9===n.nodeType&&(n=i("body > [_tag]",n)[0]),null==(a=n.getAttribute("_tag"))){var o=n.getAttribute("id");if("entityHighlight"===o){var r=e.writer;o=r.entitiesManager.getCurrentEntity(),a=r.entitiesManager.getEntity(o).getTag()}else console.warn("schematags: in unknown tag",n)}var s=[];if(a!=e.writer.schemaManager.getHeader()){var l=e.writer.schemaManager.getChildrenForTag(a);s=l.map((function(e){return e.name}))}var c=0,d=0;if(t.items().each((function(e){c++,-1!=s.indexOf(e.settings.key)?(e.settings.initialFilterState=!1,e.disabled(!1),e.visible(!0)):(e.settings.initialFilterState=!0,e.disabled(!0),e.visible(!1),d++)})),c==d){var u=t.items().length;t.items()[u-1].disabled(!1),t.items()[u-1].visible(!0)}t.parent().reflow()}(o),o.show(),n(o),o.getEl().scrollTop=0)}},onPostRender:function(n){var a=n.control.items()[0],o=n.control.items()[1],r=this.settings.action,s=t(r);o.append(s),o.reflow(),i(a.getEl()).watermark("Filter"),i(a.getEl()).width(o.getEl().offsetWidth),e.writer.event("schemaLoaded").subscribe((function(){for(var e=o.items().toArray(),n=0;n<e.length;n++){var i=e[n];void 0!==i&&i.remove()}var a=t(r);o.append(a),o.reflow()}))},items:[{type:"textbox",onkeyup:function(e){var t=e.control.value(),i=e.control.parent().items()[1];i.items().each((function(e){""==t?(e.disabled(e.settings.initialFilterState),e.visible(!e.settings.initialFilterState)):!e.settings.initialFilterState&&e.settings.key&&-1!=e.settings.key.toLowerCase().indexOf(t)?(e.disabled(!1),e.visible(!0)):(e.disabled(!0),e.visible(!1))})),n(i)}},{type:"cwrcmenu",autohide:!1,style:"position: relative !important;",items:[]}]})}a.ui.Factory.add("cwrcmenu",a.ui.FloatPanel.extend({Defaults:{defaultType:"menuitem",border:1,layout:"stack",role:"application",bodyRole:"menu",ariaRoot:!0},init:function(e){if(e.autohide=null==e.autohide||e.autohide,e.constrainToViewport=!0,e.itemDefaults)for(var t=e.items,n=t.length;n--;)t[n]=Tools.extend({},e.itemDefaults,t[n]);this._super(e),this.classes.add("menu")},repaint:function(){return this.classes.toggle("menu-align",!0),this._super(),this.getEl().style.height="",this.getEl("body").style.height="",this},cancel:function(){this.hideAll(),this.fire("select")},hideAll:function(){return this.find("menuitem").exec("hideMenu"),this._super()},preRender:function(){var e=this;return e.items().each((function(t){var n=t.settings;if(n.icon||n.image||n.selectable)return e._hasIcons=!0,!1})),e._super()}})),a.ui.Factory.add("cwrcpanelbutton",a.ui.PanelButton.extend({showPanel:function(){var t=this,n=t.settings;if(t.active(!0),t.panel)t.panel.show();else{var o=n.panel;o.type&&(o={layout:"grid",items:o}),o.role=o.role||"dialog",o.popover=!1,o.autohide=!0,o.ariaRoot=!0,t.panel=new a.ui.FloatPanel(o).on("hide",(function(){t.active(!1)})).on("cancel",(function(e){e.stopPropagation(),t.focus(),t.hidePanel()})).parent(t).renderTo(t.getContainerElm()),t.panel.fire("show"),t.panel.reflow()}var r=i(t.getEl()),s=e.writer.utilities.getOffsetPosition(r);s.top+=r.outerHeight(),t.panel.moveTo(s.left,s.top)},hideMenu:function(){this.hidePanel()}})),e.addCommand("getFilterMenu",o);var r={};o(r),e.addButton("schematags",{type:"cwrcpanelbutton",text:"Tags",icon:" img tag",popoverAlign:["bl-tl","bl-tc"],panel:r})}))},function(e,t,n){!function(){"use strict";var e=n(21),t=e.each,i={paste_auto_cleanup_on_paste:!0,paste_enable_default_filters:!0,paste_block_drop:!1,paste_retain_style_properties:"none",paste_strip_class_attributes:"mso",paste_remove_spans:!1,paste_remove_styles:!1,paste_remove_styles_if_webkit:!0,paste_convert_middot_lists:!0,paste_convert_headers_to_strong:!1,paste_dialog_width:"450",paste_dialog_height:"400",paste_max_consecutive_linebreaks:2,paste_text_use_dialog:!1,paste_text_sticky:!1,paste_text_sticky_default:!1,paste_text_notifyalways:!1,paste_text_linebreaktype:"combined",paste_text_replacements:[[/\u2026/g,"..."],[/[\x93\x94\u201c\u201d]/g,'"'],[/[\x60\x91\x92\u2018\u2019]/g,"'"]]};function a(e,t){return e.getParam(t,i[t])}e.create("tinymce.plugins.TreePastePlugin",{init:function(n,i){var o=this;function r(t,i){var r,s=n.dom;o.onPreProcess.dispatch(o,t),t.node=s.create("div",0,t.content),e.isGecko&&(r=n.selection.getRng(!0)).startContainer==r.endContainer&&3==r.startContainer.nodeType&&1===t.node.childNodes.length&&/^(p|h[1-6]|pre)$/i.test(t.node.firstChild.nodeName)&&-1===t.content.indexOf("__MCE_ITEM__")&&s.remove(t.node.firstChild,!0),o.onPostProcess.dispatch(o,t),t.content=n.serializer.serialize(t.node,{getInner:1,forced_root_block:""}),!i&&n.pasteAsPlainText?(o._insertPlainText(t.content),a(n,"paste_text_sticky")||(n.pasteAsPlainText=!1,n.controlManager.setActive("pastetext",!1))):o._insert(t.content)}function s(i){var a,o,s,l,c,d,u=n.selection,p=n.dom,g=n.getBody();if((i.clipboardData||p.doc.dataTransfer)&&(d=(i.clipboardData||p.doc.dataTransfer).getData("Text"),n.pasteAsPlainText))return i.preventDefault(),void r({content:p.encode(d).replace(/\r?\n/g,"<br />")});if(!p.get("_mcePaste")){if(a=p.add(g,"div",{id:"_mcePaste",class:"mcePaste","data-mce-bogus":"1"},"\ufeff\ufeff"),c=g!=n.getDoc().body?p.getPos(n.selection.getStart(),g).y:g.scrollTop+p.getViewPort(n.getWin()).y,p.setStyles(a,{position:"absolute",left:e.isGecko?-40:0,top:c-25,width:1,height:1,overflow:"hidden"}),e.isIE)return l=u.getRng(),(s=p.doc.body.createTextRange()).moveToElementText(a),s.execCommand("Paste"),p.remove(a),"\ufeff\ufeff"===a.innerHTML?(n.execCommand("mcePasteWord"),void i.preventDefault()):(u.setRng(l),u.setContent(""),setTimeout((function(){r({content:a.innerHTML})}),0),e.dom.Event.cancel(i));var f=function(e){e.preventDefault()};p.bind(n.getDoc(),"mousedown",f),p.bind(n.getDoc(),"keydown",f),o=n.selection.getRng(),a=a.firstChild,(s=n.getDoc().createRange()).setStart(a,0),s.setEnd(a,2),u.setRng(s),window.setTimeout((function(){var e,i="";if(p.select("div.mcePaste > div.mcePaste").length?i="<p>"+p.encode(d).replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br />")+"</p>":(e=p.select("div.mcePaste"),t(e,(function(e){var n=e.firstChild;n&&"DIV"==n.nodeName&&n.style.marginTop&&n.style.backgroundColor&&p.remove(n,1),t(p.select("span.Apple-style-span",e),(function(e){p.remove(e,1)})),t(p.select("br[data-mce-bogus]",e),(function(e){p.remove(e)})),"mcePaste"!=e.parentNode.className&&(i+=e.innerHTML)}))),null!=n.copiedElement.element){var a='id="'+$("[id]",n.copiedElement.element).attr("id")+'"';if(-1!=i.search(a))if(0==n.copiedElement.selectionType)i=n.copiedElement.element.innerHTML;else{var s=$(n.writer.tagName,n.copiedElement.element).first()[0];s&&(i=s.innerHTML)}else n.copiedElement.element=null}t(p.select("div.mcePaste"),(function(e){p.remove(e)})),o&&u.setRng(o),r({content:i}),p.unbind(n.getDoc(),"mousedown",f),p.unbind(n.getDoc(),"keydown",f)}),0)}}o.editor=n,o.url=i,o.onPreProcess=new e.util.Dispatcher(o),o.onPostProcess=new e.util.Dispatcher(o),o.onPreProcess.add(o._preProcess),o.onPostProcess.add(o._postProcess),o.onPreProcess.add((function(e,t){n.execCallback("paste_preprocess",e,t)})),o.onPostProcess.add((function(e,t){n.execCallback("paste_postprocess",e,t)})),n.onKeyDown.addToTop((function(t,n){if((e.isMac?n.metaKey:n.ctrlKey)&&86==n.keyCode||n.shiftKey&&45==n.keyCode)return!1})),n.pasteAsPlainText=a(n,"paste_text_sticky_default"),n.addCommand("mceInsertClipboardContent",(function(e,t){r(t,!0)})),a(n,"paste_text_use_dialog")||n.addCommand("mcePasteText",(function(t,i){var o=e.util.Cookie;n.pasteAsPlainText=!n.pasteAsPlainText,n.controlManager.setActive("pastetext",n.pasteAsPlainText),n.pasteAsPlainText&&!o.get("tinymcePasteText")&&(a(n,"paste_text_sticky")?n.windowManager.alert(n.translate("paste.plaintext_mode_sticky")):n.windowManager.alert(n.translate("paste.plaintext_mode")),a(n,"paste_text_notifyalways")||o.set("tinymcePasteText","1",new Date((new Date).getFullYear()+1,12,31)))})),n.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"}),n.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"}),a(n,"paste_auto_cleanup_on_paste")&&(e.isOpera||/Firefox\/2/.test(navigator.userAgent)?n.onKeyDown.addToTop((function(t,n){((e.isMac?n.metaKey:n.ctrlKey)&&86==n.keyCode||n.shiftKey&&45==n.keyCode)&&s(n)})):n.onPaste.addToTop((function(e,t){return s(t)}))),n.onInit.add((function(){n.controlManager.setActive("pastetext",n.pasteAsPlainText),a(n,"paste_block_drop")&&n.dom.bind(n.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],(function(e){return e.preventDefault(),e.stopPropagation(),!1}))}))},getInfo:function(){return{longname:"Tree paste",version:e.majorVersion+"."+e.minorVersion}},_preProcess:function(n,i){var o,r,s=this.editor,l=i.content,c=e.grep,d=e.explode,u=e.trim;function p(e){t(e,(function(e){l=e.constructor==RegExp?l.replace(e,""):l.replace(e[0],e[1])}))}if(0!=s.settings.paste_enable_default_filters){if(e.isIE&&document.documentMode>=9&&/<(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)/.test(i.content)&&(p([[/(?:<br>&nbsp;[\s\r\n]+|<br>)*(<\/?(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)[^>]*>)(?:<br>&nbsp;[\s\r\n]+|<br>)*/g,"$1"]]),p([[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])),/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(l)||i.wordContent){i.wordContent=!0,p([/^\s*(&nbsp;)+/gi,/(&nbsp;|<br[^>]*>)+\s*$/gi]),a(s,"paste_convert_headers_to_strong")&&(l=l.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>")),a(s,"paste_convert_middot_lists")&&p([[/<!--\[if !supportLists\]-->/gi,"$&__MCE_ITEM__"],[/(<span[^>]+(?:mso-list:|:\s*symbol)[^>]+>)/gi,"$1__MCE_ITEM__"],[/(<p[^>]+(?:MsoListParagraph)[^>]+>)/gi,"$1__MCE_ITEM__"]]),p([/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,""]]);do{o=l.length,l=l.replace(/(<[a-z][^>]*\s)(?:id|name|language|type|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1")}while(o!=l.length);0==a(s,"paste_retain_style_properties").replace(/^none$/i,"").length?l=l.replace(/<\/?span[^>]*>/gi,""):p([[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(e,t){return t.length>0?t.replace(/./," ").slice(Math.floor(t.length/2)).split("").join(""):""}],[/(<[a-z][^>]*)\sstyle=('|")([^('|")]*)('|")/gi,function(e,n,i){var a=[],o=0,r=d(u(i).replace(/&quot;/gi,"'"),";");return t(r,(function(e){var t,n,i=d(e,":");function r(e){return e+("0"!==e&&/\d$/.test(e))?"px":""}if(2==i.length){switch(t=i[0].toLowerCase(),n=i[1].toLowerCase(),t){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":return void(a[o++]=t.replace(/^mso-|-alt$/g,"")+":"+r(n));case"horiz-align":return void(a[o++]="text-align:"+n);case"vert-align":return void(a[o++]="vertical-align:"+n);case"font-color":case"mso-foreground":return void(a[o++]="color:"+n);case"mso-background":case"mso-highlight":return void(a[o++]="background:"+n);case"mso-default-height":return void(a[o++]="min-height:"+r(n));case"mso-default-width":return void(a[o++]="min-width:"+r(n));case"mso-padding-between-alt":return void(a[o++]="border-collapse:separate;border-spacing:"+r(n));case"text-line-through":return void("single"!=n&&"double"!=n||(a[o++]="text-decoration:line-through"));case"mso-zero-height":return void("yes"==n&&(a[o++]="display:none"))}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(t))return;a[o++]=t+":"+i[1]}})),o>0?n+' style="'+a.join(";")+'"':n}]])}if(a(s,"paste_convert_headers_to_strong")&&p([[/<h[1-6][^>]*>/gi,"<p><strong>"],[/<\/h[1-6][^>]*>/gi,"</strong></p>"]]),p([[/Version:[\d.]+\nStartHTML:\d+\nEndHTML:\d+\nStartFragment:\d+\nEndFragment:\d+/gi,""]]),"none"!==(r=a(s,"paste_strip_class_attributes"))){var g=function(e,t){if("all"===r)return"";var n=c(d(t.replace(/^(["'])(.*)\1$/,"$2")," "),(function(e){return/^(?!mso)/i.test(e)}));return n.length?' class="'+n.join(" ")+'"':""};l=(l=l.replace(/ class="([^"]+)"/gi,g)).replace(/ class=([\-\w]+)/gi,g)}a(s,"paste_remove_spans")&&(l=l.replace(/<\/?span[^>]*>/gi,"")),i.content=l}},_postProcess:function(n,i){var o,r=this.editor,s=r.dom;0!=r.settings.paste_enable_default_filters&&(i.wordContent&&(t(s.select("a",i.node),(function(e){e.href&&-1==e.href.indexOf("#_Toc")||s.remove(e,1)})),a(r,"paste_convert_middot_lists")&&this._convertLists(n,i),o=a(r,"paste_retain_style_properties"),e.is(o,"string")&&"all"!==o&&"*"!==o&&(o=e.explode(o.replace(/^none$/i,"")),t(s.select("*",i.node),(function(e){var t,n,i,a={},r=0;if(o)for(t=0;t<o.length;t++)n=o[t],(i=s.getStyle(e,n))&&(a[n]=i,r++);s.setAttrib(e,"style",""),o&&r>0?s.setStyles(e,a):"SPAN"!=e.nodeName||e.className||s.remove(e,!0)})))),a(r,"paste_remove_styles")||a(r,"paste_remove_styles_if_webkit")&&e.isWebKit?t(s.select("*[style]",i.node),(function(e){e.removeAttribute("style"),e.removeAttribute("data-mce-style")})):e.isWebKit&&t(s.select("*",i.node),(function(e){e.removeAttribute("data-mce-style")})))},_convertLists:function(n,i){var a,o,r,s,l,c=n.editor.dom,d=-1,u=[];t(c.select("p",i.node),(function(n){var i,l,p,g,f,h="";for(i=n.firstChild;i&&3==i.nodeType;i=i.nextSibling)h+=i.nodeValue;h=n.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g,""),/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*\u00a0*/.test(h)&&(l="ul"),/^__MCE_ITEM__\s*\w+\.\s*\u00a0+/.test(h)&&(l="ol"),l?((r=parseFloat(n.style.marginLeft||0))>d&&u.push(r),a&&l==s?r>d?a=o.appendChild(c.create(l)):r<d&&(g=e.inArray(u,r),f=c.getParents(a.parentNode,l),a=f[f.length-1-g]||a):(a=c.create(l),c.insertAfter(a,n)),t(c.select("span",n),(function(e){var t=e.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");("ul"==l&&/^__MCE_ITEM__[\u2022\u00b7\u00a7\u00d8o\u25CF]/.test(t)||/^__MCE_ITEM__[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(t))&&c.remove(e)})),p=n.innerHTML,p="ul"==l?n.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*(&nbsp;|\u00a0)+\s*/,""):n.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,""),o=a.appendChild(c.create("li",0,p)),c.remove(n),d=r,s=l):a=d=0})),-1!=(l=i.node.innerHTML).indexOf("__MCE_ITEM__")&&(i.node.innerHTML=l.replace(/__MCE_ITEM__/g,""))},_insert:function(e,t){var n=this.editor,i=n.selection.getRng(),a=n.writer.tree;null!=a.selectionType?a.selectionType==a.CONTENTS_SELECTED?$("#"+a.currentlySelectedNodes[0],n.getBody()).html(e):$("#"+a.currentlySelectedNodes[0],n.getBody()).replaceWith(e):(n.selection.isCollapsed()||i.startContainer==i.endContainer||n.getDoc().execCommand("Delete",!1,null),n.execCommand("mceInsertContent",!1,e,{skip_undo:t}))},_insertPlainText:function(n){var i=this.editor,o=a(i,"paste_text_linebreaktype"),r=a(i,"paste_text_replacements"),s=e.is;function l(e){t(e,(function(e){n=e.constructor==RegExp?n.replace(e,""):n.replace(e[0],e[1])}))}if("string"==typeof n&&n.length>0){/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(n)?l([/[\n\r]+/g]):l([/\r+/g]),l([[/<\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi,"\n\n"],[/<br[^>]*>|<\/tr>/gi,"\n"],[/<\/t[dh]>\s*<t[dh][^>]*>/gi,"\t"],/<[a-z!\/?][^>]*>/gi,[/&nbsp;/gi," "],[/(?:(?!\n)\s)*(\n+)(?:(?!\n)\s)*/gi,"$1"]]);var c=Number(a(i,"paste_max_consecutive_linebreaks"));if(c>-1){for(var d=new RegExp("\n{"+(c+1)+",}","g"),u="";u.length<c;)u+="\n";l([[d,u]])}n=i.dom.decode(e.html.Entities.encodeRaw(n)),s(r,"array")?l(r):s(r,"string")&&l(new RegExp(r,"gi")),l("none"==o?[[/\n+/g," "]]:"br"==o?[[/\n/g,"<br />"]]:"p"==o?[[/\n+/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"]]:[[/\n\n/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"],[/\n/g,"<br />"]]),i.execCommand("mceInsertContent",!1,n)}}}),e.PluginManager.add("treepaste",e.plugins.TreePastePlugin)}()},function(e,t,n){"use strict";function i(e,t){return e.indexOf(t)>-1}function a(e,t,n){return e>=t&&e<=n}function o(e){return e.preventDefault(),e.stopPropagation(),!1}function r(e,t,n){var i;i="back"===n?t.commonAncestorContainer.previousElementSibling||t.commonAncestorContainer.parentElement:t.commonAncestorContainer.nextElementSibling||t.commonAncestorContainer.parentElement;var a=e.writer.schemaManager.wouldDeleteInvalidate(i,!0,!1),o='<p>Delete "'.concat(i.getAttribute("_tag"),'" element?</p>'),r="confirm-delete-tag";a&&(o='<p>Deleting the "'.concat(i.getAttribute("_tag"),'" element will make the document invalid. Do you wish to continue?</p>'),r="confirm-delete-tag-invalidating"),e.writer.dialogManager.confirm({title:"Warning",msg:o,showConfirmKey:r,type:"info",callback:function(a){var o;if(o="back"===n?e.writer.utilities.getPreviousTextNode(t.commonAncestorContainer,!0):e.writer.utilities.getNextTextNode(t.commonAncestorContainer,!0),a){var r="\ufeff"!==i.textContent;e.writer.tagger.removeStructureTag(i.getAttribute("id"),!r)}if(null!==o&&null!==o.parentNode){var s=e.selection.getRng();s.selectNode(o),s.collapse("back"!==n),e.selection.setRng(s)}e.focus()}})}function s(e,t,n,i){var a;if(null!==(a="back"===i?t.writer.utilities.getPreviousTextNode(n.commonAncestorContainer,!0):t.writer.utilities.getNextTextNode(n.commonAncestorContainer,!0))&&null!==a.parentNode){if(0===(l=a.parentElement).textContent.length||1===l.textContent.length&&65279===l.textContent.charCodeAt(0)){var s=t.selection.getRng();return"back"===i?(s.setStart(a,a.textContent.length),s.setEnd(a,a.textContent.length)):(s.setStart(a,0),s.setEnd(a,0)),r(t,s,i),o(e)}if("SPAN"===a.parentElement.nodeName){var l;if(1===a.parentElement.textContent.length)return(l=a.parentElement).textContent="\ufeff",(s=t.selection.getRng()).setStart(l.firstChild,1),s.setEnd(l.firstChild,1),t.selection.setRng(s),o(e)}else{s=t.selection.getRng();"back"===i?(s.setStart(a,a.textContent.length),s.setEnd(a,a.textContent.length)):(s.setStart(a,0),s.setEnd(a,0)),t.selection.setRng(s)}}}n(21).PluginManager.add("preventdelete",(function(e){e.on("keydown",(function(t){if(function(e){var t=e.keyCode;return e.ctrlKey?"x"==e.key||i([8,46],t):i([8,9,13,46],t)||a(t,48,57)||a(t,65,90)||a(t,96,111)||a(t,186,192)||a(t,219,222)}(t)){var n=e.selection.getRng();if(n.collapsed&&n.commonAncestorContainer.nodeType===Node.TEXT_NODE){var l=n.commonAncestorContainer;if(8===t.keyCode){if(0===n.startOffset)return 0===l.textContent.length?(r(e,n,"back"),o(t)):s(t,e,n,"back");if(1===n.startOffset&&1===l.textContent.length)return 65279===l.textContent.charCodeAt(0)?null===l.previousSibling?(r(e,n,"back"),o(t)):s(t,e,n,"back"):(l.textContent="\ufeff",n.setStart(l,1),e.selection.setRng(n),o(t));if(2===n.startOffset&&2===l.textContent.length&&65279===l.textContent.charCodeAt(0))return l.textContent="\ufeff",n.setStart(l,1),e.selection.setRng(n),o(t)}if(46===t.keyCode){if(n.startOffset===l.length)return 0===l.length?(r(e,n,"forward"),o(t)):s(t,e,n,"forward");if(n.startOffset===l.length-1&&1===l.length)return 65279===l.textContent.charCodeAt(0)?null===l.nextSibling?(r(e,n,"forward"),o(t)):s(t,e,n,"forward"):(l.textContent="\ufeff",n.setStart(l,0),e.selection.setRng(n),o(t))}}else{var c=!1,d=n.cloneContents();if(1===d.childNodes.length&&d.childNodes[0].nodeType===Node.ELEMENT_NODE)c=!0;else for(var u=0;u<d.childNodes.length;u++){if(d.childNodes[u].nodeType===Node.ELEMENT_NODE){var p=d.childNodes[u-1],g=d.childNodes[u+1];if(void 0!==p&&void 0!==g){c=!0;break}}}if(c)return e.writer.dialogManager.confirm({title:"Warning",msg:"<p>The text you are trying to delete contains XML elements, do you want to proceed?</p>",showConfirmKey:"confirm-delete-tags-selection",type:"info",callback:function(i){i&&(e.writer.tagger.processRemovedContent(n),e.focus(),8===t.keyCode||46===t.keyCode?e.getDoc().execCommand("insertText",!1,""):e.getDoc().execCommand("insertText",!1,t.key),e.writer.event("contentChanged").publish(),e.undoManager.add())}}),o(t)}}}))}))},,function(e,t,n){"use strict";n.r(t);var i=n(5),a=n.n(i);function o(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{headers:{Accept:"application/json"}},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,i=new Promise((function(e,t){var i=setTimeout((function(){clearTimeout(i),t("Call to DBPedia timed out")}),n)}));return Promise.race([fetch(e,t),i])},s=function(e,t){return"https://lookup.services.cwrc.ca/dbpedia/api/search/KeywordSearch?QueryClass=".concat(t,"&MaxHits=5&QueryString=").concat(encodeURIComponent(e))},l=function(e){return s(e,"person")},c=function(e){return s(e,"place")},d=function(e){return s(e,"organisation")},u=function(e){return s(e,"work")},p=function(e){return s(e,"thing")},g=function(){var e,t=(e=a.a.mark((function e(t,n,i){var o,s,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(t).catch((function(e){return e}));case 2:if((o=e.sent).ok){e.next=5;break}throw new Error("Something wrong with the call to DBPedia, possibly a problem with the network or the server. HTTP error: ".concat(o.status));case 5:return e.next=7,o.json();case 7:return s=e.sent,l=s.results.map((function(e){var t=e.uri,a=e.label,o=e.description,r=void 0===o?"No description available":o;return{nameType:i,id:t,uri:t,uriForDisplay:t.replace("http://dbpedia.org","https://dbpedia.lookup.services.cwrc.ca"),name:a,repository:"dbpedia",originalQueryString:n,description:r}})),e.abrupt("return",l);case 10:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function s(e){o(r,i,a,s,l,"next",e)}function l(e){o(r,i,a,s,l,"throw",e)}s(void 0)}))});return function(e,n,i){return t.apply(this,arguments)}}(),f={findPerson:function(e){return g(l(e),e,"person")},findPlace:function(e){return g(c(e),e,"place")},findOrganization:function(e){return g(d(e),e,"organisation")},findTitle:function(e){return g(u(e),e,"work")},findRS:function(e){return g(p(e),e,"thing")},getPersonLookupURI:l,getPlaceLookupURI:c,getOrganizationLookupURI:d,getTitleLookupURI:u,getRSLookupURI:p},h={_username:"",set username(e){this._username=e},get username(){return this._username}};function m(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function r(e){m(o,i,a,r,s,"next",e)}function s(e){m(o,i,a,r,s,"throw",e)}r(void 0)}))}}var y=function(){var e=v(a.a.mark((function e(t){var n,i,o,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{headers:{Accept:"application/json"}},i=r.length>2&&void 0!==r[2]?r[2]:3e3,o=new Promise((function(e,t){var n=setTimeout((function(){clearTimeout(n),t("Call to geonames timed out")}),i)})),e.abrupt("return",Promise.race([fetch(t,n),o]));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(e){return"https://secure.geonames.org/searchJSON?q=".concat(encodeURIComponent(e),"&username=").concat(h.username,"&maxRows=10")},w=function(){var e=v(a.a.mark((function e(t,n){var i,o,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==h.username){e.next=2;break}throw new Error('You must provide a username to make requests to GeoNames. See instruction here: <a href=https://github.com/cwrc/CWRC-GitWriter target="blank" rel="noopener noreferrer">https://github.com/cwrc/CWRC-GitWriter</a>');case 2:return e.next=4,y(t).catch((function(e){return e}));case 4:if((i=e.sent).ok){e.next=7;break}throw new Error("Something wrong with the call to geonames, possibly a problem with the network or the server. HTTP error: ".concat(i.status));case 7:return e.next=9,i.json();case 9:return o=e.sent,r=o.geonames.map((function(e){var t=e.toponymName,i=e.adminName1,a=void 0===i?"":i,o=e.countryName,r=void 0===o?"":o,s=e.geonameId,l=e.fcodeName,c=void 0===l?"No description available":l,d="".concat(t," ").concat(a," ").concat(r),u="http://geonames.org/".concat(s);return{nameType:"place",id:u,uri:u,uriForDisplay:null,externalLink:u,name:d,repository:"geonames",originalQueryString:n,description:c}})),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),_={findPlace:function(e){return w(b(e),e)},getPlaceLookupURI:b,credentials:h};function x(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}var C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,i=new Promise((function(e,t){var i=setTimeout((function(){clearTimeout(i),t("Call to Getty timed out")}),n)}));return Promise.race([fetch(e,t),i])},k=function(e,t){return"https://lookup.services.cwrc.ca/getty/sparql.json?query="+encodeURIComponent('select ?Subject ?Term ?Parents ?Descr ?ScopeNote ?Type (coalesce(?Type1,?Type2) as ?ExtraType) {\n        ?Subject luc:term "'.concat(e,'"; a ?typ; skos:inScheme ').concat(t,":.\n        ?typ rdfs:subClassOf gvp:Subject; rdfs:label ?Type.\n        filter (?typ != gvp:Subject)\n        optional {?Subject gvp:placeTypePreferred [gvp:prefLabelGVP [xl:literalForm ?Type1]]}\n        optional {?Subject gvp:agentTypePreferred [gvp:prefLabelGVP [xl:literalForm ?Type2]]}\n        optional {?Subject gvp:prefLabelGVP [xl:literalForm ?Term]}\n        optional {?Subject gvp:parentStringAbbrev ?Parents}\n        optional {?Subject foaf:focus/gvp:biographyPreferred/schema:description ?Descr}\n        optional {?Subject skos:scopeNote [dct:language gvp_lang:en; rdf:value ?ScopeNote]}}\n        LIMIT 5"))},T=function(e){return k(e,"ulan")},E=function(e){return k(e,"tgn")},S=function(){var e,t=(e=a.a.mark((function e(t,n,i){var o,r,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C(t).catch((function(e){return e}));case 2:if((o=e.sent).ok){e.next=5;break}throw new Error("Something wrong with the call to Getty, possibly a problem with the network or the server. HTTP error: ".concat(o.status));case 5:return e.next=7,o.json();case 7:return r=e.sent,s=r.results.bindings.map((function(e){var t=e.Subject.value,a=e.Term.value,o=e.Descr,r=(o=void 0===o?"No description available":o).value,s=void 0===r?"No description available":r;return{nameType:i,id:t,uri:t,uriForDisplay:t.replace("http://vocab.getty.edu","https://getty.lookup.services.cwrc.ca"),name:a,repository:"getty",originalQueryString:n,description:s}})),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function r(e){x(o,i,a,r,s,"next",e)}function s(e){x(o,i,a,r,s,"throw",e)}r(void 0)}))});return function(e,n,i){return t.apply(this,arguments)}}(),D={findPerson:function(e){return S(T(e),e,"ulan")},findPlace:function(e){return S(E(e),e,"tgn")},getPersonLookupURI:T,getPlaceLookupURI:E};function M(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}var R=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,i=new Promise((function(e,t){var i=setTimeout((function(){clearTimeout(i),t("Call to VIAF timed out")}),n)}));return Promise.race([fetch(e,t),i])},A=function(e,t){return"https://viaf.org/viaf/search?query=".concat(t,"+all+%22").concat(encodeURIComponent(e),"%22&httpAccept=application/json&maximumRecords=5")},P=function(e){return A(e,"local.personalNames")},N=function(e){return A(e,"local.geographicNames")},$=function(e){return A(e,"local.corporateNames")},O=function(e){return A(e,"local.uniformTitleWorks")},I=function(e){return A(e,"local.names")},L=function(){var e,t=(e=a.a.mark((function e(t,n){var i,o,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(t).catch((function(e){return e}));case 2:if((i=e.sent).ok){e.next=5;break}throw new Error("Something wrong with the call to VIAF, possibly a problem with the network or the server. HTTP error: ".concat(i.status));case 5:return e.next=7,i.json();case 7:return o=e.sent,r=o.searchRetrieveResponse.records?o.searchRetrieveResponse.records.map((function(e){var t=e.record.recordData,i=t.nameType,a=t.Document["@about"],o=t.mainHeadings.data;return{nameType:i,id:a,uri:a,uriForDisplay:null,externalLink:a,name:Array.isArray(o)?o[0].text:o.text,repository:"VIAF",originalQueryString:n}})):[],e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function r(e){M(o,i,a,r,s,"next",e)}function s(e){M(o,i,a,r,s,"throw",e)}r(void 0)}))});return function(e,n){return t.apply(this,arguments)}}(),z={findPerson:function(e){return L(P(e),e)},findPlace:function(e){return L(N(e),e)},findOrganization:function(e){return L($(e),e)},findTitle:function(e){return L(O(e),e)},findRS:function(e){return L(I(e),e)},getPersonLookupURI:P,getPlaceLookupURI:N,getOrganizationLookupURI:$,getTitleLookupURI:O,getRSLookupURI:I,fetchWithTimeout:R},F=n(188),j=n.n(F);function B(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}var U=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4,i=new Promise((function(e,t){var i=setTimeout((function(){clearTimeout(i),t("Call to Wikidata timed out")}),n)}));return Promise.race([fetch(e,t),i])},W=function(e){return j.a.searchEntities({search:e,format:"json",language:"en",limit:5})},H=function(e){return W(e)},V=function(e){return W(e)},X=function(e){return W(e)},q=function(e){return W(e)},Y=function(e){return W(e)},K=function(){var e,t=(e=a.a.mark((function e(t,n){var i,o,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(t).catch((function(e){return e}));case 2:if((i=e.sent).ok){e.next=5;break}throw new Error("Something wrong with the call to Wikidata, possibly a problem with the network or the server. HTTP error: ".concat(i.status));case 5:return e.next=7,i.json();case 7:return o=e.sent,r=o.search.map((function(e){var t=e.concepturi,i=e.label,a=e.description;return{nameType:"unknown",id:t,uriForDisplay:t.replace("http","https"),uri:t,name:i,repository:"wikidata",originalQueryString:n,description:a}})),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function r(e){B(o,i,a,r,s,"next",e)}function s(e){B(o,i,a,r,s,"throw",e)}r(void 0)}))});return function(e,n){return t.apply(this,arguments)}}(),G={findPerson:function(e){return K(H(e),e)},findPlace:function(e){return K(V(e),e)},findOrganization:function(e){return K(X(e),e)},findTitle:function(e){return K(q(e),e)},findRS:function(e){return K(Y(e),e)},getPersonLookupURI:H,getPlaceLookupURI:V,getOrganizationLookupURI:X,getTitleLookupURI:q,getRSLookupURI:Y,fetchWithTimeout:U},J=n(12),Q=n.n(J),Z=n(10),ee=n.n(Z),te=n(1),ne=n.n(te);n(6);function ie(e,t,n,i,a,o,r){try{var s=e[o](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}function ae(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oe(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a,o=!0,r=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return o=e.done,e},e:function(e){r=!0,a=e},f:function(){try{o||null==i.return||i.return()}finally{if(r)throw a}}}}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var re=function(e,t){var n=e,i={fontSize:"11pt",showEntities:!1,showTags:!1};ne.a.extend(i,t);var o={mode:n.mode,annotationMode:n.annotationMode,allowOverlap:n.allowOverlap};ne.a.extend(o,i),ne()('<div class="helpLink"><a href="https://cwrc.ca/Documentation/CWRC-Writer" target="_blank">Help</a></div>').prependTo(n.layoutManager.getHeaderButtonsParent());var r=ne()('<div class="settingsLink">Settings</div>').prependTo(n.layoutManager.getHeaderButtonsParent()),s=8,l=18,c=ne()('\n    <div>\n        <div>\n            <label>Font Size</label>\n            <select name="fontsize">\n                '.concat(function(){for(var e=s,t="";e<=l;)t+='<option value="'.concat(e,'pt">').concat(e,"pt</option>\n"),e++;return t}(),'\n\n\n\n\n            </select>\n        </div>\n        <div style="margin-top: 10px;">\n            <label>Show Entities <input type="checkbox" name="showEntities" class="showentities" /></label>\n        </div>\n        <div style="margin-top: 10px;">\n            <label>Show Tags <input type="checkbox" name="showTags" class="showtags" /></label>\n        </div>\n        <div class="settingsDialogAdvanced">\n            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #aaa;">\n                <label>Editor Mode</label>\n                <select name="editormode">\n                    <option value="xml">XML only (no overlap)</option>\n                    <option value="xmlrdf">XML and RDF (no overlap)</option>\n                    <option value="xmlrdfoverlap">XML and RDF (overlapping entities)</option>\n                    <option value="rdf">RDF only</option>\n                </select>\n            </div>\n            <div style="margin-top: 10px;">\n                <label>Annotations Format</label>\n                <select name="annotations">\n                    <option value="xml">RDF/XML</option>\n                    <option value="json">JSON-LD</option>\n                </select>\n            </div>\n            <div style="margin-top: 10px;">\n                <label>Schema</label>\n                <select name="schema">\n                ').concat(function(){var e,t="",i=ae(n.schemaManager.schemas);try{for(i.s();!(e=i.n()).done;){var a=e.value;t+='<option value="'.concat(a.id,'">').concat(a.name,"</option>")}}catch(e){i.e(e)}finally{i.f()}return t}(),'\n                </select>\n                <br/><br/><button type="button" name="addSchemaButton">Add Schema</button>\n            </div>\n            <div style="margin-top: 10px;">\n                <button type="button" name="resetConfirmButton">Reset Confirmation Dialog Preferences</button>\n            </div>\n        </div>\n    </div>\n    ')).appendTo(n.dialogManager.getDialogWrapper());ne()('select[name="fontsize"]',c).change((function(e){var t={fontSize:e.currentTarget.value};n.editor.dom.setStyles(n.editor.dom.getRoot(),t),i.fontSize=t})),ne()(".showtags").click((function(e){var t=ne()(e.currentTarget).is(":checked");i.showTags!=t&&ne()("body",n.editor.getDoc()).toggleClass("showTags"),i.showTags=t})),ne()(".showentities").click((function(e){var t=ne()(e.currentTarget).is(":checked");i.showEntities!=t&&ne()("body",n.editor.getDoc()).toggleClass("showEntities"),i.showEntities=t})),ne()('select[name="annotations"]',c).change((function(e){var t=e.currentTarget.value;i.annotationMode=t,"xml"===i.annotationMode?n.annotationMode=n.XML:n.annotationMode=n.JSON})),ne()('button[name="addSchemaButton"]',c).button().click((function(){n.dialogManager.show("addschema")})),ne()('button[name="resetConfirmButton"]',c).button().click((function(){n.dialogManager.clearDialogPrefs(),n.dialogManager.show("message",{title:"Settings",msg:"Confirmation dialog preferences have been reset.",height:200})})),r.click((function(){ne()('select[name="fontsize"] > option[value="'+i.fontSize+'"]',c).prop("selected",!0),c.find(".showentities").prop("checked",i.showEntities),c.find(".showtags").prop("checked",i.showTags),n.mode===n.XML?ne()('select[name="editormode"] > option[value="xml"]',c).prop("selected",!0):n.mode===n.XMLRDF?n.allowOverlap?ne()('select[name="editormode"] > option[value="xmlrdfoverlap"]',c).prop("selected",!0):ne()('select[name="editormode"] > option[value="xmlrdf"]',c).prop("selected",!0):n.mode===n.RDF&&ne()('select[name="editormode"] > option[value="rdf"]',c).prop("selected",!0),n.annotationMode===n.XML?ne()('select[name="annotations"] > option[value="xml"]',c).prop("selected",!0):ne()('select[name="annotations"] > option[value="json"]',c).prop("selected",!0),ne()('select[name="schema"] > option[value="'+n.schemaManager.schemaId+'"]',c).prop("selected",!0),c.dialog("open")})),c.dialog({title:"Settings",modal:!0,resizable:!1,dialogClass:"splitButtons",closeOnEscape:!0,height:450,width:450,position:{my:"center",at:"center",of:n.layoutManager.getContainer()},autoOpen:!1,buttons:[{text:"Revert to Defaults",role:"revert",class:"left",click:function(){g(),u()}},{text:"Cancel",role:"cancel",click:function(){c.dialog("close")}},{text:"Apply",role:"ok",click:function(){u()}}]});var d=function(){var e,t=(e=a.a.mark((function e(t){var i,o,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t&&("xml"===t?(n.mode=n.XML,n.allowOverlap=!1):"xmlrdf"===t?(n.mode=n.XMLRDF,n.allowOverlap=!1):"xmlrdfoverlap"===t?(n.mode=n.XMLRDF,n.allowOverlap=!0):"rdf"===t&&(n.mode=n.RDF,n.allowOverlap=!0)),(i=ne()('select[name="schema"]',c).val())===n.schemaManager.schemaId){e.next=12;break}return p(!0),e.next=6,n.schemaManager.getRootForSchema(i).catch((function(){console.warn("getRootSchema failed"),c.dialog("close"),n.event("schemaChanged").publish(i)}));case 6:o=e.sent,p(!1),r=n.utilities.getRootTag().attr("_tag"),null===o?(n.dialogManager.show("message",{title:"Error",msg:"The root element of the schema could not be determined and so it will not be used.",type:"error"}),c.dialog("close")):r!==o?n.dialogManager.confirm({title:"Warning",msg:"<p>The root element (".concat(o,") required by the selected schema is different from the root element (").concat(r,") of the current document.</p>\n                          <p>Applying this schema change will cause a document loading error.</p>\n                          <p>Continue?</p>"),type:"info",callback:function(e){e?(c.dialog("close"),n.event("schemaChanged").publish(i)):ne()('select[name="schema"] > option[value="'.concat(n.schemaManager.schemaId,'"]'),c).prop("selected",!0)}}):(c.dialog("close"),n.event("schemaChanged").publish(i)),e.next=13;break;case 12:c.dialog("close");case 13:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function r(e){ie(o,i,a,r,s,"next",e)}function s(e){ie(o,i,a,r,s,"throw",e)}r(void 0)}))});return function(e){return t.apply(this,arguments)}}(),u=function(){var e=ne()('select[name="editormode"]',c).val(),t=!1;if("xml"===e?n.mode!==n.XML&&(t=!0):"xmlrdf"===e?n.mode===n.XMLRDF&&!0!==n.allowOverlap||(t=!0):"xmlrdfoverlap"===e?n.mode===n.XMLRDF&&!1!==n.allowOverlap||(t=!0):"rdf"===e&&(n.mode===n.RDF&&!1!==n.allowOverlap||(t=!0)),t){var i,a=n.entitiesManager.doEntitiesOverlap();"xml"===e&&(i="If you select the XML only mode, no RDF will be created when tagging entities.<br/>Furthermore, the existing RDF annotations will be discarded.<br/><br/>Do you wish to continue?"),"xmlrdf"===e&&n.mode===n.XML&&(i="XML tags and RDF/Semantic Web annotations equivalent to the XML tags will be created, consistent with the hierarchy of the XML schema, so annotations will not be allowed to overlap.<br/><br/>Do you wish to continue?"),!1===n.allowOverlap&&"xmlrdfoverlap"===e&&(i="The editor mode will be switched to XML and RDF (Overlapping Entities) and only RDF will be created for entities that overlap existing XML structures.<br/><br/>Do you wish to continue?"),n.allowOverlap&&"xmlrdfoverlap"!==e&&a&&(i="You have overlapping entities and are attemping to switch to a mode which prohibits them.<br/>The overlapping entities will be discarded if you continue.<br/><br/>Do you wish to continue?"),void 0!==i?n.dialogManager.confirm({title:"Warning",msg:i,callback:function(t){t&&("xmlrdfoverlap"!==e&&(n.entitiesManager.removeOverlappingEntities(),n.entitiesManager.convertBoundaryEntitiesToTags()),d(e))}}):d(e)}else d()},p=function(e){var t=c.dialog("option","buttons");e?(t[2].icon="ui-icon-clock",t[2].disabled=!0):(t[2].icon=void 0,t[2].disabled=!1),c.dialog("option","buttons",t)},g=function(){var e;switch(ne()('select[name="fontsize"]',c).val(o.fontSize),c.find(".showentities").prop("checked",o.showEntities),c.find(".showtags").prop("checked",o.showTags),o.mode){case n.XMLRDF:e="xmlrdf",o.allowOverlap&&(e="xmlrdfoverlap");break;case n.XML:e="xml";break;case n.RDF:e="rdf"}ne()('select[name="editormode"]',c).val(e),ne()('select[name="annotations"]',c).val(o.annotationMode)},f=function(){c.find(".settingsDialogAdvanced").hide(),c.dialog("option","height",260)};return n.isReadOnly&&f(),{getSettings:function(){return i},hideAdvanced:f,destroy:function(){c.dialog("destroy")}}},se=n(1),le=n(225),ce=n(226),de=n(228),ue=n(255),pe=n(329),ge=n(330),fe=n(331),he=n(30),me=n(334),ve=n(349),ye=n(350);var be=function(e){e=e||{};var t={};if(t.initialConfig=e,t.containerId,void 0!==e.container){t.containerId=e.container,t.editor=null,t.triples=[],t.cwrcRootUrl=e.cwrcRootUrl,null!=t.cwrcRootUrl&&""!=t.cwrcRootUrl||(t.cwrcRootUrl=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname.split("/")[1]+"/",console.info("using default cwrcRootUrl",t.cwrcRootUrl));se('<link type="text/css" rel="stylesheet" href="'+t.cwrcRootUrl+'css/cwrc-writer.css" />').appendTo(document.head);t.currentDocId=null,t.isInitialized=!1,t.isDocLoaded=!1,t.isReadOnly=!1,void 0!==e.readonly&&"boolean"==typeof e.readonly&&(t.isReadOnly=e.readonly),t.isAnnotator=!1,void 0!==e.annotator&&"boolean"==typeof e.annotator&&(t.isAnnotator=e.annotator),t.XMLRDF=0,t.XML=1,t.RDF=2,t.JSON=3,t.mode=t.XMLRDF,void 0!==e.mode&&("xml"===e.mode?t.mode=t.XML:"rdf"===e.mode&&(t.mode=t.RDF)),t.annotationMode=t.JSON,t.allowOverlap=!1,void 0!==e.allowOverlap&&"boolean"==typeof e.allowOverlap&&(t.allowOverlap=e.allowOverlap),t.allowOverlap&&t.mode===t.XML&&(t.allowOverlap=!1,console&&console.warn("Mode set to XML and overlap allowed. Disabling overlap since XML doesn't allow it.")),t.getUniqueId=function(e){return tinymce.DOM.uniqueId(e)},t.loadDocumentURL=function(e){t.converter.loadDocumentURL(e)},t.loadDocumentXML=function(e){t.converter.loadDocumentXML(e)},t.showLoadDialog=function(){t.storageDialogs.load(t)},t.showSaveDialog=function(){t.storageDialogs.save(t)},t.getDocumentURI=function(){return t.storageDialogs.getDocumentURI?t.storageDialogs.getDocumentURI():t.filePathInGithub?"https://github.com/"+t.repoName+"/blob/master"+t.filePathInGithub:"https://github.com/placeholder/blob/master/placeholder.xml"},t.getUserInfo=function(){if(t.storageDialogs.getUserInfo){var e=t.storageDialogs.getUserInfo();return{id:e.userUrl,name:e.userName,nick:e.userId}}return{id:"http://id.cwrc.ca/user/placeholder",name:"Placeholder",nick:"plchldr"}},t.showSaveAsDialog=function(){},t.saveAndExit=function(){},t.exit=function(){t.storageDialogs.logOut?t.storageDialogs.logOut():console.warn("writer: no exit/logout method found!")},t.validate=function(e){if(void 0!==e){t.event("documentValidated").subscribe((function n(i){e.call(t,i),t.event("documentValidated").unsubscribe(n)}))}t.event("validationRequested").publish()},t.getDocumentXML=function(e){t.converter.getDocument(!1,e)},t.getDocumentString=function(e){t.converter.getDocument(!0,e)},t.setDocument=function(e){t.converter.setDocument(e)},t.getDocRawContent=function(){return t.editor.getContent({format:"raw"})},t.isEditorReadOnly=function(){return"false"===t.editor.getBody().getAttribute("contenteditable")},t.destroy=function(){console.info("destroying",t.editor.id);try{se(t.editor.getBody()).empty()}catch(e){}window.removeEventListener("beforeunload",n),t.editor.remove(),t.editor.destroy(),t.settings.destroy(),t.utilities.destroy(),t.dialogManager.destroy(),t.layoutManager.destroy(),t.eventManager.destroy(),t.tagMenu.destroy()};var n=function(e){if((!1===t.isReadOnly||!0===t.isAnnotator)&&"localhost"!=window.location.hostname&&tinymce.get(i).isDirty()){var n="You have unsaved changes.";return(e||window.event).returnValue=n,n}};window.addEventListener("beforeunload",n),se(window).on("unload",(function(e){try{t.utilities.getRootTag().remove()}catch(e){}})),null!=e.storageDialogs?t.storageDialogs=e.storageDialogs:alert("Error: you must specify a storage dialogs class in the CWRCWriter config to allow loading and saving documents."),null!=e.entityLookupDialogs?t.entityLookupDialogs=e.entityLookupDialogs:alert("Error: you must specify entity lookups in the CWRCWriter config for full functionality!"),t.eventManager=new le(t),t.event("processingDocument").subscribe((function(){t.triples=[]})),t.event("documentLoaded").subscribe((function(e){t.isDocLoaded=!!e})),t.event("tinymceInitialized").subscribe((function(){t.layoutManager.$outerLayout.options.onresizeall_end=function(){t.layoutManager.$outerLayout.options.onresizeall_end=null,t.layoutManager.$loadingMask.fadeOut(350)},setTimeout((function(){t.layoutManager.resizeAll(),setTimeout((function(){t.isInitialized=!0,t.event("writerInitialized").publish(t)}),350)}),1e3)})),t.utilities=new ce(t);var i=t.getUniqueId("editor_");t.layoutManager=new me(t),t.layoutManager.init({editorId:i,modules:e.modules,container:se("#"+t.containerId)}),t.schemaManager=new de(t,e.schema),t.entitiesManager=new pe(t),t.dialogManager=new ue(t),t.tagger=new ge(t),t.converter=new fe(t),t.annotationsManager=new he(t),t.settings=re(t,{showEntities:!0,showTags:!1}),t.tagMenu=new ve(t);var a=t.layoutManager.getContainer().attr("id");return ye.init({writer:t,editorId:i,layoutContainerId:a,buttons1:e.buttons1,buttons2:e.buttons2,buttons3:e.buttons3}),t}alert("Error: no container supplied for CWRCWriter!")};_.credentials.username="cwrcgeonames",window.Drupal=window.Drupal||{},Q.a.setEntityRoot(Drupal.settings.CWRCWriter.cwrcDialogs.repositoryBaseObjectUrl),Q.a.setSearchRoot(Drupal.settings.CWRCWriter.cwrcDialogs.cwrcApiUrl),Q.a.setProjectLookupConfig({projectLookupUrl:Drupal.settings.CWRCWriter.cwrcDialogs.projectLookupUrl,projectLogoRoot:Drupal.settings.CWRCWriter.cwrcDialogs.projectLogoRoot,cwrcProjectId:Drupal.settings.CWRCWriter.cwrcDialogs.cwrcProjectId}),ee.a.showNoLinkButton(!0),ee.a.showCreateNewButton(!0),ee.a.setEntityCollectionsUrl(window.location.origin+"/islandora/get_entity_collections"),ee.a.showEditButton(!0),ee.a.setEntityFormsRoot(Drupal.settings.CWRCWriter.cwrcDialogs.entityFormsRootUrl),ee.a.setCollectionsRoot(Drupal.settings.CWRCWriter.cwrcDialogs.entityFormsCollectionUrl),ee.a.registerEntitySources({person:(new Map).set("cwrc",Q.a).set("viaf",z).set("wikidata",G).set("getty",D).set("dbpedia",f),place:(new Map).set("cwrc",Q.a).set("geonames",_).set("viaf",z).set("dbpedia",f).set("wikidata",G),organization:(new Map).set("cwrc",Q.a).set("viaf",z).set("wikidata",G).set("dbpedia",f),title:(new Map).set("cwrc",Q.a).set("viaf",z).set("wikidata",G).set("dbpedia",f)}),window.Drupal.CWRCWriterDialogs=ee.a,window.Drupal.CWRCWriter=be}])}));